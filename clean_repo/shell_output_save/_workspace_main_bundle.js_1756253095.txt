useState(null),[n,i]=z.useState(null),[a,o]=z.useState(!0);z.useEffect(()=>{let p=!0;async function h(){var v;try{o(!0);const x=setTimeout(()=>{p&&(console.warn("Auth initialization timeout"),o(!1))},1e4),{data:{user:b},error:y}=await we.auth.getUser();if(!p)return;if(clearTimeout(x),y){(v=y.message)!=null&&v.includes("Auth session missing")||y.name==="AuthSessionMissingError"?console.log("Auth session not yet available, waiting for auth state change..."):console.error("Auth error:",y),o(!1);return}if(r(b),b)try{const{data:j,error:_}=await we.from("admins").select("*").eq("id",b.id).maybeSingle();_?console.error("Admin lookup error:",_):i(j)}catch(j){console.error("Admin query failed:",j)}o(!1)}catch(x){p&&(console.error("Error getting initial session:",x),o(!1))}}h();const{data:{subscription:m}}=we.auth.onAuthStateChange(async(v,x)=>{if(!p)return;console.log("Auth state changed:",v);const b=(x==null?void 0:x.user)||null;if(JSON.stringify(e)!==JSON.stringify(b)){if(r(b),x!=null&&x.user)try{const{data:y,error:j}=await we.from("admins").select("*").eq("id",x.user.id).maybeSingle();j?console.error("Admin lookup in auth change failed:",j):p&&i(y)}catch(y){console.error("Admin lookup in auth change failed:",y)}else i(null);p&&o(!1)}});return()=>{p=!1,m.unsubscribe()}},[]);const d={user:e,admin:n,loading:a,signIn:async(p,h)=>{try{const{error:m}=await we.auth.signInWithPassword({email:p,password:h});return m?{error:m.message}:{}}catch{return{error:"An unexpected error occurred"}}},signOut:async()=>{await we.auth.signOut()}};return f.jsx(pT.Provider,{value:d,children:t})}function mT(t){var e,r,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(r=mT(t[e]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r);return n}function Ke(){for(var t,e,r=0,n="",i=arguments.length;r<i;r++)(t=arguments[r])&&(e=mT(t))&&(n&&(n+=" "),n+=e);return n}const Ix="-",xL=t=>{const e=_L(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=t;return{getClassGroupId:o=>{const l=o.split(Ix);return l[0]===""&&l.length!==1&&l.shift(),vT(l,e)||wL(o)},getConflictingClassGroupIds:(o,l)=>{const c=r[o]||[];return l&&n[o]?[...c,...n[o]]:c}}},vT=(t,e)=>{var o;if(t.length===0)return e.classGroupId;const r=t[0],n=e.nextPart.get(r),i=n?vT(t.slice(1),n):void 0;if(i)return i;if(e.validators.length===0)return;const a=t.join(Ix);return(o=e.validators.find(({validator:l})=>l(a)))==null?void 0:o.classGroupId},vS=/^\[(.+)\]$/,wL=t=>{if(vS.test(t)){const e=vS.exec(t)[1],r=e==null?void 0:e.substring(0,e.indexOf(":"));if(r)return"arbitrary.."+r}},_L=t=>{const{theme:e,prefix:r}=t,n={nextPart:new Map,validators:[]};return SL(Object.entries(t.classGroups),r).forEach(([a,o])=>{X0(o,n,a,e)}),n},X0=(t,e,r,n)=>{t.forEach(i=>{if(typeof i=="string"){const a=i===""?e:gS(e,i);a.classGroupId=r;return}if(typeof i=="function"){if(jL(i)){X0(i(n),e,r,n);return}e.validators.push({validator:i,classGroupId:r});return}Object.entries(i).forEach(([a,o])=>{X0(o,gS(e,a),r,n)})})},gS=(t,e)=>{let r=t;return e.split(Ix).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},jL=t=>t.isThemeGetter,SL=(t,e)=>e?t.map(([r,n])=>{const i=n.map(a=>typeof a=="string"?e+a:typeof a=="object"?Object.fromEntries(Object.entries(a).map(([o,l])=>[e+o,l])):a);return[r,i]}):t,OL=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,r=new Map,n=new Map;const i=(a,o)=>{r.set(a,o),e++,e>t&&(e=0,n=r,r=new Map)};return{get(a){let o=r.get(a);if(o!==void 0)return o;if((o=n.get(a))!==void 0)return i(a,o),o},set(a,o){r.has(a)?r.set(a,o):i(a,o)}}},gT="!",NL=t=>{const{separator:e,experimentalParseClassName:r}=t,n=e.length===1,i=e[0],a=e.length,o=l=>{const c=[];let d=0,p=0,h;for(let y=0;y<l.length;y++){let j=l[y];if(d===0){if(j===i&&(n||l.slice(y,y+a)===e)){c.push(l.slice(p,y)),p=y+a;continue}if(j==="/"){h=y;continue}}j==="["?d++:j==="]"&&d--}const m=c.length===0?l:l.substring(p),v=m.startsWith(gT),x=v?m.substring(1):m,b=h&&h>p?h-p:void 0;return{modifiers:c,hasImportantModifier:v,baseClassName:x,maybePostfixModifierPosition:b}};return r?l=>r({className:l,parseClassName:o}):o},kL=t=>{if(t.length<=1)return t;const e=[];let r=[];return t.forEach(n=>{n[0]==="["?(e.push(...r.sort(),n),r=[]):r.push(n)}),e.push(...r.sort()),e},EL=t=>({cache:OL(t.cacheSize),parseClassName:NL(t),...xL(t)}),AL=/\s+/,PL=(t,e)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:i}=e,a=[],o=t.trim().split(AL);let l="";for(let c=o.length-1;c>=0;c-=1){const d=o[c],{modifiers:p,hasImportantModifier:h,baseClassName:m,maybePostfixModifierPosition:v}=r(d);let x=!!v,b=n(x?m.substring(0,v):m);if(!b){if(!x){l=d+(l.length>0?" "+l:l);continue}if(b=n(m),!b){l=d+(l.length>0?" "+l:l);continue}x=!1}const y=kL(p).join(":"),j=h?y+gT:y,_=j+b;if(a.includes(_))continue;a.push(_);const S=i(b,x);for(let w=0;w<S.length;++w){const O=S[w];a.push(j+O)}l=d+(l.length>0?" "+l:l)}return l};function TL(){let t=0,e,r,n="";for(;t<arguments.length;)(e=arguments[t++])&&(r=yT(e))&&(n&&(n+=" "),n+=r);return n}const yT=t=>{if(typeof t=="string")return t;let e,r="";for(let n=0;n<t.length;n++)t[n]&&(e=yT(t[n]))&&(r&&(r+=" "),r+=e);return r};function CL(t,...e){let r,n,i,a=o;function o(c){const d=e.reduce((p,h)=>h(p),t());return r=EL(d),n=r.cache.get,i=r.cache.set,a=l,l(c)}function l(c){const d=n(c);if(d)return d;const p=PL(c,r);return i(c,p),p}return function(){return a(TL.apply(null,arguments))}}const yt=t=>{const e=r=>r[t]||[];return e.isThemeGetter=!0,e},bT=/^\[(?:([a-z-]+):)?(.+)\]$/i,ML=/^\d+\/\d+$/,IL=new Set(["px","full","screen"]),RL=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,DL=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,LL=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,$L=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,qL=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Fn=t=>Io(t)||IL.has(t)||ML.test(t),Ei=t=>vs(t,"length",KL),Io=t=>!!t&&!Number.isNaN(Number(t)),Em=t=>vs(t,"number",Io),dl=t=>!!t&&Number.isInteger(Number(t)),BL=t=>t.endsWith("%")&&Io(t.slice(0,-1)),Ve=t=>bT.test(t),Ai=t=>RL.test(t),FL=new Set(["length","size","percentage"]),UL=t=>vs(t,FL,xT),zL=t=>vs(t,"position",xT),WL=new Set(["image","url"]),HL=t=>vs(t,WL,YL),VL=t=>vs(t,"",GL),hl=()=>!0,vs=(t,e,r)=>{const n=bT.exec(t);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):r(n[2]):!1},KL=t=>DL.test(t)&&!LL.test(t),xT=()=>!1,GL=t=>$L.test(t),YL=t=>qL.test(t),XL=()=>{const t=yt("colors"),e=yt("spacing"),r=yt("blur"),n=yt("brightness"),i=yt("borderColor"),a=yt("borderRadius"),o=yt("borderSpacing"),l=yt("borderWidth"),c=yt("contrast"),d=yt("grayscale"),p=yt("hueRotate"),h=yt("invert"),m=yt("gap"),v=yt("gradientColorStops"),x=yt("gradientColorStopPositions"),b=yt("inset"),y=yt("margin"),j=yt("opacity"),_=yt("padding"),S=yt("saturate"),w=yt("scale"),O=yt("sepia"),k=yt("skew"),E=yt("space"),C=yt("translate"),I=()=>["auto","contain","none"],P=()=>["auto","hidden","clip","visible","scroll"],A=()=>["auto",Ve,e],T=()=>[Ve,e],L=()=>["",Fn,Ei],$=()=>["auto",Io,Ve],B=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],U=()=>["solid","dashed","dotted","double","none"],V=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],X=()=>["start","end","center","between","around","evenly","stretch"],G=()=>["","0",Ve],F=()=>["auto","avoid","all","avoid-page","page","left","right","column"],R=()=>[Io,Ve];return{cacheSize:500,separator:":",theme:{colors:[hl],spacing:[Fn,Ei],blur:["none","",Ai,Ve],brightness:R(),borderColor:[t],borderRadius:["none","","full",Ai,Ve],borderSpacing:T(),borderWidth:L(),contrast:R(),grayscale:G(),hueRotate:R(),invert:G(),gap:T(),gradientColorStops:[t],gradientColorStopPositions:[BL,Ei],inset:A(),margin:A(),opacity:R(),padding:T(),saturate:R(),scale:R(),sepia:G(),skew:R(),space:T(),translate:T()},classGroups:{aspect:[{aspect:["auto","square","video",Ve]}],container:["container"],columns:[{columns:[Ai]}],"break-after":[{"break-after":F()}],"break-before":[{"break-before":F()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...B(),Ve]}],overflow:[{overflow:P()}],"overflow-x":[{"overflow-x":P()}],"overflow-y":[{"overflow-y":P()}],overscroll:[{overscroll:I()}],"overscroll-x":[{"overscroll-x":I()}],"overscroll-y":[{"overscroll-y":I()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[b]}],"inset-x":[{"inset-x":[b]}],"inset-y":[{"inset-y":[b]}],start:[{start:[b]}],end:[{end:[b]}],top:[{top:[b]}],right:[{right:[b]}],bottom:[{bottom:[b]}],left:[{left:[b]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",dl,Ve]}],basis:[{basis:A()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Ve]}],grow:[{grow:G()}],shrink:[{shrink:G()}],order:[{order:["first","last","none",dl,Ve]}],"grid-cols":[{"grid-cols":[hl]}],"col-start-end":[{col:["auto",{span:["full",dl,Ve]},Ve]}],"col-start":[{"col-start":$()}],"col-end":[{"col-end":$()}],"grid-rows":[{"grid-rows":[hl]}],"row-start-end":[{row:["auto",{span:[dl,Ve]},Ve]}],"row-start":[{"row-start":$()}],"row-end":[{"row-end":$()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Ve]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Ve]}],gap:[{gap:[m]}],"gap-x":[{"gap-x":[m]}],"gap-y":[{"gap-y":[m]}],"justify-content":[{justify:["normal",...X()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...X(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...X(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_]}],px:[{px:[_]}],py:[{py:[_]}],ps:[{ps:[_]}],pe:[{pe:[_]}],pt:[{pt:[_]}],pr:[{pr:[_]}],pb:[{pb:[_]}],pl:[{pl:[_]}],m:[{m:[y]}],mx:[{mx:[y]}],my:[{my:[y]}],ms:[{ms:[y]}],me:[{me:[y]}],mt:[{mt:[y]}],mr:[{mr:[y]}],mb:[{mb:[y]}],ml:[{ml:[y]}],"space-x":[{"space-x":[E]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[E]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Ve,e]}],"min-w":[{"min-w":[Ve,e,"min","max","fit"]}],"max-w":[{"max-w":[Ve,e,"none","full","min","max","fit","prose",{screen:[Ai]},Ai]}],h:[{h:[Ve,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Ve,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Ve,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Ve,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Ai,Ei]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Em]}],"font-family":[{font:[hl]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Ve]}],"line-clamp":[{"line-clamp":["none",Io,Em]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Fn,Ve]}],"list-image":[{"list-image":["none",Ve]}],"list-style-type":[{list:["none","disc","decimal",Ve]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[j]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[j]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...U(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Fn,Ei]}],"underline-offset":[{"underline-offset":["auto",Fn,Ve]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:T()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ve]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ve]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[j]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...B(),zL]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",UL]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},HL]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[x]}],"gradient-via-pos":[{via:[x]}],"gradient-to-pos":[{to:[x]}],"gradient-from":[{from:[v]}],"gradient-via":[{via:[v]}],"gradient-to":[{to:[v]}],rounded:[{rounded:[a]}],"rounded-s":[{"rounded-s":[a]}],"rounded-e":[{"rounded-e":[a]}],"rounded-t":[{"rounded-t":[a]}],"rounded-r":[{"rounded-r":[a]}],"rounded-b":[{"rounded-b":[a]}],"rounded-l":[{"rounded-l":[a]}],"rounded-ss":[{"rounded-ss":[a]}],"rounded-se":[{"rounded-se":[a]}],"rounded-ee":[{"rounded-ee":[a]}],"rounded-es":[{"rounded-es":[a]}],"rounded-tl":[{"rounded-tl":[a]}],"rounded-tr":[{"rounded-tr":[a]}],"rounded-br":[{"rounded-br":[a]}],"rounded-bl":[{"rounded-bl":[a]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[j]}],"border-style":[{border:[...U(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[j]}],"divide-style":[{divide:U()}],"border-color":[{border:[i]}],"border-color-x":[{"border-x":[i]}],"border-color-y":[{"border-y":[i]}],"border-color-s":[{"border-s":[i]}],"border-color-e":[{"border-e":[i]}],"border-color-t":[{"border-t":[i]}],"border-color-r":[{"border-r":[i]}],"border-color-b":[{"border-b":[i]}],"border-color-l":[{"border-l":[i]}],"divide-color":[{divide:[i]}],"outline-style":[{outline:["",...U()]}],"outline-offset":[{"outline-offset":[Fn,Ve]}],"outline-w":[{outline:[Fn,Ei]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:L()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[j]}],"ring-offset-w":[{"ring-offset":[Fn,Ei]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Ai,VL]}],"shadow-color":[{shadow:[hl]}],opacity:[{opacity:[j]}],"mix-blend":[{"mix-blend":[...V(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":V()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",Ai,Ve]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[p]}],invert:[{invert:[h]}],saturate:[{saturate:[S]}],sepia:[{sepia:[O]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[p]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[j]}],"backdrop-saturate":[{"backdrop-saturate":[S]}],"backdrop-sepia":[{"backdrop-sepia":[O]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Ve]}],duration:[{duration:R()}],ease:[{ease:["linear","in","out","in-out",Ve]}],delay:[{delay:R()}],animate:[{animate:["none","spin","ping","pulse","bounce",Ve]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[w]}],"scale-x":[{"scale-x":[w]}],"scale-y":[{"scale-y":[w]}],rotate:[{rotate:[dl,Ve]}],"translate-x":[{"translate-x":[C]}],"translate-y":[{"translate-y":[C]}],"skew-x":[{"skew-x":[k]}],"skew-y":[{"skew-y":[k]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Ve]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ve]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":T()}],"scroll-mx":[{"scroll-mx":T()}],"scroll-my":[{"scroll-my":T()}],"scroll-ms":[{"scroll-ms":T()}],"scroll-me":[{"scroll-me":T()}],"scroll-mt":[{"scroll-mt":T()}],"scroll-mr":[{"scroll-mr":T()}],"scroll-mb":[{"scroll-mb":T()}],"scroll-ml":[{"scroll-ml":T()}],"scroll-p":[{"scroll-p":T()}],"scroll-px":[{"scroll-px":T()}],"scroll-py":[{"scroll-py":T()}],"scroll-ps":[{"scroll-ps":T()}],"scroll-pe":[{"scroll-pe":T()}],"scroll-pt":[{"scroll-pt":T()}],"scroll-pr":[{"scroll-pr":T()}],"scroll-pb":[{"scroll-pb":T()}],"scroll-pl":[{"scroll-pl":T()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ve]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[Fn,Ei,Em]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},QL=CL(XL);function JL(...t){return QL(Ke(t))}function Nt({size:t="md",className:e}){const r={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"};return f.jsx("div",{className:JL("animate-spin rounded-full border-2 border-gray-300 border-t-blue-600",r[t],e)})}function lt({children:t,requireAdmin:e=!1}){const{user:r,admin:n,loading
useState({}),[r,n]=z.useState([]),[i,a]=z.useState("all"),[o,l]=z.useState({start:ha(oZ(new Date),"yyyy-MM-dd"),end:ha(new Date,"yyyy-MM-dd")}),[c,d]=z.useState(!0),[p,h]=z.useState(null),[m,v]=z.useState(!1),x=z.useCallback(async()=>{try{const{data:U,error:V}=await we.from("clients").select("id, name, brand_color").order("name");if(V)throw V;n(U||[])}catch(U){console.error("Error fetching clients:",U)}},[]),b=z.useCallback(async(U=!1)=>{try{U?v(!0):d(!0),h(null);const{data:V,error:X}=await we.functions.invoke("analytics-dashboard",{body:{clientId:i,dateRange:{start:ha(_x(new Date(o.start)),"yyyy-MM-dd'T'HH:mm:ss.SSSxxx"),end:ha(oJ(new Date(o.end)),"yyyy-MM-dd'T'HH:mm:ss.SSSxxx")},metrics:["user_activity","recent_activity","content_engagement","agent_usage","summary_stats"]}});if(X)throw new Error(X.message||"Failed to fetch analytics data");e(V||{})}catch(V){h(V instanceof Error?V.message:"Failed to load analytics data"),console.error("Analytics fetch error:",V)}finally{d(!1),v(!1)}},[i,o.start,o.end]);z.useEffect(()=>{x()},[]),z.useEffect(()=>{let U=!0;return(async()=>{U&&await b()})(),()=>{U=!1}},[i,o.start,o.end]);const y=()=>{b(!0)},j=U=>{a(U)},_=(U,V)=>{l(X=>({...X,[U]:V}))},S=[{title:"Total Users",value:((k=t.summaryStats)==null?void 0:k.totalUsers)||0,icon:Lr,color:"bg-blue-500",bgColor:"bg-blue-50",textColor:"text-blue-600"},{title:"Content Items",value:((E=t.summaryStats)==null?void 0:E.totalContent)||0,icon:ko,color:"bg-green-500",bgColor:"bg-green-50",textColor:"text-green-600"},{title:"Recent Activities",value:((C=t.summaryStats)==null?void 0:C.recentActivities)||0,icon:Ef,color:"bg-purple-500",bgColor:"bg-purple-50",textColor:"text-purple-600"},{title:"Active Sessions",value:((I=t.agentUsage)==null?void 0:I.reduce((U,V)=>U+V.conversation_count,0))||0,icon:wr,color:"bg-orange-500",bgColor:"bg-orange-50",textColor:"text-orange-600"}],w=((P=t.contentEngagement)==null?void 0:P.slice(0,8).map(U=>({name:U.content_items.title.substring(0,20)+"...",engagements:U.engagement_count,type:U.content_items.content_type})))||[],O=((A=t.agentUsage)==null?void 0:A.slice(0,6).map((U,V)=>({name:U.content_items.title.substring(0,15)+"...",conversations:U.conversation_count,messages:U.total_messages,fill:OP[V%OP.length]})))||[];return c&&!m?f.jsx(hr,{children:f.jsxs("div",{className:"space-y-8",children:[f.jsx("div",{className:"flex items-center justify-between",children:f.jsxs("div",{children:[f.jsx("div",{className:"h-8 bg-gray-200 rounded w-48 mb-2 animate-pulse"}),f.jsx("div",{className:"h-5 bg-gray-200 rounded w-80 animate-pulse"})]})}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(4)].map((U,V)=>f.jsx(sZ,{},V))}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[f.jsx(Sf,{}),f.jsx(Sf,{}),f.jsx(Sf,{}),f.jsx(Sf,{})]})]})}):f.jsx(hr,{children:f.jsxs("div",{className:"space-y-8",children:[f.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between space-y-4 lg:space-y-0",children:[f.jsxs("div",{children:[f.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Analytics Dashboard"}),f.jsx("p",{className:"mt-2 text-gray-600",children:"Track platform performance and user engagement"})]}),f.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center space-y-3 sm:space-y-0 sm:space-x-4",children:[f.jsxs("div",{className:"relative",children:[f.jsxs("select",{value:i,onChange:U=>j(U.target.value),className:"appearance-none bg-white border border-gray-300 rounded-lg px-4 py-2 pr-8 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[f.jsx("option",{value:"all",children:"All Clients"}),r.map(U=>f.jsx("option",{value:U.id,children:U.name},U.id))]}),f.jsx(Rf,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"})]}),f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx("input",{type:"date",value:o.start,onChange:U=>_("start",U.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),f.jsx("span",{className:"text-gray-500",children:"to"}),f.jsx("input",{type:"date",value:o.end,onChange:U=>_("end",U.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),f.jsxs("button",{onClick:y,disabled:m,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:[f.jsx(d$,{className:`w-4 h-4 mr-2 ${m?"animate-spin":""}`}),"Refresh"]})]})]}),p&&f.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center space-x-3",children:[f.jsx(Rx,{className:"w-5 h-5 text-red-500"}),f.jsx("span",{className:"text-red-700",children:p}),f.jsx("button",{onClick:y,className:"ml-auto text-red-600 hover:text-red-700 font-medium",children:"Try Again"})]}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:S.map(U=>{const V=U.icon;return f.jsx("div",{className:`${U.bgColor} rounded-xl p-6 border border-gray-200`,children:f.jsxs("div",{className:"flex items-center",children:[f.jsx("div",{className:`${U.color} rounded-lg p-3 mr-4`,children:f.jsx(V,{className:"h-6 w-6 text-white"})}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm font-medium text-gray-600",children:U.title}),f.jsx("p",{className:`text-3xl font-bold ${U.textColor}`,children:U.value.toLocaleString()})]})]})},U.title)})}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[f.jsxs("div",{className:"bg-white rounded-xl border border-gray-200",children:[f.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx(v$,{className:"w-5 h-5 text-yellow-500"}),f.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Top Active Users"})]}),f.jsx("span",{className:"text-sm text-gray-500",children:"Last 30 days"})]}),f.jsx("div",{className:"p-6",children:t.userActivity&&t.userActivity.length>0?f.jsx("div",{className:"space-y-4",children:t.userActivity.slice(0,10).map((U,V)=>f.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${V<3?"bg-yellow-100 text-yellow-800":"bg-gray-200 text-gray-600"}`,children:V+1}),f.jsxs("div",{children:[f.jsxs("p",{className:"font-medium text-gray-900",children:[U.first_name," ",U.last_name]}),f.jsx("p",{className:"text-sm text-gray-500",children:U.email})]})]}),f.jsxs("div",{className:"text-right",children:[f.jsx("p",{className:"font-semibold text-gray-900",children:U.activity_count}),f.jsx("p",{className:"text-xs text-gray-500",children:"activities"})]})]},U.user_id))}):f.jsx(Of,{title:"No user activity data",description:"User activity will appear here once users start engaging with the platform",icon:Lr})})]}),f.jsxs("div",{className:"bg-white rounded-xl border border-gray-200",children:[f.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx(Kl,{className:"w-5 h-5 text-blue-500"}),f.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Recent Activity"})]}),f.jsx("span",{className:"text-sm text-gray-500",children:"Live feed"})]}),f.jsx("div",{className:"p-6 max-h-96 overflow-y-auto",children:t.recentActivity&&t.recentActivity.length>0?f.jsx("div",{className:"space-y-4",children:t.recentActivity.slice(0,20).map(U=>f.jsxs("div",{className:"flex items-start space-x-3 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[f.jsx(Ef,{className:"w-4 h-4 text-green-500 mt-1 flex-shrink-0"}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("p",{className:"text-sm text-gray-900",children:[f.jsxs("span",{className:"font-medium",children:[U.users.first_name," ",U.users.last_name]})," ",U.activity_type.replace("_"," "),U.content_items&&f.jsxs("span",{className:"text-gray-600",children:[" ",'"',f.jsx("span",{className:"font-medium",children:U.content_items.title}),'"']})]}),f.jsx("p",{className:"text-xs text-gray-500",children:ha(new Date(U.created_at),"MMM d, h:mm a")})]})]},U.id))}):f.jsx(Of,{title:"No recent activity",description:"User activities will appear here as they happen on your platform",icon:Ef})})]}),f.jsxs("div",{className:"bg-white rounded-xl border border-gray-200",children:[f.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx(If,{className:"w-5 h-5 text-purple-500"}),f.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Content Engagement"})]})}),f.jsx("div",{className:"p-6",children:w.length>0?f.jsx(yb,{width:"100%",height:300,children:f.jsxs(QQ,{data:w,layout:"horizontal",children:[f.jsx(Fw,{strokeDasharray:"3 3"}),f.jsx(ks,{type:"number"}),f.jsx(Es,{dataKey:"name",type:"category",width:120}),f.jsx(Kr,{}),f.jsx($a,{dataKey:"engagements",fill:"#8B5CF6",radius:[0,4,4,0]})]})}):f.jsx(Of,{title:"No engagement data",description:"Content engagement metrics will appear here once users start interacting with your content",icon:If})})]}),f.jsxs("div",{className:"bg-white rounded-xl border border-gray-200",children:[f.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx(f$,{className:"w-5 h-5 text-green-500"}),f.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Agent Usage"})]})}),f.jsx("div",{className:"p-6",children:O.length>0?f.jsxs("div",{className:"flex items-center space-x-8",children:[f.jsx(yb,{width:"70%",height:300,children:f.jsxs(JQ,{children:[f.jsx(si,{data:O,cx:"50%",cy:"50%",outerRadius:100,dataKey:"conversations",children:O.map((U,V)=>f.jsx(eh,{fill:U.fill},`cell-${V}`))}),f.jsx(Kr,{})]})}),f.jsx("div",{className:"space-y-2",children:O.map((U,V)=>f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:U.fill}}),f.jsx("span",{className:"text-sm text-gray-700",children:U.name})]},V))})]}):f.jsx(Of,{title:"No agent usage data",description:"Agent conversation statistics will appear here once users start chatting with AI agents",icon:wr})})]})]}),f.jsxs("div",{className:"bg-white rounded-xl border border-gray-200",children:[f.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx(OT,{className:"w-5 h-5 text-blue-500"}),f.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Platform Overview"})]}),f.jsxs("span",{className:"text-sm text-gray-500",children:[ha(new Date(o.start),"MMM d")," - ",ha(new Date(o.end),"MMM d, yyyy")]})]})}),f.jsx("div",{className:"p-6",children:f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[f.jsxs("div",{className:"text-center",children:[f.jsxs("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:[((((T=t.summaryStats)==null?void 0:T.recentActivities)||0)/Math.max(((L=t.summaryStats)==null?void 0:L.totalUsers)||1,1)*100).toFixed(1),"%"]}),f.jsx("p",{className:"text-gray-600",children:"User Engagement Rate"}),f.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Activities per user in selected period"})]}),f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"text-3xl font-bold text-green-600 mb-2",children:(($=t.contentEngagement)==null?void 0:$.length)||0}),f.jsx("p",{className:"text-gray-600",children:"Active Content Items"}),f.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Content with user interactions"})]}),f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:((B=t.agentUsage)==null?void 0:B.reduce((U,V)=>U+V.total_messages,0))||0}),f.jsx("p",{className:"text-gray-600",children:"Total Messages"}),f.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Messages exchanged with AI agents"})]})]})})]})]})})}const uZ=({isOpen:t,onClose:e,onClientCreated:r,editingClient:n})=>{const i=z.useRef(null),[a,o]=z.useState(!1),[l,c]=z.useState([]),[d,p]=z.useState([]),[h,m]=z.useState({}),[v,x]=z.useState({clientName:(n==null?void 0:n.name)||"",projectName:(n==null?void 0:n.project_name)||"",logoFile:null,logoPreview:(n==null?void 0:n.logo_url)||"",brandColor:(n==null?void 0:n.brand_color)||"#3B82F6",apiKeyId:(n==null?void 0:n.api_key_id)||"",forumEnabled:(n==null?void 0:n.forum_enabled)??!0,startFromTemplate:!1,templateId:"",includeContent:!1});te.useEffect(()=>{t&&!n&&b()},[t]);const b=async()=>{try{const{data:C}=await we.from("api_keys").select("id, name, key_type").eq("status","active").order("name");C&&c(C);const{data:I}=await we.from("clients").select("id, name, project_name").eq("is_template",!0).eq("status","active").order("name");I&&p(I)}catch(C){console.error("Error loading options:",C)}},y=()=>{const C={};return v.clientName.trim()?v.clientName.length<2&&(C.clientName="Client name must be at least 2 characters"):C.clientName="Client name is required",/^#[0-9A-F]{6}$/i.test(v.brandColor)||(C.brandColor="Please enter a valid HEX color code"),!v.apiKeyId&&!v.startFromTemplate&&(C.apiKeyId="Please select an API key"),m(C),Object.keys(C).length===0},j=z.useCallback(C=>{if(C&&C.type.startsWith("image/")){const I=new FileReader;I.onload=P=>{x(A=>{var T;return{...A,logoFile:C,logoPreview:(T=P.target)==null?void 0:T.result}})},I.readAsDataURL(C)}},[]),_=z.useCallback(C=>{C.preventDefault();const I=Array.from(C.dataTransfer.files);I.length>0&&j(I[0])},[j]),S=z.useCallback(C=>{const I=C.target.files;I&&I.length>0&&j(I[0])},[j]),w=async()=>{if(!v.logoFile)return null;try{const C=v.logoFile.name.split(".").pop(),P=`client-logos/${`${Date.now()}-${Math.random().toString(36).substring(2)}.${C}`}`,{error:A}=await we.storage.from("assets").upload(P,v.logoFile);if(A)throw A;const{data:T}=we.storage.from("assets").getPublicUrl(P);return T.publicUrl}catch(C){return console.error("Error uploading logo:",C),null}},O=async C=>{if(C.preventDefault(),!!y()){o(!0);try{let I=v.logoPreview;if(v.logoFile){const T=await w();T&&(I=T)}const P={name:v.clientName.trim(),project_name:v.projectName.trim()||null,logo_url:I,brand_color:v.brandColor,api_key_id:v.apiKeyId||null,forum_enabled:v.forumEnabled,status:"active",is_template:!1};let A;if(n){const{data:T,error:L}=await we.from("clients").update(P).eq("id",n.id).select().single();A={data:T,error:L}}else if(v.startFromTemplate&&v.templateId){const{data:T,error:L}=await we.functions.invoke("clone-client-template",{body:{template_id:v.templateId,client_data:P,include_content:v.includeContent}});A={data:T,error:L}}else{const{data:T,error:L}=await we.from("clients").insert([P]).select().single();A={data:T,error:L}}if(A.error){if(A.error.code==="23505"){m({clientName:"A client with this name already exists"});return}throw A.error}k(),r(),e()}catch(I){console.error("Error saving client:",I)}finally{o(!1)}}},k=()=>{x({clientName:"",projectName:"",logoFile:null,logoPreview:"",brandColor:"#3B82F6",apiKeyId:"",forumEnabled:!0,startFromTemplate:!1,templateId:"",includeContent:!1}),m({})},E=()=>{a||(k(),e())};return t?f.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:f.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[f.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[f.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:n?"Edit Client":"Create New Client"}),f.jsx("button",{onClick:E,disabled:a,className:"text-gray-400 hover:text-gray-600 transition-colors",children:f.jsx(Iu,{size:24})})]}),f.jsxs("form",{onSubmit:O,className:"p-6 space-y-6",children:[!n&&f.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[f.jsxs("label",{className:"flex items-center space-x-3",children:[f.jsx("input",{type:"checkbox",checked:v.startFromTemplate,onChange:C=>x(I=>({...I,startFromTemplate:C.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),f.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Start from Template"})]}),v.startFromTemplate&&f.jsxs("div",{className:"mt-4 space-y-3",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Template"}),f.jsxs("select",{value:v.templateId,onChange:C=>x(I=>({...I,templateId:C.target.value})),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",required:v.startFromTemplate,children:[f.jsx("option",{value:"",children:"Select a template..."}),d.map(C=>f.jsxs("option",{value:C.id,children:[C.name," ",C.project_name&&`(${C.project_name})`]},C.id))]})]}),f.jsxs("label",{className:"flex items-center space-x-3",children:[f.jsx("input",{type:"checkbox",checked:v.includeContent,onChange:C=>x(I=>({...I,includeContent:C.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),f.jsx("span",{className:"text-sm text-gray-600",children:"Include all content (agents, documents, etc.)"})]})]})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Client Name *"}),f.jsx("input",{type:"text",value:v.clientName,onChange:C=>x(I=>({...I,clientName:C.target.value})),className:`w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${h.clientName?"border-red-500":"border-gray-300"}`,placeholder:"Enter client name",required:!0}),h.clientName&&f.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center",children:[f.jsx(Ml,{size:16,className:"mr-1"}),h.clientName]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Project Name"}),f.jsx("input",{type:"text",value:v.projectName,onChange:C=>x(I=>({...I,projectName:C.target.value})),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional project name"})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Client Logo"}),f.jsxs("div",{className:"flex items-center space-x-6",children:[f.jsx("div",{className:"flex-shrink-0",children:v.logoPreview?f.jsx("div",{className:"w-20 h-20 rounded-full overflow-hidden border-2 border-gray-200",children:f.jsx("img",{src:v.logoPreview,alt:"Logo preview",className:"w-full h-full object-cover"})}):f.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-100 border-2 border-gray-200 flex items-center justify-center",children:f.jsx(Df,{size:24,className:"text-gray-400"})})}),f.jsxs("div",{className:"flex-1",children:[f.jsxs("div",{onDrop:_,onDragOver:C=>C.preventDefault(),onClick:()=>{var C;return(C=i.current)==null?void 0:C.click()},className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:border-blue-400 transition-colors",children:[f.jsx(Df,{size:24,className:"mx-auto mb-2 text-gray-400"}),f.jsxs("p",{className:"text-sm text-gray-600",children:["Drag and drop an image, or ",f.jsx("span",{className:"text-blue-600",children:"click to browse"})]}),f.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Recommended: Square image, at least 200x200px"})]}),f.jsx("input",{ref:i,type:"file",accept:"image/*",onChange:S,className:"hidden"})]})]})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Brand Color *"}),f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"w-10 h-10 rounded-md border border-gray-300 cursor-pointer",style:{backgroundColor:v.brandColor},onClick:()=>{const C=document.createElement("input");C.type="color",C.value=v.brandColor,C.onchange=I=>{x(P=>({...P,brandColor:I.target.value}))},C.click()},children:f.jsx(c$,{size:16,className:"text-white m-2"})}),f.jsx("input",{type:"text",value:v.brandColor,onChange:C=>x(I=>({...I,brandColor:C.target.value})),className:`flex-1 border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono ${h.brandColor?"border-red-500":"border-gray-300"}`,placeholder:"#3B82F6",pattern:"^#[0-9A-Fa-f]{6}$"})]}),h.brandColor&&f.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center",children:[f.jsx(Ml,{size:16,className:"mr-1"}),h.brandColor]})]}),f.jsxs("div",{children:[f.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["API Key ",!v.startFromTemplate&&"*"]}),f.jsxs("select",{value:v.apiKeyId,onChange:C=>x(I=>({...I,apiKeyId:C.target.value})),className:`w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${h.apiKeyId?"border-red-500":"border-gray-300"}`,required:!v.startFromTemplate,children:[f.jsx("option",{value:"",children:"Select an API key..."}),l.map(C=>f.jsxs("option",{value:C.id,children:[C.name," (",C.key_type,")"]},C.id))]}),h.apiKeyId&&f.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center",children:[f.jsx(Ml,{size:16,className:"mr-1"}),h.apiKeyId]})]})]}),f.jsx("div",{children:f.jsxs("label",{className:"flex items-center space-x-3",children:[f.jsx("input",{type:"checkbox",checked:v.forumEnabled,onChange:C=>x(I=>({...I,forumEnabled:C.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),f.jsxs("div",{children:[f.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Enable Forum"}),f.jsx("p",{className:"text-xs text-gray-500",children:"Allow users to participate in community discussions"})]})]})}),f.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t",children:[f.jsx("button",{type:"button",onClick:E,disabled:a,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:"Cancel"}),f.jsxs("button",{type:"submit",disabled:a,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 flex items-center space-x-2",children:[a&&f.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),f.jsx("span",{children:n?"Update Client":"Create Client"}),!a&&f.jsx(t$,{size:16})]})]})]})]})}):null},cZ=()=>{const t=zi(),[e,r]=z.useState([]),[n,i]=z.useState(!0),[a,o]=z.useState(""),[l,c]=z.useState("all"),[d,p]=z.useState(!1),[h,m]=z.useState(!1),[v,x]=z.useState(null),[b,y]=z.useState(null);z.useEffect(()=>{j()},[l,d]);const j=async()=>{i(!0);try{let A=we.from("clients").select("*").order("created_at",{ascending:!1});l!=="all"&&(A=A.eq("status",l)),d||(A=A.neq("status","archived"));const{data:T,error:L}=await A;if(L)throw L;r(T||[])}catch(A){console.error("Error loading
useState(null),[i,a]=z.useState(!0),[o,l]=z.useState("settings"),[c,d]=z.useState(!1),[p,h]=z.useState({name:"",project_name:"",brand_color:"",forum_enabled:!0}),[m,v]=z.useState(!1),[x,b]=z.useState([]),[y,j]=z.useState([]),[_,S]=z.useState(""),[w,O]=z.useState("#3B82F6"),[k,E]=z.useState(null),[C,I]=z.useState(null),[P,A]=z.useState(""),[T,L]=z.useState([]),[$,B]=z.useState(""),[U,V]=z.useState("all"),[X,G]=z.useState(!1),[F,R]=z.useState(!1),q=z.useCallback(async()=>{if(t)try{const{data:ae,error:ye}=await we.from("clients").select("*").eq("id",t).single();if(ye)throw ye;if(!ae)throw new Error("Client not found");n(ae),h({name:ae.name,project_name:ae.project_name||"",brand_color:ae.brand_color||"#3B82F6",forum_enabled:ae.forum_enabled}),await H(ae.id)}catch(ae){console.error("Error loading client:",ae),e("/clients")}finally{a(!1)}},[t,e]),H=async ae=>{try{const{data:ye}=await we.from("client_features").select("*").eq("client_id",ae),Te=new Map((ye==null?void 0:ye.map(ue=>[ue.feature_name,ue]))||[]),Ie=T0.map(ue=>{var de,xe;return{id:((de=Te.get(ue.key))==null?void 0:de.id)||"",feature_name:ue.key,enabled:((xe=Te.get(ue.key))==null?void 0:xe.enabled)??!0}});b(Ie)}catch(ye){console.error("Error initializing features:",ye)}},ee=z.useCallback(async()=>{if(t)try{const{data:ae,error:ye}=await we.functions.invoke("manage-user-tags",{body:{client_id:t,action:"list"}});if(ye)throw ye;j(ae||[])}catch(ae){console.error("Error loading
loading users:",ae)}},[t]);z.useEffect(()=>{q()},[q]),z.useEffect(()=>{o==="tags"?ee():o==="users"&&J()},[o,ee,J]);const K=(ae,ye)=>{h(Te=>({...Te,[ae]:ye})),v(!0)},Y=async()=>{if(r){d(!0);try{const{error:ae}=await we.from("clients").update({name:p.name,project_name:p.project_name||null,brand_color:p.brand_color,forum_enabled:p.forum_enabled}).eq("id",r.id);if(ae)throw ae;n(ye=>ye?{...ye,...p}:null),v(!1),alert("Settings saved successfully!")}catch(ae){console.error("Error saving settings:",ae),alert("Error saving settings")}finally{d(!1)}}},re=async ae=>{var Ie;const ye=x[ae],Te=!ye.enabled;try{if(ye.id){const{error:de}=await we.from("client_features").update({enabled:Te}).eq("id",ye.id);if(de)throw de}else{const{data:de,error:xe}=await we.from("client_features").insert({client_id:t,feature_name:ye.feature_name,enabled:Te}).select().single();if(xe)throw xe;b(je=>je.map((me,qe)=>qe===ae?{...me,id:de.id,enabled:Te}:me));return}b(de=>de.map((xe,je)=>je===ae?{...xe,enabled:Te}:xe));const ue=((Ie=T0.find(de=>de.key===ye.feature_name))==null?void 0:Ie.label)||ye.feature_name;alert(`${ue} ${Te?"enabled":"disabled"}`)}catch(ue){console.error("Error toggling feature:",ue),alert("Error updating feature")}},Q=async()=>{if(!(!_.trim()||!t))try{const{data:ae,error:ye}=await we.functions.invoke("manage-user-tags",{body:{client_id:t,action:"create",tag_data:{name:_.trim(),color:w}}});if(ye)throw ye;j(Te=>[...Te,{...ae,user_count:0}]),S(""),O("#3B82F6")}catch(ae){console.error("Error creating tag:",ae),alert("Error creating tag")}},oe=async()=>{if(!(!C||P!==C.name))try{const{error:ae}=await we.functions.invoke("manage-user-tags",{body:{client_id:t,action:"delete",tag_data:{id:C.id}}});if(ae)throw ae;j(ye=>ye.filter(Te=>Te.id!==C.id)),I(null),A(""),J()}catch(ae){console.error("Error deleting tag:",ae),alert("Error deleting tag")}},pe=T.filter(ae=>{var Ie,ue;const ye=((Ie=ae.first_name)==null?void 0:Ie.toLowerCase().includes($.toLowerCase()))||((ue=ae.last_name)==null?void 0:ue.toLowerCase().includes($.toLowerCase()))||ae.email.toLowerCase().includes($.toLowerCase()),Te=U==="all"||ae.tags.some(de=>de.id===U);return ye&&Te}),ce=ae=>new Date(ae).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Oe=()=>{switch(o){case"settings":return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Client Name *"}),f.jsx("input",{type:"text",value:p.name,onChange:ae=>K("name",ae.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter client name"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Project Name"}),f.jsx("input",{type:"text",value:p.project_name,onChange:ae=>K("project_name",ae.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional project name"})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Brand Color"}),f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"w-10 h-10 rounded-md border border-gray-300 cursor-pointer",style:{backgroundColor:p.brand_color},onClick:()=>{const ae=document.createElement("input");ae.type="color",ae.value=p.brand_color,ae.onchange=ye=>{K("brand_color",ye.target.value)},ae.click()}}),f.jsx("input",{type:"text",value:p.brand_color,onChange:ae=>K("brand_color",ae.target.value),className:"flex-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono",placeholder:"#3B82F6"})]})]}),f.jsx("div",{children:f.jsxs("label",{className:"flex items-center space-x-3",children:[f.jsx("input",{type:"checkbox",checked:p.forum_enabled,onChange:ae=>K("forum_enabled",ae.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),f.jsxs("div",{children:[f.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Enable Forum"}),f.jsx("p",{className:"text-xs text-gray-500",children:"Allow users to participate in community discussions"})]})]})}),f.jsx("div",{className:"flex justify-end pt-4 border-t",children:f.jsxs("button",{onClick:Y,disabled:!m||c,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[c&&f.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),f.jsx(Dx,{size:16}),f.jsx("span",{children:"Save Changes"})]})})]});case"features":return f.jsxs("div",{className:"space-y-4",children:[f.jsx("p",{className:"text-gray-600 text-sm mb-6",children:"Control which platform features are available to this client's users."}),T0.map((ae,ye)=>{const Te=x.find(ue=>ue.feature_name===ae.key),Ie=(Te==null?void 0:Te.enabled)??!0;return f.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[f.jsxs("div",{className:"flex-1",children:[f.jsx("h3",{className:"text-sm font-medium text-gray-900",children:ae.label}),f.jsx("p",{className:"text-xs text-gray-500 mt-1",children:ae.description})]}),f.jsxs("button",{onClick:()=>re(ye),className:`flex items-center space-x-2 px-3 py-2 rounded-md transition-colors ${Ie?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[Ie?f.jsx(m$,{size:20}):f.jsx(_S,{size:20}),f.jsx("span",{className:"text-sm font-medium",children:Ie?"Enabled":"Disabled"})]})]},ae.key)})]});case"tags":return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[f.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Create New Tag"}),f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("input",{type:"text",value:_,onChange:ae=>S(ae.target.value),className:"flex-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Tag name"}),f.jsx("div",{className:"w-10 h-10 rounded-md border border-gray-300 cursor-pointer",style:{backgroundColor:w},onClick:()=>{const ae=document.createElement("input");ae.type="color",ae.value=w,ae.onchange=ye=>{O(ye.target.value)},ae.click()}}),f.jsxs("button",{onClick:Q,disabled:!_.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[f.jsx(Qr,{size:16}),f.jsx("span",{children:"Create Tag"})]})]})]}),f.jsx("div",{className:"space-y-3",children:y.length===0?f.jsxs("div",{className:"text-center py-8 text-gray-500",children:[f.jsx(En,{size:48,className:"mx-auto mb-4 text-gray-300"}),f.jsx("p",{children:"No tags created yet"}),f.jsx("p",{className:"text-sm",children:"Create your first tag above"})]}):y.map(ae=>f.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("span",{className:"inline-block px-3 py-1 rounded-full text-white text-sm font-medium",style:{backgroundColor:ae.color},children:ae.name}),f.jsxs("span",{className:"text-sm text-gray-500",children:["(",ae.user_count," users)"]})]}),f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx("button",{onClick:()=>E(ae),className:"text-gray-400 hover:text-blue-600 transition-colors",children:f.jsx(ST,{size:16})}),f.jsx("button",{onClick:()=>I(ae),className:"text-gray-400 hover:text-red-600 transition-colors",children:f.jsx(ys,{size:16})})]})]},ae.id))}),C&&f.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:f.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md",children:[f.jsxs("div",{className:"flex items-center mb-4",children:[f.jsx(Ml,{className:"text-red-500 mr-3",size:24}),f.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete Tag"})]}),f.jsxs("p",{className:"text-gray-600 mb-4",children:['This will permanently delete the tag "',C.name,'" and remove it from all ',C.user_count," assigned users."]}),f.jsxs("div",{className:"mb-4",children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type the tag name to confirm:"}),f.jsx("input",{type:"text",value:P,onChange:ae=>A(ae.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500",placeholder:C.name})]}),f.jsxs("div",{className:"flex justify-end space-x-3",children:[f.jsx("button",{onClick:()=>{I(null),A("")},className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),f.jsx("button",{onClick:oe,disabled:P!==C.name,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Delete Tag"})]})]})})]});case"users":return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[f.jsxs("div",{className:"flex items-center space-x-4",children:[f.jsxs("div",{className:"relative",children:[f.jsx(gs,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),f.jsx("input",{type:"text",value:$,onChange:ae=>B(ae.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Search users..."})]}),f.jsxs("select",{value:U,onChange:ae=>V(ae.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[f.jsx("option",{value:"all",children:"All Tags"}),y.map(ae=>f.jsx("option",{value:ae.id,children:ae.name},ae.id))]})]}),f.jsxs("button",{onClick:()=>G(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center space-x-2",children:[f.jsx(Df,{size:20}),f.jsx("span",{children:"Upload CSV"})]})]}),f.jsx("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:pe.length===0?f.jsxs("div",{className:"text-center py-12",children:[f.jsx(Lr,{size:48,className:"mx-auto mb-4 text-gray-300"}),f.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No users found"}),f.jsx("p",{className:"text-gray-600 mb-4",children:$||U!=="all"?"Try adjusting your search criteria.":"Start by uploading users via CSV or create them manually."}),!$&&U==="all"&&f.jsx("button",{onClick:()=>G(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Upload First Users"})]}):f.jsx("div",{className:"overflow-x-auto",children:f.jsxs("table",{className:"w-full",children:[f.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:f.jsxs("tr",{children:[f.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),f.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tags"}),f.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Active"}),f.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),f.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),f.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:pe.map(ae=>f.jsxs("tr",{className:"hover:bg-gray-50",children:[f.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:f.jsxs("div",{children:[f.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[ae.first_name," ",ae.last_name]}),f.jsx("div",{className:"text-sm text-gray-500",children:ae.email})]})}),f.jsx("td",{className:"px-6 py-4",children:f.jsxs("div",{className:"flex flex-wrap gap-1",children:[ae.tags.map(ye=>f.jsx("span",{className:"inline-block px-2 py-1 text-xs text-white rounded-full",style:{backgroundColor:ye.color},children:ye.name},ye.id)),ae.tags.length===0&&f.jsx("span",{className:"text-sm text-gray-400",children:"No tags"})]})}),f.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ae.last_active?ce(ae.last_active):"Never"}),f.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ce(ae.created_at)}),f.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:f.jsx("button",{onClick:()=>e(`/users/${ae.id}`),className:"text-blue-600 hover:text-blue-800 transition-colors",title:"View Details",children:f.jsx(Bi,{size:16})})})]},ae.id))})]})})})]});default:return null}};return i?f.jsx("div",{className:"flex justify-center items-center min-h-screen",children:f.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):r?f.jsxs("div",{className:"min-h-screen bg-gray-50",children:[f.jsx("div",{className:"bg-white border-b border-gray-200",children:f.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:f.jsx("div",{className:"flex items-center justify-between py-6",children:f.jsxs("div",{className:"flex items-center space-x-4",children:[f.jsx("button",{onClick:()=>e("/clients"),className:"text-gray-400 hover:text-gray-600 transition-colors",children:f.jsx(Hl,{size:24})}),f.jsxs("div",{className:"flex items-center space-x-4",children:[r.logo_url?f.jsx("img",{src:r.logo_url,alt:r.name,className:"w-12 h-12 rounded-full object-cover border border-gray-200"}):f.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold",style:{backgroundColor:r.brand_color},children:r.name.charAt(0).toUpperCase()}),f.jsxs("div",{children:[f.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:r.name}),r.project_name&&f.jsx("p",{className:"text-gray-600",children:r.project_name})]})]})]})})})}),f.jsx("div",{className:"bg-white border-b border-gray-200",children:f.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:f.jsx("nav",{className:"flex space-x-8",children:[{id:"settings",label:"Settings",icon:Lx},{id:"features",label:"Enabled Features",icon:_S},{id:"tags",label:"Tag Management",icon:En},{id:"users",label:"User Management",icon:Lr}].map(ae=>{const ye=ae.icon;return f.jsxs("button",{onClick:()=>l(ae.id),className:`flex items-center space-x-2 px-1 py-4 border-b-2 font-medium text-sm transition-colors ${o===ae.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[f.jsx(ye,{size:18}),f.jsx("span",{children:ae.label})]},ae.id)})})})}),f.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:f.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:Oe()})}),f.jsx(mZ,{isOpen:X,onClose:()=>G(!1),clientId:t,onUploadComplete:()=>{J(),ee()}})]}):f.jsxs("div",{className:"text-center py-12",children:[f.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Client not found"}),f.jsx("button",{onClick:()=>e("/clients"),className:"mt-4 text-blue-600 hover:text-blue-800",children:"Back to Clients"})]})},gZ=()=>{const{userId:t}=ni(),e=zi(),[r,n]=z.useState(null),[i,a]=z.useState(!0),[o,l]=z.useState("overview"),[c,d]=z.useState([]),[p,h]=z.useState([]),[m,v]=z.useState([]),[x,b]=z.useState([]),[y,j]=z.useState
loading conversations:",T)}},E=T=>{if(T.length===0)return 0;let L=0;const $=[...T].sort((B,U)=>new Date(U.date).getTime()-new Date(B.date).getTime());for(const B of $)if(B.activities>0)L++;else break;return L};z.useEffect(()=>{_()},[_]),z.useEffect(()=>{o==="content"?w():o==="courses"?O():o==="conversations"&&k()},[o,t]);const C=T=>new Date(T).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),I=T=>new Date(T).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),P=T=>{switch(T){case"ai_agent":return f.jsx(wr,{size:16,className:"text-blue-500"});case"video":return f.jsx(n$,{size:16,className:"text-red-500"});case"document":return f.jsx(nr,{size:16,className:"text-green-500"});default:return f.jsx(ko,{size:16,className:"text-gray-500"})}},A=()=>{switch(o){case"overview":return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[f.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-blue-600",children:y.totalActivities}),f.jsx("div",{className:"text-sm text-blue-800",children:"Total Activities"})]}),f.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-green-600",children:y.contentCompleted}),f.jsx("div",{className:"text-sm text-green-800",children:"Content Completed"})]}),f.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4 text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-purple-600",children:y.avgScore}),f.jsx("div",{className:"text-sm text-purple-800",children:"Avg Score"})]}),f.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-orange-600",children:y.streakDays}),f.jsx("div",{className:"text-sm text-orange-800",children:"Day Streak"})]}),f.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center",children:[f.jsxs("div",{className:"text-2xl font-bold text-gray-600",children:[y.totalTimeSpent,"m"]}),f.jsx("div",{className:"text-sm text-gray-800",children:"Time Spent"})]})]}),f.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[f.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Activity Score (Last 30 Days)"}),f.jsx("div",{className:"h-64",children:f.jsx(yb,{width:"100%",height:"100%",children:f.jsxs(XQ,{data:c,children:[f.jsx(Fw,{strokeDasharray:"3 3"}),f.jsx(ks,{dataKey:"date",tick:{fontSize:12},tickFormatter:T=>new Date(T).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),f.jsx(Es,{tick:{fontSize:12}}),f.jsx(Kr,{labelFormatter:T=>C(T),formatter:(T,L)=>[T,L==="score"?"Activity Score":"Activities Count"]}),f.jsx(Hu,{type:"monotone",dataKey:"score",stroke:"#3B82F6",strokeWidth:2,dot:{fill:"#3B82F6",strokeWidth:2,r:4}})]})})})]}),f.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[f.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Activity"}),p.slice(0,5).length>0?f.jsx("div",{className:"space-y-3",children:p.slice(0,5).map(T=>f.jsxs("div",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg",children:[P(T.content_item.content_type),f.jsxs("div",{className:"flex-1",children:[f.jsx("div",{className:"text-sm font-medium text-gray-900",children:T.content_item.title}),f.jsxs("div",{className:"text-xs text-gray-500",children:["Completed ",I(T.practiced_at)]})]}),f.jsxs("div",{className:"text-sm font-semibold text-green-600",children:[T.completion_score,"%"]})]},T.id))}):f.jsx("p",{className:"text-gray-500 text-center py-4",children:"No recent activity"})]})]});case"content":return f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Content Mastery Log"}),f.jsxs("div",{className:"text-sm text-gray-500",children:[p.length," items practiced"]})]}),p.length>0?f.jsx("div",{className:"space-y-3",children:p.map(T=>f.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[f.jsxs("div",{className:"flex items-center space-x-4",children:[P(T.content_item.content_type),f.jsxs("div",{children:[f.jsx("div",{className:"font-medium text-gray-900",children:T.content_item.title}),f.jsxs("div",{className:"text-sm text-gray-500",children:["Practiced on ",I(T.practiced_at)]})]})]}),f.jsxs("div",{className:"flex items-center space-x-4",children:[f.jsxs("div",{className:"text-right",children:[f.jsxs("div",{className:"text-lg font-semibold text-green-600",children:[T.completion_score,"%"]}),f.jsx("div",{className:"text-xs text-gray-500",children:"Completion"})]}),T.completion_score>=90&&f.jsx(Yn,{size:20,className:"text-green-500"})]})]},T.id))}):f.jsxs("div",{className:"text-center py-12",children:[f.jsx(ko,{size:48,className:"mx-auto mb-4 text-gray-300"}),f.jsx("p",{className:"text-gray-500",children:"No content practiced yet"})]})]});case"courses":return f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Course Progress"}),f.jsxs("div",{className:"text-sm text-gray-500",children:[m.length," courses enrolled"]})]}),m.length>0?f.jsx("div",{className:"space-y-4",children:m.map(T=>f.jsxs("div",{className:"border border-gray-200 rounded-lg p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h4",{className:"text-lg font-medium text-gray-900",children:T.course_title}),f.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${T.progress_percentage===100?"bg-green-100 text-green-800":T.progress_percentage>=50?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:[T.progress_percentage,"% Complete"]})]}),f.jsxs("div",{className:"mb-4",children:[f.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[f.jsxs("span",{children:[T.lessons_completed," of ",T.total_lessons," lessons"]}),f.jsxs("span",{children:["Last accessed ",C(T.last_accessed)]})]}),f.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:f.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${T.progress_percentage}%`}})})]}),T.progress_percentage===100&&f.jsxs("div",{className:"flex items-center text-green-600",children:[f.jsx(Yn,{size:16,className:"mr-2"}),f.jsx("span",{className:"text-sm font-medium",children:"Course Completed!"})]})]},T.id))}):f.jsxs("div",{className:"text-center py-12",children:[f.jsx(ko,{size:48,className:"mx-auto mb-4 text-gray-300"}),f.jsx("p",{className:"text-gray-500",children:"No courses enrolled yet"})]})]});case"conversations":return f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Conversation History"}),f.jsxs("div",{className:"text-sm text-gray-500",children:[x.length," conversations"]})]}),x.length>0?f.jsx("div",{className:"space-y-3",children:x.map(T=>f.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:[f.jsxs("div",{className:"flex items-center justify-between mb-2",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx(wr,{size:20,className:"text-blue-500"}),f.jsxs("div",{children:[f.jsx("div",{className:"font-medium text-gray-900",children:T.agent_name}),f.jsxs("div",{className:"text-sm text-gray-500",children:[T.message_count," messages"]})]})]}),f.jsxs("div",{className:"text-right",children:[f.jsx("div",{className:"text-sm text-gray-900",children:I(T.started_at)}),f.jsxs("div",{className:"text-xs text-gray-500",children:["Last: ",I(T.last_message_at)]})]})]}),f.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded-md",children:T.summary})]},T.id))}):f.jsxs("div",{className:"text-center py-12",children:[f.jsx(wr,{size:48,className:"mx-auto mb-4 text-gray-300"}),f.jsx("p",{className:"text-gray-500",children:"No conversations yet"})]})]});default:return null}};return i?f.jsx("div",{className:"flex justify-center items-center min-h-screen",children:f.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):r?f.jsxs("div",{className:"min-h-screen bg-gray-50",children:[f.jsx("div",{className:"bg-white border-b border-gray-200",children:f.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:f.jsx("div",{className:"flex items-center justify-between py-6",children:f.jsxs("div",{className:"flex items-center space-x-4",children:[f.jsx("button",{onClick:()=>e(-1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:f.jsx(Hl,{size:24})}),f.jsxs("div",{className:"flex items-center space-x-4",children:[f.jsxs("div",{className:"w-16 h-16 rounded-full flex items-center justify-center text-white text-xl font-semibold",style:{backgroundColor:r.client.brand_color},children:[r.first_name.charAt(0).toUpperCase(),r.last_name.charAt(0).toUpperCase()]}),f.jsxs("div",{children:[f.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[r.first_name," ",r.last_name]}),f.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[f.jsxs("div",{className:"flex items-center space-x-1",children:[f.jsx(u$,{size:16}),f.jsx("span",{children:r.email})]}),f.jsxs("div",{className:"flex items-center space-x-1",children:[f.jsx(Vl,{size:16}),f.jsxs("span",{children:["Joined ",C(r.created_at)]})]}),r.last_active&&f.jsxs("div",{className:"flex items-center space-x-1",children:[f.jsx(Ef,{size:16}),f.jsxs("span",{children:["Active ",C(r.last_active)]})]})]}),f.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[f.jsxs("div",{className:"flex items-center space-x-2",children:[r.client.logo_url?f.jsx("img",{src:r.client.logo_url,alt:r.client.name,className:"w-6 h-6 rounded-full"}):f.jsx("div",{className:"w-6 h-6 rounded-full",style:{backgroundColor:r.client.brand_color}}),f.jsx("span",{className:"text-sm text-gray-700",children:r.client.name})]}),r.tags.length>0&&f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx(En,{size:16,className:"text-gray-400"}),f.jsx("div",{className:"flex flex-wrap gap-1",children:r.tags.map(T=>f.jsx("span",{className:"inline-block px-2 py-1 text-xs text-white rounded-full",style:{backgroundColor:T.color},children:T.name},T.id))})]})]})]})]})]})})})}),f.jsx("div",{className:"bg-white border-b border-gray-200",children:f.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:f.jsx("nav",{className:"flex space-x-8",children:[{id:"overview",label:"Overview",icon:OT},{id:"content",label:"Content Mastery",icon:ko},{id:"courses",label:"Course Progress",icon:Yn},{id:"conversations",label:"Conversation History",icon:wr}].map(T=>{const L=T.icon;return f.jsxs("button",{onClick:()=>l(T.id),className:`flex items-center space-x-2 px-1 py-4 border-b-2 font-medium text-sm transition-colors ${o===T.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[f.jsx(L,{size:18}),f.jsx("span",{children:T.label})]},T.id)})})})}),f.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:f.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:A()})})]}):f.jsxs("div",{className:"text-center py-12",children:[f.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"User not found"}),f.jsx("button",{onClick:()=>e("/clients"),className:"mt-4 text-blue-600 hover:text-blue-800",children:"Back to Clients"})]})},C0=[{type:"articles",label:"Articles",icon:nr,color:"#10B981",description:"Blog posts, tutorials, and written content",count:0},{type:"ai-agents",label:"AI Agents",icon:Sn,color:"#3B82F6",description:"Intelligent AI agents with custom prompts",count:0},{type:"videos",label:"Videos",icon:Gl,color:"#EF4444",description:"Educational videos with transcriptions",count:0},{type:"documents",label:"Documents",icon:nr,color:"#10B981",description:"Rich text documents and guides",count:0},{type:"prompts",label:"Prompts",icon:wr,color:"#8B5CF6",description:"Reusable prompt templates",count:0},{type:"automations",label:"Automations",icon:Fo,color:"#F59E0B",description:"Process automations and workflows",count:0}];function yZ(){const[t,e]=z.useState(C0),[r,n]=z.useState(!0);z.useEffect(()=>{i()},[]);const i=async()=>{try{n(!0);const{count:a}=await we.from("content_articles").select("*",{count:"exact",head:!0}),o=C0.map(l=>{switch(l.type){case"articles":return{...l,count:a||0};default:return l}});e(o)}catch(a){console.error("Error fetching content counts:",a),e(C0)}finally{n(!1)}};return r?f.jsx(hr,{children:f.jsx("div",{className:"flex items-center justify-center h-64",children:f.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):f.jsx(hr,{children:f.jsxs("div",{className:"space-y-8",children:[f.jsx("div",{className:"flex justify-between items-center",children:f.jsxs("div",{children:[f.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Content Management"}),f.jsx("p",{className:"mt-2 text-gray-600",children:"Create and manage content for your AI platform"})]})}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(a=>{const o=a.icon;return f.jsxs(Yr,{to:`/content/${a.type}`,className:"bg-white rounded-xl border border-gray-200 p-6 hover:shadow-md transition-shadow group",children:[f.jsxs("div",{className:"flex items-center space-x-4",children:[f.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform",style:{backgroundColor:a.color+"20"},children:f.jsx(o,{className:"h-6 w-6",style:{color:a.color}})}),f.jsxs("div",{className:"flex-1",children:[f.jsx("h3",{className:"text-lg font-semibold text-gray-900 group-hover:text-blue-600 transition-colors",children:a.label}),f.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.description})]})]}),f.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[f.jsxs("span",{className:"text-sm text-gray-500",children:[a.count," items"]}),f.jsx("div",{className:"flex items-center space-x-2",children:f.jsxs(Yr,{to:`/content/${a.type}/create`,className:"inline-flex items-center px-3 py-1.5 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",onClick:l=>l.stopPropagation(),children:[f.jsx(Qr,{className:"h-4 w-4 mr-1"}),"Create"]})})]})]},a.type)})}),f.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[f.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Quick Actions"}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[f.jsxs("button",{className:"flex items-center space-x-3 p-3 text-left border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[f.jsx(gs,{className:"h-5 w-5 text-gray-400"}),f.jsxs("div",{children:[f.jsx("p",{className:"font-medium text-gray-900",children:"Search Content"}),f.jsx("p",{className:"text-sm text-gray-500",children:"Find existing content"})]})]}),f.jsxs("button",{className:"flex items-center space-x-3 p-3 text-left border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[f.jsx(Fd,{className:"h-5 w-5 text-gray-400"}),f.jsxs("div",{children:[f.jsx("p",{className:"font-medium text-gray-900",children:"Filter by Tags"}),f.jsx("p",{className:"text-sm text-gray-500",children:"Organize content"})]})]}),f.jsxs(Yr,{to:"/content/ai-agents/create",className:"flex items-center space-x-3 p-3 text-left border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[f.jsx(Sn,{className:"h-5 w-5 text-blue-500"}),f.jsxs("div",{children:[f.jsx("p",{className:"font-medium text-gray-900",children:"Quick Agent"}),f.jsx("p",{className:"text-sm text-gray-500",children:"Create new AI agent"})]})]}),f.jsxs(Yr,{to:"/content/articles/create",className:"flex items-center space-x-3 p-3 text-left border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[f.jsx(nr,{className:"h-5 w-5 text-green-500"}),f.jsxs("div",{children:[f.jsx("p",{className:"font-medium text-gray-900",children:"New Article"}),f.jsx("p",{className:"text-sm text-gray-500",children:"Write blog posts and tutorials"})]})]})]})]}),f.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[f.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Recent Activity"}),f.jsxs("div",{className:"text-center py-8",children:[f.jsx(nr,{className:"mx-auto h-12 w-12 text-gray-300"}),f.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No recent activity"}),f.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Content creation and editing activity will appear here"})]})]})]})})}function bZ(){const[t,e]=z.useState([]),[r,n]=z.useState([]),[i,a]=z.useState(!0),[o,l]=z.useState(""),[c,d]=z.useState("all"),[p,h]=z.useState("all"),[m,v]=z.useState
loading:n,_ref:i,className:a,wrapperProps:o}){return te.createElement("section",{style:{...R0.wrapper,width:t,height:e},...o},!r&&te.createElement(gee,null,n),te.createElement("div",{ref:i,style:{...R0.fullWidth,...!r&&R0.hide},className:a}))}var bee=yee,nR=z.memo(bee);function xee(t){z.useEffect(t,[])}var iR=xee;function wee(t,e,r=!0){let n=z.useRef(!0);z.useEffect(n.current||!r?()=>{n.current=!1}:t,e)}var Cr=wee;function Fl(){}function Mo(t,e,r,n){return _ee(t,n)||jee(t,e,r,n)}function _ee(t,e){return t.editor.getModel(aR(t,e))}function jee(t,e,r,n){return t.editor.createModel(e,r,n?aR(t,n):void 0)}function aR(t,e){return t.Uri.parse(e)}function See({original:t,modified:e,language:r,originalLanguage:n,modifiedLanguage:i,originalModelPath:a,modifiedModelPath:o,keepCurrentOriginalModel:l=!1,keepCurrentModifiedModel:c=!1,theme:d="light",loading:p="Loading...",options:h={},height:m="100%",width:v="100%",className:x,wrapperProps:b={},beforeMount:y=Fl,onMount:j=Fl}){let[_,S]=z.useState(!1),[w,O]=z.useState(!0),k=z.useRef(null),E=z.useRef(null),C=z.useRef(null),I=z.useRef(j),P=z.useRef(y),A=z.useRef(!1);iR(()=>{let B=rR.init();return B.then(U=>(E.current=U)&&O(!1)).catch(U=>(U==null?void 0:U.type)!=="cancelation"&&console.error("Monaco initialization: error:",U)),()=>k.current?$():B.cancel()}),Cr(()=>{if(k.current&&E.current){let B=k.current.getOriginalEditor(),U=Mo(E.current,t||"",n||r||"text",a||"");U!==B.getModel()&&B.setModel(U)}},[a],_),Cr(()=>{if(k.current&&E.current){let B=k.current.getModifiedEditor(),U=Mo(E.current,e||"",i||r||"text",o||"");U!==B.getModel()&&B.setModel(U)}},[o],_),Cr(()=>{let B=k.current.getModifiedEditor();B.getOption(E.current.editor.EditorOption.readOnly)?B.setValue(e||""):e!==B.getValue()&&(B.executeEdits("",[{range:B.getModel().getFullModelRange(),text:e||"",forceMoveMarkers:!0}]),B.pushUndoStop())},[e],_),Cr(()=>{var B,U;(U=(B=k.current)==null?void 0:B.getModel())==null||U.original.setValue(t||"")},[t],_),Cr(()=>{let{original:B,modified:U}=k.current.getModel();E.current.editor.setModelLanguage(B,n||r||"text"),E.current.editor.setModelLanguage(U,i||r||"text")},[r,n,i],_),Cr(()=>{var B;(B=E.current)==null||B.editor.setTheme(d)},[d],_),Cr(()=>{var B;(B=k.current)==null||B.updateOptions(h)},[h],_);let T=z.useCallback(()=>{var V;if(!E.current)return;P.current(E.current);let B=Mo(E.current,t||"",n||r||"text",a||""),U=Mo(E.current,e||"",i||r||"text",o||"");(V=k.current)==null||V.setModel({original:B,modified:U})},[r,e,i,t,n,a,o]),L=z.useCallback(()=>{var B;!A.current&&C.current&&(k.current=E.current.editor.createDiffEditor(C.current,{automaticLayout:!0,...h}),T(),(B=E.current)==null||B.editor.setTheme(d),S(!0),A.current=!0)},[h,d,T]);z.useEffect(()=>{_&&I.current(k.current,E.current)},[_]),z.useEffect(()=>{!w&&!_&&L()},[w,_,L]);function $(){var U,V,X,G;let B=(U=k.current)==null?void 0:U.getModel();l||((V=B==null?void 0:B.original)==null||V.dispose()),c||((X=B==null?void 0:B.modified)==null||X.dispose()),(G=k.current)==null||G.dispose()}return te.createElement(nR,{width:v,height:m,isEditorReady:_,loading:p,_ref:C,className:x,wrapperProps:b})}var Oee=See;z.memo(Oee);function Nee(t){let e=z.useRef();return z.useEffect(()=>{e.current=t},[t]),e.current}var kee=Nee,kf=new Map;function Eee({defaultValue:t,defaultLanguage:e,defaultPath:r,value:n,language:i,path:a,theme:o="light",line:l,loading:c="Loading...",options:d={},overrideServices:p={},saveViewState:h=!0,keepCurrentModel:m=!1,width:v="100%",height:x="100%",className:b,wrapperProps:y={},beforeMount:j=Fl,onMount:_=Fl,onChange:S,onValidate:w=Fl}){let[O,k]=z.useState(!1),[E,C]=z.useState(!0),I=z.useRef(null),P=z.useRef(null),A=z.useRef(null),T=z.useRef(_),L=z.useRef(j),$=z.useRef(),B=z.useRef(n),U=kee(a),V=z.useRef(!1),X=z.useRef(!1);iR(()=>{let R=rR.init();return R.then(q=>(I.current=q)&&C(!1)).catch(q=>(q==null?void 0:q.type)!=="cancelation"&&console.error("Monaco initialization: error:",q)),()=>P.current?F():R.cancel()}),Cr(()=>{var q,H,ee,J;let R=Mo(I.current,t||n||"",e||i||"",a||r||"");R!==((q=P.current)==null?void 0:q.getModel())&&(h&&kf.set(U,(H=P.current)==null?void 0:H.saveViewState()),(ee=P.current)==null||ee.setModel(R),h&&((J=P.current)==null||J.restoreViewState(kf.get(a))))},[a],O),Cr(()=>{var R;(R=P.current)==null||R.updateOptions(d)},[d],O),Cr(()=>{!P.current||n===void 0||(P.current.getOption(I.current.editor.EditorOption.readOnly)?P.current.setValue(n):n!==P.current.getValue()&&(X.current=!0,P.current.executeEdits("",[{range:P.current.getModel().getFullModelRange(),text:n,forceMoveMarkers:!0}]),P.current.pushUndoStop(),X.current=!1))},[n],O),Cr(()=>{var q,H;let R=(q=P.current)==null?void 0:q.getModel();R&&i&&((H=I.current)==null||H.editor.setModelLanguage(R,i))},[i],O),Cr(()=>{var R;l!==void 0&&((R=P.current)==null||R.revealLine(l))},[l],O),Cr(()=>{var R;(R=I.current)==null||R.editor.setTheme(o)},[o],O);let G=z.useCallback(()=>{var R;if(!(!A.current||!I.current)&&!V.current){L.current(I.current);let q=a||r,H=Mo(I.current,n||t||"",e||i||"",q||"");P.current=(R=I.current)==null?void 0:R.editor.create(A.current,{model:H,automaticLayout:!0,...d},p),h&&P.current.restoreViewState(kf.get(q)),I.current.editor.setTheme(o),l!==void 0&&P.current.revealLine(l),k(!0),V.current=!0}},[t,e,r,n,i,a,d,p,h,o,l]);z.useEffect(()=>{O&&T.current(P.current,I.current)},[O]),z.useEffect(()=>{!E&&!O&&G()},[E,O,G]),B.current=n,z.useEffect(()=>{var R,q;O&&S&&((R=$.current)==null||R.dispose(),$.current=(q=P.current)==null?void 0:q.onDidChangeModelContent(H=>{X.current||S(P.current.getValue(),H)}))},[O,S]),z.useEffect(()=>{if(O){let R=I.current.editor.onDidChangeMarkers(q=>{var ee;let H=(ee=P.current.getModel())==null?void 0:ee.uri;if(H&&q.find(J=>J.path===H.path)){let J=I.current.editor.getModelMarkers({resource:H});w==null||w(J)}});return()=>{R==null||R.dispose()}}return()=>{}},[O,w]);function F(){var R,q;(R=$.current)==null||R.dispose(),m?h&&kf.set(a,P.current.saveViewState()):(q=P.current.getModel())==null||q.dispose(),P.current.dispose()}return te.createElement(nR,{width:v,height:x,isEditorReady:O,loading:c,_ref:A,className:b,wrapperProps:y})}var Aee=Eee,Pee=z.memo(Aee),Tee=Pee;function MP(){const{id:t}=ni(),e=!!t,[r,n]=z.useState(null),[i,a]=z.useState(""),[o,l]=z.useState(""),[c,d]=z.useState(""),[p,h]=z.useState([]),[m,v]=z.useState(e),[x,b]=z.useState(""),[y,j]=z.useState(null),[_,S]=z.useState(!1),[w,O]=z.useState(null),k=z.useRef(null),[E,C]=z.useState([]),[I,P]=z.useState(!1);z.useEffect(()=>{let F=!0;return e&&t?A():e||F&&v(!1),()=>{F=!1}},[e,t]),z.useEffect(()=>{let F=!0;if(r&&r.id){const q=setTimeout(async()=>{F&&await T()},100);return()=>{clearTimeout(q),F=!1}}},[r==null?void 0:r.id]),z.useEffect(()=>{k.current&&k.current.scrollIntoView({behavior:"smooth"})},[y==null?void 0:y.messages]);const A=async()=>{if(!t){v(!1);return}try{const{data:F,error:R}=await we.from("ai_agents").select("*").eq("content_item_id",t).maybeSingle();if(R){console.error("Error fetching AI agent:",R),v(!1);return}F?(n(F),a(F.system_prompt||""),l(F.agent_name||""),d(F.short_description||""),h(F.test_conversations||[])):(n(null),a(""),l(""),d(""),h([]))}catch(F){console.error("Error fetching AI agent:",F)}finally{v(!1)}},T=async()=>{if(!(!r||!r.id||I)){P(!0);try{const{data:{user:F}}=await we.auth.getUser();if(!F)return;const{data:R,error:q}=await we.functions.invoke("conversation-history",{body:{agentId:r.id,userId:F.id,limit:10}});if(q){console.error("Error fetching conversation history:",q);return}C((R==null?void 0:R.conversations)||[])}catch(F){console.error("Error loading conversation history:",F)}finally{P(!1)}}},L=()=>{const F={id:`conv_${Date.now()}`,messages:[],created_at:new Date().toISOString()};j(F),h([F,...p]),O(null)},$=F=>{j(F),O(null)},B=F=>{const R=p.filter(q=>q.id!==F);h(R),(y==null?void 0:y.id)===F&&j(R[0]||null)},U=async()=>{var q,H,ee;if(!x.trim()||!y||!i.trim())return;S(!0),O(null);const F={role:"user",content:x.trim(),timestamp:new Date().toISOString()},R={...y,messages:[...y.messages,F]};j(R),b("");try{const{data:J,error:K}=await we.functions.invoke("ai-chat",{body:{messages:R.messages,systemPrompt:i,agentId:(r==null?void 0:r.id)||t,conversationId:y.id.startsWith("conv_")?void 0:y.id,userId:(ee=(H=(q=await we.auth.getUser())==null?void 0:q.data)==null?void 0:H.user)==null?void 0:ee.id}});if(K)throw new Error(K.message||"Failed to connect to AI service");if(J!=null&&J.error)throw new Error(J.error.message||"AI service error");const Y={role:"assistant",content:(J==null?void 0:J.message)||"Sorry, I could not generate a response.",timestamp:new Date().toISOString()},re={...R,messages:[...R.messages,Y]};J!=null&&J.conversationId&&y.id.startsWith("conv_")&&(re.id=J.conversationId),j(re),h(Q=>Q.map(oe=>oe.id===y.id||oe.id===re.id?re:oe))}catch(J){console.error("Error testing agent:",J),O(J.message||"Failed to get AI response")}finally{S(!1)}},V=async()=>{try{await navigator.clipboard.writeText(i)}catch(F){console.error("Failed to copy prompt:",F)}},X=async F=>{try{const R={content_item_id:F,system_prompt:i,agent_name:o,short_description:c||null,test_conversations:p};if(r){const{error:q}=await we.from("ai_agents").update({...R,updated_at:new Date().toISOString()}).eq("id",r.id);if(q)throw q}else{const{error:q}=await we.from("ai_agents").insert([R]);if(q)throw q}}catch(R){throw console.error("Error saving agent data:",R),R}},G=F=>{F.key==="Enter"&&!F.shiftKey&&(F.preventDefault(),U())};return m?f.jsx("div",{className:"min-h-screen flex items-center justify-center",children:f.jsxs("div",{className:"text-center",children:[f.jsx(Nt,{size:"lg"}),f.jsx("p",{className:"text-sm text-gray-500 mt-3",children:"Loading AI agent..."})]})}):f.jsx(Ku,{contentType:"ai_agent",isEdit:e,onSaveContent:X,title:"AI Agents",description:"Intelligent AI agents with custom prompts",color:"#3B82F6",icon:Sn,children:f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[f.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[f.jsx(Sn,{className:"h-5 w-5 mr-2 text-blue-500"}),"Agent Configuration"]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{htmlFor:"agentName",className:"block text-sm font-medium text-gray-700 mb-2",children:"Agent Name *"}),f.jsx("input",{type:"text",id:"agentName",value:o,onChange:F=>l(F.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., Customer Support Assistant",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{htmlFor:"shortDescription",className:"block text-sm font-medium text-gray-700 mb-2",children:"Short Description"}),f.jsx("input",{type:"text",id:"shortDescription",value:c,onChange:F=>d(F.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Brief description of agent capabilities"})]})]})]}),f.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[f.jsx(wr,{className:"h-5 w-5 mr-2 text-purple-500"}),"System Prompt"]}),f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsxs("button",{onClick:V,className:"inline-flex items-center px-3 py-1.5 text-xs font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors",children:[f.jsx(Q0,{className:"h-3 w-3 mr-1"}),"Copy"]}),f.jsxs("span",{className:"text-xs text-gray-500",children:[i.length," characters"]})]})]}),f.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:f.jsx(Tee,{height:"400px",defaultLanguage:"markdown",value:i,onChange:F=>a(F||""),theme:"vs-light",options:{minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:14,lineNumbers:"on",wordWrap:"on",automaticLayout:!0,padding:{top:16,bottom:16}}})})]}),f.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[f.jsx("div",{className:"border-b border-gray-200 p-6",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[f.jsx(Fo,{className:"h-5 w-5 mr-2 text-green-500"}),"AI Test Sandbox with History"]}),f.jsx("div",{className:"flex items-center space-x-2",children:f.jsxs("button",{onClick:L,disabled:!i.trim(),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:[f.jsx(wr,{className:"h-3 w-3 mr-1"}),"New Chat"]})})]})}),f.jsxs("div",{className:"flex h-96",children:[f.jsxs("div",{className:"w-80 border-r border-gray-200 bg-gray-50 flex flex-col",children:[f.jsxs("div",{className:"p-4",children:[f.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Active Conversations"}),f.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:p.filter(F=>F.id.startsWith("conv_")).map((F,R)=>f.jsxs("div",{onClick:()=>$(F),className:`p-2 rounded-lg cursor-pointer transition-colors border ${(y==null?void 0:y.id)===F.id?"bg-blue-100 border-blue-200":"bg-white border-gray-200 hover:bg-gray-100"}`,children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["New Chat ",R+1]}),f.jsx("button",{onClick:q=>{q.stopPropagation(),B(F.id)},className:"text-red-500 hover:text-red-700",children:f.jsx(ys,{className:"h-3 w-3"})})]}),f.jsxs("p",{className:"text-xs text-gray-500",children:[F.messages.length," messages"]})]},F.id))})]}),f.jsxs("div",{className:"flex-1 border-t border-gray-200 p-4",children:[f.jsxs("div",{className:"flex items-center justify-between mb-3",children:[f.jsxs("h4",{className:"text-sm font-medium text-gray-700 flex items-center",children:[f.jsx(wS,{className:"h-4 w-4 mr-2"}),"Saved History"]}),f.jsxs("div",{className:"flex items-center space-x-2",children:[I&&f.jsx(Nt,{size:"sm"}),f.jsx("button",{onClick:T,disabled:I||!r,className:"text-xs text-blue-600 hover:text-blue-700 disabled:opacity-50",title:"Refresh conversation history",children:f.jsx(h$,{className:"h-3 w-3"})})]})]}),f.jsxs("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:[E.map(F=>f.jsxs("div",{className:"p-2 rounded-lg border bg-white hover:bg-gray-50 cursor-pointer",children:[f.jsxs("p",{className:"text-sm font-medium text-gray-900 truncate",children:[F.title.substring(0,40),"..."]}),f.jsxs("p",{className:"text-xs text-gray-500 flex items-center mt-1",children:[f.jsx(Kl,{className:"h-3 w-3 mr-1"}),new Date(F.updated_at).toLocaleDateString()]})]},F.id)),E.length===0&&!I&&f.jsxs("div",{className:"text-center py-4",children:[f.jsx(wS,{className:"h-6 w-6 mx-auto text-gray-300 mb-2"}),f.jsx("p",{className:"text-xs text-gray-500",children:"No saved conversations"})]})]})]})]}),f.jsx("div",{className:"flex-1 flex flex-col",children:y?f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[y.messages.length===0?f.jsxs("div",{className:"text-center py-12 text-gray-500",children:[f.jsx(Sn,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),f.jsx("p",{className:"text-sm",children:"Start testing your AI agent"})]}):y.messages.map((F,R)=>f.jsxs("div",{className:`flex items-start space-x-3 ${F.role==="user"?"flex-row-reverse space-x-reverse":""}`,children:[f.jsx("div",{className:`flex-shrink-0 h-8 w-8 rounded-full flex items-center justify-center ${F.role==="user"?"bg-blue-500 text-white":"bg-gray-600 text-white"}`,children:F.role==="user"?f.jsx(NT,{className:"h-4 w-4"}):f.jsx(Sn,{className:"h-4 w-4"})}),f.jsxs("div",{className:`flex-1 ${F.role==="user"?"text-right":"text-left"}`,children:[f.jsx("div",{className:`inline-block max-w-3xl p-3 rounded-lg text-sm ${F.role==="user"?"bg-blue-500 text-white":"bg-gray-100 text-gray-900"}`,children:f.jsx("div",{className:"whitespace-pre-wrap",children:F.content})}),f.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(F.timestamp||F.created_at||new Date).toLocaleTimeString()})]})]},`${y.id}-${R}`)),_&&f.jsxs("div",{className:"flex items-start space-x-3",children:[f.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-gray-600 flex items-center justify-center",children:f.jsx(Sn,{className:"h-4 w-4 text-white"})}),f.jsx("div",{className:"flex-1",children:f.jsxs("div",{className:"inline-block bg-gray-100 p-3 rounded-lg",children:[f.jsx(Nt,{size:"sm"}),f.jsx("span",{className:"text-sm text-gray-600 ml-2",children:"Thinking..."})]})})]}),f.jsx("div",{ref:k})]}),f.jsxs("div",{className:"border-t border-gray-200 p-4",children:[f.jsxs("div",{className:"flex items-end space-x-3",children:[f.jsx("div",{className:"flex-1",children:f.jsx("textarea",{value:x,onChange:F=>b(F.target.value),onKeyPress:G,placeholder:"Type your message...",disabled:!i.trim()||_,className:"w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none disabled:opacity-50",rows:2})}),f.jsx("button",{onClick:U,disabled:!x.trim()||!i.trim()||_,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 transition-colors",children:_?f.jsx(Nt,{size:"sm"}):f.jsx(p$,{className:"h-4 w-4"})})]}),w&&f.jsx("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded-lg",children:f.jsx("p",{className:"text-sm text-red-600",children:w})})]})]}):f.jsx("div",{className:"flex-1 flex items-center justify-center",children:f.jsxs("div",{className:"text-center",children:[f.jsx(Sn,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),f.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Conversation Selected"}),f.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Create a new conversation to start testing"}),f.jsxs("button",{onClick:L,disabled:!i.trim(),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50",children:[f.jsx(Qr,{className:"h-4 w-4 mr-2"}),"Start New Conversation"]})]})})})]})]})]})})}function IP(){const{id:t}=ni(),e=!!t,[r,n]=z.useState(null),[i,a]=z.useState(""),[o,l]=z.useState(""),[c,d]=z.useState(""),[p,h]=z.useState(""),[m,v]=z.useState(e),[x,b]=z.useState(!1),[y,j]=z.useState(null),[_,S]=z.useState
