Suggested solution: ${e.workaround}`),new Error(r)}static createWebSocket(e,r){const n=this.getWebSocketConstructor();return new n(e,r)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const qG="2.15.1",zG=`realtime-js/${qG}`,UG="1.0.0",Wk=1e4,HG=1e3,WG=100;var Xf;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Xf||(Xf={}));var wr;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(wr||(wr={}));var Yi;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Yi||(Yi={}));var Vk;(function(t){t.websocket="websocket"})(Vk||(Vk={}));var wl;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(wl||(wl={}));class VG{constructor(){this.HEADER_LENGTH=1}decode(e,r){return e.constructor===ArrayBuffer?r(this._binaryDecode(e)):r(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const r=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,r,n)}_decodeBroadcast(e,r,n){const i=r.getUint8(1),s=r.getUint8(2);let o=this.HEADER_LENGTH+2;const l=n.decode(e.slice(o,o+i));o=o+i;const c=n.decode(e.slice(o,o+s));o=o+s;const u=JSON.parse(n.decode(e.slice(o,e.byteLength)));return{ref:null,topic:l,event:c,payload:u}}}class vB{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Rt;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Rt||(Rt={}));const tM=(t,e,r={})=>{var n;const i=(n=r.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((s,o)=>(s[o]=KG(o,t,e,i),s),{})},KG=(t,e,r,n)=>{const i=e.find(l=>l.name===t),s=i==null?void 0:i.type,o=r[t];return s&&!n.includes(s)?xB(s,o):Kk(o)},xB=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return JG(e,r)}switch(t){case Rt.bool:return GG(e);case Rt.float4:case Rt.float8:case Rt.int2:case Rt.int4:case Rt.int8:case Rt.numeric:case Rt.oid:return YG(e);case Rt.json:case Rt.jsonb:return XG(e);case Rt.timestamp:return QG(e);case Rt.abstime:case Rt.date:case Rt.daterange:case Rt.int4range:case Rt.int8range:case Rt.money:case Rt.reltime:case Rt.text:case Rt.time:case Rt.timestamptz:case Rt.timetz:case Rt.tsrange:case Rt.tstzrange:return Kk(e);default:return Kk(e)}},Kk=t=>t,GG=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},YG=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},XG=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},JG=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,n=t[r];if(t[0]==="{"&&n==="}"){let s;const o=t.slice(1,r);try{s=JSON.parse("["+o+"]")}catch{s=o?o.split(","):[]}return s.map(l=>xB(e,l))}return t},QG=t=>typeof t=="string"?t.replace(" ","T"):t,bB=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Pw{constructor(e,r,n={},i=Wk){this.channel=e,this.event=r,this.payload=n,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var n;return this._hasReceived(e)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var rM;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(rM||(rM={}));class Jf{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},i=>{const{onJoin:s,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Jf.syncState(this.state,i,s,o),this.pendingDiffs.forEach(c=>{this.state=Jf.syncDiff(this.state,c,s,o)}),this.pendingDiffs=[],l()}),this.channel._on(n.diff,{},i=>{const{onJoin:s,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=Jf.syncDiff(this.state,i,s,o),l())}),this.onJoin((i,s,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:s,newPresences:o})}),this.onLeave((i,s,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:s,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,n,i){const s=this.cloneDeep(e),o=this.transformState(r),l={},c={};return this.map(s,(u,f)=>{o[u]||(c[u]=f)}),this.map(o,(u,f)=>{const d=s[u];if(d){const p=f.map(v=>v.presence_ref),m=d.map(v=>v.presence_ref),x=f.filter(v=>m.indexOf(v.presence_ref)<0),y=d.filter(v=>p.indexOf(v.presence_ref)<0);x.length>0&&(l[u]=x),y.length>0&&(c[u]=y)}else l[u]=f}),this.syncDiff(s,{joins:l,leaves:c},n,i)}static syncDiff(e,r,n,i){const{joins:s,leaves:o}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),i||(i=()=>{}),this.map(s,(l,c)=>{var u;const f=(u=e[l])!==null&&u!==void 0?u:[];if(e[l]=this.cloneDeep(c),f.length>0){const d=e[l].map(m=>m.presence_ref),p=f.filter(m=>d.indexOf(m.presence_ref)<0);e[l].unshift(...p)}n(l,f,c)}),this.map(o,(l,c)=>{let u=e[l];if(!u)return;const f=c.map(d=>d.presence_ref);u=u.filter(d=>f.indexOf(d.presence_ref)<0),e[l]=u,i(l,u,c),u.length===0&&delete e[l]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(n=>r(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,n)=>{const i=e[n];return"metas"in i?r[n]=i.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):r[n]=i,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var nM;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(nM||(nM={}));var Qf;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Qf||(Qf={}));var to;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(to||(to={}));class _O{constructor(e,r={config:{}},n){this.topic=e,this.params=r,this.socket=n,this.bindings={},this.state=wr.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new Pw(this,Yi.join,this.params,this.timeout),this.rejoinTimer=new vB(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=wr.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=wr.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=wr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=wr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=wr.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Yi.reply,{},(i,s)=>{this._trigger(this._replyEventName(s),i)}),this.presence=new Jf(this),this.broadcastEndpointURL=bB(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,r=this.timeout){var n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==wr.closed){const{config:{broadcast:s,presence:o,private:l}}=this.params,c=(i=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(p=>p.filter))!==null&&i!==void 0?i:[],u=!!this.bindings[Qf.PRESENCE]&&this.bindings[Qf.PRESENCE].length>0,f={},d={broadcast:s,presence:Object.assign(Object.assign({},o),{enabled:u}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(f.access_token=this.socket.accessTokenValue),this._onError(p=>e==null?void 0:e(to.CHANNEL_ERROR,p)),this._onClose(()=>e==null?void 0:e(to.CLOSED)),this.updateJoinPayload(Object.assign({config:d},f)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:p})=>{var m;if(this.socket.setAuth(),p===void 0){e==null||e(to.SUBSCRIBED);return}else{const x=this.bindings.postgres_changes,y=(m=x==null?void 0:x.length)!==null&&m!==void 0?m:0,v=[];for(let b=0;b<y;b++){const w=x[b],{filter:{event:N,schema:j,table:k,filter:_}}=w,E=p&&p[b];if(E&&E.event===N&&E.schema===j&&E.table===k&&E.filter===_)v.push(Object.assign(Object.assign({},w),{id:E.id}));else{this.unsubscribe(),this.state=wr.errored,e==null||e(to.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e(to.SUBSCRIBED);return}}).receive("error",p=>{this.state=wr.errored,e==null||e(to.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(to.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,n){return this.state===wr.joined&&e===Qf.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,r,n)}async send(e,r={}){var n,i;if(!this._canPush()&&e.type==="broadcast"){const{event:s,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((i=u.body)===null||i===void 0?void 0:i.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var o,l,c;const u=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&s("ok"),u.receive("ok",()=>s("ok")),u.receive("error",()=>s("error")),u.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=wr.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Yi.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(i=>{n=new Pw(this,Yi.leave,{},e),n.receive("ok",()=>{r(),i("ok")}).receive("timeout",()=>{r(),i("timed out")}).receive("error",()=>{i("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=wr.closed,this.bindings={}}async _fetchWithTimeout(e,r,n){const i=new AbortController,s=setTimeout(()=>i.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:i.signal}));return clearTimeout(s),o}_push(e,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Pw(this,e,r,n);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>WG){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(e,r,n){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,n){var i,s;const o=e.toLocaleLowerCase(),{close:l,error:c,leave:u,join:f}=Yi;if(n&&[l,c,u,f].indexOf(o)>=0&&n!==this._joinRef())return;let p=this._onMessage(o,r,n);if(r&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(m=>{var x,y,v;return((x=m.filter)===null||x===void 0?void 0:x.event)==="*"||((v=(y=m.filter)===null||y===void 0?void 0:y.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===o}).map(m=>m.callback(p,n)):(s=this.bindings[o])===null||s===void 0||s.filter(m=>{var x,y,v,b,w,N;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in m){const j=m.id,k=(x=m.filter)===null||x===void 0?void 0:x.event;return j&&((y=r.ids)===null||y===void 0?void 0:y.includes(j))&&(k==="*"||(k==null?void 0:k.toLocaleLowerCase())===((v=r.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const j=(w=(b=m==null?void 0:m.filter)===null||b===void 0?void 0:b.event)===null||w===void 0?void 0:w.toLocaleLowerCase();return j==="*"||j===((N=r==null?void 0:r.event)===null||N===void 0?void 0:N.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===o}).map(m=>{if(typeof p=="object"&&"ids"in p){const x=p.data,{schema:y,table:v,commit_timestamp:b,type:w,errors:N}=x;p=Object.assign(Object.assign({},{schema:y,table:v,commit_timestamp:b,eventType:w,new:{},old:{},errors:N}),this._getPayloadRecords(x))}m.callback(p,n)})}_isClosed(){return this.state===wr.closed}_isJoined(){return this.state===wr.joined}_isJoining(){return this.state===wr.joining}_isLeaving(){return this.state===wr.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,n){const i=e.toLocaleLowerCase(),s={type:i,filter:r,callback:n};return this.bindings[i]?this.bindings[i].push(s):this.bindings[i]=[s],this}_off(e,r){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(i=>{var s;return!(((s=i.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===n&&_O.isEqual(i.filter,r))})),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const n in e)if(e[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Yi.close,{},e)}_onError(e){this._on(Yi.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=wr.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=tM(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=tM(e.columns,e.old_record)),r}}const iM=()=>{},ug={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},ZG=[1e3,2e3,5e3,1e4],eY=1e4,tY=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class rY{constructor(e,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Wk,this.transport=null,this.heartbeatIntervalMs=ug.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=iM,this.ref=0,this.reconnectTimer=null,this.logger=iM,this.conn=null,this.sendBuffer=[],this.serializer=new VG,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>{let s;return i?s=i:typeof fetch>"u"?s=(...o)=>_p(async()=>{const{default:l}=await Promise.resolve().then(()=>ud);return{default:l}},void 0).then(({default:l})=>l(...o)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):s=fetch,(...o)=>s(...o)},!(!((n=r==null?void 0:r.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${e}/${Vk.websocket}`,this.httpEndpoint=bB(e),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=FG.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const r=e.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:
--

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:UG}))}disconnect(e,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,r??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,n){this.logger(e,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Xf.connecting:return wl.Connecting;case Xf.open:return wl.Open;case Xf.closing:return wl.Closing;default:return wl.Closed}}isConnected(){return this.connectionState()===wl.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,r={config:{}}){const n=`realtime:${e}`,i=this.getChannels().find(s=>s.topic===n);if(i)return i;{const s=new _O(`realtime:${e}`,r,this);return this.channels.push(s),s}}push(e){const{topic:r,event:n,payload:i,ref:s}=e,o=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${r} ${n} (${s})`,i),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(HG,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},ug.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,r=>{r.topic==="phoenix"&&r.event==="phx_reply"&&this.heartbeatCallback(r.payload.status==="ok"?"ok":"error"),r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:i,payload:s,ref:o}=r,l=o?`(${o})`:"",c=s.status||"";this.log("receive",`${c} ${n} ${i} ${l}`.trim(),s),this.channels.filter(u=>u._isMember(n)).forEach(u=>u._trigger(i,s,o)),this._triggerStateCallbacks("message",r)})}_clearTimer(e){var r;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var r;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Yi.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const n=e.match(/\?/)?"&":"?",i=new URLSearchParams(r);return`${e}${n}${i}`}_workerObjectUrl(e){let r;if(e)r=e;else{const n=new Blob([tY],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(e,r=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(e=null){let r;e?r=e:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const i={access_token:r,version:zG};r&&n.updateJoinPayload(i),n.joinedOnce&&n._isJoined()&&n._push(Yi.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${e}`,r)})}_triggerStateCallbacks(e,r){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(r)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new vB(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ug.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var r,n,i,s,o,l,c,u;if(this.transport=(r=e==null?void 0:e.transport)!==null&&r!==void 0?r:null,this.timeout=(n=e==null?void 0:e.timeout)!==null&&n!==void 0?n:Wk,this.heartbeatIntervalMs=(i=e==null?void 0:e.heartbeatIntervalMs)!==null&&i!==void 0?i:ug.HEARTBEAT_INTERVAL,this.worker=(s=e==null?void 0:e.worker)!==null&&s!==void 0?s:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(l=e==null?void 0:e.reconnectAfterMs)!==null&&l!==void 0?l:f=>ZG[f-1]||eY,this.encode=(c=e==null?void 0:e.encode)!==null&&c!==void 0?c:(f,d)=>d(JSON.stringify(f)),this.decode=(u=e==null?void 0:e.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class OO extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function jr(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class nY extends OO{constructor(e,r,n){super(e),this.name="StorageApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Gk extends OO{constructor(e,r){super(e),this.name="StorageUnknownError",this.originalError=r}}var iY=function(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function l(f){try{u(n.next(f))}catch(d){o(d)}}function c(f){try{u(n.throw(f))}catch(d){o(d)}}function u(f){f.done?s(f.value):i(f.value).then(l,c)}u((n=n.apply(t,e||[])).next())})};const wB=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>_p(async()=>{const{default:n}=await Promise.resolve().then(()=>ud);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},sY=()=>iY(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield _p(()=>Promise.resolve().then(()=>ud),void 0)).Response:Response}),Yk=t=>{if(Array.isArray(t))return t.map(r=>Yk(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,n])=>{const i=r.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[i]=Yk(n)}),e},oY=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)};var nc=function(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function l(f){try{u(n.next(f))}catch(d){o(d)}}function c(f){try{u(n.throw(f))}catch(d){o(d)}}function u(f){f.done?s(f.value):i(f.value).then(l,c)}u((n=n.apply(t,e||[])).next())})};const Mw=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),aY=(t,e,r)=>nc(void 0,void 0,void 0,function*(){const n=yield sY();t instanceof n&&!(r!=null&&r.noResolveJson)?t.json().then(i=>{const s=t.status||500,o=(i==null?void 0:i.statusCode)||s+"";e(new nY(Mw(i),s,o))}).catch(i=>{e(new Gk(Mw(i),i))}):e(new Gk(Mw(t),t))}),lY=(t,e,r,n)=>{const i={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!n?i:(oY(n)?(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(n)):i.body=n,e!=null&&e.duplex&&(i.duplex=e.duplex),Object.assign(Object.assign({},i),r))};function Op(t,e,r,n,i,s){return nc(this,void 0,void 0,function*(){return new Promise((o,l)=>{t(r,lY(e,n,i,s)).then(c=>{if(!c.ok)throw c;return n!=null&&n.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>aY(c,l,n))})})}function fy(t,e,r,n){return nc(this,void 0,void 0,function*(){return Op(t,"GET",e,r,n)})}function vs(t,e,r,n,i){return nc(this,void 0,void 0,function*(){return Op(t,"POST",e,n,i,r)})}function Xk(t,e,r,n,i){return nc(this,void 0,void 0,function*(){return Op(t,"PUT",e,n,i,r)})}function cY(t,e,r,n){return nc(this,void 0,void 0,function*(){return Op(t,"HEAD",e,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function jB(t,e,r,n,i){return nc(this,void 0,void 0,function*(){return Op(t,"DELETE",e,n,i,r)})}var hn=function(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function l(f){try{u(n.next(f))}catch(d){o(d)}}function c(f){try{u(n.throw(f))}catch(d){o(d)}}function u(f){f.done?s(f.value):i(f.value).then(l,c)}u((n=n.apply(t,e||[])).next())})};const uY={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},sM={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class dY{constructor(e,r={},n,i){this.url=e,this.headers=r,this.bucketId=n,this.fetch=wB(i)}uploadOrUpdate(e,r,n,i){return hn(this,void 0,void 0,function*(){try{let s;const o=Object.assign(Object.assign({},sM),i);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&n instanceof Blob?(s=new FormData,s.append("cacheControl",o.cacheControl),c&&s.append("metadata",this.encodeMetadata(c)),s.append("",n)):typeof FormData<"u"&&n instanceof FormData?(s=n,s.append("cacheControl",o.cacheControl),c&&s.append("metadata",this.encodeMetadata(c))):(s=n,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),i!=null&&i.headers&&(l=Object.assign(Object.assign({},l),i.headers));const u=this._removeEmptyFolders(r),f=this._getFinalPath(u),d=yield(e=="PUT"?Xk:vs)(this.fetch,`${this.url}/object/${f}`,s,Object.assign({headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:u,id:d.Id,fullPath:d.Key},error:null}}catch(s){if(jr(s))return{data:null,error:s};throw s}})}upload(e,r,n){return hn(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,r,n)})}uploadToSignedUrl(e,r,n,i){return hn(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),o=this._getFinalPath(s),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",r);try{let c;const u=Object.assign({upsert:sM.upsert},i),f=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",u.cacheControl)):(c=n,f["cache-control"]=`max-age=${u.cacheControl}`,f["content-type"]=u.contentType);const d=yield Xk(this.fetch,l.toString(),c,{headers:f});return{data:{path:s,fullPath:d.Key},error:null}}catch(c){if(jr(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,r){return hn(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const i=Object.assign({},this.headers);r!=null&&r.upsert&&(i["x-upsert"]="true");const s=yield vs(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:i}),o=new URL(this.url+s.url),l=o.searchParams.get("token");if(!l)throw new OO("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:l},error:null}}catch(n){if(jr(n))return{data:null,error:n};throw n}})}update(e,r,n){return hn(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,r,n)})}move(e,r,n){return hn(this,void 0,void 0,function*(){try{return{data:yield vs(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(jr(i))return{data:null,error:i};throw i}})}copy(e,r,n){return hn(this,void 0,void 0,function*(){try{return{data:{path:(yield vs(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(jr(i))return{data:null,error:i};throw i}})}createSignedUrl(e,r,n){return hn(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),s=yield vs(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:r},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${o}`)},{data:s,error:null}}catch(i){if(jr(i))return{data:null,error:i};throw i}})}createSignedUrls(e,r,n){return hn(this,void 0,void 0,function*(){try{const i=yield vs(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:e},{headers:this.headers}),s=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:i.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${s}`):null})),error:null}}catch(i){if(jr(i))return{data:null,error:i};throw i}})}download(e,r){return hn(this,void 0,void 0,function*(){const i=typeof(r==null?void 0:r.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((r==null?void 0:r.transform)||{}),o=s?`?${s}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield fy(this.fetch,`${this.url}/${i}/${l}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(jr(l))return{data:null,error:l};throw l}})}info(e){return hn(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{const n=yield fy(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:Yk(n),error:null}}catch(n){if(jr(n))return{data:null,error:n};throw n}})}exists(e){return hn(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{return yield cY(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(jr(n)&&n instanceof Gk){const i=n.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,r){const n=this._getFinalPath(e),i=[],s=r!=null&&r.download?`download=${r.download===!0?"":r.download}`:"";s!==""&&i.push(s);const l=typeof(r==null?void 0:r.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((r==null?void 0:r.transform)||{});c!==""&&i.push(c);let u=i.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${n}${u}`)}}}remove(e){return hn(this,void 0,void 0,function*(){try{return{data:yield jB(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(r){if(jr(r))return{data:null,error:r};throw r}})}list(e,r,n){return hn(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},uY),r),{prefix:e||""});return{data:yield vs(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},n),error:null}}catch(i){if(jr(i))return{data:null,error:i};throw i}})}listV2(e,r){return hn(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield vs(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(jr(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const r=[];return e.width&&r.push(`width=${e.width}`),e.height&&r.push(`height=${e.height}`),e.resize&&r.push(`resize=${e.resize}`),e.format&&r.push(`format=${e.format}`),e.quality&&r.push(`quality=${e.quality}`),r.join("&")}}const fY="2.11.0",hY={"X-Client-Info":`storage-js/${fY}`};var zc=function(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function l(f){try{u(n.next(f))}catch(d){o(d)}}function c(f){try{u(n.throw(f))}catch(d){o(d)}}function u(f){f.done?s(f.value):i(f.value).then(l,c)}u((n=n.apply(t,e||[])).next())})};class pY{constructor(e,r={},n,i){const s=new URL(e);i!=null&&i.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href,this.headers=Object.assign(Object.assign({},hY),r),this.fetch=wB(n)}listBuckets(){return zc(this,void 0,void 0,function*(){try{return{data:yield fy(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(jr(e))return{data:null,error:e};throw e}})}getBucket(e){return zc(this,void 0,void 0,function*(){try{return{data:yield fy(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(r){if(jr(r))return{data:null,error:r};throw r}})}createBucket(e,r={public:!1}){return zc(this,void 0,void 0,function*(){try{return{data:yield vs(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(jr(n))return{data:null,error:n};throw n}})}updateBucket(e,r){return zc(this,void 0,void 0,function*(){try{return{data:yield Xk(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(jr(n))return{data:null,error:n};throw n}})}emptyBucket(e){return zc(this,void 0,void 0,function*(){try{return{data:yield vs(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(jr(r))return{data:null,error:r};throw r}})}deleteBucket(e){return zc(this,void 0,void 0,function*(){try{return{data:yield jB(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(r){if(jr(r))return{data:null,error:r};throw r}})}}class mY extends pY{constructor(e,r={},n,i){super(e,r,n,i)}from(e){return new dY(this.url,this.headers,e,this.fetch)}}const gY="2.56.0";let Df="";typeof Deno<"u"?Df="deno":typeof document<"u"?Df="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Df="react-native":Df="node";const yY={"X-Client-Info":`supabase-js-${Df}/${gY}`},vY={headers:yY},xY={schema:"public"},bY={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},wY={};var jY=function(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function l(f){try{u(n.next(f))}catch(d){o(d)}}function c(f){try{u(n.throw(f))}catch(d){o(d)}}function u(f){f.done?s(f.value):i(f.value).then(l,c)}u((n=n.apply(t,e||[])).next())})};const SY=t=>{let e;return t?e=t:typeof fetch>"u"?e=fB:e=fetch,(...r)=>e(...r)},NY=()=>typeof Headers>"u"?hB:Headers,kY=(t,e,r)=>{const n=SY(r),i=NY();return(s,o)=>jY(void 0,void 0,void 0,function*(){var l;const c=(l=yield e())!==null&&l!==void 0?l:t;let u=new i(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",t),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),n(s,Object.assign(Object.assign({},o),{headers:u}))})};var _Y=function(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function l(f){try{u(n.next(f))}catch(d){o(d)}}function c(f){try{u(n.throw(f))}catch(d){o(d)}}function u(f){f.done?s(f.value):i(f.value).then(l,c)}u((n=n.apply(t,e||[])).next())})};function OY(t){return t.endsWith("/")?t:t+"/"}function EY(t,e){var r,n;const{db:i,auth:s,realtime:o,global:l}=t,{db:c,auth:u,realtime:f,global:d}=e,p={db:Object.assign(Object.assign({},c),i),auth:Object.assign(Object.assign({},u),s),realtime:Object.assign(Object.assign({},f),o),storage:{},global:Object.assign(Object.assign(Object.assign({},d),l),{headers:Object.assign(Object.assign({},(r=d==null?void 0:d.headers)!==null&&r!==void 0?r:{}),(n=l==null?void 0:l.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>_Y(this,void 0,void 0,function*(){return""})};return t.accessToken?p.accessToken=t.accessToken:delete p.accessToken,p}const SB="2.71.1",nu=30*1e3,Jk=3,Rw=Jk*nu,CY="http://localhost:9999",AY="supabase.auth.token",TY={"X-Client-Info":`gotrue-js/${SB}`},Qk="X-Supabase-Api-Version",NB={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},PY=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,MY=10*60*1e3;class EO extends Error{constructor(e,r,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function nt(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class RY extends EO{constructor(e,r,n){super(e,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function IY(t){return nt(t)&&t.name==="AuthApiError"}class kB extends EO{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class Ba extends EO{constructor(e,r,n,i){super(e,n,i),this.name=r,this.status=n}}class na extends Ba{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function DY(t){return nt(t)&&t.name==="AuthSessionMissingError"}class dg extends Ba{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class fg extends Ba{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class hg extends Ba{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function LY(t){return nt(t)&&t.name==="AuthImplicitGrantRedirectError"}class oM extends Ba{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Zk extends Ba{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function Iw(t){return nt(t)&&t.name==="AuthRetryableFetchError"}class aM extends Ba{constructor(e,r,n){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class e_ extends Ba{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const hy="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),lM=` 	
\r=`.split(""),$Y=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<lM.length;e+=1)t[lM[e].charCodeAt(0)]=-2;for(let e=0;e<hy.length;e+=1)t[hy[e].charCodeAt(0)]=e;return t})();function cM(t,e,r){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(hy[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(hy[n]),e.queuedBits-=6}}function _B(t,e,r){const n=$Y[t];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function uM(t){const e=[],r=o=>{e.push(String.fromCodePoint(o))},n={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},s=o=>{qY(o,n,r)};for(let o=0;o<t.length;o+=1)_B(t.charCodeAt(o),i,s);return e.join("")}function BY(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function FY(t,e){for(let r=0;r<t.length;r+=1){let n=t.charCodeAt(r);if(n>55295&&n<=56319){const i=(n-55296)*1024&65535;n=(t.charCodeAt(r+1)-56320&65535|i)+65536,r+=1}BY(n,e)}}function qY(t,e,r){if(e.utf8seq===0){if(t<=127){r(t);return}for(let n=1;n<6;n+=1)if((t>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function zY(t){const e=[],r={queue:0,queuedBits:0},n=i=>{e.push(i)};for(let i=0;i<t.length;i+=1)_B(t.charCodeAt(i),r,n);return new Uint8Array(e)}function UY(t){const e=[];return FY(t,r=>e.push(r)),new Uint8Array(e)}function HY(t){const e=[],r={queue:0,queuedBits:0},n=i=>{e.push(i)};return t.forEach(i=>cM(i,r,n)),cM(null,r,n),e.join("")}function WY(t){return Math.round(Date.now()/1e3)+t}function VY(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const Ki=()=>typeof window<"u"&&typeof document<"u",ll={tested:!1,writable:!1},OB=()=>{if(!Ki())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ll.tested)return ll.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),ll.tested=!0,ll.writable=!0}catch{ll.tested=!0,ll.writable=!1}return ll.writable};function KY(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((i,s)=>{e[s]=i})}catch{}return r.searchParams.forEach((n,i)=>{e[i]=n}),e}const EB=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>_p(async()=>{const{default:n}=await Promise.resolve().then(()=>ud);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},GY=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",iu=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},cl=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Jo=async(t,e)=>{await t.removeItem(e)};class O0{constructor(){this.promise=new O0.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}O0.promiseConstructor=Promise;function Dw(t){const e=t.split(".");if(e.length!==3)throw new e_("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!PY.test(e[n]))throw new e_("JWT not in base64url format");return{header:JSON.parse(uM(e[0])),payload:JSON.parse(uM(e[1])),signature:zY(e[2]),raw:{header:e[0],payload:e[1]}}}async function YY(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function XY(t,e){return new Promise((n,i)=>{(async()=>{for(let s=0;s<1/0;s++)try{const o=await t(s);if(!e(s,null,o)){n(o);return}}catch(o){if(!e(s,o)){i(o);return}}})()})}function JY(t){return("0"+t.toString(16)).substr(-2)}function QY(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let i="";for(let s=0;s<56;s++)i+=r.charAt(Math.floor(Math.random()*n));return i}return crypto.getRandomValues(e),Array.from(e,JY).join("")}async function ZY(t){const r=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",r),i=new Uint8Array(n);return Array.from(i).map(s=>String.fromCharCode(s)).join("")}async function eX(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await ZY(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Uc(t,e,r=!1){const n=QY();let i=n;r&&(i+="/PASSWORD_RECOVERY"),await iu(t,`${e}-code-verifier`,i);const s=await eX(n);return[s,n===s?"plain":"s256"]}const tX=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function rX(t){const e=t.headers.get(Qk);if(!e||!e.match(tX))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function nX(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function iX(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const sX=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Hc(t){if(!sX.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Lw(){const t={};return new Proxy(t,{get:(e,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function dM(t){return JSON.parse(JSON.stringify(t))}var oX=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r};const yl=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),aX=[502,503,504];async function fM(t){var e;if(!GY(t))throw new Zk(yl(t),0);if(aX.includes(t.status))throw new Zk(yl(t),t.status);let r;try{r=await t.json()}catch(s){throw new kB(yl(s),s)}let n;const i=rX(t);if(i&&i.getTime()>=NB["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new aM(yl(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new na}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((s,o)=>s&&typeof o=="string",!0))throw new aM(yl(r),t.status,r.weak_password.reasons);throw new RY(yl(r),t.status||500,n)}const lX=(t,e,r,n)=>{const i={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(n),Object.assign(Object.assign({},i),r))};async function dt(t,e,r,n){var i;const s=Object.assign({},n==null?void 0:n.headers);s[Qk]||(s[Qk]=NB["2024-01-01"].name),n!=null&&n.jwt&&(s.Authorization=`Bearer ${n.jwt}`);const o=(i=n==null?void 0:n.query)!==null&&i!==void 0?i:{};n!=null&&n.redirectTo&&(o.redirect_to=n.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await cX(t,e,r+l,{headers:s,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(c):{data:Object.assign({},c),error:null}}async function cX(t,e,r,n,i,s){const o=lX(e,n,i,s);let l;try{l=await t(r,Object.assign({},o))}catch(c){throw console.error(c),new Zk(yl(c),0)}if(l.ok||await fM(l),n!=null&&n.noResolveJson)return l;try{return await l.json()}catch(c){await fM(c)}}function Zs(t){var e;let r=null;hX(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=WY(t.expires_in)));const n=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:n},error:null}}function hM(t){const e=Zs(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(e.data.weak_password=t.weak_password),e}function fa(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function uX(t){return{data:t,error:null}}function dX(t){const{action_link:e,email_otp:r,hashed_token:n,redirect_to:i,verification_type:s}=t,o=oX(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:r,hashed_token:n,redirect_to:i,verification_type:s},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function fX(t){return t}function hX(t){return t.access_token&&t.refresh_token&&t.expires_in}const $w=["global","local","others"];var pX=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r};class mX{constructor({url:e="",headers:r={},fetch:n}){this.url=e,this.headers=r,this.fetch=EB(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,r=$w[0]){if($w.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${$w.join(", ")}`);try{return await dt(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(nt(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,r={}){try{return await dt(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:fa})}catch(n){if(nt(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:r}=e,n=pX(e,["options"]),i=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(i.new_email=n==null?void 0:n.newEmail,delete i.newEmail),await dt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:dX,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(nt(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await dt(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:fa})}catch(r){if(nt(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,n,i,s,o,l,c;try{const u={nextPage:null,lastPage:0,total:0},f=await dt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=e==null?void 0:e.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(s=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""},xform:fX});if(f.error)throw f.error;const d=await f.json(),p=(o=f.headers.get("x-total-count"))!==null&&o!==void 0?o:0,m=(c=(l=f.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(x=>{const y=parseInt(x.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(x.split(";")[1].split("=")[1]);u[`${v}Page`]=y}),u.total=parseInt(p)),{data:Object.assign(Object.assign({},d),u),error:null}}catch(u){if(nt(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){Hc(e);try{return await dt(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:fa})}catch(r){if(nt(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){Hc(e);try{return await dt(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:fa})}catch(n){if(nt(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,r=!1){Hc(e);try{return await dt(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:fa})}catch(n){if(nt(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){Hc(e.userId);try{const{data:r,error:n}=await dt(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:r,error:n}}catch(r){if(nt(r))return{data:null,error:r};throw r}}async _deleteFactor(e){Hc(e.userId),Hc(e.id);try{return{data:await dt(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if(nt(r))return{data:null,error:r};throw r}}}function pM(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}function gX(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Wc={debug:!!(globalThis&&OB()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class CB extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class yX extends CB{}async function vX(t,e,r){Wc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Wc.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async i=>{if(i){Wc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,i.name);try{return await r()}finally{Wc.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,i.name)}}else{if(e===0)throw Wc.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new yX(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Wc.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}gX();const xX={url:CY,storageKey:AY,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:TY,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function mM(t,e,r){return await r()}const Vc={};class wh{constructor(e){var r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=wh.nextInstanceID,wh.nextInstanceID+=1,this.instanceID>0&&Ki()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},xX),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new mX({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=EB(i.fetch),this.lock=i.lock||mM,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:Ki()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=vX:this.lock=mM,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:OB()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=pM(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=pM(this.memoryStorage)),Ki()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}get jwks(){var e,r;return(r=(e=Vc[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(e){Vc[this.storageKey]=Object.assign(Object.assign({},Vc[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,r;return(r=(e=Vc[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Vc[this.storageKey]=Object.assign(Object.assign({},Vc[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${SB}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const r=KY(window.location.href);let n="none";if(this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce"),Ki()&&this.detectSessionInUrl&&n!=="none"){const{data:i,error:s}=await this._getSessionFromURL(r,n);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),LY(s)){const c=(e=s.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}const{session:o,redirectType:l}=i;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return nt(r)?{error:r}:{error:new kB("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,n,i;try{const s=await dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=e==null?void 0:e.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:Zs}),{data:o,error:l}=s;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(nt(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var r,n,i;try{let s;if("email"in e){const{email:f,password:d,options:p}=e;let m=null,x=null;this.flowType==="pkce"&&([m,x]=await Uc(this.storage,this.storageKey)),s=await dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p==null?void 0:p.emailRedirectTo,body:{email:f,password:d,data:(r=p==null?void 0:p.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:m,code_challenge_method:x},xform:Zs})}else if("phone"in e){const{phone:f,password:d,options:p}=e;s=await dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:f,password:d,data:(n=p==null?void 0:p.data)!==null&&n!==void 0?n:{},channel:(i=p==null?void 0:p.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken}},xform:Zs})}else throw new fg("You must provide either an email or phone number and a password");const{data:o,error:l}=s;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(nt(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let r;if("email"in e){const{email:s,password:o,options:l}=e;r=await dt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:hM})}else if("phone"in e){const{phone:s,password:o,options:l}=e;r=await dt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:hM})}else throw new fg("You must provide either an email or phone number and a password");const{data:n,error:i}=r;return i?{data:{user:null,session:null},error:i}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new dg}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:i})}catch(r){if(nt(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(e){var r,n,i,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;if(r==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}async signInWithSolana(e){var r,n,i,s,o,l,c,u,f,d,p,m;let x,y;if("message"in e)x=e.message,y=e.signature;else{const{chain:v,wallet:b,statement:w,options:N}=e;let j;if(Ki())if(typeof b=="object")j=b;else{const _=window;if("solana"in _&&typeof _.solana=="object"&&("signIn"in _.solana&&typeof _.solana.signIn=="function"||"signMessage"in _.solana&&typeof _.solana.signMessage=="function"))j=_.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!(N!=null&&N.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");j=b}const k=new URL((r=N==null?void 0:N.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in j&&j.signIn){const _=await j.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},N==null?void 0:N.signInWithSolana),{version:"1",domain:k.host,uri:k.href}),w?{statement:w}:null));let E;if(Array.isArray(_)&&_[0]&&typeof _[0]=="object")E=_[0];else if(_&&typeof _=="object"&&"signedMessage"in _&&"signature"in _)E=_;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in E&&"signature"in E&&(typeof E.signedMessage=="string"||E.signedMessage instanceof Uint8Array)&&E.signature instanceof Uint8Array)x=typeof E.signedMessage=="string"?E.signedMessage:new TextDecoder().decode(E.signedMessage),y=E.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in j)||typeof j.signMessage!="function"||!("publicKey"in j)||typeof j!="object"||!j.publicKey||!("toBase58"in j.publicKey)||typeof j.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");x=[`${k.host} wants you to sign in with your Solana account:`,j.publicKey.toBase58(),...w?["",w,""]:[""],"Version: 1",`URI: ${k.href}`,`Issued At: ${(i=(n=N==null?void 0:N.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((s=N==null?void 0:N.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${N.signInWithSolana.notBefore}`]:[],...!((o=N==null?void 0:N.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${N.signInWithSolana.expirationTime}`]:[],...!((l=N==null?void 0:N.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${N.signInWithSolana.chainId}`]:[],...!((c=N==null?void 0:N.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${N.signInWithSolana.nonce}`]:[],...!((u=N==null?void 0:N.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${N.signInWithSolana.requestId}`]:[],...!((d=(f=N==null?void 0:N.signInWithSolana)===null||f===void 0?void 0:f.resources)===null||d===void 0)&&d.length?["Resources",...N.signInWithSolana.resources.map(E=>`- ${E}`)]:[]].join(`
`);const _=await j.signMessage(new TextEncoder().encode(x),"utf8");if(!_||!(_ instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=_}}try{const{data:v,error:b}=await dt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:x,signature:HY(y)},!((p=e.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(m=e.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:Zs});if(b)throw b;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new dg}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:b})}catch(v){if(nt(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const r=await cl(this.storage,`${this.storageKey}-code-verifier`),[n,i]=(r??"").split("/");try{const{data:s,error:o}=await dt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Zs});if(await Jo(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new dg}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:i??null}),error:o})}catch(s){if(nt(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{const{options:r,provider:n,token:i,access_token:s,nonce:o}=e,l=await dt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:i,access_token:s,nonce:o,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:Zs}),{data:c,error:u}=l;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new dg}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(r){if(nt(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(e){var r,n,i,s,o;try{if("email"in e){const{email:l,options:c}=e;let u=null,f=null;this.flowType==="pkce"&&([u,f]=await Uc(this.storage,this.storageKey));const{error:d}=await dt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(r=c==null?void 0:c.data)!==null&&r!==void 0?r:{},create_user:(n=c==null?void 0:c.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:u,code_challenge_method:f},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:l,options:c}=e,{data:u,error:f}=await dt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(i=c==null?void 0:c.data)!==null&&i!==void 0?i:{},create_user:(s=c==null?void 0:c.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:f}}throw new fg("You must provide either an email or phone number.")}catch(l){if(nt(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var r,n;try{let i,s;"options"in e&&(i=(r=e.options)===null||r===void 0?void 0:r.redirectTo,s=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:l}=await dt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:i,xform:Zs});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,u=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(nt(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var r,n,i;try{let s=null,o=null;return this.flowType==="pkce"&&([s,o]=await Uc(this.storage,this.storageKey)),await dt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:o}),headers:this.headers,xform:uX})}catch(s){if(nt(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:n}=e;if(n)throw n;if(!r)throw new na;const{error:i}=await dt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(nt(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:n,type:i,options:s}=e,{error:o}=await dt(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:i,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},redirectTo:s==null?void 0:s.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:n,type:i,options:s}=e,{data:o,error:l}=await dt(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:i,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l}}throw new fg("You must provide either an email or phone number and a type")}catch(r){if(nt(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await cl(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Rw:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const o=await cl(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=Lw()}if(this.storage.isServer&&e.user){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,f)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,f))})}return{data:{session:e},error:null}}const{session:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await dt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:fa}):await this._useSession(async r=>{var n,i,s;const{data:o,error:l}=r;if(l)throw l;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new na}:await dt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&s!==void 0?s:void 0,xform:fa})})}catch(r){if(nt(r))return DY(r)&&(await this._removeSession(),await Jo(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async n=>{const{data:i,error:s}=n;if(s)throw s;if(!i.session)throw new na;const o=i.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await Uc(this.storage,this.storageKey));const{data:u,error:f}=await dt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:fa});if(f)throw f;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(n){if(nt(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new na;const r=Date.now()/1e3;let n=r,i=!0,s=null;const{payload:o}=Dw(e.access_token);if(o.exp&&(n=o.exp,i=n<=r),i){const{session:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};s=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;s={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(r){if(nt(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var n;if(!e){const{data:o,error:l}=r;if(l)throw l;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new na;const{session:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(nt(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(e,r){try{if(!Ki())throw new hg("No browser detected.");if(e.error||e.error_description||e.error_code)throw new hg(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new oM("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new hg("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new oM("No code detected.");const{data:w,error:N}=await this._exchangeCodeForSession(e.code);if(N)throw N;const j=new URL(window.location.href);return j.searchParams.delete("code"),window.history.replaceState(window.history.state,"",j.toString()),{data:{session:w.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:i,access_token:s,refresh_token:o,expires_in:l,expires_at:c,token_type:u}=e;if(!s||!l||!o||!u)throw new hg("No session defined in URL");const f=Math.round(Date.now()/1e3),d=parseInt(l);let p=f+d;c&&(p=parseInt(c));const m=p-f;m*1e3<=nu&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${d}s`);const x=p-d;f-x>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",x,p,f):f-x<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",x,p,f);const{data:y,error:v}=await this._getUser(s);if(v)throw v;const b={provider_token:n,provider_refresh_token:i,access_token:s,expires_in:d,expires_at:p,refresh_token:o,token_type:u,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:b,redirectType:e.type},error:null}}catch(n){if(nt(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await cl(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:i,error:s}=r;if(s)return{error:s};const o=(n=i.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(IY(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await Jo(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const r=VY(),n={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async r=>{var n,i;try{const{data:{session:s},error:o}=r;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,r={}){let n=null,i=null;this.flowType==="pkce"&&([n,i]=await Uc(this.storage,this.storageKey,!0));try{return await dt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:i,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(s){if(nt(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(r){if(nt(r))return{data:null,error:r};throw r}}async linkIdentity(e){var r;try{const{data:n,error:i}=await this._useSession(async s=>{var o,l,c,u,f;const{data:d,error:p}=s;if(p)throw p;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await dt(this.fetch,"GET",m,{headers:this.headers,jwt:(f=(u=d.session)===null||u===void 0?void 0:u.access_token)!==null&&f!==void 0?f:void 0})});if(i)throw i;return Ki()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:e.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(nt(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async r=>{var n,i;const{data:s,error:o}=r;if(o)throw o;return await dt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(n=s.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0})})}catch(r){if(nt(r))return{data:null,error:r};throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await XY(async i=>(i>0&&await YY(200*Math.pow(2,i-1)),this._debug(r,"refreshing attempt",i),await dt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Zs})),(i,s)=>{const o=200*Math.pow(2,i);return s&&Iw(s)&&Date.now()+o-n<nu})}catch(n){if(this._debug(r,"error",n),nt(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",n),Ki()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const i=await cl(this.storage,this.storageKey);if(i&&this.userStorage){let o=await cl(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:i.user},await iu(this.userStorage,this.storageKey+"-user",o)),i.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:Lw()}else if(i&&!i.user&&!i.user){const o=await cl(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(i.user=o.user,await Jo(this.storage,this.storageKey+"-user"),await iu(this.storage,this.storageKey,i)):i.user=Lw()}if(this._debug(n,"session from storage",i),!this._isValidSession(i)){this._debug(n,"session is not valid"),i!==null&&await this._removeSession();return}const s=((r=i.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<Rw;if(this._debug(n,`session has${s?"":" not"} expired with margin of ${Rw}s`),s){if(this.autoRefreshToken&&i.refresh_token){const{error:o}=await this._callRefreshToken(i.refresh_token);o&&(console.error(o),Iw(o)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(i.access_token);!l&&(o!=null&&o.user)?(i.user=o.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(n,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(n,"error",i),console.error(i);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var r,n;if(!e)throw new na;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new O0;const{data:s,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!s.session)throw new na;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const l={session:s.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(s){if(this._debug(i,"error",s),nt(s)){const o={session:null,error:s};return Iw(s)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(s),s}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,r,n=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:r});const s=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,r)}catch(c){s.push(c)}});if(await Promise.all(o),s.length>0){for(let l=0;l<s.length;l+=1)console.error(s[l]);throw s[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const r=Object.assign({},e),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await iu(this.userStorage,this.storageKey+"-user",{user:r.user});const i=Object.assign({},r);delete i.user;const s=dM(i);await iu(this.storage,this.storageKey,s)}else{const i=dM(r);await iu(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await Jo(this.storage,this.storageKey),await Jo(this.storage,this.storageKey+"-code-verifier"),await Jo(this.storage,this.storageKey+"-user"),this.userStorage&&await Jo(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ki()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),nu);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((n.expires_at*1e3-e)/nu);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${nu}ms, refresh threshold is ${Jk} ticks`),i<=Jk&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof CB)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ki()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,n){const i=[`provider=${encodeURIComponent(r)}`];if(n!=null&&n.redirectTo&&i.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&i.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[s,o]=await Uc(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(l.toString())}if(n!=null&&n.queryParams){const s=new URLSearchParams(n.queryParams);i.push(s.toString())}return n!=null&&n.skipBrowserRedirect&&i.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var n;const{data:i,error:s}=r;return s?{data:null,error:s}:await dt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(nt(r))return{data:null,error:r};throw r}}async _enroll(e){try{return await this._useSession(async r=>{var n,i;const{data:s,error:o}=r;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:u}=await dt(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((i=c==null?void 0:c.totp)===null||i===void 0)&&i.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(r){if(nt(r))return{data:null,error:r};throw r}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:i,error:s}=r;if(s)return{data:null,error:s};const{data:o,error:l}=await dt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:l})})}catch(r){if(nt(r))return{data:null,error:r};throw r}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:i,error:s}=r;return s?{data:null,error:s}:await dt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(nt(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(e){const{data:r,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){const{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};const n=(e==null?void 0:e.factors)||[],i=n.filter(o=>o.factor_type==="totp"&&o.status==="verified"),s=n.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:n,totp:i,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var r,n;const{data:{session:i},error:s}=e;if(s)return{data:null,error:s};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Dw(i.access_token);let l=null;o.aal&&(l=o.aal);let c=l;((n=(r=i.user.factors)===null||r===void 0?void 0:r.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(c="aal2");const f=o.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:f},error:null}}))}async fetchJwk(e,r={keys:[]}){let n=r.keys.find(l=>l.kid===e);if(n)return n;const i=Date.now();if(n=this.jwks.keys.find(l=>l.kid===e),n&&this.jwks_cached_at+MY>i)return n;const{data:s,error:o}=await dt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=i,n=s.keys.find(l=>l.kid===e),!n)?null:n}async getClaims(e,r={}){try{let n=e;if(!n){const{data:m,error:x}=await this.getSession();if(x||!m.session)return{data:null,error:x};n=m.session.access_token}const{header:i,payload:s,signature:o,raw:{header:l,payload:c}}=Dw(n);r!=null&&r.allowExpired||nX(s.exp);const u=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!u){const{error:m}=await this.getUser(n);if(m)throw m;return{data:{claims:s,header:i,signature:o},error:null}}const f=iX(i.alg),d=await crypto.subtle.importKey("jwk",u,f,!0,["verify"]);if(!await crypto.subtle.verify(f,d,o,UY(`${l}.${c}`)))throw new e_("Invalid JWT signature");return{data:{claims:s,header:i,signature:o},error:null}}catch(n){if(nt(n))return{data:null,error:n};throw n}}}wh.nextInstanceID=0;const bX=wh;class wX extends bX{constructor(e){super(e)}}var jX=function(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function l(f){try{u(n.next(f))}catch(d){o(d)}}function c(f){try{u(n.throw(f))}catch(d){o(d)}}function u(f){f.done?s(f.value):i(f.value).then(l,c)}u((n=n.apply(t,e||[])).next())})};class SX{constructor(e,r,n){var i,s,o;if(this.supabaseUrl=e,this.supabaseKey=r,!e)throw new Error("supabaseUrl is required.");if(!r)throw new Error("supabaseKey is required.");const l=OY(e),c=new URL(l);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const u=`sb-${c.hostname.split(".")[0]}-auth-token`,f={db:xY,realtime:wY,auth:Object.assign(Object.assign({},bY),{storageKey:u}),global:vY},d=EY(n??{},f);this.storageKey=(i=d.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(s=d.global.headers)!==null&&s!==void 0?s:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(p,m)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(m)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=d.auth)!==null&&o!==void 0?o:{},this.headers,d.global.fetch),this.fetch=kY(r,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new BG(new URL("rest/v1",c).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),this.storage=new mY(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new CG(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,r={},n={}){return this.rest.rpc(e,r,n)}channel(e,r={config:{}}){return this.realtime.channel(e,r)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,r;return jX(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(r=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&r!==void 0?r:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:i,storageKey:s,flowType:o,lock:l,debug:c},u,f){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new wX({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),u),storageKey:s,autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:i,flowType:o,lock:l,debug:c,fetch:f,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new rY(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(e,r,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const NX=(t,e,r)=>new SX(t,e,r);function kX(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}kX()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const _X="https://givgsxytkbsdrlmoxzkp.supabase.co",OX="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpdmdzeHl0a2JzZHJsbW94emtwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwOTM1NTQsImV4cCI6MjA3MTY2OTU1NH0.dUHOfO0-8i90ebOy0HsrZqsoYqwNx1hpbUTRurLcMBA",pe=NX(_X,OX),xn={ai_agent:{label:"AI Agents",color:"#3B82F6",description:"Intelligent AI agents with custom prompts"},video:{label:"Videos",color:"#EF4444",description:"Educational videos with transcriptions"},document:{label:"Documents",color:"#10B981",description:"Rich text documents and guides"},prompt:{label:"Prompts",color:"#8B5CF6",description:"Reusable prompt templates"},automation:{label:"Automations",color:"#F59E0B",description:"Process automations and workflows"}},AB=O.createContext(void 0);function Ln(){const t=O.useContext(AB);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}function EX({children:t}){const[e,r]=O.useState(null),[n,i]=O.useState(null),[s,o]=O.useState(!0),[l,c]=O.useState(!1),u=O.useRef(!0),f=O.useRef(null);O.useEffect(()=>{const y=setTimeout(()=>{u.current&&(console.warn("Auth loading timeout reached - switching to production auth"),c(!0),o(!1))},1e4);return()=>clearTimeout(y)},[]);const d=O.useCallback(async y=>{console.log("🔍 Fetching admin data for user:",y);try{const{data:v,error:b}=await pe.from("admins").select("*").eq("id",y).maybeSingle();return console.log("🔍 Admin query result:",{data:v,error:b}),b?(console.error("❌ Admin lookup error:",b),null):(v?console.log("✅ Admin data found:",v):console.log("❌ No admin data found for user:",y),v)}catch(v){return console.error("❌ Admin fetch failed with exception:",v),null}},[]);O.useEffect(()=>{let y=!0;const v=new AbortController;(async()=>{var N;try{o(!0);const{data:{user:j},error:k}=await pe.auth.getUser();if(!y)return;k&&!((N=k.message)!=null&&N.includes("Auth session missing"))&&console.error("Auth initialization error:",k);const _=j||null;if(r(_),_){const E=await d(_.id);y&&i(E)}else i(null);y&&o(!1)}catch(j){console.error("Auth initialization failed:",j),y&&(r(null),i(null),o(!1))}})();const{data:{subscription:w}}=pe.auth.onAuthStateChange(async(N,j)=>{var _;if(!y)return;console.log("Auth state change:",N,(_=j==null?void 0:j.user)==null?void 0:_.id);const k=(j==null?void 0:j.user)||null;if(console.log("🔄 Processing auth state change:",{event:N,userId:k==null?void 0:k.id}),r(k),k){console.log("👤 User authenticated, fetching admin data...");try{const E=await d(k.id);y&&(console.log("✅ Setting admin data:",E),i(E))}catch(E){console.error("❌ Failed to fetch admin data:",E),y&&i(null)}}else console.log("❌ No user, clearing admin data"),i(null);y&&o(!1)});return()=>{y=!1,v.abort(),w.unsubscribe()}},[d]),O.useEffect(()=>()=>{u.current=!1,f.current&&clearTimeout(f.current)},[]);const p=O.useCallback(async(y,v)=>{try{o(!0);const{error:b}=await pe.auth.signInWithPassword({email:y,password:v});return b?(o(!1),{error:b.message}):{}}catch{return o(!1),{error:"Sign in failed"}}},[]),m=O.useCallback(async()=>{try{o(!0),await pe.auth.signOut()}catch(y){console.error("Sign out error:",y),o(!1)}},[]),x=O.useMemo(()=>({user:e,admin:n,loading:s,signIn:p,signOut:m}),[e==null?void 0:e.id,n==null?void 0:n.id,s,p,m]);return a.jsx(AB.Provider,{value:x,children:t})}/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var CX={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
--
          content_categories (
            id,
            name,
            color
          )
        `).order("created_at",{ascending:!1});if(k)throw k;e(j||[])}catch(j){console.error("Error fetching articles:",j)}finally{s(!1)}},y=async()=>{try{const{data:j,error:k}=await pe.from("content_categories").select("*").order("name");if(k)throw k;n(j||[])}catch(j){console.error("Error fetching categories:",j)}},v=async j=>{if(confirm("Are you sure you want to delete this article?"))try{const{error:k}=await pe.from("content_articles").delete().eq("id",j);if(k)throw k;await x()}catch(k){console.error("Error deleting article:",k)}},b=t.filter(j=>{var A;const k=j.title.toLowerCase().includes(o.toLowerCase())||j.author.toLowerCase().includes(o.toLowerCase()),_=c==="all"||((A=j.category_id)==null?void 0:A.toString())===c,E=f==="all"||j.status===f;return k&&_&&E}),w=j=>{const _={draft:{bg:"bg-yellow-100",text:"text-yellow-800",label:"Draft"},published:{bg:"bg-green-100",text:"text-green-800",label:"Published"},archived:{bg:"bg-gray-100",text:"text-gray-800",label:"Archived"}}[j];return a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${_.bg} ${_.text}`,children:_.label})},N=j=>j?new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(j)):"-";return i?a.jsx(pr,{children:a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):a.jsx(pr,{children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Articles Management"}),a.jsx("p",{className:"text-gray-600",children:"Create and manage your content articles"})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsxs("button",{onClick:()=>m(!p),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[a.jsx(Ep,{className:"h-4 w-4 mr-2"}),"Filters"]}),a.jsxs(Qn,{to:"/content/articles/create",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[a.jsx(Vt,{className:"h-4 w-4 mr-2"}),"Add New Article"]})]})]}),a.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 space-y-4",children:[a.jsx("div",{className:"flex flex-col sm:flex-row gap-4",children:a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"relative",children:[a.jsx(In,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx("input",{type:"text",placeholder:"Search articles by title or author...",value:o,onChange:j=>l(j.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]})})}),p&&a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 pt-4 border-t border-gray-200",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),a.jsxs("select",{value:c,onChange:j=>u(j.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"all",children:"All Categories"}),r.map(j=>a.jsx("option",{value:j.id.toString(),children:j.name},j.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),a.jsxs("select",{value:f,onChange:j=>d(j.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"all",children:"All Statuses"}),a.jsx("option",{value:"draft",children:"Draft"}),a.jsx("option",{value:"published",children:"Published"}),a.jsx("option",{value:"archived",children:"Archived"})]})]})]})]}),a.jsx("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden",children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Title"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Author"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created At"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.length===0?a.jsx("tr",{children:a.jsxs("td",{colSpan:6,className:"px-6 py-12 text-center",children:[a.jsx(Ot,{className:"mx-auto h-12 w-12 text-gray-300"}),a.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No articles found"}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:o||c!=="all"||f!=="all"?"Try adjusting your search or filters.":"Get started by creating your first article."})]})}):b.map(j=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex flex-col",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900 mb-1",children:j.title}),j.excerpt&&a.jsx("div",{className:"text-sm text-gray-500 line-clamp-2",children:j.excerpt})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:j.content_categories?a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:j.content_categories.color}}),a.jsx("span",{className:"text-sm text-gray-900",children:j.content_categories.name})]}):a.jsx("span",{className:"text-sm text-gray-500",children:"Uncategorized"})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(zB,{className:"h-4 w-4 text-gray-400 mr-2"}),a.jsx("span",{className:"text-sm text-gray-900",children:j.author})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:w(j.status)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(Fl,{className:"h-4 w-4 text-gray-400 mr-2"}),a.jsx("span",{className:"text-sm text-gray-900",children:N(j.created_at)})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:a.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[a.jsx(Qn,{to:`/content/articles/${j.id}/edit`,className:"text-blue-600 hover:text-blue-900 p-1",children:a.jsx(ii,{className:"h-4 w-4"})}),a.jsx(Qn,{to:`/content/articles/${j.id}/edit`,className:"text-indigo-600 hover:text-indigo-900 p-1",children:a.jsx(yo,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>v(j.id),className:"text-red-600 hover:text-red-900 p-1",children:a.jsx(ns,{className:"h-4 w-4"})})]})})]},j.id))})]})})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(Ot,{className:"h-8 w-8 text-blue-500"}),a.jsxs("div",{className:"ml-3",children:[a.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Articles"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900",children:t.length})]})]})}),a.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(ii,{className:"h-8 w-8 text-green-500"}),a.jsxs("div",{className:"ml-3",children:[a.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Published"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900",children:t.filter(j=>j.status==="published").length})]})]})}),a.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(yo,{className:"h-8 w-8 text-yellow-500"}),a.jsxs("div",{className:"ml-3",children:[a.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Drafts"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900",children:t.filter(j=>j.status==="draft").length})]})]})}),a.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(Es,{className:"h-8 w-8 text-purple-500"}),a.jsxs("div",{className:"ml-3",children:[a.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Categories"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900",children:r.length})]})]})})]})]})})}function A5(){const{id:t}=us(),e=Ti(),r=!!t,[n,i]=O.useState({title:"",content:"",excerpt:"",author:"Admin User",category_id:null,status:"draft",tags:[],featured_image_url:"",slug:"",seo_title:"",seo_description:""}),[s,o]=O.useState([]),[l,c]=O.useState(!1),[u,f]=O.useState(!1),[d,p]=O.useState(""),[m,x]=O.useState("content"),[y,v]=O.useState(null);O.useEffect(()=>{b(),r&&w()},[t]);const b=async()=>{try{const{data:T,error:M}=await pe.from("content_categories").select("*").order("name");if(M)throw M;o(T||[])}catch(T){console.error("Error fetching categories:",T)}},w=async()=>{if(t)try{c(!0);const{data:T,error:M}=await pe.from("content_articles").select("*").eq("id",parseInt(t)).single();if(M)throw M;T&&i({...T,tags:T.tags||[]})}catch(T){console.error("Error fetching article:",T)}finally{c(!1)}},N=T=>T.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),j=T=>{i(M=>({...M,title:T,slug:M.slug||N(T),seo_title:M.seo_title||T}))},k=()=>{d.trim()&&!n.tags.includes(d.trim())&&(i(T=>({...T,tags:[...T.tags,d.trim()]})),p(""))},_=T=>{i(M=>({...M,tags:M.tags.filter(P=>P!==T)}))},E=(T,M)=>{v({message:T,type:M}),setTimeout(()=>{v(null)},3e3)},A=async(T=!1)=>{try{f(!0);const M={...n,status:T?"published":n.status,published_at:T?new Date().toISOString():null,updated_at:new Date().toISOString()};if(r){const{error:P}=await pe.from("content_articles").update(M).eq("id",parseInt(t));if(P)throw P;E(T?"Article published successfully!":"Article saved successfully!","success"),setTimeout(()=>{e("/content/articles")},1500)}else{const{data:P,error:R}=await pe.from("content_articles").insert([M]).select().single();if(R)throw R;E(T?"Article published successfully!":"Article created successfully!","success"),setTimeout(()=>{P?e(`/content/articles/${P.id}/edit`,{replace:!0}):e("/content/articles")},1500)}}catch(M){console.error("Error saving article:",M),E("Failed to save article. Please try again.","error")}finally{f(!1)}};return l?a.jsx(pr,{children:a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):a.jsxs(pr,{children:[y&&a.jsx("div",{className:"fixed top-4 right-4 z-50 transition-all duration-500 ease-in-out transform translate-x-0 opacity-100",children:a.jsx("div",{className:`max-w-sm w-full ${y.type==="success"?"bg-green-500":"bg-red-500"} shadow-lg rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5`,children:a.jsx("div",{className:"flex-1 w-0 p-4",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx("div",{className:"ml-3 flex-1",children:a.jsx("p",{className:"text-sm font-medium text-white",children:y.message})}),a.jsx("div",{className:"ml-4 flex-shrink-0 flex",children:a.jsxs("button",{className:"bg-transparent rounded-md inline-flex text-white hover:text-gray-200 focus:outline-none focus:ring-2 focus:ring-white",onClick:()=>v(null),children:[a.jsx("span",{className:"sr-only",children:"Close"}),a.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:a.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})})]})})})}),a.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("button",{onClick:()=>e("/content/articles"),className:"p-2 hover:bg-gray-100 rounded-md",children:a.jsx(lo,{className:"h-5 w-5"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:r?"Edit Article":"Create New Article"}),a.jsx("p",{className:"text-gray-600",children:"Write and publish your content"})]})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsxs("button",{onClick:()=>A(!1),disabled:u,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:[a.jsx(Cp,{className:"h-4 w-4 mr-2"}),"Save Draft"]}),a.jsxs("button",{onClick:()=>A(!0),disabled:u,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:[a.jsx(ii,{className:"h-4 w-4 mr-2"}),"Publish"]})]})]}),a.jsx("div",{className:"border-b border-gray-200",children:a.jsxs("nav",{className:"-mb-px flex space-x-8",children:[a.jsx("button",{onClick:()=>x("content"),className:`py-2 px-1 border-b-2 font-medium text-sm ${m==="content"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Content"}),a.jsx("button",{onClick:()=>x("settings"),className:`py-2 px-1 border-b-2 font-medium text-sm ${m==="settings"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Settings"}),a.jsx("button",{onClick:()=>x("seo"),className:`py-2 px-1 border-b-2 font-medium text-sm ${m==="seo"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"SEO"})]})}),m==="content"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title *"}),a.jsx("input",{type:"text",value:n.title,onChange:T=>j(T.target.value),placeholder:"Enter article title...",className:"w-full text-2xl font-bold border-0 border-b border-gray-200 focus:border-blue-500 focus:ring-0 px-0 py-2",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Excerpt"}),a.jsx("textarea",{value:n.excerpt,onChange:T=>i(M=>({...M,excerpt:T.target.value})),placeholder:"Brief description of the article...",rows:3,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Content *"}),a.jsx("textarea",{value:n.content,onChange:T=>i(M=>({...M,content:T.target.value})),placeholder:"Write your article content here...",rows:20,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm",required:!0}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"You can use HTML tags for formatting."})]})]}),m==="settings"&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),a.jsxs("select",{value:n.category_id||"",onChange:T=>i(M=>({...M,category_id:T.target.value?parseInt(T.target.value):null})),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"No Category"}),s.map(T=>a.jsx("option",{value:T.id,children:T.name},T.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Author"}),a.jsx("input",{type:"text",value:n.author,onChange:T=>i(M=>({...M,author:T.target.value})),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),a.jsxs("select",{value:n.status,onChange:T=>i(M=>({...M,status:T.target.value})),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"draft",children:"Draft"}),a.jsx("option",{value:"published",children:"Published"}),a.jsx("option",{value:"archived",children:"Archived"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"URL Slug"}),a.jsx("input",{type:"text",value:n.slug,onChange:T=>i(M=>({...M,slug:T.target.value})),placeholder:"article-url-slug",className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Featured Image URL"}),a.jsx("input",{type:"url",value:n.featured_image_url,onChange:T=>i(M=>({...M,featured_image_url:T.target.value})),placeholder:"https://example.com/image.jpg",className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags"}),a.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:n.tags.map((T,M)=>a.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[T,a.jsx("button",{type:"button",onClick:()=>_(T),className:"ml-1.5 inline-flex items-center justify-center w-4 h-4 rounded-full hover:bg-blue-200",children:"×"})]},M))}),a.jsxs("div",{className:"flex",children:[a.jsx("input",{type:"text",value:d,onChange:T=>p(T.target.value),onKeyPress:T=>T.key==="Enter"&&k(),placeholder:"Add a tag...",className:"flex-1 border border-gray-300 rounded-l-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"}),a.jsx("button",{type:"button",onClick:k,className:"px-4 py-2 border border-l-0 border-gray-300 bg-gray-50 rounded-r-md hover:bg-gray-100",children:"Add"})]})]})]}),m==="seo"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"SEO Title"}),a.jsx("input",{type:"text",value:n.seo_title,onChange:T=>i(M=>({...M,seo_title:T.target.value})),placeholder:"SEO optimized title...",className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Recommended: 50-60 characters"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"SEO Description"}),a.jsx("textarea",{value:n.seo_description,onChange:T=>i(M=>({...M,seo_description:T.target.value})),placeholder:"Meta description for search engines...",rows:4,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Recommended: 150-160 characters"})]})]})]})]})}function qp({contentType:t,title:e,description:r,icon:n,color:i}){const s=Ti(),[o,l]=O.useState([]),[c,u]=O.useState([]),[f,d]=O.useState(!0),[p,m]=O.useState(null),[x,y]=O.useState({}),v=O.useRef(!0),b=O.useRef(""),[w,N]=O.useState({search:"",clients:[],status:"all",sortBy:"updated_at",sortOrder:"desc",viewMode:"cards"}),[j,k]=O.useState(!1),_=O.useMemo(()=>JSON.stringify({contentType:t,search:w.search,clients:w.clients.sort(),status:w.status,sortBy:w.sortBy,sortOrder:w.sortOrder}),[t,w.search,w.clients,w.status,w.sortBy,w.sortOrder]),E=O.useCallback(async()=>{if(!v.current)return;const z=_;if(b.current!==z)try{d(!0),m(null),b.current=z;let W=pe.from("content_items").select("*").eq("content_type",t);w.search.trim()&&(W=W.or(`title.ilike.%${w.search}%,description.ilike.%${w.search}%`)),w.status!=="all"&&(W=W.eq("status",w.status)),W=W.order(w.sortBy,{ascending:w.sortOrder==="asc"});const{data:K,error:q}=await W;if(!v.current)return;if(q){console.error("Error fetching content items:",q),m("Failed to load content items"),l([]);return}let V=K||[];if(w.clients.length>0){const{data:D,error:U}=await pe.from("content_client_assignments").select("content_item_id").in("client_id",w.clients);if(U)console.error("Error fetching assignments:",U);else if(D){const G=D.map(ee=>ee.content_item_id);V=V.filter(ee=>G.includes(ee.id))}}if(!v.current)return;if(l(V),V.length>0){const D=V.map(Q=>Q.id),[U,G]=await Promise.all([pe.from("content_client_assignments").select("content_item_id").in("content_item_id",D),pe.from("content_user_assignments").select("content_item_id").in("content_item_id",D)]),ee={};D.forEach(Q=>{var re,J;const H=((re=U.data)==null?void 0:re.filter(ne=>ne.content_item_id===Q).length)||0,Y=((J=G.data)==null?void 0:J.filter(ne=>ne.content_item_id===Q).length)||0;ee[Q]=H+Y}),v.current&&y(ee)}}catch(W){console.error("Error in fetchData:",W),v.current&&(m("Failed to load content"),l([]))}finally{v.current&&d(!1)}},[t,_,w.search,w.clients,w.status,w.sortBy,w.sortOrder]),A=O.useCallback(async()=>{try{const{data:z,error:W}=await pe.from("clients").select("*").eq("status","active").order("name");W?console.error("Error fetching clients:",W):z&&v.current&&u(z)}catch(z){console.error("Error fetching clients:",z)}},[]);O.useEffect(()=>{E()},[E]),O.useEffect(()=>{A()},[A]),O.useEffect(()=>()=>{v.current=!1},[]);const T=O.useCallback(()=>({ai_agent:"ai-agents",video:"videos",document:"documents",prompt:"prompts",automation:"automations"})[t]||t,[t]),M=O.useCallback(()=>{const z=T();s(`/content/${z}/create`)},[s,T]),P=O.useCallback(z=>{const W=T();s(`/content/${W}/${z}/edit`)},[s,T]),R=O.useCallback((z,W)=>{N(K=>({...K,[z]:W}))},[]),L=O.useCallback(()=>{N(z=>({search:"",clients:[],status:"all",sortBy:"updated_at",sortOrder:"desc",viewMode:z.viewMode}))},[]),$=O.useCallback(z=>a.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${z==="published"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:z==="published"?a.jsxs(a.Fragment,{children:[a.jsx(ii,{className:"h-3 w-3 mr-1"})," Published"]}):a.jsxs(a.Fragment,{children:[a.jsx(TO,{className:"h-3 w-3 mr-1"})," Draft"]})}),[]),F=O.useCallback(z=>new Date(z).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),[]);return p&&!f?a.jsx(pr,{children:a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-red-500 mb-4",children:a.jsx(n,{className:"h-12 w-12 mx-auto"})}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error Loading Content"}),a.jsx("p",{className:"text-sm text-gray-500 mb-4",children:p}),a.jsx("button",{onClick:()=>{m(null),E()},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Try Again"})]})})}):a.jsx(pr,{children:a.jsxs("div",{className:"min-h-screen flex bg-gray-50",children:[a.jsxs("div",{className:`transition-all duration-300 ${j?"w-80":"w-12"} bg-white border-r border-gray-200 flex flex-col shadow-sm`,children:[a.jsx("div",{className:"p-4 border-b border-gray-200",children:a.jsxs("button",{onClick:()=>k(!j),className:"flex items-center justify-center w-full p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:[a.jsx(Ep,{className:"h-5 w-5"}),j&&a.jsx("span",{className:"ml-2 text-sm font-medium",children:"Filters"})]})}),j&&a.jsxs("div",{className:"flex-1 p-4 space-y-6 overflow-y-auto",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Content"}),a.jsxs("div",{className:"relative",children:[a.jsx(In,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),a.jsx("input",{type:"text",placeholder:"Search by title or description...",value:w.search,onChange:z=>R("search",z.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Publication Status"}),a.jsxs("select",{value:w.status,onChange:z=>R("status",z.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",children:[a.jsx("option",{value:"all",children:"All Status"}),a.jsx("option",{value:"published",children:"Published Only"}),a.jsx("option",{value:"draft",children:"Drafts Only"})]})]}),c.length>0&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Clients"}),a.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-2",children:c.map(z=>a.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:w.clients.includes(z.id),onChange:W=>{W.target.checked?R("clients",[...w.clients,z.id]):R("clients",w.clients.filter(K=>K!==z.id))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:z.brand_color}}),a.jsx("span",{className:"text-sm text-gray-900",children:z.name})]})]},z.id))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort Content"}),a.jsxs("select",{value:`${w.sortBy}_${w.sortOrder}`,onChange:z=>{const[W,K]=z.target.value.split("_");R("sortBy",W),R("sortOrder",K)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",children:[a.jsx("option",{value:"updated_at_desc",children:"Last Updated (Newest)"}),a.jsx("option",{value:"updated_at_asc",children:"Last Updated (Oldest)"}),a.jsx("option",{value:"created_at_desc",children:"Date Created (Newest)"}),a.jsx("option",{value:"created_at_asc",children:"Date Created (Oldest)"}),a.jsx("option",{value:"title_asc",children:"Title (A-Z)"}),a.jsx("option",{value:"title_desc",children:"Title (Z-A)"})]})]}),a.jsx("div",{className:"pt-4 border-t border-gray-200",children:a.jsx("button",{onClick:L,className:"w-full px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Clear All Filters"})})]})]}),a.jsxs("div",{className:"flex-1 flex flex-col",children:[a.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4 shadow-sm",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"h-12 w-12 rounded-xl flex items-center justify-center shadow-sm",style:{backgroundColor:i+"15"},children:a.jsx(n,{className:"h-6 w-6",style:{color:i}})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:e}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r}),a.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[a.jsxs("span",{className:"text-xs text-gray-500",children:[o.length," ",o.length===1?"item":"items"]}),w.status!=="all"&&a.jsxs("span",{className:"text-xs text-gray-500",children:["• Filtered by ",w.status]}),w.clients.length>0&&a.jsxs("span",{className:"text-xs text-gray-500",children:["• ",w.clients.length," client(s)"]})]})]})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[a.jsx("button",{onClick:()=>R("viewMode","cards"),className:`p-2 rounded-md transition-colors ${w.viewMode==="cards"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,title:"Card View",children:a.jsx(dd,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>R("viewMode","list"),className:`p-2 rounded-md transition-colors ${w.viewMode==="list"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,title:"List View",children:a.jsx(rs,{className:"h-4 w-4"})})]}),a.jsxs("button",{onClick:M,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 transition-all",style:{backgroundColor:i,boxShadow:`0 4px 12px ${i}40`},children:[a.jsx(Vt,{className:"-ml-1 mr-2 h-4 w-4"}),"Create New"]})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:f?a.jsx("div",{className:"flex justify-center items-center py-20",children:a.jsxs("div",{className:"text-center",children:[a.jsx(cr,{size:"lg"}),a.jsxs("p",{className:"text-sm text-gray-500 mt-3",children:["Loading ",e.toLowerCase(),"..."]})]})}):a.jsx(a.Fragment,{children:o.length===0?a.jsxs("div",{className:"text-center py-20",children:[a.jsx("div",{className:"mx-auto h-24 w-24 rounded-full flex items-center justify-center mb-4",style:{backgroundColor:i+"10"},children:a.jsx(n,{className:"h-12 w-12",style:{color:i}})}),a.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["No ",e.toLowerCase()," yet"]}),a.jsx("p",{className:"text-sm text-gray-500 mt-2 max-w-sm mx-auto",children:w.search||w.status!=="all"||w.clients.length>0?`No ${e.toLowerCase()} match your current filters. Try adjusting your search criteria.`:`Get started by creating your first ${t.replace("_"," ")}.`}),a.jsx("div",{className:"mt-8",children:w.search||w.status!=="all"||w.clients.length>0?a.jsx("button",{onClick:L,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Clear Filters"}):a.jsxs("button",{onClick:M,className:"inline-flex items-center px-6 py-3 border border-transparent shadow-sm text-sm font-medium rounded-lg text-white hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2",style:{backgroundColor:i},children:[a.jsx(Vt,{className:"-ml-1 mr-2 h-5 w-5"}),"Create ",t.replace("_"," ")]})})]}):a.jsx("div",{className:w.viewMode==="cards"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6":"space-y-3",children:o.map(z=>a.jsx("div",{onClick:()=>P(z.id),className:`${w.viewMode==="cards"?"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md cursor-pointer transition-all hover:scale-105":"bg-white rounded-lg shadow-sm border border-gray-200 p-4 hover:shadow-md cursor-pointer transition-all"}`,children:w.viewMode==="cards"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"h-32 bg-gradient-to-br from-opacity-10 to-opacity-20 flex items-center justify-center relative",style:{backgroundColor:i+"08",backgroundImage:`linear-gradient(135deg, ${i}15, ${i}05)`},children:[a.jsx(n,{className:"h-8 w-8",style:{color:i}}),z.thumbnail_url&&a.jsx("img",{src:z.thumbnail_url,alt:z.title,className:"absolute inset-0 w-full h-full object-cover"})]}),a.jsxs("div",{className:"p-4",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsx("h3",{className:"text-sm font-semibold text-gray-900 line-clamp-2 leading-5",children:z.title}),$(z.status)]}),z.description&&a.jsx("p",{className:"text-xs text-gray-600 line-clamp-2 mb-3 leading-4",children:z.description}),a.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(Fl,{className:"h-3 w-3"}),a.jsx("span",{children:F(z.updated_at)})]}),x[z.id]>0&&a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(oi,{className:"h-3 w-3"}),a.jsx("span",{children:x[z.id]})]})]})]})]}):a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"h-12 w-12 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:i+"15"},children:a.jsx(n,{className:"h-6 w-6",style:{color:i}})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:z.title}),$(z.status)]}),z.description&&a.jsx("p",{className:"text-xs text-gray-600 truncate mt-1",children:z.description}),a.jsx("div",{className:"flex items-center justify-between mt-2",children:a.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(Fl,{className:"h-3 w-3"}),a.jsxs("span",{children:["Updated ",F(z.updated_at)]})]}),x[z.id]>0&&a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(oi,{className:"h-3 w-3"}),a.jsxs("span",{children:[x[z.id]," assignment",x[z.id]!==1?"s":""]})]})]})})]})]})},z.id))})})})]})]})})}function Ege(){return a.jsx(qp,{contentType:"ai_agent",title:xn.ai_agent.label,description:xn.ai_agent.description,icon:Kr,color:xn.ai_agent.color})}function Cge(){return a.jsx(qp,{contentType:"video",title:xn.video.label,description:xn.video.description,icon:si,color:xn.video.color})}function Age(){return a.jsx(qp,{contentType:"document",title:xn.document.label,description:xn.document.description,icon:Ot,color:xn.document.color})}function Tge(){return a.jsx(qp,{contentType:"prompt",title:xn.prompt.label,description:xn.prompt.description,icon:Gr,color:xn.prompt.color})}function Pge(){return a.jsx(qp,{contentType:"automation",title:xn.automation.label,description:xn.automation.description,icon:Ei,color:xn.automation.color})}function Mge({isOpen:t,onClose:e,client:r,contentItemId:n,onSave:i}){const[s,o]=O.useState([]),[l,c]=O.useState([]),[u,f]=O.useState([]),[d,p]=O.useState([]),[m,x]=O.useState(!1),[y,v]=O.useState(!1);O.useEffect(()=>{t&&b()},[t,r.id]);const b=async()=>{try{x(!0);const{data:N,error:j}=await pe.from("user_tags").select("*").eq("client_id",r.id).order("name");j?console.error("Error fetching tags:",j):N&&f(N);const{data:k,error:_}=await pe.from("users").select("*").eq("client_id",r.id).order("first_name");_?console.error("Error fetching users:",_):k&&p(k);const[E,A]=await Promise.all([pe.from("content_tag_assignments").select("tag_id").eq("content_item_id",n),pe.from("content_user_assignments").select("user_id").eq("content_item_id",n)]);E.data&&o(E.data.map(T=>T.tag_id)),A.data&&c(A.data.map(T=>T.user_id))}catch(N){console.error("Error fetching assignment data:",N)}finally{x(!1)}},w=async()=>{try{v(!0);const{data:{user:N}}=await pe.auth.getUser();if(!N)return;const j=[];u.length>0&&j.push(pe.from("content_tag_assignments").delete().eq("content_item_id",n).in("tag_id",u.map(_=>_.id))),d.length>0&&j.push(pe.from("content_user_assignments").delete().eq("content_item_id",n).in("user_id",d.map(_=>_.id))),await Promise.all(j);const k=[];if(s.length>0){const _=s.map(E=>({content_item_id:n,tag_id:E,assigned_by:N.id}));k.push(pe.from("content_tag_assignments").insert(_))}if(l.length>0){const _=l.map(E=>({content_item_id:n,user_id:E,assigned_by:N.id}));k.push(pe.from("content_user_assignments").insert(_))}await Promise.all(k),i(),e()}catch(N){console.error("Error saving assignments:",N)}finally{v(!1)}};return t?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto shadow-2xl",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"h-8 w-8 rounded-lg flex items-center justify-center",style:{backgroundColor:r.brand_color+"20"},children:a.jsx("div",{className:"h-4 w-4 rounded-full",style:{backgroundColor:r.brand_color}})}),a.jsxs("div",{children:[a.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Assign to ",r.name]}),a.jsx("p",{className:"text-sm text-gray-500",children:"Configure content visibility and access"})]})]}),a.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 p-1 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx($r,{className:"h-5 w-5"})})]}),m?a.jsxs("div",{className:"p-8 text-center",children:[a.jsx(cr,{size:"md"}),a.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Loading assignment options..."})]}):a.jsxs("div",{className:"p-6 space-y-6",children:[u.length>0&&a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:[a.jsx(Es,{className:"h-4 w-4 inline mr-2"}),"Assign to User Tags (",s.length," selected)"]}),a.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-3",children:u.map(N=>a.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-2 hover:bg-gray-50 rounded-md",children:[a.jsx("input",{type:"checkbox",checked:s.includes(N.id),onChange:j=>{j.target.checked?o([...s,N.id]):o(s.filter(k=>k!==N.id))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:N.color}}),a.jsx("span",{className:"text-sm text-gray-900",children:N.name})]})]},N.id))}),a.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Content will be visible to all users with the selected tags"})]}),d.length>0&&a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:[a.jsx(oi,{className:"h-4 w-4 inline mr-2"}),"Assign to Specific Users (",l.length," selected)"]}),a.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-3",children:d.map(N=>a.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer p-2 hover:bg-gray-50 rounded-md",children:[a.jsx("input",{type:"checkbox",checked:l.includes(N.id),onChange:j=>{j.target.checked?c([...l,N.id]):c(l.filter(k=>k!==N.id))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[N.first_name," ",N.last_name]}),a.jsx("div",{className:"text-xs text-gray-500",children:N.email})]})]},N.id))}),a.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Content will be visible to the specifically selected users"})]}),u.length===0&&d.length===0&&a.jsxs("div",{className:"text-center py-8",children:[a.jsx(oi,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),a.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"No assignment options"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This client has no users or tags configured. Set up users and tags first."})]})]}),a.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200 bg-gray-50",children:[a.jsx("button",{onClick:e,disabled:y,className:"px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:"Cancel"}),a.jsxs("button",{onClick:w,disabled:y||u.length===0&&d.length===0,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:[y?a.jsx(cr,{size:"sm",className:"mr-2"}):null,"Save Assignments"]})]})]})}):null}function zp({contentType:t,isEdit:e=!1,children:r,onSaveContent:n,title:i,description:s,color:o,icon:l}){const{id:c}=us(),u=Ti(),{admin:f}=Ln(),[d,p]=O.useState(null),[m,x]=O.useState([]),[y,v]=O.useState([]),[b,w]=O.useState(e),[N,j]=O.useState(!1),[k,_]=O.useState(!1),[E,A]=O.useState(null),[T,M]=O.useState(!1),[P,R]=O.useState(null),[L,$]=O.useState(""),[F,z]=O.useState(""),[W,K]=O.useState("draft"),[q,V]=O.useState(""),D=O.useRef(null),U=O.useCallback(()=>{if(!D.current)return!1;const te=D.current;return L!==te.title||F!==te.description||W!==te.status||q!==te.thumbnailUrl||JSON.stringify(y.slice().sort())!==JSON.stringify(te.assignedClients.slice().sort())},[L,F,W,q,y]);O.useEffect(()=>{const te=setTimeout(()=>{const se=U();se!==k&&_(se)},50);return()=>clearTimeout(te)},[L,F,W,q,y,k,U]),O.useEffect(()=>{let te=!0;return(async()=>{try{R(null),e&&c&&await G(),te&&await ee()}catch(ve){te&&(console.error("Error initializing ContentEditor:",ve),R(ve instanceof Error?ve.message:"Failed to load content"))}})(),()=>{te=!1}},[e,c]);const G=O.useCallback(async()=>{if(c)try{R(null);const{data:te,error:se}=await pe.from("content_items").select("*").eq("id",c).maybeSingle();if(se)throw se;if(!te){console.warn("Content item not found, redirecting to content list"),u("/content",{replace:!0});return}p(te);const ve=te.title||"",ie=te.description||"",ye=te.status||"draft",Te=te.thumbnail_url||"";$(ve),z(ie),K(ye),V(Te);const{data:Le,error:ue}=await pe.from("content_client_assignments").select("client_id").eq("content_item_id",te.id);ue&&console.error("Error fetching client assignments:",ue);const he=Le?Le.map(we=>we.client_id):[];v(he),D.current={title:ve,description:ie,status:ye,thumbnailUrl:Te,assignedClients:he},_(!1)}catch(te){console.error("Error fetching content item:",te),R(te instanceof Error?te.message:"Failed to load content item")}finally{w(!1)}},[c,u]),ee=O.useCallback(async()=>{try{R(null);const{data:te,error:se}=await pe.from("clients").select("*").eq("status","active").order("name");if(se)throw se;x(te||[]),!e&&!D.current&&(D.current={title:"",description:"",status:"draft",thumbnailUrl:"",assignedClients:[]})}catch(te){console.error("Error fetching clients:",te),R(te instanceof Error?te.message:"Failed to load clients")}},[e]),Q=O.useCallback(()=>({ai_agent:"ai-agents",video:"videos",document:"documents",prompt:"prompts",automation:"automations"})[t]||t,[t]),H=O.useCallback(async te=>{if(!f)throw new Error("Admin authentication required");try{const{error:se}=await pe.from("content_client_assignments").delete().eq("content_item_id",te);if(se)throw se;if(y.length>0){const ve=y.map(ye=>({content_item_id:te,client_id:ye,assigned_by:f.id})),{error:ie}=await pe.from("content_client_assignments").insert(ve);if(ie)throw ie}}catch(se){throw console.error("Error saving client assignments:",se),new Error("Failed to save client assignments")}},[f,y]),Y=O.useCallback(async()=>{if(!d||!f){R("Unable to delete: missing content item or admin authentication");return}if(confirm("Are you sure you want to delete this content? This action cannot be undone."))try{j(!0),R(null);const{error:te}=await pe.from("content_items").delete().eq("id",d.id);if(te)throw te;const se=Q();u(`/content/${se}`,{replace:!0})}catch(te){console.error("Error deleting content:",te);const se=te instanceof Error?te.message:"Error deleting content. Please try again.";R(se)}finally{j(!1)}},[d,f,u]),re=O.useCallback(async()=>{if(!f){R("Admin authentication required");return}try{j(!0),R(null);let te=c;const se={title:L.trim(),description:F.trim()||null,content_type:t,status:W,thumbnail_url:q.trim()||null,created_by:f.id,updated_at:new Date().toISOString()};if(e&&te){const{error:ve}=await pe.from("content_items").update(se).eq("id",te);if(ve)throw ve}else{const{data:ve,error:ie}=await pe.from("content_items").insert([{...se,created_at:new Date().toISOString()}]).select().single();if(ie)throw ie;ve&&(te=ve.id,p(ve))}if(n&&te&&await n(te),await H(te),D.current={title:L.trim(),description:F.trim(),status:W,thumbnailUrl:q.trim(),assignedClients:[...y]},_(!1),!e&&te){const ve=Q();u(`/content/${ve}/${te}/edit`,{replace:!0})}}catch(te){console.error("Error saving content:",te);const se=te instanceof Error?te.message:"Error saving content. Please try again.";R(se)}finally{j(!1)}},[f,c,L,F,t,W,q,n,y,e,u]),J=O.useCallback(async()=>{if(!f){R("Admin authentication required");return}try{j(!0),R(null);let te=c;const se={title:L.trim(),description:F.trim()||null,content_type:t,status:W,thumbnail_url:q.trim()||null,created_by:f.id,updated_at:new Date().toISOString()};if(e&&te){const{error:ie}=await pe.from("content_items").update(se).eq("id",te);if(ie)throw ie}else{const{data:ie,error:ye}=await pe.from("content_items").insert([{...se,created_at:new Date().toISOString()}]).select().single();if(ye)throw ye;ie&&(te=ie.id,p(ie))}n&&te&&await n(te),await H(te),_(!1);const ve=Q();u(`/content/${ve}`,{replace:!0})}catch(te){console.error("Error saving content:",te);const se=te instanceof Error?te.message:"Error saving content. Please try again.";R(se)}finally{j(!1)}},[f,c,L,F,t,W,q,n,y,u]),ne=O.useCallback(te=>{v(se=>se.includes(te)?se.filter(ie=>ie!==te):[...se,te])},[]);return b?a.jsx(pr,{children:a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(cr,{size:"lg"}),a.jsx("p",{className:"text-sm text-gray-500 mt-3",children:"Loading content..."})]})})}):P?a.jsx(pr,{children:a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsx("div",{className:"text-center max-w-md mx-auto",children:a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[a.jsxs("div",{className:"text-red-800 mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Error Loading Content"}),a.jsx("p",{className:"text-sm",children:P})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("button",{onClick:()=>{R(null),e&&c&&G(),ee()},className:"w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500",children:"Try Again"}),a.jsx(Qn,{to:"/content",className:"block w-full px-4 py-2 border border-red-300 text-red-700 rounded-lg hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-500 text-center",children:"Back to Content"})]})]})})})}):a.jsx(Nh,{onError:(te,se)=>{console.error("ContentEditor Error Boundary:",te,se),R(`Component Error: ${te.message}`)},children:a.jsx(pr,{children:a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"flex items-center justify-between py-4",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx(Qn,{to:`/content/${Q()}`,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(lo,{className:"h-5 w-5"})}),a.jsx("div",{className:"h-8 w-8 rounded-lg flex items-center justify-center",style:{backgroundColor:o+"20"},children:a.jsx(l,{className:"h-5 w-5",style:{color:o}})}),a.jsxs("div",{children:[a.jsxs("h1",{className:"text-xl font-semibold text-gray-900",children:[e?"Edit":"Create"," ",i.slice(0,-1)]}),a.jsx("p",{className:"text-sm text-gray-500",children:s})]})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[e&&a.jsxs("button",{onClick:Y,disabled:N,className:"inline-flex items-center px-3 py-2 border border-red-300 shadow-sm text-sm font-medium rounded-lg text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50",children:[a.jsx(ns,{className:"h-4 w-4 mr-1"}),"Delete"]}),!e&&a.jsxs("button",{onClick:J,disabled:N||!L.trim(),className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:[N?a.jsx(cr,{size:"sm",className:"mr-2"}):a.jsx(lo,{className:"h-4 w-4 mr-2"}),N?"Saving...":"Save & Return to List"]}),a.jsxs("button",{onClick:re,disabled:N||!L.trim(),className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50",style:{backgroundColor:o},children:[N?a.jsx(cr,{size:"sm",className:"mr-2"}):a.jsx(Cp,{className:"h-4 w-4 mr-2"}),N?"Saving...":e?"Update":"Save & Continue Editing"]})]})]})})}),a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Basic Information"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-2",children:"Title *"}),a.jsx("input",{type:"text",id:"title",value:L,onChange:te=>$(te.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:`Enter ${i.slice(0,-1).toLowerCase()} title...`,required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),a.jsx("textarea",{id:"description",rows:3,value:F,onChange:te=>z(te.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:`Brief description of this ${i.slice(0,-1).toLowerCase()}...`})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"thumbnail",className:"block text-sm font-medium text-gray-700 mb-2",children:"Thumbnail URL"}),a.jsx("input",{type:"url",id:"thumbnail",value:q,onChange:te=>V(te.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"https://example.com/image.jpg"})]})]})]}),r]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Status & Visibility"}),a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Publication Status"}),a.jsxs("select",{value:W,onChange:te=>K(te.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"draft",children:"📝 Draft"}),a.jsx("option",{value:"published",children:"👁️ Published"})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:W==="draft"?"Only visible to admin users":"Visible to assigned clients and users"})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Client Assignment"}),a.jsxs("span",{className:"text-sm text-gray-500",children:[y.length," of ",m.length]})]}),m.length>0?a.jsx("div",{className:"space-y-3",children:m.map(te=>{const se=y.includes(te.id);return a.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("input",{type:"checkbox",checked:se,onChange:()=>ne(te.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:te.brand_color}}),a.jsx("span",{className:"text-sm font-medium text-gray-900",children:te.name})]})]}),se&&a.jsx("button",{onClick:()=>A(te.id),className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"Configure"})]},te.id)})}):a.jsxs("div",{className:"text-center py-4",children:[a.jsx(oi,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),a.jsx("p",{className:"text-sm text-gray-500",children:"No clients available"})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[a.jsxs("button",{onClick:()=>M(!T),className:"w-full flex items-center justify-between p-6 text-left",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Dn,{className:"h-5 w-5 text-gray-600"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Advanced Settings"})]}),T?a.jsx(mo,{className:"h-5 w-5 text-gray-600"}):a.jsx(jh,{className:"h-5 w-5 text-gray-600"})]}),T&&a.jsx("div",{className:"px-6 pb-6 border-t border-gray-200",children:a.jsx("div",{className:"pt-4 space-y-4",children:a.jsxs("div",{className:"text-sm text-gray-600",children:[a.jsxs("p",{children:["Content ID: ",a.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:(d==null?void 0:d.id)||"Not created yet"})]}),a.jsxs("p",{children:["Content Type: ",a.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:t})]}),d&&a.jsxs(a.Fragment,{children:[a.jsxs("p",{children:["Created: ",new Date(d.created_at).toLocaleString()]}),a.jsxs("p",{children:["Updated: ",new Date(d.updated_at).toLocaleString()]})]})]})})})]})]})]})}),E&&a.jsx(Nh,{children:a.jsx(Mge,{isOpen:!0,onClose:()=>A(null),client:m.find(te=>te.id===E),contentItemId:(d==null?void 0:d.id)||c,onSave:()=>{}})})]})})})}function Rge(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function T5(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function P5(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?T5(Object(r),!0).forEach(function(n){Rge(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):T5(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Ige(t,e){if(t==null)return{};var r={},n=Object.keys(t),i,s;for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&(r[i]=t[i]);return r}function Dge(t,e){if(t==null)return{};var r=Ige(t,e),n,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function Lge(t,e){return $ge(t)||Bge(t,e)||Fge(t,e)||qge()}function $ge(t){if(Array.isArray(t))return t}function Bge(t,e){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(t)))){var r=[],n=!0,i=!1,s=void 0;try{for(var o=t[Symbol.iterator](),l;!(n=(l=o.next()).done)&&(r.push(l.value),!(e&&r.length===e));n=!0);}catch(c){i=!0,s=c}finally{try{!n&&o.return!=null&&o.return()}finally{if(i)throw s}}return r}}function Fge(t,e){if(t){if(typeof t=="string")return M5(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M5(t,e)}}function M5(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function qge(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zge(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function R5(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function I5(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?R5(Object(r),!0).forEach(function(n){zge(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):R5(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Uge(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(n){return e.reduceRight(function(i,s){return s(i)},n)}}function Ff(t){return function e(){for(var r=this,n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return i.length>=t.length?t.apply(this,i):function(){for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return e.apply(r,[].concat(i,l))}}}function xv(t){return{}.toString.call(t).includes("Object")}function Hge(t){return!Object.keys(t).length}function ap(t){return typeof t=="function"}function Wge(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Vge(t,e){return xv(e)||Sa("changeType"),Object.keys(e).some(function(r){return!Wge(t,r)})&&Sa("changeField"),e}function Kge(t){ap(t)||Sa("selectorType")}function Gge(t){ap(t)||xv(t)||Sa("handlerType"),xv(t)&&Object.values(t).some(function(e){return!ap(e)})&&Sa("handlersType")}function Yge(t){t||Sa("initialIsRequired"),xv(t)||Sa("initialType"),Hge(t)&&Sa("initialContent")}function Xge(t,e){throw new Error(t[e]||t.default)}var Jge={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},Sa=Ff(Xge)(Jge),Cg={changes:Vge,selector:Kge,handler:Gge,initial:Yge};function Qge(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Cg.initial(t),Cg.handler(e);var r={current:t},n=Ff(tye)(r,e),i=Ff(eye)(r),s=Ff(Cg.changes)(t),o=Ff(Zge)(r);function l(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(f){return f};return Cg.selector(u),u(r.current)}function c(u){Uge(n,i,s,o)(u)}return[l,c]}function Zge(t,e){return ap(e)?e(t.current):e}function eye(t,e){return t.current=I5(I5({},t.current),e),e}function tye(t,e,r){return ap(e)?e(t.current):Object.keys(r).forEach(function(n){var i;return(i=e[n])===null||i===void 0?void 0:i.call(e,t.current[n])}),r}var rye={create:Qge},nye={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs"}};function iye(t){return function e(){for(var r=this,n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return i.length>=t.length?t.apply(this,i):function(){for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return e.apply(r,[].concat(i,l))}}}function sye(t){return{}.toString.call(t).includes("Object")}function oye(t){return t||D5("configIsRequired"),sye(t)||D5("configType"),t.urls?(aye(),{paths:{vs:t.urls.monacoBase}}):t}function aye(){console.warn(w8.deprecation)}function lye(t,e){throw new Error(t[e]||t.default)}var w8={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
--
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},$ke=0,ru=[];function Bke(t){var e=O.useRef([]),r=O.useRef([0,0]),n=O.useRef(),i=O.useState($ke++)[0],s=O.useState(q9)[0],o=O.useRef(t);O.useEffect(function(){o.current=t},[t]),O.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var y=oke([t.lockRef.current],(t.shards||[]).map(B6),!0).filter(Boolean);return y.forEach(function(v){return v.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),y.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(i))})}}},[t.inert,t.lockRef.current,t.shards]);var l=O.useCallback(function(y,v){if("touches"in y&&y.touches.length===2||y.type==="wheel"&&y.ctrlKey)return!o.current.allowPinchZoom;var b=Wg(y),w=r.current,N="deltaX"in y?y.deltaX:w[0]-b[0],j="deltaY"in y?y.deltaY:w[1]-b[1],k,_=y.target,E=Math.abs(N)>Math.abs(j)?"h":"v";if("touches"in y&&E==="h"&&_.type==="range")return!1;var A=L6(E,_);if(!A)return!0;if(A?k=E:(k=E==="v"?"h":"v",A=L6(E,_)),!A)return!1;if(!n.current&&"changedTouches"in y&&(N||j)&&(n.current=k),!k)return!0;var T=n.current||k;return Ike(T,v,y,T==="h"?N:j)},[]),c=O.useCallback(function(y){var v=y;if(!(!ru.length||ru[ru.length-1]!==s)){var b="deltaY"in v?$6(v):Wg(v),w=e.current.filter(function(k){return k.name===v.type&&(k.target===v.target||v.target===k.shadowParent)&&Dke(k.delta,b)})[0];if(w&&w.should){v.cancelable&&v.preventDefault();return}if(!w){var N=(o.current.shards||[]).map(B6).filter(Boolean).filter(function(k){return k.contains(v.target)}),j=N.length>0?l(v,N[0]):!o.current.noIsolation;j&&v.cancelable&&v.preventDefault()}}},[]),u=O.useCallback(function(y,v,b,w){var N={name:y,delta:v,target:b,should:w,shadowParent:Fke(b)};e.current.push(N),setTimeout(function(){e.current=e.current.filter(function(j){return j!==N})},1)},[]),f=O.useCallback(function(y){r.current=Wg(y),n.current=void 0},[]),d=O.useCallback(function(y){u(y.type,$6(y),y.target,l(y,t.lockRef.current))},[]),p=O.useCallback(function(y){u(y.type,Wg(y),y.target,l(y,t.lockRef.current))},[]);O.useEffect(function(){return ru.push(s),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:p}),document.addEventListener("wheel",c,tu),document.addEventListener("touchmove",c,tu),document.addEventListener("touchstart",f,tu),function(){ru=ru.filter(function(y){return y!==s}),document.removeEventListener("wheel",c,tu),document.removeEventListener("touchmove",c,tu),document.removeEventListener("touchstart",f,tu)}},[]);var m=t.removeScrollBar,x=t.inert;return O.createElement(O.Fragment,null,x?O.createElement(s,{styles:Lke(i)}):null,m?O.createElement(Eke,{gapMode:t.gapMode}):null)}function Fke(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const qke=mke(F9,Bke);var W9=O.forwardRef(function(t,e){return O.createElement(Px,ws({},t,{ref:e,sideCar:qke}))});W9.classNames=Px.classNames;var zke=[" ","Enter","ArrowUp","ArrowDown"],Uke=[" ","Enter"],Jp="Select",[Mx,Rx,Hke]=wSe(Jp),[_d,EEe]=Yp(Jp,[Hke,_9]),Ix=_9(),[Wke,Ka]=_d(Jp),[Vke,Kke]=_d(Jp),V9=t=>{const{__scopeSelect:e,children:r,open:n,defaultOpen:i,onOpenChange:s,value:o,defaultValue:l,onValueChange:c,dir:u,name:f,autoComplete:d,disabled:p,required:m,form:x}=t,y=Ix(e),[v,b]=O.useState(null),[w,N]=O.useState(null),[j,k]=O.useState(!1),_=SSe(u),[E=!1,A]=v0({prop:n,defaultProp:i,onChange:s}),[T,M]=v0({prop:o,defaultProp:l,onChange:c}),P=O.useRef(null),R=v?x||!!v.closest("form"):!0,[L,$]=O.useState(new Set),F=Array.from(L).map(z=>z.props.value).join(";");return a.jsx(YNe,{...y,children:a.jsxs(Wke,{required:m,scope:e,trigger:v,onTriggerChange:b,valueNode:w,onValueNodeChange:N,valueNodeHasChildren:j,onValueNodeHasChildrenChange:k,contentId:OC(),value:T,onValueChange:M,open:E,onOpenChange:A,dir:_,triggerPointerDownPosRef:P,disabled:p,children:[a.jsx(Mx.Provider,{scope:e,children:a.jsx(Vke,{scope:t.__scopeSelect,onNativeOptionAdd:O.useCallback(z=>{$(W=>new Set(W).add(z))},[]),onNativeOptionRemove:O.useCallback(z=>{$(W=>{const K=new Set(W);return K.delete(z),K})},[]),children:r})}),R?a.jsxs(yH,{"aria-hidden":!0,required:m,tabIndex:-1,name:f,autoComplete:d,value:T,onChange:z=>M(z.target.value),disabled:p,form:x,children:[T===void 0?a.jsx("option",{value:""}):null,Array.from(L)]},F):null]})})};V9.displayName=Jp;var K9="SelectTrigger",G9=O.forwardRef((t,e)=>{const{__scopeSelect:r,disabled:n=!1,...i}=t,s=Ix(r),o=Ka(K9,r),l=o.disabled||n,c=yr(e,o.onTriggerChange),u=Rx(r),f=O.useRef("touch"),[d,p,m]=vH(y=>{const v=u().filter(N=>!N.disabled),b=v.find(N=>N.value===o.value),w=xH(v,y,b);w!==void 0&&o.onValueChange(w.value)}),x=y=>{l||(o.onOpenChange(!0),m()),y&&(o.triggerPointerDownPosRef.current={x:Math.round(y.pageX),y:Math.round(y.pageY)})};return a.jsx(XNe,{asChild:!0,...s,children:a.jsx($t.button,{type:"button",role:"combobox","aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":"none",dir:o.dir,"data-state":o.open?"open":"closed",disabled:l,"data-disabled":l?"":void 0,"data-placeholder":gH(o.value)?"":void 0,...i,ref:c,onClick:Jt(i.onClick,y=>{y.currentTarget.focus(),f.current!=="mouse"&&x(y)}),onPointerDown:Jt(i.onPointerDown,y=>{f.current=y.pointerType;const v=y.target;v.hasPointerCapture(y.pointerId)&&v.releasePointerCapture(y.pointerId),y.button===0&&y.ctrlKey===!1&&y.pointerType==="mouse"&&(x(y),y.preventDefault())}),onKeyDown:Jt(i.onKeyDown,y=>{const v=d.current!=="";!(y.ctrlKey||y.altKey||y.metaKey)&&y.key.length===1&&p(y.key),!(v&&y.key===" ")&&zke.includes(y.key)&&(x(),y.preventDefault())})})})});G9.displayName=K9;var Y9="SelectValue",X9=O.forwardRef((t,e)=>{const{__scopeSelect:r,className:n,style:i,children:s,placeholder:o="",...l}=t,c=Ka(Y9,r),{onValueNodeHasChildrenChange:u}=c,f=s!==void 0,d=yr(e,c.onValueNodeChange);return Sn(()=>{u(f)},[u,f]),a.jsx($t.span,{...l,ref:d,style:{pointerEvents:"none"},children:gH(c.value)?a.jsx(a.Fragment,{children:o}):s})});X9.displayName=Y9;var Gke="SelectIcon",J9=O.forwardRef((t,e)=>{const{__scopeSelect:r,children:n,...i}=t;return a.jsx($t.span,{"aria-hidden":!0,...i,ref:e,children:n||"▼"})});J9.displayName=Gke;var Yke="SelectPortal",Q9=t=>a.jsx(I9,{asChild:!0,...t});Q9.displayName=Yke;var Zl="SelectContent",Z9=O.forwardRef((t,e)=>{const r=Ka(Zl,t.__scopeSelect),[n,i]=O.useState();if(Sn(()=>{i(new DocumentFragment)},[]),!r.open){const s=n;return s?js.createPortal(a.jsx(eH,{scope:t.__scopeSelect,children:a.jsx(Mx.Slot,{scope:t.__scopeSelect,children:a.jsx("div",{children:t.children})})}),s):null}return a.jsx(tH,{...t,ref:e})});Z9.displayName=Zl;var Gi=10,[eH,Ga]=_d(Zl),Xke="SelectContentImpl",Jke=h0("SelectContent.RemoveScroll"),tH=O.forwardRef((t,e)=>{const{__scopeSelect:r,position:n="item-aligned",onCloseAutoFocus:i,onEscapeKeyDown:s,onPointerDownOutside:o,side:l,sideOffset:c,align:u,alignOffset:f,arrowPadding:d,collisionBoundary:p,collisionPadding:m,sticky:x,hideWhenDetached:y,avoidCollisions:v,...b}=t,w=Ka(Zl,r),[N,j]=O.useState(null),[k,_]=O.useState(null),E=yr(e,Y=>j(Y)),[A,T]=O.useState(null),[M,P]=O.useState(null),R=Rx(r),[L,$]=O.useState(!1),F=O.useRef(!1);O.useEffect(()=>{if(N)return ske(N)},[N]),RSe();const z=O.useCallback(Y=>{const[re,...J]=R().map(se=>se.ref.current),[ne]=J.slice(-1),te=document.activeElement;for(const se of Y)if(se===te||(se==null||se.scrollIntoView({block:"nearest"}),se===re&&k&&(k.scrollTop=0),se===ne&&k&&(k.scrollTop=k.scrollHeight),se==null||se.focus(),document.activeElement!==te))return},[R,k]),W=O.useCallback(()=>z([A,N]),[z,A,N]);O.useEffect(()=>{L&&W()},[L,W]);const{onOpenChange:K,triggerPointerDownPosRef:q}=w;O.useEffect(()=>{if(N){let Y={x:0,y:0};const re=ne=>{var te,se;Y={x:Math.abs(Math.round(ne.pageX)-(((te=q.current)==null?void 0:te.x)??0)),y:Math.abs(Math.round(ne.pageY)-(((se=q.current)==null?void 0:se.y)??0))}},J=ne=>{Y.x<=10&&Y.y<=10?ne.preventDefault():N.contains(ne.target)||K(!1),document.removeEventListener("pointermove",re),q.current=null};return q.current!==null&&(document.addEventListener("pointermove",re),document.addEventListener("pointerup",J,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",re),document.removeEventListener("pointerup",J,{capture:!0})}}},[N,K,q]),O.useEffect(()=>{const Y=()=>K(!1);return window.addEventListener("blur",Y),window.addEventListener("resize",Y),()=>{window.removeEventListener("blur",Y),window.removeEventListener("resize",Y)}},[K]);const[V,D]=vH(Y=>{const re=R().filter(te=>!te.disabled),J=re.find(te=>te.ref.current===document.activeElement),ne=xH(re,Y,J);ne&&setTimeout(()=>ne.ref.current.focus())}),U=O.useCallback((Y,re,J)=>{const ne=!F.current&&!J;(w.value!==void 0&&w.value===re||ne)&&(T(Y),ne&&(F.current=!0))},[w.value]),G=O.useCallback(()=>N==null?void 0:N.focus(),[N]),ee=O.useCallback((Y,re,J)=>{const ne=!F.current&&!J;(w.value!==void 0&&w.value===re||ne)&&P(Y)},[w.value]),Q=n==="popper"?dO:rH,H=Q===dO?{side:l,sideOffset:c,align:u,alignOffset:f,arrowPadding:d,collisionBoundary:p,collisionPadding:m,sticky:x,hideWhenDetached:y,avoidCollisions:v}:{};return a.jsx(eH,{scope:r,content:N,viewport:k,onViewportChange:_,itemRefCallback:U,selectedItem:A,onItemLeave:G,itemTextRefCallback:ee,focusSelectedItem:W,selectedItemText:M,position:n,isPositioned:L,searchRef:V,children:a.jsx(W9,{as:Jke,allowPinchZoom:!0,children:a.jsx(f9,{asChild:!0,trapped:w.open,onMountAutoFocus:Y=>{Y.preventDefault()},onUnmountAutoFocus:Jt(i,Y=>{var re;(re=w.trigger)==null||re.focus({preventScroll:!0}),Y.preventDefault()}),children:a.jsx(u9,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:s,onPointerDownOutside:o,onFocusOutside:Y=>Y.preventDefault(),onDismiss:()=>w.onOpenChange(!1),children:a.jsx(Q,{role:"listbox",id:w.contentId,"data-state":w.open?"open":"closed",dir:w.dir,onContextMenu:Y=>Y.preventDefault(),...b,...H,onPlaced:()=>$(!0),ref:E,style:{display:"flex",flexDirection:"column",outline:"none",...b.style},onKeyDown:Jt(b.onKeyDown,Y=>{const re=Y.ctrlKey||Y.altKey||Y.metaKey;if(Y.key==="Tab"&&Y.preventDefault(),!re&&Y.key.length===1&&D(Y.key),["ArrowUp","ArrowDown","Home","End"].includes(Y.key)){let ne=R().filter(te=>!te.disabled).map(te=>te.ref.current);if(["ArrowUp","End"].includes(Y.key)&&(ne=ne.slice().reverse()),["ArrowUp","ArrowDown"].includes(Y.key)){const te=Y.target,se=ne.indexOf(te);ne=ne.slice(se+1)}setTimeout(()=>z(ne)),Y.preventDefault()}})})})})})})});tH.displayName=Xke;var Qke="SelectItemAlignedPosition",rH=O.forwardRef((t,e)=>{const{__scopeSelect:r,onPlaced:n,...i}=t,s=Ka(Zl,r),o=Ga(Zl,r),[l,c]=O.useState(null),[u,f]=O.useState(null),d=yr(e,E=>f(E)),p=Rx(r),m=O.useRef(!1),x=O.useRef(!0),{viewport:y,selectedItem:v,selectedItemText:b,focusSelectedItem:w}=o,N=O.useCallback(()=>{if(s.trigger&&s.valueNode&&l&&u&&y&&v&&b){const E=s.trigger.getBoundingClientRect(),A=u.getBoundingClientRect(),T=s.valueNode.getBoundingClientRect(),M=b.getBoundingClientRect();if(s.dir!=="rtl"){const te=M.left-A.left,se=T.left-te,ve=E.left-se,ie=E.width+ve,ye=Math.max(ie,A.width),Te=window.innerWidth-Gi,Le=v6(se,[Gi,Math.max(Gi,Te-ye)]);l.style.minWidth=ie+"px",l.style.left=Le+"px"}else{const te=A.right-M.right,se=window.innerWidth-T.right-te,ve=window.innerWidth-E.right-se,ie=E.width+ve,ye=Math.max(ie,A.width),Te=window.innerWidth-Gi,Le=v6(se,[Gi,Math.max(Gi,Te-ye)]);l.style.minWidth=ie+"px",l.style.right=Le+"px"}const P=p(),R=window.innerHeight-Gi*2,L=y.scrollHeight,$=window.getComputedStyle(u),F=parseInt($.borderTopWidth,10),z=parseInt($.paddingTop,10),W=parseInt($.borderBottomWidth,10),K=parseInt($.paddingBottom,10),q=F+z+L+K+W,V=Math.min(v.offsetHeight*5,q),D=window.getComputedStyle(y),U=parseInt(D.paddingTop,10),G=parseInt(D.paddingBottom,10),ee=E.top+E.height/2-Gi,Q=R-ee,H=v.offsetHeight/2,Y=v.offsetTop+H,re=F+z+Y,J=q-re;if(re<=ee){const te=P.length>0&&v===P[P.length-1].ref.current;l.style.bottom="0px";const se=u.clientHeight-y.offsetTop-y.offsetHeight,ve=Math.max(Q,H+(te?G:0)+se+W),ie=re+ve;l.style.height=ie+"px"}else{const te=P.length>0&&v===P[0].ref.current;l.style.top="0px";const ve=Math.max(ee,F+y.offsetTop+(te?U:0)+H)+J;l.style.height=ve+"px",y.scrollTop=re-ee+y.offsetTop}l.style.margin=`${Gi}px 0`,l.style.minHeight=V+"px",l.style.maxHeight=R+"px",n==null||n(),requestAnimationFrame(()=>m.current=!0)}},[p,s.trigger,s.valueNode,l,u,y,v,b,s.dir,n]);Sn(()=>N(),[N]);const[j,k]=O.useState();Sn(()=>{u&&k(window.getComputedStyle(u).zIndex)},[u]);const _=O.useCallback(E=>{E&&x.current===!0&&(N(),w==null||w(),x.current=!1)},[N,w]);return a.jsx(e_e,{scope:r,contentWrapper:l,shouldExpandOnScrollRef:m,onScrollButtonChange:_,children:a.jsx("div",{ref:c,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:j},children:a.jsx($t.div,{...i,ref:d,style:{boxSizing:"border-box",maxHeight:"100%",...i.style}})})})});rH.displayName=Qke;var Zke="SelectPopperPosition",dO=O.forwardRef((t,e)=>{const{__scopeSelect:r,align:n="start",collisionPadding:i=Gi,...s}=t,o=Ix(r);return a.jsx(JNe,{...o,...s,ref:e,align:n,collisionPadding:i,style:{boxSizing:"border-box",...s.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});dO.displayName=Zke;var[e_e,BC]=_d(Zl,{}),fO="SelectViewport",nH=O.forwardRef((t,e)=>{const{__scopeSelect:r,nonce:n,...i}=t,s=Ga(fO,r),o=BC(fO,r),l=yr(e,s.onViewportChange),c=O.useRef(0);return a.jsxs(a.Fragment,{children:[a.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),a.jsx(Mx.Slot,{scope:r,children:a.jsx($t.div,{"data-radix-select-viewport":"",role:"presentation",...i,ref:l,style:{position:"relative",flex:1,overflow:"hidden auto",...i.style},onScroll:Jt(i.onScroll,u=>{const f=u.currentTarget,{contentWrapper:d,shouldExpandOnScrollRef:p}=o;if(p!=null&&p.current&&d){const m=Math.abs(c.current-f.scrollTop);if(m>0){const x=window.innerHeight-Gi*2,y=parseFloat(d.style.minHeight),v=parseFloat(d.style.height),b=Math.max(y,v);if(b<x){const w=b+m,N=Math.min(x,w),j=w-N;d.style.height=N+"px",d.style.bottom==="0px"&&(f.scrollTop=j>0?j:0,d.style.justifyContent="flex-end")}}}c.current=f.scrollTop})})})]})});nH.displayName=fO;var iH="SelectGroup",[t_e,r_e]=_d(iH),n_e=O.forwardRef((t,e)=>{const{__scopeSelect:r,...n}=t,i=OC();return a.jsx(t_e,{scope:r,id:i,children:a.jsx($t.div,{role:"group","aria-labelledby":i,...n,ref:e})})});n_e.displayName=iH;var sH="SelectLabel",oH=O.forwardRef((t,e)=>{const{__scopeSelect:r,...n}=t,i=r_e(sH,r);return a.jsx($t.div,{id:i.id,...n,ref:e})});oH.displayName=sH;var x0="SelectItem",[i_e,aH]=_d(x0),lH=O.forwardRef((t,e)=>{const{__scopeSelect:r,value:n,disabled:i=!1,textValue:s,...o}=t,l=Ka(x0,r),c=Ga(x0,r),u=l.value===n,[f,d]=O.useState(s??""),[p,m]=O.useState(!1),x=yr(e,w=>{var N;return(N=c.itemRefCallback)==null?void 0:N.call(c,w,n,i)}),y=OC(),v=O.useRef("touch"),b=()=>{i||(l.onValueChange(n),l.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return a.jsx(i_e,{scope:r,value:n,disabled:i,textId:y,isSelected:u,onItemTextChange:O.useCallback(w=>{d(N=>N||((w==null?void 0:w.textContent)??"").trim())},[]),children:a.jsx(Mx.ItemSlot,{scope:r,value:n,disabled:i,textValue:f,children:a.jsx($t.div,{role:"option","aria-labelledby":y,"data-highlighted":p?"":void 0,"aria-selected":u&&p,"data-state":u?"checked":"unchecked","aria-disabled":i||void 0,"data-disabled":i?"":void 0,tabIndex:i?void 0:-1,...o,ref:x,onFocus:Jt(o.onFocus,()=>m(!0)),onBlur:Jt(o.onBlur,()=>m(!1)),onClick:Jt(o.onClick,()=>{v.current!=="mouse"&&b()}),onPointerUp:Jt(o.onPointerUp,()=>{v.current==="mouse"&&b()}),onPointerDown:Jt(o.onPointerDown,w=>{v.current=w.pointerType}),onPointerMove:Jt(o.onPointerMove,w=>{var N;v.current=w.pointerType,i?(N=c.onItemLeave)==null||N.call(c):v.current==="mouse"&&w.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Jt(o.onPointerLeave,w=>{var N;w.currentTarget===document.activeElement&&((N=c.onItemLeave)==null||N.call(c))}),onKeyDown:Jt(o.onKeyDown,w=>{var j;((j=c.searchRef)==null?void 0:j.current)!==""&&w.key===" "||(Uke.includes(w.key)&&b(),w.key===" "&&w.preventDefault())})})})})});lH.displayName=x0;var Gf="SelectItemText",cH=O.forwardRef((t,e)=>{const{__scopeSelect:r,className:n,style:i,...s}=t,o=Ka(Gf,r),l=Ga(Gf,r),c=aH(Gf,r),u=Kke(Gf,r),[f,d]=O.useState(null),p=yr(e,b=>d(b),c.onItemTextChange,b=>{var w;return(w=l.itemTextRefCallback)==null?void 0:w.call(l,b,c.value,c.disabled)}),m=f==null?void 0:f.textContent,x=O.useMemo(()=>a.jsx("option",{value:c.value,disabled:c.disabled,children:m},c.value),[c.disabled,c.value,m]),{onNativeOptionAdd:y,onNativeOptionRemove:v}=u;return Sn(()=>(y(x),()=>v(x)),[y,v,x]),a.jsxs(a.Fragment,{children:[a.jsx($t.span,{id:c.textId,...s,ref:p}),c.isSelected&&o.valueNode&&!o.valueNodeHasChildren?js.createPortal(s.children,o.valueNode):null]})});cH.displayName=Gf;var uH="SelectItemIndicator",dH=O.forwardRef((t,e)=>{const{__scopeSelect:r,...n}=t;return aH(uH,r).isSelected?a.jsx($t.span,{"aria-hidden":!0,...n,ref:e}):null});dH.displayName=uH;var hO="SelectScrollUpButton",fH=O.forwardRef((t,e)=>{const r=Ga(hO,t.__scopeSelect),n=BC(hO,t.__scopeSelect),[i,s]=O.useState(!1),o=yr(e,n.onScrollButtonChange);return Sn(()=>{if(r.viewport&&r.isPositioned){let l=function(){const u=c.scrollTop>0;s(u)};const c=r.viewport;return l(),c.addEventListener("scroll",l),()=>c.removeEventListener("scroll",l)}},[r.viewport,r.isPositioned]),i?a.jsx(pH,{...t,ref:o,onAutoScroll:()=>{const{viewport:l,selectedItem:c}=r;l&&c&&(l.scrollTop=l.scrollTop-c.offsetHeight)}}):null});fH.displayName=hO;var pO="SelectScrollDownButton",hH=O.forwardRef((t,e)=>{const r=Ga(pO,t.__scopeSelect),n=BC(pO,t.__scopeSelect),[i,s]=O.useState(!1),o=yr(e,n.onScrollButtonChange);return Sn(()=>{if(r.viewport&&r.isPositioned){let l=function(){const u=c.scrollHeight-c.clientHeight,f=Math.ceil(c.scrollTop)<u;s(f)};const c=r.viewport;return l(),c.addEventListener("scroll",l),()=>c.removeEventListener("scroll",l)}},[r.viewport,r.isPositioned]),i?a.jsx(pH,{...t,ref:o,onAutoScroll:()=>{const{viewport:l,selectedItem:c}=r;l&&c&&(l.scrollTop=l.scrollTop+c.offsetHeight)}}):null});hH.displayName=pO;var pH=O.forwardRef((t,e)=>{const{__scopeSelect:r,onAutoScroll:n,...i}=t,s=Ga("SelectScrollButton",r),o=O.useRef(null),l=Rx(r),c=O.useCallback(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return O.useEffect(()=>()=>c(),[c]),Sn(()=>{var f;const u=l().find(d=>d.ref.current===document.activeElement);(f=u==null?void 0:u.ref.current)==null||f.scrollIntoView({block:"nearest"})},[l]),a.jsx($t.div,{"aria-hidden":!0,...i,ref:e,style:{flexShrink:0,...i.style},onPointerDown:Jt(i.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(n,50))}),onPointerMove:Jt(i.onPointerMove,()=>{var u;(u=s.onItemLeave)==null||u.call(s),o.current===null&&(o.current=window.setInterval(n,50))}),onPointerLeave:Jt(i.onPointerLeave,()=>{c()})})}),s_e="SelectSeparator",mH=O.forwardRef((t,e)=>{const{__scopeSelect:r,...n}=t;return a.jsx($t.div,{"aria-hidden":!0,...n,ref:e})});mH.displayName=s_e;var mO="SelectArrow",o_e=O.forwardRef((t,e)=>{const{__scopeSelect:r,...n}=t,i=Ix(r),s=Ka(mO,r),o=Ga(mO,r);return s.open&&o.position==="popper"?a.jsx(QNe,{...i,...n,ref:e}):null});o_e.displayName=mO;function gH(t){return t===""||t===void 0}var yH=O.forwardRef((t,e)=>{const{value:r,...n}=t,i=O.useRef(null),s=yr(e,i),o=$C(r);return O.useEffect(()=>{const l=i.current,c=window.HTMLSelectElement.prototype,f=Object.getOwnPropertyDescriptor(c,"value").set;if(o!==r&&f){const d=new Event("change",{bubbles:!0});f.call(l,r),l.dispatchEvent(d)}},[o,r]),a.jsx(D9,{asChild:!0,children:a.jsx("select",{...n,ref:s,defaultValue:r})})});yH.displayName="BubbleSelect";function vH(t){const e=wo(t),r=O.useRef(""),n=O.useRef(0),i=O.useCallback(o=>{const l=r.current+o;e(l),function c(u){r.current=u,window.clearTimeout(n.current),u!==""&&(n.current=window.setTimeout(()=>c(""),1e3))}(l)},[e]),s=O.useCallback(()=>{r.current="",window.clearTimeout(n.current)},[]);return O.useEffect(()=>()=>window.clearTimeout(n.current),[]),[r,i,s]}function xH(t,e,r){const i=e.length>1&&Array.from(e).every(u=>u===e[0])?e[0]:e,s=r?t.indexOf(r):-1;let o=a_e(t,Math.max(s,0));i.length===1&&(o=o.filter(u=>u!==r));const c=o.find(u=>u.textValue.toLowerCase().startsWith(i.toLowerCase()));return c!==r?c:void 0}function a_e(t,e){return t.map((r,n)=>t[(e+n)%t.length])}var l_e=V9,bH=G9,c_e=X9,u_e=J9,d_e=Q9,wH=Z9,f_e=nH,jH=oH,SH=lH,h_e=cH,p_e=dH,NH=fH,kH=hH,_H=mH;const ec=l_e,tc=c_e,Da=O.forwardRef(({className:t,children:e,...r},n)=>a.jsxs(bH,{ref:n,className:ge("flex h-10 w-full items-center justify-between rounded-md border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...r,children:[e,a.jsx(u_e,{asChild:!0,children:a.jsx(mo,{className:"h-4 w-4 opacity-50"})})]}));Da.displayName=bH.displayName;const OH=O.forwardRef(({className:t,...e},r)=>a.jsx(NH,{ref:r,className:ge("flex cursor-default items-center justify-center py-1",t),...e,children:a.jsx(CO,{className:"h-4 w-4"})}));OH.displayName=NH.displayName;const EH=O.forwardRef(({className:t,...e},r)=>a.jsx(kH,{ref:r,className:ge("flex cursor-default items-center justify-center py-1",t),...e,children:a.jsx(mo,{className:"h-4 w-4"})}));EH.displayName=kH.displayName;const La=O.forwardRef(({className:t,children:e,position:r="popper",...n},i)=>a.jsx(d_e,{children:a.jsxs(wH,{ref:i,className:ge("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white text-gray-900 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...n,children:[a.jsx(OH,{}),a.jsx(f_e,{className:ge("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),a.jsx(EH,{})]})}));La.displayName=wH.displayName;const m_e=O.forwardRef(({className:t,...e},r)=>a.jsx(jH,{ref:r,className:ge("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...e}));m_e.displayName=jH.displayName;const kt=O.forwardRef(({className:t,children:e,...r},n)=>a.jsxs(SH,{ref:n,className:ge("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(p_e,{children:a.jsx(ko,{className:"h-4 w-4"})})}),a.jsx(h_e,{children:e})]}));kt.displayName=SH.displayName;const g_e=O.forwardRef(({className:t,...e},r)=>a.jsx(_H,{ref:r,className:ge("-mx-1 my-1 h-px bg-gray-200",t),...e}));g_e.displayName=_H.displayName;function y_e({block:t,isEditing:e=!1,isSelected:r=!1,onContentChange:n}){const i=t.content,{title:s="",subtitle:o,level:l=2}=i||{},[c,u]=O.useState(l),f=Rv({extensions:[d0.configure({heading:!1,paragraph:!1}),xp,bp,f0,u0.configure({placeholder:"Enter section title..."})],content:`<p>${s}</p>`,editable:e&&r,onUpdate:({editor:b})=>{if(n&&e){const w=b.getText();n({...i,title:w,level:c})}}}),d=Rv({extensions:[d0.configure({heading:!1}),xp,bp,f0,u0.configure({placeholder:"Optional subtitle..."})],content:`<p>${o||""}</p>`,editable:e&&r,onUpdate:({editor:b})=>{if(n&&e){const w=b.getText().trim();n({...i,title:(f==null?void 0:f.getText())||s,subtitle:w||void 0,level:c})}}});O.useEffect(()=>{f&&f.getText()!==s&&f.commands.setContent(`<p>${s}</p>`)},[f,s]),O.useEffect(()=>{d&&d.getText()!==(o||"")&&d.commands.setContent(`<p>${o||""}</p>`)},[d,o]),O.useEffect(()=>{f==null||f.setEditable(e&&r),d==null||d.setEditable(e&&r)},[f,d,e,r]);const p=b=>{b==null||b.chain().focus().toggleBold().run()},m=b=>{b==null||b.chain().focus().toggleItalic().run()},x=b=>{const w=parseInt(b);u(w),n&&n({...i,title:(f==null?void 0:f.getText())||s,subtitle:(d==null?void 0:d.getText().trim())||void 0,level:w})},y={1:"text-4xl font-bold",2:"text-3xl font-bold",3:"text-2xl font-semibold",4:"text-xl font-semibold",5:"text-lg font-medium",6:"text-base font-medium"},v=`h${c}`;return a.jsxs("div",{className:ge("space-y-3",r&&e&&"ring-2 ring-blue-500 ring-offset-2 rounded-lg p-3"),children:[e&&r&&a.jsxs("div",{className:"mb-4 p-3 border border-gray-200 rounded-lg bg-gray-50",children:[a.jsxs("div",{className:"flex items-center space-x-4 mb-3",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Heading Level:"}),a.jsxs(ec,{value:c.toString(),onValueChange:x,children:[a.jsx(Da,{className:"w-32",children:a.jsx(tc,{})}),a.jsxs(La,{children:[a.jsx(kt,{value:"1",children:"H1 - Largest"}),a.jsx(kt,{value:"2",children:"H2 - Large"}),a.jsx(kt,{value:"3",children:"H3 - Medium"}),a.jsx(kt,{value:"4",children:"H4 - Small"}),a.jsx(kt,{value:"5",children:"H5 - Smaller"}),a.jsx(kt,{value:"6",children:"H6 - Smallest"})]})]})]}),a.jsxs("div",{className:"flex items-center space-x-1 mb-2",children:[a.jsx("span",{className:"text-sm text-gray-600 mr-2",children:"Title:"}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>p(f),className:ge("h-8 w-8 p-0",(f==null?void 0:f.isActive("bold"))&&"bg-gray-200"),children:a.jsx(my,{className:"w-4 h-4"})}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>m(f),className:ge("h-8 w-8 p-0",(f==null?void 0:f.isActive("italic"))&&"bg-gray-200"),children:a.jsx(vy,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx("span",{className:"text-sm text-gray-600 mr-2",children:"Subtitle:"}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>p(d),className:ge("h-8 w-8 p-0",(d==null?void 0:d.isActive("bold"))&&"bg-gray-200"),children:a.jsx(my,{className:"w-4 h-4"})}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>m(d),className:ge("h-8 w-8 p-0",(d==null?void 0:d.isActive("italic"))&&"bg-gray-200"),children:a.jsx(vy,{className:"w-4 h-4"})})]})]}),a.jsx("div",{className:ge(y[c],"text-gray-900 leading-tight"),children:e&&r?a.jsx(Mv,{editor:f}):a.jsx(v,{className:ge(y[c],"text-gray-900 leading-tight"),children:s})}),(o||e&&r)&&a.jsx("div",{className:"text-gray-600 leading-relaxed",children:e&&r?a.jsx(Mv,{editor:d}):o?a.jsx("p",{className:"text-gray-600 leading-relaxed",children:o}):null}),e&&r&&!(f!=null&&f.getText().trim())&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none opacity-50",children:a.jsx("p",{className:"text-gray-400 text-sm",children:"Click to add section title..."})})]})}const v_e=Mi(y_e);var CH=Ct.create({name:"textAlign",addOptions(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:null}},addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:t=>{const e=t.style.textAlign;return this.options.alignments.includes(e)?e:this.options.defaultAlignment},renderHTML:t=>t.textAlign?{style:`text-align: ${t.textAlign}`}:{}}}}]},addCommands(){return{setTextAlign:t=>({commands:e})=>this.options.alignments.includes(t)?this.options.types.map(r=>e.updateAttributes(r,{textAlign:t})).every(r=>r):!1,unsetTextAlign:()=>({commands:t})=>this.options.types.map(e=>t.resetAttributes(e,"textAlign")).every(e=>e),toggleTextAlign:t=>({editor:e,commands:r})=>this.options.alignments.includes(t)?e.isActive({textAlign:t})?r.unsetTextAlign():r.setTextAlign(t):!1}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}});function x_e({block:t,isEditing:e=!1,isSelected:r=!1,onContentChange:n}){const i=t.content,{html:s="<p>Enter your text here...</p>",text:o="Enter your text here..."}=i||{},l=Rv({extensions:[d0.configure({bulletList:{keepMarks:!0,keepAttributes:!1},orderedList:{keepMarks:!0,keepAttributes:!1}}),xp,bp,CH.configure({types:["heading","paragraph"]}),NC.configure({openOnClick:!1,HTMLAttributes:{class:"text-blue-600 hover:text-blue-800 underline"}}),f0,u0.configure({placeholder:"Start typing your content here..."})],content:s,editable:e&&r,onUpdate:({editor:v})=>{if(n&&e){const b=v.getHTML(),w=v.getText();n({html:b,text:w})}}});O.useEffect(()=>{l&&l.getHTML()!==s&&l.commands.setContent(s)},[l,s]),O.useEffect(()=>{l&&l.setEditable(e&&r)},[l,e,r]);const c=O.useCallback(()=>{l==null||l.chain().focus().toggleBold().run()},[l]),u=O.useCallback(()=>{l==null||l.chain().focus().toggleItalic().run()},[l]),f=O.useCallback(()=>{l==null||l.chain().focus().toggleUnderline().run()},[l]),d=O.useCallback(()=>{l==null||l.chain().focus().toggleStrike().run()},[l]),p=O.useCallback(v=>{l==null||l.chain().focus().setTextAlign(v).run()},[l]),m=O.useCallback(()=>{l==null||l.chain().focus().toggleBulletList().run()},[l]),x=O.useCallback(()=>{l==null||l.chain().focus().toggleOrderedList().run()},[l]),y=O.useCallback(()=>{const v=l==null?void 0:l.getAttributes("link").href,b=window.prompt("URL",v);if(b!==null){if(b===""){l==null||l.chain().focus().extendMarkRange("link").unsetLink().run();return}l==null||l.chain().focus().extendMarkRange("link").setLink({href:b}).run()}},[l]);return l?a.jsxs("div",{className:ge("relative",r&&e&&"ring-2 ring-blue-500 ring-offset-2 rounded-lg"),children:[e&&r&&a.jsxs("div",{className:"mb-4 p-2 border border-gray-200 rounded-lg bg-gray-50 flex flex-wrap gap-1",children:[a.jsx(fe,{variant:"ghost",size:"sm",onClick:c,className:ge("h-8 w-8 p-0",l.isActive("bold")&&"bg-gray-200"),children:a.jsx(my,{className:"w-4 h-4"})}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:u,className:ge("h-8 w-8 p-0",l.isActive("italic")&&"bg-gray-200"),children:a.jsx(vy,{className:"w-4 h-4"})}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:f,className:ge("h-8 w-8 p-0",l.isActive("underline")&&"bg-gray-200"),children:a.jsx(qB,{className:"w-4 h-4"})}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:d,className:ge("h-8 w-8 p-0",l.isActive("strike")&&"bg-gray-200"),children:a.jsx(BB,{className:"w-4 h-4"})}),a.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>p("left"),className:ge("h-8 w-8 p-0",l.isActive({textAlign:"left"})&&"bg-gray-200"),children:a.jsx(PB,{className:"w-4 h-4"})}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>p("center"),className:ge("h-8 w-8 p-0",l.isActive({textAlign:"center"})&&"bg-gray-200"),children:a.jsx(TB,{className:"w-4 h-4"})}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>p("right"),className:ge("h-8 w-8 p-0",l.isActive({textAlign:"right"})&&"bg-gray-200"),children:a.jsx(MB,{className:"w-4 h-4"})}),a.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:m,className:ge("h-8 w-8 p-0",l.isActive("bulletList")&&"bg-gray-200"),children:a.jsx(rs,{className:"w-4 h-4"})}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:x,className:ge("h-8 w-8 p-0",l.isActive("orderedList")&&"bg-gray-200"),children:a.jsx(MO,{className:"w-4 h-4"})}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:y,className:ge("h-8 w-8 p-0",l.isActive("link")&&"bg-gray-200"),children:a.jsx(E0,{className:"w-4 h-4"})})]}),a.jsx("div",{className:ge("prose prose-gray max-w-none focus:outline-none",e&&r&&"min-h-[100px]"),children:a.jsx(Mv,{editor:l})}),e&&r&&l.getText().length===0&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:a.jsx("p",{className:"text-gray-400 text-sm",children:"Click to start typing..."})})]}):a.jsxs("div",{className:"prose prose-gray max-w-none animate-pulse",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})}const b_e=Mi(x_e);function w_e({block:t,isEditing:e=!1,isSelected:r=!1,onContentChange:n}){const i=t.content,{src:s="",alt:o="",caption:l,width:c,height:u}=i||{},[f,d]=O.useState(!1),[p,m]=O.useState(!!s),[x,y]=O.useState(!1),[v,b]=O.useState(!1),[w,N]=O.useState(l||""),[j,k]=O.useState(o||""),[_,E]=O.useState(!1),A=O.useRef(null),T=()=>{m(!1),d(!1)},M=()=>{d(!0),m(!1)},P=()=>{var z;(z=A.current)==null||z.click()},R=async z=>{var K;const W=(K=z.target.files)==null?void 0:K[0];if(W){if(!W.type.startsWith("image/")){alert("Please select an image file");return}if(W.size>5*1024*1024){alert("Image size must be less than 5MB");return}try{y(!0),d(!1);const q=await new Promise((Q,H)=>{const Y=new FileReader;Y.onloadend=()=>Q(Y.result),Y.onerror=H,Y.readAsDataURL(W)}),{data:V,error:D}=await pe.functions.invoke("enhanced-file-upload",{body:{fileData:q,fileName:W.name,fileType:W.type,folder:"page-builder/images"}});if(D)throw console.error("Upload error:",D),new Error(D.message||"Failed to upload image");if(V!=null&&V.error)throw new Error(V.error.message||"Failed to upload image");const G=V.data.publicUrl,ee={...i,src:G,alt:o||W.name.split(".")[0],width:void 0,height:void 0};n==null||n(ee),m(!0)}catch(q){console.error("Error uploading image:",q),alert(`Failed to upload image: ${q.message}`)}finally{y(!1),A.current&&(A.current.value="")}}},L=async()=>{const z=prompt("Enter image URL:");if(z)try{m(!0),d(!1);const W={...i,src:z,alt:o||"Image from URL"};n==null||n(W)}catch(W){console.error("Error setting image URL:",W),d(!0),m(!1)}},$=()=>{const z={...i,caption:w.trim()||void 0,alt:j.trim()||o};n==null||n(z),b(!1)},F=()=>{N(l||""),k(o||""),b(!1)};return s?f?a.jsx("div",{className:"flex items-center justify-center min-h-48 bg-red-50 border-2 border-dashed border-red-300 rounded-lg",children:a.jsxs("div",{className:"text-center p-8",children:[a.jsx("div",{className:"text-red-400 mb-4",children:a.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"})})}),a.jsx("h4",{className:"text-lg font-medium text-red-800 mb-2",children:"Failed to load image"}),a.jsx("p",{className:"text-red-600 text-sm mb-4 break-all max-w-md",children:s}),e&&a.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center",children:[a.jsxs(fe,{onClick:P,size:"sm",className:"flex items-center space-x-2",children:[a.jsx(Ir,{className:"w-4 h-4"}),a.jsx("span",{children:"Upload New"})]}),a.jsxs(fe,{onClick:L,variant:"outline",size:"sm",className:"flex items-center space-x-2",children:[a.jsx(Os,{className:"w-4 h-4"}),a.jsx("span",{children:"Try URL"})]})]})]})}):a.jsxs("figure",{className:ge("space-y-4 relative group",r&&e&&"ring-2 ring-blue-500 ring-offset-2 rounded-lg p-3"),children:[r&&e&&a.jsxs("div",{className:"absolute -top-2 -right-2 z-10 flex space-x-2",children:[a.jsx(fe,{onClick:()=>b(!v),size:"sm",variant:"outline",className:"h-8 w-8 p-0 bg-white border-gray-300 hover:bg-gray-50 shadow-lg",title:"Edit caption and alt text",children:a.jsx(yo,{className:"w-4 h-4"})}),a.jsx(fe,{onClick:P,size:"sm",variant:"outline",className:"h-8 w-8 p-0 bg-white border-gray-300 hover:bg-gray-50 shadow-lg",title:"Replace image",children:a.jsx(Ir,{className:"w-4 h-4"})})]}),v&&e&&a.jsxs("div",{className:"bg-white border border-gray-300 rounded-lg p-4 shadow-lg space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alt Text (for accessibility)"}),a.jsx(ct,{value:j,onChange:z=>k(z.target.value),placeholder:"Describe the image for screen readers",className:"text-sm"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Caption (optional)"}),a.jsx(ct,{value:w,onChange:z=>N(z.target.value),placeholder:"Add a caption for the image",className:"text-sm"})]}),a.jsxs("div",{className:"flex justify-end space-x-2",children:[a.jsx(fe,{onClick:F,size:"sm",variant:"outline",children:"Cancel"}),a.jsxs(fe,{onClick:$,size:"sm",className:"flex items-center space-x-1",children:[a.jsx(ko,{className:"w-4 h-4"}),a.jsx("span",{children:"Save"})]})]})]}),a.jsxs("div",{className:"relative overflow-hidden rounded-lg",children:[(p||x)&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg z-10",children:a.jsxs("div",{className:"text-center",children:[a.jsx(i_,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-2"}),a.jsx("p",{className:"text-sm text-gray-600",children:x?"Uploading...":"Loading..."})]})}),a.jsx("img",{src:s,alt:o,onLoad:T,onError:M,onClick:()=>!e&&E(!0),className:ge("max-w-full h-auto",!e&&"cursor-pointer hover:opacity-90 transition-opacity",(p||x)&&"opacity-0"),style:{width:c||"auto",height:u||"auto"}}),!e&&a.jsx("button",{onClick:()=>E(!0),className:"absolute top-3 right-3 bg-black bg-opacity-50 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",title:"View fullscreen",children:a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}),l&&a.jsx("figcaption",{className:"text-sm text-gray-600 text-center italic px-4",children:l}),a.jsx("input",{ref:A,type:"file",accept:"image/*",onChange:R,className:"hidden"}),_&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"relative max-w-full max-h-full",children:[a.jsx("button",{onClick:()=>E(!1),className:"absolute -top-12 right-0 text-white hover:text-gray-300 text-2xl font-bold z-10",children:"×"}),a.jsx("img",{src:s,alt:o,className:"max-w-full max-h-full object-contain"}),l&&a.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-75 text-white p-4 text-center",children:a.jsx("p",{className:"text-lg",children:l})})]})})]}):e?a.jsx("div",{className:"flex items-center justify-center min-h-48 bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors",children:a.jsxs("div",{className:"text-center p-8",children:[a.jsx(Eu,{className:"w-16 h-16 text-gray-400 mx-auto mb-6"}),a.jsx("h4",{className:"text-xl font-medium text-gray-900 mb-3",children:"Add Image"}),a.jsx("p",{className:"text-gray-600 text-sm mb-6 max-w-sm",children:"Upload an image file or provide a URL to display in this block."}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[a.jsx(fe,{onClick:P,disabled:x,className:"flex items-center space-x-2",children:x?a.jsxs(a.Fragment,{children:[a.jsx(i_,{className:"w-4 h-4 animate-spin"}),a.jsx("span",{children:"Uploading..."})]}):a.jsxs(a.Fragment,{children:[a.jsx(Ir,{className:"w-4 h-4"}),a.jsx("span",{children:"Upload Image"})]})}),a.jsxs(fe,{onClick:L,variant:"outline",className:"flex items-center space-x-2",children:[a.jsx(Os,{className:"w-4 h-4"}),a.jsx("span",{children:"From URL"})]})]}),a.jsx("input",{ref:A,type:"file",accept:"image/*",onChange:R,className:"hidden"})]})}):a.jsx("div",{className:"flex items-center justify-center h-48 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg",children:a.jsxs("div",{className:"text-center",children:[a.jsx(Eu,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),a.jsx("p",{className:"text-gray-500 text-sm",children:"No image selected"})]})})}const j_e=Mi(w_e);function S_e(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return O.useMemo(()=>n=>{e.forEach(i=>i(n))},e)}const Dx=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Od(t){const e=Object.prototype.toString.call(t);return e==="[object Window]"||e==="[object global]"}function FC(t){return"nodeType"in t}function Nn(t){var e,r;return t?Od(t)?t:FC(t)&&(e=(r=t.ownerDocument)==null?void 0:r.defaultView)!=null?e:window:window}function qC(t){const{Document:e}=Nn(t);return t instanceof e}function Qp(t){return Od(t)?!1:t instanceof Nn(t).HTMLElement}function AH(t){return t instanceof Nn(t).SVGElement}function Ed(t){return t?Od(t)?t.document:FC(t)?qC(t)?t:Qp(t)||AH(t)?t.ownerDocument:document:document:document}const ls=Dx?O.useLayoutEffect:O.useEffect;function Lx(t){const e=O.useRef(t);return ls(()=>{e.current=t}),O.useCallback(function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return e.current==null?void 0:e.current(...n)},[])}function N_e(){const t=O.useRef(null),e=O.useCallback((n,i)=>{t.current=setInterval(n,i)},[]),r=O.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[e,r]}function Sp(t,e){e===void 0&&(e=[t]);const r=O.useRef(t);return ls(()=>{r.current!==t&&(r.current=t)},e),r}function Zp(t,e){const r=O.useRef();return O.useMemo(()=>{const n=t(r.current);return r.current=n,n},[...e])}function b0(t){const e=Lx(t),r=O.useRef(null),n=O.useCallback(i=>{i!==r.current&&(e==null||e(i,r.current)),r.current=i},[]);return[r,n]}function w0(t){const e=O.useRef();return O.useEffect(()=>{e.current=t},[t]),e.current}let Dk={};function em(t,e){return O.useMemo(()=>{if(e)return e;const r=Dk[t]==null?0:Dk[t]+1;return Dk[t]=r,t+"-"+r},[t,e])}function TH(t){return function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return n.reduce((s,o)=>{const l=Object.entries(o);for(const[c,u]of l){const f=s[c];f!=null&&(s[c]=f+t*u)}return s},{...e})}}const ku=TH(1),j0=TH(-1);function k_e(t){return"clientX"in t&&"clientY"in t}function $x(t){if(!t)return!1;const{KeyboardEvent:e}=Nn(t.target);return e&&t instanceof e}function __e(t){if(!t)return!1;const{TouchEvent:e}=Nn(t.target);return e&&t instanceof e}function S0(t){if(__e(t)){if(t.touches&&t.touches.length){const{clientX:e,clientY:r}=t.touches[0];return{x:e,y:r}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:e,clientY:r}=t.changedTouches[0];return{x:e,y:r}}}return k_e(t)?{x:t.clientX,y:t.clientY}:null}const Rs=Object.freeze({Translate:{toString(t){if(!t)return;const{x:e,y:r}=t;return"translate3d("+(e?Math.round(e):0)+"px, "+(r?Math.round(r):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:e,scaleY:r}=t;return"scaleX("+e+") scaleY("+r+")"}},Transform:{toString(t){if(t)return[Rs.Translate.toString(t),Rs.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:e,duration:r,easing:n}=t;return e+" "+r+"ms "+n}}}),F6="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function O_e(t){return t.matches(F6)?t:t.querySelector(F6)}const E_e={display:"none"};function C_e(t){let{id:e,value:r}=t;return Z.createElement("div",{id:e,style:E_e},r)}function A_e(t){let{id:e,announcement:r,ariaLiveType:n="assertive"}=t;const i={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Z.createElement("div",{id:e,style:i,role:"status","aria-live":n,"aria-atomic":!0},r)}function T_e(){const[t,e]=O.useState("");return{announce:O.useCallback(n=>{n!=null&&e(n)},[]),announcement:t}}const PH=O.createContext(null);function P_e(t){const e=O.useContext(PH);O.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(t)},[t,e])}function M_e(){const[t]=O.useState(()=>new Set),e=O.useCallback(n=>(t.add(n),()=>t.delete(n)),[t]);return[O.useCallback(n=>{let{type:i,event:s}=n;t.forEach(o=>{var l;return(l=o[i])==null?void 0:l.call(o,s)})},[t]),e]}const R_e={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},I_e={onDragStart(t){let{active:e}=t;return"Picked up draggable item "+e.id+"."},onDragOver(t){let{active:e,over:r}=t;return r?"Draggable item "+e.id+" was moved over droppable area "+r.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(t){let{active:e,over:r}=t;return r?"Draggable item "+e.id+" was dropped over droppable area "+r.id:"Draggable item "+e.id+" was dropped."},onDragCancel(t){let{active:e}=t;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function D_e(t){let{announcements:e=I_e,container:r,hiddenTextDescribedById:n,screenReaderInstructions:i=R_e}=t;const{announce:s,announcement:o}=T_e(),l=em("DndLiveRegion"),[c,u]=O.useState(!1);if(O.useEffect(()=>{u(!0)},[]),P_e(O.useMemo(()=>({onDragStart(d){let{active:p}=d;s(e.onDragStart({active:p}))},onDragMove(d){let{active:p,over:m}=d;e.onDragMove&&s(e.onDragMove({active:p,over:m}))},onDragOver(d){let{active:p,over:m}=d;s(e.onDragOver({active:p,over:m}))},onDragEnd(d){let{active:p,over:m}=d;s(e.onDragEnd({active:p,over:m}))},onDragCancel(d){let{active:p,over:m}=d;s(e.onDragCancel({active:p,over:m}))}}),[s,e])),!c)return null;const f=Z.createElement(Z.Fragment,null,Z.createElement(C_e,{id:n,value:i.draggable}),Z.createElement(A_e,{id:l,announcement:o}));return r?js.createPortal(f,r):f}var Sr;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(Sr||(Sr={}));function N0(){}function Bx(t,e){return O.useMemo(()=>({sensor:t,options:e??{}}),[t,e])}function Fx(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return O.useMemo(()=>[...e].filter(n=>n!=null),[...e])}const cs=Object.freeze({x:0,y:0});function L_e(t,e){const r=S0(t);if(!r)return"0 0";const n={x:(r.x-e.left)/e.width*100,y:(r.y-e.top)/e.height*100};return n.x+"% "+n.y+"%"}function $_e(t,e){let{data:{value:r}}=t,{data:{value:n}}=e;return n-r}function B_e(t,e){if(!t||t.length===0)return null;const[r]=t;return r[e]}function F_e(t,e){const r=Math.max(e.top,t.top),n=Math.max(e.left,t.left),i=Math.min(e.left+e.width,t.left+t.width),s=Math.min(e.top+e.height,t.top+t.height),o=i-n,l=s-r;if(n<i&&r<s){const c=e.width*e.height,u=t.width*t.height,f=o*l,d=f/(c+u-f);return Number(d.toFixed(4))}return 0}const q_e=t=>{let{collisionRect:e,droppableRects:r,droppableContainers:n}=t;const i=[];for(const s of n){const{id:o}=s,l=r.get(o);if(l){const c=F_e(l,e);c>0&&i.push({id:o,data:{droppableContainer:s,value:c}})}}return i.sort($_e)};function z_e(t,e,r){return{...t,scaleX:e&&r?e.width/r.width:1,scaleY:e&&r?e.height/r.height:1}}function MH(t,e){return t&&e?{x:t.left-e.left,y:t.top-e.top}:cs}function U_e(t){return function(r){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return i.reduce((o,l)=>({...o,top:o.top+t*l.y,bottom:o.bottom+t*l.y,left:o.left+t*l.x,right:o.right+t*l.x}),{...r})}}const H_e=U_e(1);function RH(t){if(t.startsWith("matrix3d(")){const e=t.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(t.startsWith("matrix(")){const e=t.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function W_e(t,e,r){const n=RH(e);if(!n)return t;const{scaleX:i,scaleY:s,x:o,y:l}=n,c=t.left-o-(1-i)*parseFloat(r),u=t.top-l-(1-s)*parseFloat(r.slice(r.indexOf(" ")+1)),f=i?t.width/i:t.width,d=s?t.height/s:t.height;return{width:f,height:d,top:u,right:c+f,bottom:u+d,left:c}}const V_e={ignoreTransform:!1};function Cd(t,e){e===void 0&&(e=V_e);let r=t.getBoundingClientRect();if(e.ignoreTransform){const{transform:u,transformOrigin:f}=Nn(t).getComputedStyle(t);u&&(r=W_e(r,u,f))}const{top:n,left:i,width:s,height:o,bottom:l,right:c}=r;return{top:n,left:i,width:s,height:o,bottom:l,right:c}}function q6(t){return Cd(t,{ignoreTransform:!0})}function K_e(t){const e=t.innerWidth,r=t.innerHeight;return{top:0,left:0,right:e,bottom:r,width:e,height:r}}function G_e(t,e){return e===void 0&&(e=Nn(t).getComputedStyle(t)),e.position==="fixed"}function Y_e(t,e){e===void 0&&(e=Nn(t).getComputedStyle(t));const r=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(i=>{const s=e[i];return typeof s=="string"?r.test(s):!1})}function zC(t,e){const r=[];function n(i){if(e!=null&&r.length>=e||!i)return r;if(qC(i)&&i.scrollingElement!=null&&!r.includes(i.scrollingElement))return r.push(i.scrollingElement),r;if(!Qp(i)||AH(i)||r.includes(i))return r;const s=Nn(t).getComputedStyle(i);return i!==t&&Y_e(i,s)&&r.push(i),G_e(i,s)?r:n(i.parentNode)}return t?n(t):r}function IH(t){const[e]=zC(t,1);return e??null}function Lk(t){return!Dx||!t?null:Od(t)?t:FC(t)?qC(t)||t===Ed(t).scrollingElement?window:Qp(t)?t:null:null}function DH(t){return Od(t)?t.scrollX:t.scrollLeft}function LH(t){return Od(t)?t.scrollY:t.scrollTop}function gO(t){return{x:DH(t),y:LH(t)}}var Pr;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(Pr||(Pr={}));function $H(t){return!Dx||!t?!1:t===document.scrollingElement}function BH(t){const e={x:0,y:0},r=$H(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},n={x:t.scrollWidth-r.width,y:t.scrollHeight-r.height},i=t.scrollTop<=e.y,s=t.scrollLeft<=e.x,o=t.scrollTop>=n.y,l=t.scrollLeft>=n.x;return{isTop:i,isLeft:s,isBottom:o,isRight:l,maxScroll:n,minScroll:e}}const X_e={x:.2,y:.2};function J_e(t,e,r,n,i){let{top:s,left:o,right:l,bottom:c}=r;n===void 0&&(n=10),i===void 0&&(i=X_e);const{isTop:u,isBottom:f,isLeft:d,isRight:p}=BH(t),m={x:0,y:0},x={x:0,y:0},y={height:e.height*i.y,width:e.width*i.x};return!u&&s<=e.top+y.height?(m.y=Pr.Backward,x.y=n*Math.abs((e.top+y.height-s)/y.height)):!f&&c>=e.bottom-y.height&&(m.y=Pr.Forward,x.y=n*Math.abs((e.bottom-y.height-c)/y.height)),!p&&l>=e.right-y.width?(m.x=Pr.Forward,x.x=n*Math.abs((e.right-y.width-l)/y.width)):!d&&o<=e.left+y.width&&(m.x=Pr.Backward,x.x=n*Math.abs((e.left+y.width-o)/y.width)),{direction:m,speed:x}}function Q_e(t){if(t===document.scrollingElement){const{innerWidth:s,innerHeight:o}=window;return{top:0,left:0,right:s,bottom:o,width:s,height:o}}const{top:e,left:r,right:n,bottom:i}=t.getBoundingClientRect();return{top:e,left:r,right:n,bottom:i,width:t.clientWidth,height:t.clientHeight}}function FH(t){return t.reduce((e,r)=>ku(e,gO(r)),cs)}function Z_e(t){return t.reduce((e,r)=>e+DH(r),0)}function e2e(t){return t.reduce((e,r)=>e+LH(r),0)}function qH(t,e){if(e===void 0&&(e=Cd),!t)return;const{top:r,left:n,bottom:i,right:s}=e(t);IH(t)&&(i<=0||s<=0||r>=window.innerHeight||n>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const t2e=[["x",["left","right"],Z_e],["y",["top","bottom"],e2e]];class UC{constructor(e,r){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const n=zC(r),i=FH(n);this.rect={...e},this.width=e.width,this.height=e.height;for(const[s,o,l]of t2e)for(const c of o)Object.defineProperty(this,c,{get:()=>{const u=l(n),f=i[s]-u;return this.rect[c]+f},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class gh{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(r=>{var n;return(n=this.target)==null?void 0:n.removeEventListener(...r)})},this.target=e}add(e,r,n){var i;(i=this.target)==null||i.addEventListener(e,r,n),this.listeners.push([e,r,n])}}function r2e(t){const{EventTarget:e}=Nn(t);return t instanceof e?t:Ed(t)}function $k(t,e){const r=Math.abs(t.x),n=Math.abs(t.y);return typeof e=="number"?Math.sqrt(r**2+n**2)>e:"x"in e&&"y"in e?r>e.x&&n>e.y:"x"in e?r>e.x:"y"in e?n>e.y:!1}var Si;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(Si||(Si={}));function z6(t){t.preventDefault()}function n2e(t){t.stopPropagation()}var vt;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(vt||(vt={}));const zH={start:[vt.Space,vt.Enter],cancel:[vt.Esc],end:[vt.Space,vt.Enter,vt.Tab]},i2e=(t,e)=>{let{currentCoordinates:r}=e;switch(t.code){case vt.Right:return{...r,x:r.x+25};case vt.Left:return{...r,x:r.x-25};case vt.Down:return{...r,y:r.y+25};case vt.Up:return{...r,y:r.y-25}}};class UH{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:r}}=e;this.props=e,this.listeners=new gh(Ed(r)),this.windowListeners=new gh(Nn(r)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Si.Resize,this.handleCancel),this.windowListeners.add(Si.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Si.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:r}=this.props,n=e.node.current;n&&qH(n),r(cs)}handleKeyDown(e){if($x(e)){const{active:r,context:n,options:i}=this.props,{keyboardCodes:s=zH,coordinateGetter:o=i2e,scrollBehavior:l="smooth"}=i,{code:c}=e;if(s.end.includes(c)){this.handleEnd(e);return}if(s.cancel.includes(c)){this.handleCancel(e);return}const{collisionRect:u}=n.current,f=u?{x:u.left,y:u.top}:cs;this.referenceCoordinates||(this.referenceCoordinates=f);const d=o(e,{active:r,context:n.current,currentCoordinates:f});if(d){const p=j0(d,f),m={x:0,y:0},{scrollableAncestors:x}=n.current;for(const y of x){const v=e.code,{isTop:b,isRight:w,isLeft:N,isBottom:j,maxScroll:k,minScroll:_}=BH(y),E=Q_e(y),A={x:Math.min(v===vt.Right?E.right-E.width/2:E.right,Math.max(v===vt.Right?E.left:E.left+E.width/2,d.x)),y:Math.min(v===vt.Down?E.bottom-E.height/2:E.bottom,Math.max(v===vt.Down?E.top:E.top+E.height/2,d.y))},T=v===vt.Right&&!w||v===vt.Left&&!N,M=v===vt.Down&&!j||v===vt.Up&&!b;if(T&&A.x!==d.x){const P=y.scrollLeft+p.x,R=v===vt.Right&&P<=k.x||v===vt.Left&&P>=_.x;if(R&&!p.y){y.scrollTo({left:P,behavior:l});return}R?m.x=y.scrollLeft-P:m.x=v===vt.Right?y.scrollLeft-k.x:y.scrollLeft-_.x,m.x&&y.scrollBy({left:-m.x,behavior:l});break}else if(M&&A.y!==d.y){const P=y.scrollTop+p.y,R=v===vt.Down&&P<=k.y||v===vt.Up&&P>=_.y;if(R&&!p.x){y.scrollTo({top:P,behavior:l});return}R?m.y=y.scrollTop-P:m.y=v===vt.Down?y.scrollTop-k.y:y.scrollTop-_.y,m.y&&y.scrollBy({top:-m.y,behavior:l});break}}this.handleMove(e,ku(j0(d,this.referenceCoordinates),m))}}}handleMove(e,r){const{onMove:n}=this.props;e.preventDefault(),n(r)}handleEnd(e){const{onEnd:r}=this.props;e.preventDefault(),this.detach(),r()}handleCancel(e){const{onCancel:r}=this.props;e.preventDefault(),this.detach(),r()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}UH.activators=[{eventName:"onKeyDown",handler:(t,e,r)=>{let{keyboardCodes:n=zH,onActivation:i}=e,{active:s}=r;const{code:o}=t.nativeEvent;if(n.start.includes(o)){const l=s.activatorNode.current;return l&&t.target!==l?!1:(t.preventDefault(),i==null||i({event:t.nativeEvent}),!0)}return!1}}];function U6(t){return!!(t&&"distance"in t)}function H6(t){return!!(t&&"delay"in t)}class HC{constructor(e,r,n){var i;n===void 0&&(n=r2e(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=r;const{event:s}=e,{target:o}=s;this.props=e,this.events=r,this.document=Ed(o),this.documentListeners=new gh(this.document),this.listeners=new gh(n),this.windowListeners=new gh(Nn(o)),this.initialCoordinates=(i=S0(s))!=null?i:cs,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:r,bypassActivationConstraint:n}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Si.Resize,this.handleCancel),this.windowListeners.add(Si.DragStart,z6),this.windowListeners.add(Si.VisibilityChange,this.handleCancel),this.windowListeners.add(Si.ContextMenu,z6),this.documentListeners.add(Si.Keydown,this.handleKeydown),r){if(n!=null&&n({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(H6(r)){this.timeoutId=setTimeout(this.handleStart,r.delay),this.handlePending(r);return}if(U6(r)){this.handlePending(r);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,r){const{active:n,onPending:i}=this.props;i(n,e,this.initialCoordinates,r)}handleStart(){const{initialCoordinates:e}=this,{onStart:r}=this.props;e&&(this.activated=!0,this.documentListeners.add(Si.Click,n2e,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Si.SelectionChange,this.removeTextSelection),r(e))}handleMove(e){var r;const{activated:n,initialCoordinates:i,props:s}=this,{onMove:o,options:{activationConstraint:l}}=s;if(!i)return;const c=(r=S0(e))!=null?r:cs,u=j0(i,c);if(!n&&l){if(U6(l)){if(l.tolerance!=null&&$k(u,l.tolerance))return this.handleCancel();if($k(u,l.distance))return this.handleStart()}if(H6(l)&&$k(u,l.tolerance))return this.handleCancel();this.handlePending(l,u);return}e.cancelable&&e.preventDefault(),o(c)}handleEnd(){const{onAbort:e,onEnd:r}=this.props;this.detach(),this.activated||e(this.props.active),r()}handleCancel(){const{onAbort:e,onCancel:r}=this.props;this.detach(),this.activated||e(this.props.active),r()}handleKeydown(e){e.code===vt.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const s2e={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Ad extends HC{constructor(e){const{event:r}=e,n=Ed(r.target);super(e,s2e,n)}}Ad.activators=[{eventName:"onPointerDown",handler:(t,e)=>{let{nativeEvent:r}=t,{onActivation:n}=e;return!r.isPrimary||r.button!==0?!1:(n==null||n({event:r}),!0)}}];const o2e={move:{name:"mousemove"},end:{name:"mouseup"}};var yO;(function(t){t[t.RightClick=2]="RightClick"})(yO||(yO={}));class a2e extends HC{constructor(e){super(e,o2e,Ed(e.event.target))}}a2e.activators=[{eventName:"onMouseDown",handler:(t,e)=>{let{nativeEvent:r}=t,{onActivation:n}=e;return r.button===yO.RightClick?!1:(n==null||n({event:r}),!0)}}];const Bk={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class l2e extends HC{constructor(e){super(e,Bk)}static setup(){return window.addEventListener(Bk.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(Bk.move.name,e)};function e(){}}}l2e.activators=[{eventName:"onTouchStart",handler:(t,e)=>{let{nativeEvent:r}=t,{onActivation:n}=e;const{touches:i}=r;return i.length>1?!1:(n==null||n({event:r}),!0)}}];var yh;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(yh||(yh={}));var k0;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(k0||(k0={}));function c2e(t){let{acceleration:e,activator:r=yh.Pointer,canScroll:n,draggingRect:i,enabled:s,interval:o=5,order:l=k0.TreeOrder,pointerCoordinates:c,scrollableAncestors:u,scrollableAncestorRects:f,delta:d,threshold:p}=t;const m=d2e({delta:d,disabled:!s}),[x,y]=N_e(),v=O.useRef({x:0,y:0}),b=O.useRef({x:0,y:0}),w=O.useMemo(()=>{switch(r){case yh.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case yh.DraggableRect:return i}},[r,i,c]),N=O.useRef(null),j=O.useCallback(()=>{const _=N.current;if(!_)return;const E=v.current.x*b.current.x,A=v.current.y*b.current.y;_.scrollBy(E,A)},[]),k=O.useMemo(()=>l===k0.TreeOrder?[...u].reverse():u,[l,u]);O.useEffect(()=>{if(!s||!u.length||!w){y();return}for(const _ of k){if((n==null?void 0:n(_))===!1)continue;const E=u.indexOf(_),A=f[E];if(!A)continue;const{direction:T,speed:M}=J_e(_,A,w,e,p);for(const P of["x","y"])m[P][T[P]]||(M[P]=0,T[P]=0);if(M.x>0||M.y>0){y(),N.current=_,x(j,o),v.current=M,b.current=T;return}}v.current={x:0,y:0},b.current={x:0,y:0},y()},[e,j,n,y,s,o,JSON.stringify(w),JSON.stringify(m),x,u,k,f,JSON.stringify(p)])}const u2e={x:{[Pr.Backward]:!1,[Pr.Forward]:!1},y:{[Pr.Backward]:!1,[Pr.Forward]:!1}};function d2e(t){let{delta:e,disabled:r}=t;const n=w0(e);return Zp(i=>{if(r||!n||!i)return u2e;const s={x:Math.sign(e.x-n.x),y:Math.sign(e.y-n.y)};return{x:{[Pr.Backward]:i.x[Pr.Backward]||s.x===-1,[Pr.Forward]:i.x[Pr.Forward]||s.x===1},y:{[Pr.Backward]:i.y[Pr.Backward]||s.y===-1,[Pr.Forward]:i.y[Pr.Forward]||s.y===1}}},[r,e,n])}function f2e(t,e){const r=e!=null?t.get(e):void 0,n=r?r.node.current:null;return Zp(i=>{var s;return e==null?null:(s=n??i)!=null?s:null},[n,e])}function h2e(t,e){return O.useMemo(()=>t.reduce((r,n)=>{const{sensor:i}=n,s=i.activators.map(o=>({eventName:o.eventName,handler:e(o.handler,n)}));return[...r,...s]},[]),[t,e])}var Np;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(Np||(Np={}));var vO;(function(t){t.Optimized="optimized"})(vO||(vO={}));const W6=new Map;function p2e(t,e){let{dragging:r,dependencies:n,config:i}=e;const[s,o]=O.useState(null),{frequency:l,measure:c,strategy:u}=i,f=O.useRef(t),d=v(),p=Sp(d),m=O.useCallback(function(b){b===void 0&&(b=[]),!p.current&&o(w=>w===null?b:w.concat(b.filter(N=>!w.includes(N))))},[p]),x=O.useRef(null),y=Zp(b=>{if(d&&!r)return W6;if(!b||b===W6||f.current!==t||s!=null){const w=new Map;for(let N of t){if(!N)continue;if(s&&s.length>0&&!s.includes(N.id)&&N.rect.current){w.set(N.id,N.rect.current);continue}const j=N.node.current,k=j?new UC(c(j),j):null;N.rect.current=k,k&&w.set(N.id,k)}return w}return b},[t,s,r,d,c]);return O.useEffect(()=>{f.current=t},[t]),O.useEffect(()=>{d||m()},[r,d]),O.useEffect(()=>{s&&s.length>0&&o(null)},[JSON.stringify(s)]),O.useEffect(()=>{d||typeof l!="number"||x.current!==null||(x.current=setTimeout(()=>{m(),x.current=null},l))},[l,d,m,...n]),{droppableRects:y,measureDroppableContainers:m,measuringScheduled:s!=null};function v(){switch(u){case Np.Always:return!1;case Np.BeforeDragging:return r;default:return!r}}}function WC(t,e){return Zp(r=>t?r||(typeof e=="function"?e(t):t):null,[e,t])}function m2e(t,e){return WC(t,e)}function g2e(t){let{callback:e,disabled:r}=t;const n=Lx(e),i=O.useMemo(()=>{if(r||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:s}=window;return new s(n)},[n,r]);return O.useEffect(()=>()=>i==null?void 0:i.disconnect(),[i]),i}function qx(t){let{callback:e,disabled:r}=t;const n=Lx(e),i=O.useMemo(()=>{if(r||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:s}=window;return new s(n)},[r]);return O.useEffect(()=>()=>i==null?void 0:i.disconnect(),[i]),i}function y2e(t){return new UC(Cd(t),t)}function V6(t,e,r){e===void 0&&(e=y2e);const[n,i]=O.useState(null);function s(){i(c=>{if(!t)return null;if(t.isConnected===!1){var u;return(u=c??r)!=null?u:null}const f=e(t);return JSON.stringify(c)===JSON.stringify(f)?c:f})}const o=g2e({callback(c){if(t)for(const u of c){const{type:f,target:d}=u;if(f==="childList"&&d instanceof HTMLElement&&d.contains(t)){s();break}}}}),l=qx({callback:s});return ls(()=>{s(),t?(l==null||l.observe(t),o==null||o.observe(document.body,{childList:!0,subtree:!0})):(l==null||l.disconnect(),o==null||o.disconnect())},[t]),n}function v2e(t){const e=WC(t);return MH(t,e)}const K6=[];function x2e(t){const e=O.useRef(t),r=Zp(n=>t?n&&n!==K6&&t&&e.current&&t.parentNode===e.current.parentNode?n:zC(t):K6,[t]);return O.useEffect(()=>{e.current=t},[t]),r}function b2e(t){const[e,r]=O.useState(null),n=O.useRef(t),i=O.useCallback(s=>{const o=Lk(s.target);o&&r(l=>l?(l.set(o,gO(o)),new Map(l)):null)},[]);return O.useEffect(()=>{const s=n.current;if(t!==s){o(s);const l=t.map(c=>{const u=Lk(c);return u?(u.addEventListener("scroll",i,{passive:!0}),[u,gO(u)]):null}).filter(c=>c!=null);r(l.length?new Map(l):null),n.current=t}return()=>{o(t),o(s)};function o(l){l.forEach(c=>{const u=Lk(c);u==null||u.removeEventListener("scroll",i)})}},[i,t]),O.useMemo(()=>t.length?e?Array.from(e.values()).reduce((s,o)=>ku(s,o),cs):FH(t):cs,[t,e])}function G6(t,e){e===void 0&&(e=[]);const r=O.useRef(null);return O.useEffect(()=>{r.current=null},e),O.useEffect(()=>{const n=t!==cs;n&&!r.current&&(r.current=t),!n&&r.current&&(r.current=null)},[t]),r.current?j0(t,r.current):cs}function w2e(t){O.useEffect(()=>{if(!Dx)return;const e=t.map(r=>{let{sensor:n}=r;return n.setup==null?void 0:n.setup()});return()=>{for(const r of e)r==null||r()}},t.map(e=>{let{sensor:r}=e;return r}))}function j2e(t,e){return O.useMemo(()=>t.reduce((r,n)=>{let{eventName:i,handler:s}=n;return r[i]=o=>{s(o,e)},r},{}),[t,e])}function HH(t){return O.useMemo(()=>t?K_e(t):null,[t])}const Y6=[];function S2e(t,e){e===void 0&&(e=Cd);const[r]=t,n=HH(r?Nn(r):null),[i,s]=O.useState(Y6);function o(){s(()=>t.length?t.map(c=>$H(c)?n:new UC(e(c),c)):Y6)}const l=qx({callback:o});return ls(()=>{l==null||l.disconnect(),o(),t.forEach(c=>l==null?void 0:l.observe(c))},[t]),i}function WH(t){if(!t)return null;if(t.children.length>1)return t;const e=t.children[0];return Qp(e)?e:t}function N2e(t){let{measure:e}=t;const[r,n]=O.useState(null),i=O.useCallback(u=>{for(const{target:f}of u)if(Qp(f)){n(d=>{const p=e(f);return d?{...d,width:p.width,height:p.height}:p});break}},[e]),s=qx({callback:i}),o=O.useCallback(u=>{const f=WH(u);s==null||s.disconnect(),f&&(s==null||s.observe(f)),n(f?e(f):null)},[e,s]),[l,c]=b0(o);return O.useMemo(()=>({nodeRef:l,rect:r,setRef:c}),[r,l,c])}const k2e=[{sensor:Ad,options:{}},{sensor:UH,options:{}}],_2e={current:{}},cy={draggable:{measure:q6},droppable:{measure:q6,strategy:Np.WhileDragging,frequency:vO.Optimized},dragOverlay:{measure:Cd}};class vh extends Map{get(e){var r;return e!=null&&(r=super.get(e))!=null?r:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:r}=e;return!r})}getNodeFor(e){var r,n;return(r=(n=this.get(e))==null?void 0:n.node.current)!=null?r:void 0}}const O2e={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new vh,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:N0},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:cy,measureDroppableContainers:N0,windowRect:null,measuringScheduled:!1},VH={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:N0,draggableNodes:new Map,over:null,measureDroppableContainers:N0},tm=O.createContext(VH),KH=O.createContext(O2e);function E2e(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new vh}}}function C2e(t,e){switch(e.type){case Sr.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case Sr.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:e.coordinates.x-t.draggable.initialCoordinates.x,y:e.coordinates.y-t.draggable.initialCoordinates.y}}};case Sr.DragEnd:case Sr.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Sr.RegisterDroppable:{const{element:r}=e,{id:n}=r,i=new vh(t.droppable.containers);return i.set(n,r),{...t,droppable:{...t.droppable,containers:i}}}case Sr.SetDroppableDisabled:{const{id:r,key:n,disabled:i}=e,s=t.droppable.containers.get(r);if(!s||n!==s.key)return t;const o=new vh(t.droppable.containers);return o.set(r,{...s,disabled:i}),{...t,droppable:{...t.droppable,containers:o}}}case Sr.UnregisterDroppable:{const{id:r,key:n}=e,i=t.droppable.containers.get(r);if(!i||n!==i.key)return t;const s=new vh(t.droppable.containers);return s.delete(r),{...t,droppable:{...t.droppable,containers:s}}}default:return t}}function A2e(t){let{disabled:e}=t;const{active:r,activatorEvent:n,draggableNodes:i}=O.useContext(tm),s=w0(n),o=w0(r==null?void 0:r.id);return O.useEffect(()=>{if(!e&&!n&&s&&o!=null){if(!$x(s)||document.activeElement===s.target)return;const l=i.get(o);if(!l)return;const{activatorNode:c,node:u}=l;if(!c.current&&!u.current)return;requestAnimationFrame(()=>{for(const f of[c.current,u.current]){if(!f)continue;const d=O_e(f);if(d){d.focus();break}}})}},[n,e,i,o,s]),null}function GH(t,e){let{transform:r,...n}=e;return t!=null&&t.length?t.reduce((i,s)=>s({transform:i,...n}),r):r}function T2e(t){return O.useMemo(()=>({draggable:{...cy.draggable,...t==null?void 0:t.draggable},droppable:{...cy.droppable,...t==null?void 0:t.droppable},dragOverlay:{...cy.dragOverlay,...t==null?void 0:t.dragOverlay}}),[t==null?void 0:t.draggable,t==null?void 0:t.droppable,t==null?void 0:t.dragOverlay])}function P2e(t){let{activeNode:e,measure:r,initialRect:n,config:i=!0}=t;const s=O.useRef(!1),{x:o,y:l}=typeof i=="boolean"?{x:i,y:i}:i;ls(()=>{if(!o&&!l||!e){s.current=!1;return}if(s.current||!n)return;const u=e==null?void 0:e.node.current;if(!u||u.isConnected===!1)return;const f=r(u),d=MH(f,n);if(o||(d.x=0),l||(d.y=0),s.current=!0,Math.abs(d.x)>0||Math.abs(d.y)>0){const p=IH(u);p&&p.scrollBy({top:d.y,left:d.x})}},[e,o,l,n,r])}const zx=O.createContext({...cs,scaleX:1,scaleY:1});var ua;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(ua||(ua={}));const Ux=O.memo(function(e){var r,n,i,s;let{id:o,accessibility:l,autoScroll:c=!0,children:u,sensors:f=k2e,collisionDetection:d=q_e,measuring:p,modifiers:m,...x}=e;const y=O.useReducer(C2e,void 0,E2e),[v,b]=y,[w,N]=M_e(),[j,k]=O.useState(ua.Uninitialized),_=j===ua.Initialized,{draggable:{active:E,nodes:A,translate:T},droppable:{containers:M}}=v,P=E!=null?A.get(E):null,R=O.useRef({initial:null,translated:null}),L=O.useMemo(()=>{var Kt;return E!=null?{id:E,data:(Kt=P==null?void 0:P.data)!=null?Kt:_2e,rect:R}:null},[E,P]),$=O.useRef(null),[F,z]=O.useState(null),[W,K]=O.useState(null),q=Sp(x,Object.values(x)),V=em("DndDescribedBy",o),D=O.useMemo(()=>M.getEnabled(),[M]),U=T2e(p),{droppableRects:G,measureDroppableContainers:ee,measuringScheduled:Q}=p2e(D,{dragging:_,dependencies:[T.x,T.y],config:U.droppable}),H=f2e(A,E),Y=O.useMemo(()=>W?S0(W):null,[W]),re=To(),J=m2e(H,U.draggable.measure);P2e({activeNode:E!=null?A.get(E):null,config:re.layoutShiftCompensation,initialRect:J,measure:U.draggable.measure});const ne=V6(H,U.draggable.measure,J),te=V6(H?H.parentElement:null),se=O.useRef({activatorEvent:null,active:null,activeNode:H,collisionRect:null,collisions:null,droppableRects:G,draggableNodes:A,draggingNode:null,draggingNodeRect:null,droppableContainers:M,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),ve=M.getNodeFor((r=se.current.over)==null?void 0:r.id),ie=N2e({measure:U.dragOverlay.measure}),ye=(n=ie.nodeRef.current)!=null?n:H,Te=_?(i=ie.rect)!=null?i:ne:null,Le=!!(ie.nodeRef.current&&ie.rect),ue=v2e(Le?null:ne),he=HH(ye?Nn(ye):null),we=x2e(_?ve??H:null),Oe=S2e(we),be=GH(m,{transform:{x:T.x-ue.x,y:T.y-ue.y,scaleX:1,scaleY:1},activatorEvent:W,active:L,activeNodeRect:ne,containerNodeRect:te,draggingNodeRect:Te,over:se.current.over,overlayNodeRect:ie.rect,scrollableAncestors:we,scrollableAncestorRects:Oe,windowRect:he}),We=Y?ku(Y,T):null,Je=b2e(we),Ye=G6(Je),Ae=G6(Je,[ne]),Me=ku(be,Ye),Re=Te?H_e(Te,be):null,sr=L&&Re?d({active:L,collisionRect:Re,droppableRects:G,droppableContainers:D,pointerCoordinates:We}):null,ut=B_e(sr,"id"),[wt,ci]=O.useState(null),dc=Le?be:ku(be,Ae),fc=z_e(dc,(s=wt==null?void 0:wt.rect)!=null?s:null,ne),Md=O.useRef(null),hc=O.useCallback((Kt,Yr)=>{let{sensor:Xr,options:Ri}=Yr;if($.current==null)return;const un=A.get($.current);if(!un)return;const Jr=Kt.nativeEvent,kn=new Xr({active:$.current,activeNode:un,event:Jr,options:Ri,context:se,onAbort(Gt){if(!A.get(Gt))return;const{onDragAbort:Qr}=q.current,Ii={id:Gt};Qr==null||Qr(Ii),w({type:"onDragAbort",event:Ii})},onPending(Gt,ui,Qr,Ii){if(!A.get(Gt))return;const{onDragPending:fs}=q.current,Bn={id:Gt,constraint:ui,initialCoordinates:Qr,offset:Ii};fs==null||fs(Bn),w({type:"onDragPending",event:Bn})},onStart(Gt){const ui=$.current;if(ui==null)return;const Qr=A.get(ui);if(!Qr)return;const{onDragStart:Ii}=q.current,Di={activatorEvent:Jr,active:{id:ui,data:Qr.data,rect:R}};js.unstable_batchedUpdates(()=>{Ii==null||Ii(Di),k(ua.Initializing),b({type:Sr.DragStart,initialCoordinates:Gt,active:ui}),w({type:"onDragStart",event:Di}),z(Md.current),K(Jr)})},onMove(Gt){b({type:Sr.DragMove,coordinates:Gt})},onEnd:$s(Sr.DragEnd),onCancel:$s(Sr.DragCancel)});Md.current=kn;function $s(Gt){return async function(){const{active:Qr,collisions:Ii,over:Di,scrollAdjustedTranslate:fs}=se.current;let Bn=null;if(Qr&&fs){const{cancelDrop:Bs}=q.current;Bn={activatorEvent:Jr,active:Qr,collisions:Ii,delta:fs,over:Di},Gt===Sr.DragEnd&&typeof Bs=="function"&&await Promise.resolve(Bs(Bn))&&(Gt=Sr.DragCancel)}$.current=null,js.unstable_batchedUpdates(()=>{b({type:Gt}),k(ua.Uninitialized),ci(null),z(null),K(null),Md.current=null;const Bs=Gt===Sr.DragEnd?"onDragEnd":"onDragCancel";if(Bn){const Ld=q.current[Bs];Ld==null||Ld(Bn),w({type:Bs,event:Bn})}})}}},[A]),Rd=O.useCallback((Kt,Yr)=>(Xr,Ri)=>{const un=Xr.nativeEvent,Jr=A.get(Ri);if($.current!==null||!Jr||un.dndKit||un.defaultPrevented)return;const kn={active:Jr};Kt(Xr,Yr.options,kn)===!0&&(un.dndKit={capturedBy:Yr.sensor},$.current=Ri,hc(Xr,Yr))},[A,hc]),pc=h2e(f,Rd);w2e(f),ls(()=>{ne&&j===ua.Initializing&&k(ua.Initialized)},[ne,j]),O.useEffect(()=>{const{onDragMove:Kt}=q.current,{active:Yr,activatorEvent:Xr,collisions:Ri,over:un}=se.current;if(!Yr||!Xr)return;const Jr={active:Yr,activatorEvent:Xr,collisions:Ri,delta:{x:Me.x,y:Me.y},over:un};js.unstable_batchedUpdates(()=>{Kt==null||Kt(Jr),w({type:"onDragMove",event:Jr})})},[Me.x,Me.y]),O.useEffect(()=>{const{active:Kt,activatorEvent:Yr,collisions:Xr,droppableContainers:Ri,scrollAdjustedTranslate:un}=se.current;if(!Kt||$.current==null||!Yr||!un)return;const{onDragOver:Jr}=q.current,kn=Ri.get(ut),$s=kn&&kn.rect.current?{id:kn.id,rect:kn.rect.current,data:kn.data,disabled:kn.disabled}:null,Gt={active:Kt,activatorEvent:Yr,collisions:Xr,delta:{x:un.x,y:un.y},over:$s};js.unstable_batchedUpdates(()=>{ci($s),Jr==null||Jr(Gt),w({type:"onDragOver",event:Gt})})},[ut]),ls(()=>{se.current={activatorEvent:W,active:L,activeNode:H,collisionRect:Re,collisions:sr,droppableRects:G,draggableNodes:A,draggingNode:ye,draggingNodeRect:Te,droppableContainers:M,over:wt,scrollableAncestors:we,scrollAdjustedTranslate:Me},R.current={initial:Te,translated:Re}},[L,H,sr,Re,A,ye,Te,G,M,wt,we,Me]),c2e({...re,delta:T,draggingRect:Re,pointerCoordinates:We,scrollableAncestors:we,scrollableAncestorRects:Oe});const Id=O.useMemo(()=>({active:L,activeNode:H,activeNodeRect:ne,activatorEvent:W,collisions:sr,containerNodeRect:te,dragOverlay:ie,draggableNodes:A,droppableContainers:M,droppableRects:G,over:wt,measureDroppableContainers:ee,scrollableAncestors:we,scrollableAncestorRects:Oe,measuringConfiguration:U,measuringScheduled:Q,windowRect:he}),[L,H,ne,W,sr,te,ie,A,M,G,wt,ee,we,Oe,U,Q,he]),Dd=O.useMemo(()=>({activatorEvent:W,activators:pc,active:L,activeNodeRect:ne,ariaDescribedById:{draggable:V},dispatch:b,draggableNodes:A,over:wt,measureDroppableContainers:ee}),[W,pc,L,ne,b,V,A,wt,ee]);return Z.createElement(PH.Provider,{value:N},Z.createElement(tm.Provider,{value:Dd},Z.createElement(KH.Provider,{value:Id},Z.createElement(zx.Provider,{value:fc},u)),Z.createElement(A2e,{disabled:(l==null?void 0:l.restoreFocus)===!1})),Z.createElement(D_e,{...l,hiddenTextDescribedById:V}));function To(){const Kt=(F==null?void 0:F.autoScrollEnabled)===!1,Yr=typeof c=="object"?c.enabled===!1:c===!1,Xr=_&&!Kt&&!Yr;return typeof c=="object"?{...c,enabled:Xr}:{enabled:Xr}}}),M2e=O.createContext(null),X6="button",R2e="Draggable";function I2e(t){let{id:e,data:r,disabled:n=!1,attributes:i}=t;const s=em(R2e),{activators:o,activatorEvent:l,active:c,activeNodeRect:u,ariaDescribedById:f,draggableNodes:d,over:p}=O.useContext(tm),{role:m=X6,roleDescription:x="draggable",tabIndex:y=0}=i??{},v=(c==null?void 0:c.id)===e,b=O.useContext(v?zx:M2e),[w,N]=b0(),[j,k]=b0(),_=j2e(o,e),E=Sp(r);ls(()=>(d.set(e,{id:e,key:s,node:w,activatorNode:j,data:E}),()=>{const T=d.get(e);T&&T.key===s&&d.delete(e)}),[d,e]);const A=O.useMemo(()=>({role:m,tabIndex:y,"aria-disabled":n,"aria-pressed":v&&m===X6?!0:void 0,"aria-roledescription":x,"aria-describedby":f.draggable}),[n,m,y,v,x,f.draggable]);return{active:c,activatorEvent:l,activeNodeRect:u,attributes:A,isDragging:v,listeners:n?void 0:_,node:w,over:p,setNodeRef:N,setActivatorNodeRef:k,transform:b}}function YH(){return O.useContext(KH)}const D2e="Droppable",L2e={timeout:25};function $2e(t){let{data:e,disabled:r=!1,id:n,resizeObserverConfig:i}=t;const s=em(D2e),{active:o,dispatch:l,over:c,measureDroppableContainers:u}=O.useContext(tm),f=O.useRef({disabled:r}),d=O.useRef(!1),p=O.useRef(null),m=O.useRef(null),{disabled:x,updateMeasurementsFor:y,timeout:v}={...L2e,...i},b=Sp(y??n),w=O.useCallback(()=>{if(!d.current){d.current=!0;return}m.current!=null&&clearTimeout(m.current),m.current=setTimeout(()=>{u(Array.isArray(b.current)?b.current:[b.current]),m.current=null},v)},[v]),N=qx({callback:w,disabled:x||!o}),j=O.useCallback((A,T)=>{N&&(T&&(N.unobserve(T),d.current=!1),A&&N.observe(A))},[N]),[k,_]=b0(j),E=Sp(e);return O.useEffect(()=>{!N||!k.current||(N.disconnect(),d.current=!1,N.observe(k.current))},[k,N]),O.useEffect(()=>(l({type:Sr.RegisterDroppable,element:{id:n,key:s,disabled:r,node:k,rect:p,data:E}}),()=>l({type:Sr.UnregisterDroppable,key:s,id:n})),[n]),O.useEffect(()=>{r!==f.current.disabled&&(l({type:Sr.SetDroppableDisabled,id:n,key:s,disabled:r}),f.current.disabled=r)},[n,s,r,l]),{active:o,rect:p,isOver:(c==null?void 0:c.id)===n,node:k,over:c,setNodeRef:_}}function B2e(t){let{animation:e,children:r}=t;const[n,i]=O.useState(null),[s,o]=O.useState(null),l=w0(r);return!r&&!n&&l&&i(l),ls(()=>{if(!s)return;const c=n==null?void 0:n.key,u=n==null?void 0:n.props.id;if(c==null||u==null){i(null);return}Promise.resolve(e(u,s)).then(()=>{i(null)})},[e,n,s]),Z.createElement(Z.Fragment,null,r,n?O.cloneElement(n,{ref:o}):null)}const F2e={x:0,y:0,scaleX:1,scaleY:1};function q2e(t){let{children:e}=t;return Z.createElement(tm.Provider,{value:VH},Z.createElement(zx.Provider,{value:F2e},e))}const z2e={position:"fixed",touchAction:"none"},U2e=t=>$x(t)?"transform 250ms ease":void 0,H2e=O.forwardRef((t,e)=>{let{as:r,activatorEvent:n,adjustScale:i,children:s,className:o,rect:l,style:c,transform:u,transition:f=U2e}=t;if(!l)return null;const d=i?u:{...u,scaleX:1,scaleY:1},p={...z2e,width:l.width,height:l.height,top:l.top,left:l.left,transform:Rs.Transform.toString(d),transformOrigin:i&&n?L_e(n,l):void 0,transition:typeof f=="function"?f(n):f,...c};return Z.createElement(r,{className:o,style:p,ref:e},s)}),W2e=t=>e=>{let{active:r,dragOverlay:n}=e;const i={},{styles:s,className:o}=t;if(s!=null&&s.active)for(const[l,c]of Object.entries(s.active))c!==void 0&&(i[l]=r.node.style.getPropertyValue(l),r.node.style.setProperty(l,c));if(s!=null&&s.dragOverlay)for(const[l,c]of Object.entries(s.dragOverlay))c!==void 0&&n.node.style.setProperty(l,c);return o!=null&&o.active&&r.node.classList.add(o.active),o!=null&&o.dragOverlay&&n.node.classList.add(o.dragOverlay),function(){for(const[c,u]of Object.entries(i))r.node.style.setProperty(c,u);o!=null&&o.active&&r.node.classList.remove(o.active)}},V2e=t=>{let{transform:{initial:e,final:r}}=t;return[{transform:Rs.Transform.toString(e)},{transform:Rs.Transform.toString(r)}]},K2e={duration:250,easing:"ease",keyframes:V2e,sideEffects:W2e({styles:{active:{opacity:"0"}}})};function G2e(t){let{config:e,draggableNodes:r,droppableContainers:n,measuringConfiguration:i}=t;return Lx((s,o)=>{if(e===null)return;const l=r.get(s);if(!l)return;const c=l.node.current;if(!c)return;const u=WH(o);if(!u)return;const{transform:f}=Nn(o).getComputedStyle(o),d=RH(f);if(!d)return;const p=typeof e=="function"?e:Y2e(e);return qH(c,i.draggable.measure),p({active:{id:s,data:l.data,node:c,rect:i.draggable.measure(c)},draggableNodes:r,dragOverlay:{node:o,rect:i.dragOverlay.measure(u)},droppableContainers:n,measuringConfiguration:i,transform:d})})}function Y2e(t){const{duration:e,easing:r,sideEffects:n,keyframes:i}={...K2e,...t};return s=>{let{active:o,dragOverlay:l,transform:c,...u}=s;if(!e)return;const f={x:l.rect.left-o.rect.left,y:l.rect.top-o.rect.top},d={scaleX:c.scaleX!==1?o.rect.width*c.scaleX/l.rect.width:1,scaleY:c.scaleY!==1?o.rect.height*c.scaleY/l.rect.height:1},p={x:c.x-f.x,y:c.y-f.y,...d},m=i({...u,active:o,dragOverlay:l,transform:{initial:c,final:p}}),[x]=m,y=m[m.length-1];if(JSON.stringify(x)===JSON.stringify(y))return;const v=n==null?void 0:n({active:o,dragOverlay:l,...u}),b=l.node.animate(m,{duration:e,easing:r,fill:"forwards"});return new Promise(w=>{b.onfinish=()=>{v==null||v(),w()}})}}let J6=0;function X2e(t){return O.useMemo(()=>{if(t!=null)return J6++,J6},[t])}const VC=Z.memo(t=>{let{adjustScale:e=!1,children:r,dropAnimation:n,style:i,transition:s,modifiers:o,wrapperElement:l="div",className:c,zIndex:u=999}=t;const{activatorEvent:f,active:d,activeNodeRect:p,containerNodeRect:m,draggableNodes:x,droppableContainers:y,dragOverlay:v,over:b,measuringConfiguration:w,scrollableAncestors:N,scrollableAncestorRects:j,windowRect:k}=YH(),_=O.useContext(zx),E=X2e(d==null?void 0:d.id),A=GH(o,{activatorEvent:f,active:d,activeNodeRect:p,containerNodeRect:m,draggingNodeRect:v.rect,over:b,overlayNodeRect:v.rect,scrollableAncestors:N,scrollableAncestorRects:j,transform:_,windowRect:k}),T=WC(p),M=G2e({config:n,draggableNodes:x,droppableContainers:y,measuringConfiguration:w}),P=T?v.setRef:void 0;return Z.createElement(q2e,null,Z.createElement(B2e,{animation:M},d&&E?Z.createElement(H2e,{key:E,id:d.id,ref:P,as:l,activatorEvent:f,adjustScale:e,className:c,transition:s,rect:T,style:{zIndex:u,...i},transform:A},r):null))});function Td(t,e,r){const n=t.slice();return n.splice(r<0?n.length+r:r,0,n.splice(e,1)[0]),n}function J2e(t,e){return t.reduce((r,n,i)=>{const s=e.get(n);return s&&(r[i]=s),r},Array(t.length))}function Vg(t){return t!==null&&t>=0}function Q2e(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Z2e(t){return typeof t=="boolean"?{draggable:t,droppable:t}:t}const XH=t=>{let{rects:e,activeIndex:r,overIndex:n,index:i}=t;const s=Td(e,n,r),o=e[i],l=s[i];return!l||!o?null:{x:l.left-o.left,y:l.top-o.top,scaleX:l.width/o.width,scaleY:l.height/o.height}},Kg={scaleX:1,scaleY:1},Hx=t=>{var e;let{activeIndex:r,activeNodeRect:n,index:i,rects:s,overIndex:o}=t;const l=(e=s[r])!=null?e:n;if(!l)return null;if(i===r){const u=s[o];return u?{x:0,y:r<o?u.top+u.height-(l.top+l.height):u.top-l.top,...Kg}:null}const c=eOe(s,i,r);return i>r&&i<=o?{x:0,y:-l.height-c,...Kg}:i<r&&i>=o?{x:0,y:l.height+c,...Kg}:{x:0,y:0,...Kg}};function eOe(t,e,r){const n=t[e],i=t[e-1],s=t[e+1];return n?r<e?i?n.top-(i.top+i.height):s?s.top-(n.top+n.height):0:s?s.top-(n.top+n.height):i?n.top-(i.top+i.height):0:0}const JH="Sortable",QH=Z.createContext({activeIndex:-1,containerId:JH,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:XH,disabled:{draggable:!1,droppable:!1}});function Wx(t){let{children:e,id:r,items:n,strategy:i=XH,disabled:s=!1}=t;const{active:o,dragOverlay:l,droppableRects:c,over:u,measureDroppableContainers:f}=YH(),d=em(JH,r),p=l.rect!==null,m=O.useMemo(()=>n.map(_=>typeof _=="object"&&"id"in _?_.id:_),[n]),x=o!=null,y=o?m.indexOf(o.id):-1,v=u?m.indexOf(u.id):-1,b=O.useRef(m),w=!Q2e(m,b.current),N=v!==-1&&y===-1||w,j=Z2e(s);ls(()=>{w&&x&&f(m)},[w,m,x,f]),O.useEffect(()=>{b.current=m},[m]);const k=O.useMemo(()=>({activeIndex:y,containerId:d,disabled:j,disableTransforms:N,items:m,overIndex:v,useDragOverlay:p,sortedRects:J2e(m,c),strategy:i}),[y,d,j.draggable,j.droppable,N,m,v,c,p,i]);return Z.createElement(QH.Provider,{value:k},e)}const tOe=t=>{let{id:e,items:r,activeIndex:n,overIndex:i}=t;return Td(r,n,i).indexOf(e)},rOe=t=>{let{containerId:e,isSorting:r,wasDragging:n,index:i,items:s,newIndex:o,previousItems:l,previousContainerId:c,transition:u}=t;return!u||!n||l!==s&&i===o?!1:r?!0:o!==i&&e===c},nOe={duration:200,easing:"ease"},ZH="transform",iOe=Rs.Transition.toString({property:ZH,duration:0,easing:"linear"}),sOe={roleDescription:"sortable"};function oOe(t){let{disabled:e,index:r,node:n,rect:i}=t;const[s,o]=O.useState(null),l=O.useRef(r);return ls(()=>{if(!e&&r!==l.current&&n.current){const c=i.current;if(c){const u=Cd(n.current,{ignoreTransform:!0}),f={x:c.left-u.left,y:c.top-u.top,scaleX:c.width/u.width,scaleY:c.height/u.height};(f.x||f.y)&&o(f)}}r!==l.current&&(l.current=r)},[e,r,n,i]),O.useEffect(()=>{s&&o(null)},[s]),s}function KC(t){let{animateLayoutChanges:e=rOe,attributes:r,disabled:n,data:i,getNewIndex:s=tOe,id:o,strategy:l,resizeObserverConfig:c,transition:u=nOe}=t;const{items:f,containerId:d,activeIndex:p,disabled:m,disableTransforms:x,sortedRects:y,overIndex:v,useDragOverlay:b,strategy:w}=O.useContext(QH),N=aOe(n,m),j=f.indexOf(o),k=O.useMemo(()=>({sortable:{containerId:d,index:j,items:f},...i}),[d,i,j,f]),_=O.useMemo(()=>f.slice(f.indexOf(o)),[f,o]),{rect:E,node:A,isOver:T,setNodeRef:M}=$2e({id:o,data:k,disabled:N.droppable,resizeObserverConfig:{updateMeasurementsFor:_,...c}}),{active:P,activatorEvent:R,activeNodeRect:L,attributes:$,setNodeRef:F,listeners:z,isDragging:W,over:K,setActivatorNodeRef:q,transform:V}=I2e({id:o,data:k,attributes:{...sOe,...r},disabled:N.draggable}),D=S_e(M,F),U=!!P,G=U&&!x&&Vg(p)&&Vg(v),ee=!b&&W,Q=ee&&G?V:null,Y=G?Q??(l??w)({rects:y,activeNodeRect:L,activeIndex:p,overIndex:v,index:j}):null,re=Vg(p)&&Vg(v)?s({id:o,items:f,activeIndex:p,overIndex:v}):j,J=P==null?void 0:P.id,ne=O.useRef({activeId:J,items:f,newIndex:re,containerId:d}),te=f!==ne.current.items,se=e({active:P,containerId:d,isDragging:W,isSorting:U,id:o,index:j,items:f,newIndex:ne.current.newIndex,previousItems:ne.current.items,previousContainerId:ne.current.containerId,transition:u,wasDragging:ne.current.activeId!=null}),ve=oOe({disabled:!se,index:j,node:A,rect:E});return O.useEffect(()=>{U&&ne.current.newIndex!==re&&(ne.current.newIndex=re),d!==ne.current.containerId&&(ne.current.containerId=d),f!==ne.current.items&&(ne.current.items=f)},[U,re,d,f]),O.useEffect(()=>{if(J===ne.current.activeId)return;if(J!=null&&ne.current.activeId==null){ne.current.activeId=J;return}const ye=setTimeout(()=>{ne.current.activeId=J},50);return()=>clearTimeout(ye)},[J]),{active:P,activeIndex:p,attributes:$,data:k,rect:E,index:j,newIndex:re,items:f,isOver:T,isSorting:U,isDragging:W,listeners:z,node:A,overIndex:v,over:K,setNodeRef:D,setActivatorNodeRef:q,setDroppableNodeRef:M,setDraggableNodeRef:F,transform:ve??Y,transition:ie()};function ie(){if(ve||te&&ne.current.newIndex===j)return iOe;if(!(ee&&!$x(R)||!u)&&(U||se))return Rs.Transition.toString({...u,property:ZH})}}function aOe(t,e){var r,n;return typeof t=="boolean"?{draggable:t,droppable:!1}:{draggable:(r=t==null?void 0:t.draggable)!=null?r:e.draggable,droppable:(n=t==null?void 0:t.droppable)!=null?n:e.droppable}}vt.Down,vt.Right,vt.Up,vt.Left;function lOe({item:t,isEditing:e,onUpdate:r,onDelete:n}){const[i,s]=O.useState(t.text),[o,l]=O.useState(!1),{attributes:c,listeners:u,setNodeRef:f,transform:d,transition:p,isDragging:m}=KC({id:t.id}),x={transform:Rs.Transform.toString(d),transition:p},y=()=>{i.trim()&&r(t.id,i.trim()),l(!1)},v=()=>{s(t.text),l(!1)},b=w=>{w.key==="Enter"?(w.preventDefault(),y()):w.key==="Escape"&&v()};return a.jsxs("li",{ref:f,style:x,className:ge("flex items-center group relative py-2 px-1 rounded transition-colors",m&&"opacity-50",e&&"hover:bg-gray-50"),children:[e&&a.jsx("button",{...c,...u,className:"opacity-0 group-hover:opacity-100 mr-2 p-1 text-gray-400 hover:text-gray-600 cursor-grab active:cursor-grabbing",title:"Drag to reorder",children:a.jsx(DB,{className:"w-4 h-4"})}),a.jsx("div",{className:"flex-1 min-w-0",children:o&&e?a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(ct,{value:i,onChange:w=>s(w.target.value),onKeyDown:b,className:"text-sm",autoFocus:!0,placeholder:"Enter list item text..."}),a.jsx(fe,{onClick:y,size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-green-600 hover:text-green-700 hover:bg-green-50",children:a.jsx(ko,{className:"w-4 h-4"})}),a.jsx(fe,{onClick:v,size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:a.jsx($r,{className:"w-4 h-4"})})]}):a.jsxs("div",{className:"flex items-center justify-between group",children:[a.jsx("span",{className:"text-gray-700 leading-relaxed break-words",children:t.html?a.jsx("span",{dangerouslySetInnerHTML:{__html:t.html}}):t.text}),e&&a.jsxs("div",{className:"opacity-0 group-hover:opacity-100 flex items-center space-x-1 ml-2",children:[a.jsx(fe,{onClick:()=>l(!0),size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"Edit item",children:a.jsx(yo,{className:"w-3 h-3"})}),a.jsx(fe,{onClick:()=>n(t.id),size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",title:"Delete item",children:a.jsx(RO,{className:"w-3 h-3"})})]})]})})]})}function cOe({block:t,isEditing:e=!1,isSelected:r=!1,onContentChange:n}){var w;const i=t.content,{type:s="unordered",items:o=[]}=i||{},[l,c]=O.useState(null),u=Fx(Bx(Ad,{activationConstraint:{distance:8}})),f=O.useCallback(N=>{n&&n({...i,...N})},[i,n]),d=()=>{const j={id:`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:"New item"};f({items:[...o,j]})},p=(N,j)=>{const k=o.map(_=>_.id===N?{..._,text:j}:_);f({items:k})},m=N=>{const j=o.filter(k=>k.id!==N);f({items:j})},x=()=>{f({type:s==="ordered"?"unordered":"ordered"})},y=N=>{const{active:j,over:k}=N;if(k&&j.id!==k.id){const _=o.findIndex(A=>A.id===j.id),E=o.findIndex(A=>A.id===k.id);if(_!==-1&&E!==-1){const A=Td(o,_,E);f({items:A})}}c(null)},v=s==="ordered"?"ol":"ul",b=ge("space-y-1 pl-6",s==="ordered"?"list-decimal":"list-disc");return o.length===0&&!e?a.jsx("div",{className:"text-gray-400 italic py-4",children:"No list items"}):a.jsxs("div",{className:ge("space-y-3",r&&e&&"ring-2 ring-blue-500 ring-offset-2 rounded-lg p-3"),children:[e&&r&&a.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg bg-gray-50",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(fe,{onClick:x,size:"sm",variant:"outline",className:"flex items-center space-x-2",children:s==="ordered"?a.jsxs(a.Fragment,{children:[a.jsx(MO,{className:"w-4 h-4"}),a.jsx("span",{children:"Numbered"})]}):a.jsxs(a.Fragment,{children:[a.jsx(rs,{className:"w-4 h-4"}),a.jsx("span",{children:"Bulleted"})]})}),a.jsxs("span",{className:"text-sm text-gray-500",children:[o.length," ",o.length===1?"item":"items"]})]}),a.jsxs(fe,{onClick:d,size:"sm",className:"flex items-center space-x-2",children:[a.jsx(Vt,{className:"w-4 h-4"}),a.jsx("span",{children:"Add Item"})]})]}),o.length>0&&a.jsxs(Ux,{sensors:u,onDragStart:N=>c(N.active.id),onDragEnd:y,children:[a.jsx(v,{className:b,children:a.jsx(Wx,{items:o.map(N=>N.id),strategy:Hx,children:o.map(N=>a.jsx(lOe,{item:N,isEditing:e&&r,onUpdate:p,onDelete:m},N.id))})}),a.jsx(VC,{children:l?a.jsx("div",{className:"bg-white border border-gray-300 rounded px-3 py-2 shadow-lg",children:(w=o.find(N=>N.id===l))==null?void 0:w.text}):null})]}),o.length===0&&e&&r&&a.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg",children:[a.jsx(rs,{className:"w-8 h-8 text-gray-400 mx-auto mb-3"}),a.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"No list items yet"}),a.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Add your first list item to get started"}),a.jsxs(fe,{onClick:d,size:"sm",className:"flex items-center space-x-2",children:[a.jsx(Vt,{className:"w-4 h-4"}),a.jsx("span",{children:"Add First Item"})]})]})]})}const uOe=Mi(cOe),Ai=O.forwardRef(({className:t,...e},r)=>a.jsx("textarea",{className:ge("flex min-h-[80px] w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...e}));Ai.displayName="Textarea";function dOe({block:t,isEditing:e=!1,isSelected:r=!1,onContentChange:n}){const i=t.content,{text:s="",author:o="",source:l=""}=i||{},[c,u]=O.useState(s),[f,d]=O.useState(o||""),[p,m]=O.useState(l||""),[x,y]=O.useState(!1);O.useEffect(()=>{u(s),d(o||""),m(l||"")},[s,o,l]);const v=()=>{c.trim()&&n&&n({text:c.trim(),author:f.trim()||void 0,source:p.trim()||void 0}),y(!1)},b=()=>{u(s),d(o||""),m(l||""),y(!1)},w=j=>{j.key==="Escape"&&b()},N=j=>{j.key==="Enter"?(j.preventDefault(),v()):j.key==="Escape"&&b()};return!s&&!e?a.jsx("div",{className:"text-gray-400 italic py-4",children:"No quote text"}):a.jsxs("div",{className:ge("relative",r&&e&&"ring-2 ring-blue-500 ring-offset-2 rounded-lg p-3"),children:[x&&e&&r?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"bg-white border border-gray-300 rounded-lg p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quote Text *"}),a.jsx(Ai,{value:c,onChange:j=>u(j.target.value),onKeyDown:w,placeholder:"Enter the quote text here...",className:"min-h-[100px] resize-none",autoFocus:!0})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a.jsx(zB,{className:"w-4 h-4 inline mr-1"}),"Author (Optional)"]}),a.jsx(ct,{value:f,onChange:j=>d(j.target.value),onKeyDown:N,placeholder:"e.g., Albert Einstein",className:"text-sm"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a.jsx(E0,{className:"w-4 h-4 inline mr-1"}),"Source (Optional)"]}),a.jsx(ct,{value:p,onChange:j=>m(j.target.value),onKeyDown:N,placeholder:"e.g., Theory of Relativity",className:"text-sm"})]})]}),a.jsxs("div",{className:"flex items-center justify-end space-x-2 pt-2 border-t border-gray-200",children:[a.jsxs(fe,{onClick:b,size:"sm",variant:"outline",className:"flex items-center space-x-2",children:[a.jsx($r,{className:"w-4 h-4"}),a.jsx("span",{children:"Cancel"})]}),a.jsxs(fe,{onClick:v,size:"sm",disabled:!c.trim(),className:"flex items-center space-x-2",children:[a.jsx(ko,{className:"w-4 h-4"}),a.jsx("span",{children:"Save Quote"})]})]})]})}):a.jsxs("blockquote",{className:"relative border-l-4 border-blue-500 bg-blue-50 py-4 px-6 my-6 group",children:[e&&r&&a.jsx(fe,{onClick:()=>y(!0),size:"sm",variant:"outline",className:"absolute -top-2 -right-2 opacity-0 group-hover:opacity-100 transition-opacity bg-white border-gray-300 hover:bg-gray-50 shadow-lg h-8 w-8 p-0",title:"Edit quote",children:a.jsx(yo,{className:"w-4 h-4"})}),a.jsxs("div",{className:"relative",children:[a.jsx("svg",{className:"absolute top-0 left-0 transform -translate-x-2 -translate-y-2 h-8 w-8 text-blue-500",fill:"currentColor",viewBox:"0 0 32 32",children:a.jsx("path",{d:"M9.352 4c4.456 0 8.064 3.84 8.064 8.352 0 4.448-3.608 8.064-8.064 8.064a7.12 7.12 0 01-.448-.032c1.216-1.344 1.888-3.136 1.888-5.12 0-3.584-2.848-6.464-6.464-6.464a7.12 7.12 0 01-.448.032c1.216 1.344 1.888 3.136 1.888 5.12 0 3.584-2.848 6.464-6.464 6.464v-1.6c2.752 0 4.864-2.112 4.864-4.864 0-2.688-2.176-4.864-4.864-4.864V4h10.048z"})}),a.jsx("div",{className:"pl-6",children:s?a.jsx("p",{className:"text-gray-800 text-lg leading-relaxed italic whitespace-pre-wrap",children:s}):a.jsx("p",{className:"text-gray-400 text-lg leading-relaxed italic",children:"Click to add quote text..."})}),(o||l)&&a.jsx("footer",{className:"mt-4 pl-6",children:a.jsxs("cite",{className:"text-gray-600 text-sm not-italic",children:[o&&a.jsx("span",{className:"font-medium",children:o}),o&&l&&a.jsx("span",{className:"mx-1",children:"•"}),l&&a.jsx("span",{children:l})]})})]})]}),!s&&e&&r&&!x&&a.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>y(!0),children:[a.jsx(xy,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Add an Inspirational Quote"}),a.jsx("p",{className:"text-gray-500 mb-4 max-w-sm mx-auto",children:"Share wisdom, motivation, or insights with a beautifully formatted quote block."}),a.jsxs(fe,{onClick:j=>{j.stopPropagation(),y(!0)},className:"flex items-center space-x-2",children:[a.jsx(xy,{className:"w-4 h-4"}),a.jsx("span",{children:"Add Quote"})]})]})]})}const fOe=Mi(dOe);function hOe({block:t}){return a.jsx("div",{className:"flex items-center justify-center my-8",children:a.jsx("hr",{className:"flex-grow border-t border-gray-300"})})}const pOe=Mi(hOe);function mOe({onSelect:t,selectedContentType:e="video",allowedTypes:r=["video","document","prompt","automation","ai_agent"],multiSelect:n=!1}){const[i,s]=O.useState(e),[o,l]=O.useState("grid"),[c,u]=O.useState(""),[f,d]=O.useState("updated_at"),[p,m]=O.useState("desc"),[x,y]=O.useState([]),[v,b]=O.useState(""),[w,N]=O.useState(!1),[j,k]=O.useState([]),[_,E]=O.useState(0),[A,T]=O.useState(0),[M,P]=O.useState([]),[R,L]=O.useState(!1),[$,F]=O.useState([]),z=20,W={video:{icon:si,label:"Videos",color:"text-red-600"},document:{icon:Ot,label:"Documents",color:"text-blue-600"},prompt:{icon:Gr,label:"Prompts",color:"text-green-600"},automation:{icon:Ei,label:"Automations",color:"text-yellow-600"},ai_agent:{icon:Kr,label:"AI Agents",color:"text-purple-600"}},K=H=>({video:"videos",document:"documents",prompt:"prompts",automation:"automations",ai_agent:"ai_agents"})[H]||H,q=async(H=!1)=>{var Y;N(!0);try{const re=H?0:A,{data:J,error:ne}=await pe.functions.invoke("content-repository-manager",{body:{action:"list",contentType:K(i),searchQuery:c,filters:{tags:x,difficulty:v},sortBy:f,sortOrder:p,limit:z,offset:re}});if(ne){console.error("Failed to fetch content:",ne);return}const te=J.data;k(H||re===0?te.items||[]:se=>[...se,...te.items||[]]),E(((Y=te.pagination)==null?void 0:Y.total)||0),H&&T(0)}catch(re){console.error("Error fetching content:",re)}finally{N(!1)}},V=()=>{const H=A+z;T(H),q(!1)};O.useEffect(()=>{q(!0)},[i,c,x,v,f,p]);const D=H=>{if(n){const Y=M.includes(H.id)?M.filter(re=>re!==H.id):[...M,H.id];P(Y)}else t(H)},U=H=>{y(Y=>Y.includes(H)?Y.filter(re=>re!==H):[...Y,H])},G=W[i],ee=G.icon,Q=A+z<_;return a.jsxs("div",{className:"h-full flex flex-col",children:[a.jsx("div",{className:"border-b border-gray-200 px-4 py-3",children:a.jsx("div",{className:"flex flex-wrap gap-1",children:r.map(H=>{const Y=W[H],re=Y.icon;return a.jsxs("button",{onClick:()=>{s(H),u(""),y([]),T(0)},className:ge("flex items-center space-x-2 px-3 py-2 text-sm font-medium rounded-lg transition-all duration-200",i===H?"bg-blue-100 text-blue-700 border border-blue-200":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"),children:[a.jsx(re,{className:"w-4 h-4"}),a.jsx("span",{children:Y.label})]},H)})})}),a.jsxs("div",{className:"border-b border-gray-200 px-4 py-3 space-y-3",children:[a.jsxs("div",{className:"relative",children:[a.jsx(In,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),a.jsx(ct,{placeholder:`Search ${G.label.toLowerCase()}...`,value:c,onChange:H=>u(H.target.value),className:"pl-10 pr-10"}),c&&a.jsx("button",{onClick:()=>u(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:"×"})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs(fe,{variant:"outline",size:"sm",onClick:()=>L(!R),className:ge("flex items-center space-x-2",R&&"bg-gray-100"),children:[a.jsx(Ep,{className:"w-4 h-4"}),a.jsx("span",{children:"Filters"}),(x.length>0||v)&&a.jsx(At,{variant:"secondary",className:"text-xs",children:x.length+(v?1:0)})]}),a.jsxs("select",{value:`${f}-${p}`,onChange:H=>{const[Y,re]=H.target.value.split("-");d(Y),m(re)},className:"text-sm border border-gray-300 rounded-md px-3 py-1.5 bg-white",children:[a.jsx("option",{value:"updated_at-desc",children:"Recently Updated"}),a.jsx("option",{value:"created_at-desc",children:"Newest First"}),a.jsx("option",{value:"title-asc",children:"A-Z"}),a.jsx("option",{value:"title-desc",children:"Z-A"})]})]}),a.jsxs("div",{className:"flex items-center space-x-1 bg-gray-100 rounded-lg p-1",children:[a.jsx("button",{onClick:()=>l("grid"),className:ge("p-1.5 rounded-md transition-colors",o==="grid"?"bg-white shadow-sm":"hover:bg-gray-200"),children:a.jsx(dd,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>l("list"),className:ge("p-1.5 rounded-md transition-colors",o==="list"?"bg-white shadow-sm":"hover:bg-gray-200"),children:a.jsx(rs,{className:"w-4 h-4"})})]})]}),R&&a.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty Level"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:["beginner","intermediate","advanced"].map(H=>a.jsx("button",{onClick:()=>b(v===H?"":H),className:ge("px-3 py-1.5 text-sm rounded-full border transition-colors",v===H?"bg-blue-100 border-blue-300 text-blue-700":"border-gray-300 text-gray-600 hover:border-gray-400"),children:H.charAt(0).toUpperCase()+H.slice(1)},H))})]}),$.length>0&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:$.slice(0,10).map(H=>a.jsx("button",{onClick:()=>U(H),className:ge("px-3 py-1.5 text-sm rounded-full border transition-colors",x.includes(H)?"bg-blue-100 border-blue-300 text-blue-700":"border-gray-300 text-gray-600 hover:border-gray-400"),children:H},H))})]}),(x.length>0||v)&&a.jsx("div",{className:"flex justify-end",children:a.jsx(fe,{variant:"outline",size:"sm",onClick:()=>{y([]),b("")},children:"Clear All Filters"})})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:w&&j.length===0?a.jsxs("div",{className:"flex flex-col items-center justify-center h-48",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"}),a.jsxs("p",{className:"text-gray-600",children:["Loading ",G.label.toLowerCase(),"..."]})]}):j.length===0?a.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-center",children:[a.jsx(ee,{className:ge("w-12 h-12 mb-4",G.color)}),a.jsxs("h3",{className:"font-medium text-gray-900 mb-2",children:["No ",G.label.toLowerCase()," found"]}),a.jsx("p",{className:"text-gray-500 text-sm",children:c||x.length>0||v?"Try adjusting your search or filters":`No ${G.label.toLowerCase()} available yet`})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:ge(o==="grid"?"grid grid-cols-2 gap-4":"space-y-3"),children:j.map(H=>a.jsx("div",{onClick:()=>D(H),className:ge("border border-gray-200 rounded-lg transition-all duration-200 cursor-pointer hover:shadow-md",M.includes(H.id)&&"border-blue-500 bg-blue-50",o==="grid"?"p-4":"p-3 flex items-center space-x-4"),children:o==="grid"?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"aspect-video bg-gray-100 rounded-lg mb-3 flex items-center justify-center overflow-hidden",children:H.thumbnail_url||H.file_url?a.jsx("img",{src:H.thumbnail_url||H.file_url,alt:H.title,className:"w-full h-full object-cover"}):a.jsx(ee,{className:ge("w-8 h-8",G.color)})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 text-sm line-clamp-2 mb-1",children:H.title}),H.description&&a.jsx("p",{className:"text-xs text-gray-600 line-clamp-2 mb-2",children:H.description}),a.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(go,{className:"w-3 h-3"}),a.jsx("span",{children:new Date(H.updated_at).toLocaleDateString()})]}),H.status&&a.jsx(At,{variant:H.status==="published"?"default":"secondary",className:"text-xs",children:H.status})]}),H.tags&&H.tags.length>0&&a.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[H.tags.slice(0,2).map(Y=>a.jsx(At,{variant:"outline",className:"text-xs",children:Y},Y)),H.tags.length>2&&a.jsxs("span",{className:"text-xs text-gray-500",children:["+",H.tags.length-2]})]})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0 overflow-hidden",children:H.thumbnail_url||H.file_url?a.jsx("img",{src:H.thumbnail_url||H.file_url,alt:H.title,className:"w-full h-full object-cover"}):a.jsx(ee,{className:ge("w-5 h-5",G.color)})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"font-medium text-gray-900 text-sm truncate",children:H.title}),H.description&&a.jsx("p",{className:"text-xs text-gray-600 truncate mt-1",children:H.description})]}),H.status&&a.jsx(At,{variant:H.status==="published"?"default":"secondary",className:"text-xs ml-2 flex-shrink-0",children:H.status})]}),a.jsxs("div",{className:"flex items-center justify-between mt-2",children:[a.jsxs("div",{className:"flex items-center space-x-3 text-xs text-gray-500",children:[a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(go,{className:"w-3 h-3"}),a.jsx("span",{children:new Date(H.updated_at).toLocaleDateString()})]}),H.difficulty_level&&a.jsx(At,{variant:"outline",className:"text-xs",children:H.difficulty_level})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("button",{className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",children:a.jsx(ii,{className:"w-4 h-4"})}),a.jsx("button",{className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",children:a.jsx(Os,{className:"w-4 h-4"})})]})]})]})]})},H.id))}),Q&&a.jsx("div",{className:"flex justify-center mt-6",children:a.jsx(fe,{variant:"outline",onClick:V,disabled:w,className:"flex items-center space-x-2",children:w?a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600"}):a.jsx("span",{children:"Load More"})})})]})}),a.jsxs("div",{className:"border-t border-gray-200 px-4 py-3 text-xs text-gray-500",children:["Showing ",j.length," of ",_," ",G.label.toLowerCase(),n&&M.length>0&&a.jsxs("span",{className:"ml-2",children:["• ",M.length," selected"]})]})]})}function GC({isOpen:t,onClose:e,onSelect:r,contentType:n="video",allowedTypes:i=["video","document","prompt","automation","ai_agent"],title:s="Select Content",description:o="Choose content from your library",multiSelect:l=!1}){const[c,u]=O.useState([]);O.useEffect(()=>{t||u([])},[t]);const f=p=>{l?u(m=>m.find(y=>y.id===p.id)?m.filter(y=>y.id!==p.id):[...m,p]):(r(p),e())},d=()=>{c.length>0&&(r(l?c:c[0]),e())};return t?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[80vh] flex flex-col",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:s}),o&&a.jsx("p",{className:"text-gray-600 text-sm mt-1",children:o})]}),a.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 p-2",children:a.jsx($r,{className:"w-6 h-6"})})]}),a.jsx("div",{className:"flex-1 overflow-hidden",children:a.jsx(mOe,{onSelect:f,selectedContentType:n,allowedTypes:i,multiSelect:l})}),a.jsx("div",{className:"border-t border-gray-200 px-6 py-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"text-sm text-gray-500",children:l&&c.length>0&&a.jsxs("span",{children:[c.length," item",c.length!==1?"s":""," selected"]})}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(fe,{variant:"outline",onClick:e,children:"Cancel"}),l&&a.jsxs(fe,{onClick:d,disabled:c.length===0,children:["Select ",c.length>0?`(${c.length})`:""]})]})]})})]})}):null}async function ml(t,e={}){const{search:r,status:n="published",limit:i=20,offset:s=0,sortBy:o="updated_at",sortOrder:l="desc"}=e;let c=pe.from("content_items").select("*").eq("content_type",t);n!=="all"&&(c=c.eq("status",n)),r!=null&&r.trim()&&(c=c.or(`title.ilike.%${r}%,description.ilike.%${r}%`)),c=c.order(o,{ascending:l==="asc"}),c=c.range(s,s+i-1);const{data:u,error:f,count:d}=await c;if(f)throw console.error("Error fetching content items:",f),f;if(!u||u.length===0)return{items:[],total:d||0};let p;const m=u.map(b=>b.id);switch(t){case"ai_agent":p=pe.from("ai_agents").select("content_item_id, agent_name, short_description").in("content_item_id",m);break;case"video":p=pe.from("videos").select("content_item_id, video_platform, duration_seconds").in("content_item_id",m);break;case"document":p=pe.from("documents").select("content_item_id, word_count, reading_time_minutes").in("content_item_id",m);break;case"prompt":p=pe.from("prompts").select("content_item_id, prompt_category, usage_count").in("content_item_id",m);break;case"automation":p=pe.from("automations").select("content_item_id, required_tools").in("content_item_id",m);break}const{data:x,error:y}=await p;return y&&console.error("Error fetching metadata:",y),{items:u.map(b=>{const w=x==null?void 0:x.find(N=>N.content_item_id===b.id);return{...b,metadata:w?{...w,content_item_id:void 0}:void 0}}),total:d||0}}const gOe={async getAIAgents(t){return ml("ai_agent",t)},async getVideos(t){return ml("video",t)},async getDocuments(t){return ml("document",t)},async getPrompts(t){return ml("prompt",t)},async getAutomations(t){return ml("automation",t)},async getContentByType(t,e){return ml(t,e)},async getContentById(t,e){const{data:r,error:n}=await pe.from("content_items").select("*").eq("id",e).eq("content_type",t).maybeSingle();if(n)throw console.error("Error fetching content item:",n),n;if(!r)return null;let i;switch(t){case"ai_agent":i=pe.from("ai_agents").select("agent_name, short_description").eq("content_item_id",e).maybeSingle();break;case"video":i=pe.from("videos").select("video_platform, duration_seconds").eq("content_item_id",e).maybeSingle();break;case"document":i=pe.from("documents").select("word_count, reading_time_minutes").eq("content_item_id",e).maybeSingle();break;case"prompt":i=pe.from("prompts").select("prompt_category, usage_count").eq("content_item_id",e).maybeSingle();break;case"automation":i=pe.from("automations").select("required_tools").eq("content_item_id",e).maybeSingle();break}const{data:s}=await i||{data:null};return{...r,metadata:s||void 0}},async searchAllContent(t,e){const{contentTypes:r=["ai_agent","video","document","prompt","automation"],status:n="published",limit:i=5}=e||{},s=await Promise.all(r.map(async l=>{const{items:c}=await ml(l,{search:t,status:n,limit:i,sortBy:"updated_at",sortOrder:"desc"});return{type:l,items:c}})),o={};return s.forEach(({type:l,items:c})=>{o[l]=c}),o}},uy={formatDuration(t){if(!t)return"Unknown duration";const e=Math.floor(t/3600),r=Math.floor(t%3600/60),n=t%60;return e>0?`${e}:${r.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`:`${r}:${n.toString().padStart(2,"0")}`},formatReadingTime(t){return t?t<1?"< 1 min read":`${t} min read`:"Unknown reading time"},formatWordCount(t){return t?t<1e3?`${t} words`:`${(t/1e3).toFixed(1)}k words`:"Unknown length"},getContentTypeInfo(t){return{ai_agent:{label:"AI Agent",icon:"Bot",color:"#3B82F6"},video:{label:"Video",icon:"Play",color:"#EF4444"},document:{label:"Document",icon:"FileText",color:"#10B981"},prompt:{label:"Prompt",icon:"MessageSquare",color:"#8B5CF6"},automation:{label:"Automation",icon:"Zap",color:"#F59E0B"}}[t]||{label:t,icon:"File",color:"#6B7280"}},generatePreviewText(t){const{content_type:e,metadata:r,description:n}=t;if(n&&n.length>100)return n.substring(0,100)+"...";if(n)return n;switch(e){case"ai_agent":return(r==null?void 0:r.short_description)||"AI agent for automated conversations and assistance";case"video":const i=r==null?void 0:r.duration_seconds,s=(r==null?void 0:r.video_platform)||"video";return`${s.charAt(0).toUpperCase()+s.slice(1)} - ${uy.formatDuration(i)}`;case"document":const o=r==null?void 0:r.word_count,l=r==null?void 0:r.reading_time_minutes;return`${uy.formatWordCount(o)} • ${uy.formatReadingTime(l)}`;case"prompt":const c=r==null?void 0:r.prompt_category,u=(r==null?void 0:r.usage_count)||0;return`${c?c+" • ":""}Used ${u} times`;case"automation":const f=r==null?void 0:r.required_tools;return f&&f.length>0?`Requires: ${f.slice(0,2).join(", ")}${f.length>2?`+${f.length-2} more`:""}`:"Process automation workflow";default:return"Content item"}}},gl={video:{label:"Videos",icon:({className:t})=>a.jsx("svg",{className:t,fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{d:"M2 6a2 2 0 012-2h6l2 2h6a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"})}),color:"#EF4444",bgColor:"#FEF2F2",description:"Video content and tutorials",extensions:["mp4","avi","mov","wmv"]},document:{label:"Documents",icon:({className:t})=>a.jsx("svg",{className:t,fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-5L9 2H4z",clipRule:"evenodd"})}),color:"#10B981",bgColor:"#ECFDF5",description:"PDFs, guides and documentation",extensions:["pdf","doc","docx"]},ai_agent:{label:"AI Agents",icon:({className:t})=>a.jsx("svg",{className:t,fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"})}),color:"#3B82F6",bgColor:"#EFF6FF",description:"Interactive AI assistants",extensions:[]},prompt:{label:"Prompts",icon:({className:t})=>a.jsx("svg",{className:t,fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M18 13V5a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2h3l3 3 3-3h3a2 2 0 002-2zM5 7a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h3a1 1 0 100-2H6z",clipRule:"evenodd"})}),color:"#8B5CF6",bgColor:"#F3E8FF",description:"Reusable prompt templates",extensions:[]},automation:{label:"Automations",icon:({className:t})=>a.jsx("svg",{className:t,fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{d:"M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.477.859h4z"})}),color:"#F59E0B",bgColor:"#FFFBEB",description:"Workflow automations",extensions:[]}};function yOe({onSelect:t,onUpload:e,allowUpload:r=!1,multiSelect:n=!1,className:i}){const[s,o]=O.useState("folders"),[l,c]=O.useState(null),[u,f]=O.useState(["Content Repository"]),[d,p]=O.useState([]),[m,x]=O.useState(!1),[y,v]=O.useState(null),[b,w]=O.useState("tiles"),[N,j]=O.useState(""),[k,_]=O.useState("updated_at"),[E,A]=O.useState("desc"),[T,M]=O.useState([]),[P,R]=O.useState(!1),[L,$]=O.useState(!1),F=Object.entries(gl).map(([H,Y])=>({id:H,name:Y.label,contentType:H,itemCount:0,lastModified:new Date().toISOString(),color:Y.color,icon:Y.icon})),z=O.useCallback(async H=>{if(H){x(!0),v(null);try{const{items:Y}=await gOe.getContentByType(H,{search:N,status:"all",sortBy:k==="content_type"?"title":k,sortOrder:E,limit:50});p(Y)}catch(Y){console.error("Error fetching content:",Y),v("Failed to load content. Please try again."),p([])}finally{x(!1)}}},[N,k,E]),W=H=>{c(H.contentType),o("content"),f(["Content Repository",H.name]),z(H.contentType)},K=()=>{s==="content"&&(o("folders"),c(null),f(["Content Repository"]),p([]),M([]))},q=async()=>{l&&($(!0),await z(l),$(!1))},V=H=>{n?M(Y=>Y.includes(H.id)?Y.filter(J=>J!==H.id):[...Y,H.id]):t==null||t(H)},D=Z.useMemo(()=>{let H=[...d];if(N.trim()){const Y=N.toLowerCase();H=H.filter(re=>{var J;return re.title.toLowerCase().includes(Y)||((J=re.description)==null?void 0:J.toLowerCase().includes(Y))})}return H},[d,N]),U=()=>a.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 mb-4",children:[a.jsx(PO,{className:"w-4 h-4"}),u.map((H,Y)=>a.jsxs(Z.Fragment,{children:[Y>0&&a.jsx(jh,{className:"w-4 h-4"}),a.jsx("span",{className:ge(Y===u.length-1?"text-gray-900 font-medium":"hover:text-gray-900 cursor-pointer"),onClick:Y===0?K:void 0,children:H})]},Y))]}),G=()=>{var H;return a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[s==="content"&&a.jsxs(fe,{variant:"outline",size:"sm",onClick:K,className:"flex items-center space-x-2",children:[a.jsx(lo,{className:"w-4 h-4"}),a.jsx("span",{children:"Back"})]}),a.jsxs("div",{className:"relative flex-1 max-w-md",children:[a.jsx(In,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),a.jsx(ct,{placeholder:`Search ${s==="folders"?"content":(H=gl[l])==null?void 0:H.label.toLowerCase()}...`,value:N,onChange:Y=>j(Y.target.value),className:"pl-10"})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[s==="content"&&a.jsxs(fe,{variant:"outline",size:"sm",onClick:q,disabled:L,className:"flex items-center space-x-2",children:[a.jsx(IO,{className:ge("w-4 h-4",L&&"animate-spin")}),a.jsx("span",{children:"Refresh"})]}),r&&l&&a.jsxs(fe,{size:"sm",className:"flex items-center space-x-2",style:{backgroundColor:gl[l].color},children:[a.jsx(Ir,{className:"w-4 h-4"}),a.jsx("span",{children:"Upload"})]}),a.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[a.jsx("button",{onClick:()=>w("tiles"),className:ge("p-2 rounded-md transition-colors",b==="tiles"?"bg-white shadow-sm":"hover:bg-gray-200"),title:"Tile view",children:a.jsx(dd,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>w("list"),className:ge("p-2 rounded-md transition-colors",b==="list"?"bg-white shadow-sm":"hover:bg-gray-200"),title:"List view",children:a.jsx(rs,{className:"w-4 h-4"})})]})]})]})},ee=()=>a.jsx("div",{className:ge("grid gap-6",b==="tiles"?"grid-cols-2 md:grid-cols-3 lg:grid-cols-4":"grid-cols-1"),children:F.map(H=>{const Y=H.icon;return a.jsxs("div",{onClick:()=>W(H),className:ge("group relative border border-gray-200 rounded-xl transition-all duration-200 cursor-pointer hover:shadow-lg hover:border-gray-300",b==="tiles"?"p-6 text-center":"p-4 flex items-center space-x-4"),style:{backgroundColor:H.color+"08"},children:[a.jsx("div",{className:ge("flex items-center justify-center rounded-lg transition-transform group-hover:scale-110",b==="tiles"?"w-16 h-16 mx-auto mb-4":"w-12 h-12 flex-shrink-0"),style:{backgroundColor:H.color+"20"},children:a.jsx(Y,{className:"w-8 h-8",style:{color:H.color}})}),a.jsxs("div",{className:ge(b==="list"&&"flex-1"),children:[a.jsx("h3",{className:"font-semibold text-gray-900 group-hover:text-gray-700 transition-colors",children:H.name}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:gl[H.contentType].description}),a.jsxs("div",{className:"flex items-center justify-center space-x-4 mt-2 text-xs text-gray-500",children:[a.jsxs("span",{children:[H.itemCount," items"]}),a.jsx("span",{children:"•"}),a.jsx("span",{children:"Updated today"})]})]})]},H.id)})}),Q=()=>{var H;if(m)return a.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[a.jsx(cr,{size:"lg"}),a.jsxs("p",{className:"text-gray-600 mt-4",children:["Loading ",(H=gl[l])==null?void 0:H.label.toLowerCase(),"..."]})]});if(y)return a.jsxs("div",{className:"text-center py-20",children:[a.jsx("div",{className:"text-red-500 mb-4",children:a.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error Loading Content"}),a.jsx("p",{className:"text-gray-600 mb-4",children:y}),a.jsx(fe,{onClick:q,children:"Try Again"})]});if(D.length===0){const Y=gl[l];return a.jsxs("div",{className:"text-center py-20",children:[a.jsx("div",{className:"mb-4",style:{color:Y.color},children:a.jsx(Y.icon,{className:"w-12 h-12 mx-auto"})}),a.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:["No ",Y.label.toLowerCase()," found"]}),a.jsx("p",{className:"text-gray-600 mb-6",children:N?`No ${Y.label.toLowerCase()} match your search"${N}"`:`Start by uploading your first ${Y.label.toLowerCase().slice(0,-1)}`}),r&&a.jsxs(fe,{className:"flex items-center space-x-2",style:{backgroundColor:Y.color},children:[a.jsx(Ir,{className:"w-4 h-4"}),a.jsxs("span",{children:["Upload ",Y.label.slice(0,-1)]})]})]})}return a.jsx("div",{className:ge("grid gap-4",b==="tiles"?"grid-cols-2 md:grid-cols-3 lg:grid-cols-4":"grid-cols-1"),children:D.map(Y=>{const re=T.includes(Y.id),J=gl[l];return a.jsx("div",{onClick:()=>V(Y),className:ge("group border border-gray-200 rounded-lg transition-all duration-200 cursor-pointer hover:shadow-md",re&&"border-blue-500 bg-blue-50",b==="tiles"?"p-4":"p-3 flex items-center space-x-4"),children:b==="tiles"?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"aspect-video bg-gray-100 rounded-lg mb-3 flex items-center justify-center overflow-hidden",children:Y.thumbnail_url?a.jsx("img",{src:Y.thumbnail_url,alt:Y.title,className:"w-full h-full object-cover"}):a.jsx(J.icon,{className:"w-8 h-8",style:{color:J.color}})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 line-clamp-2 mb-1",children:Y.title}),Y.description&&a.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mb-2",children:Y.description}),a.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[a.jsx("span",{children:new Date(Y.updated_at).toLocaleDateString()}),a.jsx(At,{variant:Y.status==="published"?"default":"secondary",className:"text-xs",children:Y.status})]})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0",children:a.jsx(J.icon,{className:"w-5 h-5",style:{color:J.color}})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"font-medium text-gray-900 truncate",children:Y.title}),Y.description&&a.jsx("p",{className:"text-sm text-gray-600 truncate",children:Y.description})]}),a.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[a.jsx(At,{variant:Y.status==="published"?"default":"secondary",className:"text-xs",children:Y.status}),a.jsx("span",{children:new Date(Y.updated_at).toLocaleDateString()})]})]})},Y.id)})})};return a.jsxs("div",{className:ge("h-full flex flex-col bg-white",i),children:[a.jsxs("div",{className:"p-6 border-b border-gray-200",children:[U(),G()]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:s==="folders"?ee():Q()}),n&&T.length>0&&a.jsx("div",{className:"border-t border-gray-200 p-4 bg-gray-50",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("span",{className:"text-sm text-gray-700",children:[T.length," item",T.length!==1?"s":""," selected"]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(fe,{variant:"outline",size:"sm",onClick:()=>M([]),children:"Clear Selection"}),a.jsx(fe,{size:"sm",onClick:()=>{const H=D.filter(Y=>T.includes(Y.id));t==null||t(H[0])},children:"Use Selected"})]})]})})]})}const Q6={video:UB,document:Ot,ai_agent:Kr,prompt:Gr,automation:Ei};function eW({isOpen:t,onClose:e,onSelect:r,contentType:n,allowedTypes:i,title:s="Select Content",description:o="Choose content from your library",multiSelect:l=!1,allowUpload:c=!1,className:u}){const[f,d]=O.useState([]),[p,m]=O.useState(!1),[x,y]=O.useState(!1);if(!t)return null;const v=_=>{if(l){const E=f.find(A=>A.id===_.id);d(E?A=>A.filter(T=>T.id!==_.id):A=>[...A,_])}else r(_),e()},b=()=>{f.length>0&&(r(l?f:f[0]),e())},w=_=>{console.log("Files to upload:",_),m(!1)},N=_=>{_.preventDefault(),y(!0)},j=_=>{_.preventDefault(),y(!1)},k=_=>{_.preventDefault(),y(!1);const E=Array.from(_.dataTransfer.files);E.length>0&&w(E)};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:ge("bg-white rounded-xl shadow-2xl max-w-6xl w-full max-h-[85vh] flex flex-col overflow-hidden",u),children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gray-50",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center",children:n&&Q6[n]?Z.createElement(Q6[n],{className:"w-6 h-6 text-white"}):a.jsx(Ot,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:s}),o&&a.jsx("p",{className:"text-gray-600 text-sm mt-1",children:o})]})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[c&&a.jsxs(fe,{variant:"outline",size:"sm",onClick:()=>m(!p),className:ge("flex items-center space-x-2",p&&"bg-blue-50 border-blue-300 text-blue-700"),children:[a.jsx(Ir,{className:"w-4 h-4"}),a.jsx("span",{children:"Upload"})]}),a.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx($r,{className:"w-5 h-5"})})]})]}),a.jsx("div",{className:"flex-1 overflow-hidden relative",children:p?a.jsx("div",{className:ge("h-full flex items-center justify-center border-2 border-dashed border-gray-300 m-6 rounded-xl transition-colors",x&&"border-blue-500 bg-blue-50"),onDragOver:N,onDragLeave:j,onDrop:k,children:a.jsxs("div",{className:"text-center p-8",children:[a.jsx(Ir,{className:"w-16 h-16 mx-auto mb-6 text-gray-400"}),a.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-2",children:"Upload New Content"}),a.jsx("p",{className:"text-gray-600 mb-6 max-w-md",children:"Drag and drop your files here, or click to browse and select files from your computer."}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs(fe,{className:"flex items-center space-x-2",children:[a.jsx(Ir,{className:"w-4 h-4"}),a.jsx("span",{children:"Choose Files"})]}),n&&a.jsxs("p",{className:"text-sm text-gray-500",children:["Supported formats: ",vOe(n).join(", ")]})]})]})}):a.jsx(yOe,{onSelect:v,multiSelect:l,allowUpload:!1,className:"h-full"})}),a.jsx("div",{className:"border-t border-gray-200 px-6 py-4 bg-gray-50",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[l&&f.length>0&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-medium",children:f.length}),a.jsxs("span",{className:"text-sm text-gray-700",children:[f.length," item",f.length!==1?"s":""," selected"]})]}),p&&a.jsx(fe,{variant:"outline",size:"sm",onClick:()=>m(!1),children:"Back to Library"})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(fe,{variant:"outline",onClick:e,children:"Cancel"}),l&&f.length>0&&!p&&a.jsx(fe,{onClick:b,className:"flex items-center space-x-2",children:a.jsxs("span",{children:["Select (",f.length,")"]})})]})]})})]})})}function vOe(t){return{video:["MP4","AVI","MOV","WMV","MKV"],document:["PDF","DOC","DOCX","TXT"],ai_agent:["JSON","YAML"],prompt:["TXT","MD"],automation:["JSON","YAML","JS"]}[t]||["All files"]}function xOe({block:t,isEditing:e=!1,isSelected:r=!1,onContentChange:n,onSelect:i,onEdit:s,className:o}){const[l,c]=O.useState(!1),[u,f]=O.useState(!1),d=t.content,{video_id:p,url:m,platform:x,title:y,description:v,thumbnail:b,duration:w,autoplay:N=!1,controls:j=!0}=d||{},k=T=>{var P,R,L;const M={video_id:T.id,title:T.title,description:T.description,thumbnail:T.thumbnail_url,platform:((P=T.metadata)==null?void 0:P.video_platform)||"internal",url:((R=T.metadata)==null?void 0:R.video_url)||T.file_url,duration:(L=T.metadata)==null?void 0:L.duration_seconds,autoplay:!1,controls:!0};n==null||n(M),c(!1)},_=()=>{n==null||n({})},E=()=>"aspect-video",A=()=>!p&&!m?a.jsx("div",{className:`${E()} bg-gray-100 rounded-lg flex items-center justify-center border-2 border-dashed border-gray-300`,children:a.jsxs("div",{className:"text-center",children:[a.jsx(Fw,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Add Video Content"}),a.jsx("p",{className:"text-gray-600 mb-4 max-w-sm",children:"Select a video from your content library to embed in this block."}),e&&a.jsxs(fe,{onClick:()=>c(!0),className:"flex items-center space-x-2",children:[a.jsx(si,{className:"w-4 h-4"}),a.jsx("span",{children:"Select Video"})]})]})}):a.jsxs("div",{className:"space-y-4",children:[y&&a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:y}),v&&a.jsx("p",{className:"text-gray-600 text-sm",children:v})]}),a.jsxs("div",{className:`${E()} bg-black rounded-lg relative overflow-hidden group`,children:[a.jsx("div",{className:"absolute inset-0",children:b?a.jsx("img",{src:b,alt:y||"Video thumbnail",className:"w-full h-full object-cover"}):a.jsx("div",{className:"w-full h-full bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center",children:a.jsx(Fw,{className:"w-16 h-16 text-gray-400"})})}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:a.jsx("button",{onClick:()=>f(!0),className:"w-16 h-16 bg-white bg-opacity-90 rounded-full flex items-center justify-center hover:bg-opacity-100 transition-all duration-200 group-hover:scale-110",children:a.jsx(si,{className:"w-8 h-8 text-gray-800 ml-1",fill:"currentColor"})})}),e&&a.jsxs("div",{className:"absolute top-3 right-3 flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[a.jsx(fe,{onClick:()=>c(!0),size:"sm",variant:"outline",className:"bg-white/90 hover:bg-white border-gray-300",children:a.jsx(Dn,{className:"w-4 h-4"})}),a.jsx(fe,{onClick:_,size:"sm",variant:"outline",className:"bg-white/90 hover:bg-white border-gray-300 text-red-600 hover:text-red-700",children:"×"})]}),w&&a.jsxs("div",{className:"absolute bottom-3 right-3 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-sm",children:[Math.floor(w/60),":",(w%60).toString().padStart(2,"0")]})]}),(x||w)&&a.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[x&&a.jsxs("span",{className:"capitalize",children:[x," Video"]}),w&&a.jsxs("span",{children:["Duration: ",Math.floor(w/60),":",(w%60).toString().padStart(2,"0")]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("button",{onClick:()=>f(!0),className:"p-1 hover:text-gray-700 transition-colors",title:"View fullscreen",children:a.jsx(Jg,{className:"w-4 h-4"})}),m&&a.jsx("a",{href:m,target:"_blank",rel:"noopener noreferrer",className:"p-1 hover:text-gray-700 transition-colors",title:"Open in new tab",children:a.jsx(Os,{className:"w-4 h-4"})})]})]})]});return a.jsxs("div",{className:ge("relative",r&&e&&"ring-2 ring-blue-500 ring-offset-2 rounded-lg p-2",o),onClick:i,children:[A(),a.jsx(eW,{isOpen:l,onClose:()=>c(!1),onSelect:k,contentType:"video",title:"Select Video",description:"Choose a video to embed in this block",allowUpload:!0}),u&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"relative w-full max-w-6xl",children:[a.jsx("button",{onClick:()=>f(!1),className:"absolute -top-12 right-0 text-white hover:text-gray-300 text-xl font-bold z-10",children:"×"}),a.jsx("div",{className:"aspect-video bg-black rounded-lg overflow-hidden",children:m?a.jsx("video",{src:m,controls:j,autoPlay:N,className:"w-full h-full",poster:b,children:"Your browser does not support the video tag."}):a.jsx("div",{className:"w-full h-full flex items-center justify-center text-white",children:a.jsxs("div",{className:"text-center",children:[a.jsx(Fw,{className:"w-16 h-16 mx-auto mb-4"}),a.jsx("p",{children:"Video not available"})]})})}),y&&a.jsxs("div",{className:"mt-4 text-white text-center",children:[a.jsx("h3",{className:"text-xl font-semibold",children:y}),v&&a.jsx("p",{className:"text-gray-300 mt-2",children:v})]})]})})]})}function bOe({block:t,isSelected:e=!1,isEditing:r=!1,onSelect:n,onEdit:i,className:s}){const o=t.content,{agent_id:l,agent_name:c="AI Assistant",initial_message:u="Hello! How can I help you?",context:f,allowed_interactions:d=["chat"]}=o||{},[p,m]=O.useState([{id:"1",role:"assistant",content:u}]),[x,y]=O.useState(""),[v,b]=O.useState(!1),w=async()=>{if(!x.trim())return;const N={id:Date.now().toString(),role:"user",content:x};m(j=>[...j,N]),y(""),b(!0);try{await new Promise(k=>setTimeout(k,1e3));const j={id:(Date.now()+1).toString(),role:"assistant",content:`Thank you for your message: "${N.content}". I'm a simulated response from ${c}.`};m(k=>[...k,j])}catch(j){console.error("Failed to send message:",j)}finally{b(!1)}};return r&&!l?a.jsxs("div",{className:ge("border-2 border-dashed border-purple-300 rounded-lg p-8 text-center bg-purple-50",s),children:[a.jsx("div",{className:"text-purple-400 mb-4",children:a.jsx(Kr,{className:"w-12 h-12 mx-auto"})}),a.jsx("h3",{className:"text-lg font-medium text-purple-900 mb-2",children:"Select an AI Agent"}),a.jsx("p",{className:"text-purple-600 text-sm mb-4",children:"Choose an AI agent from your repository to embed here."}),a.jsxs(fe,{onClick:i,variant:"outline",size:"sm",className:"border-purple-300 text-purple-600 hover:bg-purple-100",children:[a.jsx(Dn,{className:"w-4 h-4 mr-2"}),"Configure Agent"]})]}):a.jsxs("div",{className:ge("border border-gray-200 rounded-lg bg-white max-w-2xl",e&&"ring-2 ring-blue-500",s),onClick:n,children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-purple-50 to-blue-50",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:a.jsx(Kr,{className:"w-4 h-4 text-purple-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:c}),a.jsx("p",{className:"text-xs text-gray-500",children:"AI Assistant"})]})]}),r&&a.jsx(fe,{onClick:i,variant:"ghost",size:"sm",children:a.jsx(Dn,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"p-4 h-64 overflow-y-auto space-y-3",children:[p.map(N=>a.jsx("div",{className:ge("flex",N.role==="user"?"justify-end":"justify-start"),children:a.jsx("div",{className:ge("max-w-xs lg:max-w-md px-3 py-2 rounded-lg text-sm",N.role==="user"?"bg-blue-500 text-white":"bg-gray-100 text-gray-900"),children:N.content})},N.id)),v&&a.jsx("div",{className:"flex justify-start",children:a.jsx("div",{className:"bg-gray-100 px-3 py-2 rounded-lg",children:a.jsxs("div",{className:"flex space-x-1",children:[a.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),a.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),a.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})})]}),a.jsx("div",{className:"p-4 border-t border-gray-200",children:a.jsxs("div",{className:"flex space-x-2",children:[a.jsx(ct,{value:x,onChange:N=>y(N.target.value),onKeyPress:N=>N.key==="Enter"&&w(),placeholder:"Type your message...",disabled:v||!l,className:"flex-1"}),a.jsx(fe,{onClick:w,disabled:v||!x.trim()||!l,size:"sm",children:a.jsx($B,{className:"w-4 h-4"})})]})})]})}const wOe=Mi(bOe);function jOe({block:t,isEditing:e=!1,isSelected:r=!1,onContentChange:n,onSelect:i,onEdit:s,className:o}){const[l,c]=O.useState(!1),[u,f]=O.useState(!1),[d,p]=O.useState(1),[m,x]=O.useState(1),[y,v]=O.useState(100),[b,w]=O.useState(0),[N,j]=O.useState(null),k=t.content,{document_id:_,title:E,excerpt:A,display_mode:T="embedded"}=k||{},M=V=>{var U;const D={document_id:V.id,title:V.title,excerpt:V.description||V.excerpt,display_mode:"embedded"};n==null||n(D),c(!1),j(V),(U=V.metadata)!=null&&U.total_pages&&x(V.metadata.total_pages)},P=()=>{d<m&&p(d+1)},R=()=>{d>1&&p(d-1)},L=()=>{y<200&&v(y+25)},$=()=>{y>50&&v(y-25)},F=()=>{w((b+90)%360)},z=()=>!_||!N?a.jsx("div",{className:"aspect-[3/4] bg-gray-100 rounded-lg flex items-center justify-center border border-gray-200",children:a.jsxs("div",{className:"text-center text-gray-500",children:[a.jsx(Ot,{className:"w-8 h-8 mx-auto mb-2"}),a.jsx("p",{className:"text-sm",children:"PDF preview unavailable"})]})}):a.jsxs("div",{className:"relative group",children:[a.jsxs("div",{className:"aspect-[3/4] bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm",children:[a.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-50",children:N.thumbnail_url?a.jsx("img",{src:N.thumbnail_url,alt:`Page ${d} of ${E}`,className:"max-w-full max-h-full object-contain",style:{transform:`rotate(${b}deg) scale(${y/100})`,transition:"transform 0.3s ease"}}):a.jsxs("div",{className:"text-center text-gray-400",children:[a.jsx(Ot,{className:"w-16 h-16 mx-auto mb-4"}),a.jsxs("p",{className:"text-lg font-medium",children:["Page ",d]}),a.jsx("p",{className:"text-sm",children:E})]})}),a.jsxs("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[d>1&&a.jsx("button",{onClick:R,className:"absolute left-2 top-1/2 -translate-y-1/2 bg-black bg-opacity-75 text-white p-2 rounded-full hover:bg-opacity-90 transition-colors",title:"Previous page",children:a.jsx(r_,{className:"w-4 h-4"})}),d<m&&a.jsx("button",{onClick:P,className:"absolute right-2 top-1/2 -translate-y-1/2 bg-black bg-opacity-75 text-white p-2 rounded-full hover:bg-opacity-90 transition-colors",title:"Next page",children:a.jsx(jh,{className:"w-4 h-4"})}),a.jsxs("div",{className:"absolute top-2 right-2 flex space-x-1",children:[a.jsx("button",{onClick:$,className:"bg-black bg-opacity-75 text-white p-1.5 rounded hover:bg-opacity-90 transition-colors",title:"Zoom out",disabled:y<=50,children:a.jsx(NM,{className:"w-3 h-3"})}),a.jsx("button",{onClick:L,className:"bg-black bg-opacity-75 text-white p-1.5 rounded hover:bg-opacity-90 transition-colors",title:"Zoom in",disabled:y>=200,children:a.jsx(SM,{className:"w-3 h-3"})}),a.jsx("button",{onClick:F,className:"bg-black bg-opacity-75 text-white p-1.5 rounded hover:bg-opacity-90 transition-colors",title:"Rotate 90°",children:a.jsx(bM,{className:"w-3 h-3"})})]}),a.jsx("button",{onClick:()=>f(!0),className:"absolute bottom-2 right-2 bg-black bg-opacity-75 text-white p-2 rounded hover:bg-opacity-90 transition-colors",title:"View fullscreen",children:a.jsx(Jg,{className:"w-4 h-4"})})]})]}),a.jsxs("div",{className:"flex items-center justify-between mt-3 px-1",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",d," of ",m]}),a.jsxs("div",{className:"text-sm text-gray-500",children:[y,"% zoom"]})]}),m>1&&m<=10&&a.jsx("div",{className:"flex justify-center mt-2 space-x-1",children:Array.from({length:m},(V,D)=>a.jsx("button",{onClick:()=>p(D+1),className:ge("w-2 h-2 rounded-full transition-colors",d===D+1?"bg-blue-600":"bg-gray-300 hover:bg-gray-400"),title:`Go to page ${D+1}`},D))})]}),W=()=>{n==null||n({document_id:"",title:"",display_mode:"embedded"})},K=V=>{n==null||n({...k,display_mode:V})},q=()=>!_||!E?a.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[a.jsx("div",{className:"text-gray-400 mb-4",children:a.jsx(Ot,{className:"w-12 h-12 mx-auto"})}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Add Document"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"Select a document from your content library to embed in this block."}),e&&a.jsxs(fe,{onClick:()=>c(!0),className:"flex items-center space-x-2",children:[a.jsx(Zn,{className:"w-4 h-4"}),a.jsx("span",{children:"Select Document"})]})]}):a.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden group hover:shadow-md transition-shadow",children:[a.jsx("div",{className:"p-6",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[a.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:a.jsx(Ot,{className:"w-6 h-6 text-blue-600"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2 line-clamp-2",children:E}),A&&a.jsx("p",{className:"text-gray-600 text-sm line-clamp-3 mb-3",children:A}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs(At,{variant:"outline",className:ge("text-xs",T==="embedded"&&"border-green-300 text-green-700",T==="modal"&&"border-blue-300 text-blue-700",T==="new_tab"&&"border-purple-300 text-purple-700"),children:[T==="embedded"&&"Embedded",T==="modal"&&"Modal View",T==="new_tab"&&"New Tab"]}),a.jsx("span",{className:"text-xs text-gray-500",children:"Document"})]})]})]}),e&&a.jsxs("div",{className:"flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[a.jsxs(fe,{onClick:()=>c(!0),size:"sm",variant:"outline",className:"flex items-center space-x-1",children:[a.jsx(Dn,{className:"w-4 h-4"}),a.jsx("span",{children:"Change"})]}),a.jsx(fe,{onClick:W,size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700 border-red-300",children:"×"})]})]})}),a.jsx("div",{className:"border-t border-gray-100 px-6 py-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsxs(fe,{onClick:()=>{T==="modal"?f(!0):T==="new_tab"&&window.open(`/content/documents/${_}`,"_blank")},size:"sm",className:"flex items-center space-x-2",children:[T==="embedded"&&a.jsxs(a.Fragment,{children:[a.jsx(ii,{className:"w-4 h-4"}),a.jsx("span",{children:"View Document"})]}),T==="modal"&&a.jsxs(a.Fragment,{children:[a.jsx(Jg,{className:"w-4 h-4"}),a.jsx("span",{children:"Open Modal"})]}),T==="new_tab"&&a.jsxs(a.Fragment,{children:[a.jsx(Os,{className:"w-4 h-4"}),a.jsx("span",{children:"Open in New Tab"})]})]}),a.jsxs(fe,{onClick:()=>{console.log("Download document:",_)},size:"sm",variant:"outline",className:"flex items-center space-x-2",children:[a.jsx(yy,{className:"w-4 h-4"}),a.jsx("span",{children:"Download"})]})]}),e&&a.jsx("div",{className:"flex items-center space-x-1 bg-gray-100 rounded-lg p-1",children:[{mode:"embedded",icon:ii,label:"Embedded"},{mode:"modal",icon:Jg,label:"Modal"},{mode:"new_tab",icon:Os,label:"New Tab"}].map(({mode:V,icon:D,label:U})=>a.jsxs("button",{onClick:()=>K(V),className:ge("px-2 py-1 text-xs rounded-md transition-colors flex items-center space-x-1",T===V?"bg-white shadow-sm text-blue-600":"text-gray-600 hover:text-gray-900"),title:U,children:[a.jsx(D,{className:"w-3 h-3"}),a.jsx("span",{className:"hidden sm:inline",children:U})]},V))})]})}),T==="embedded"&&a.jsx("div",{className:"border-t border-gray-100 p-4",children:z()})]});return a.jsxs("div",{className:ge("relative",r&&e&&"ring-2 ring-blue-500 ring-offset-2 rounded-lg p-2",o),onClick:i,children:[q(),a.jsx(eW,{isOpen:l,onClose:()=>c(!1),onSelect:M,contentType:"document",title:"Select Document",description:"Choose a document to embed in this block",allowUpload:!0}),u&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"relative w-full max-w-6xl max-h-full bg-white rounded-lg overflow-hidden",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:E}),A&&a.jsx("p",{className:"text-gray-600 text-sm mt-1",children:A})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs(fe,{onClick:()=>{console.log("Download document:",_)},size:"sm",variant:"outline",className:"flex items-center space-x-2",children:[a.jsx(yy,{className:"w-4 h-4"}),a.jsx("span",{children:"Download"})]}),a.jsx("button",{onClick:()=>f(!1),className:"text-gray-400 hover:text-gray-600 p-2",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-6",style:{maxHeight:"calc(90vh - 120px)"},children:a.jsxs("div",{className:"max-w-4xl mx-auto",children:[z(),m>1&&a.jsxs("div",{className:"flex items-center justify-center space-x-4 mt-6",children:[a.jsxs(fe,{onClick:R,disabled:d===1,variant:"outline",size:"sm",className:"flex items-center space-x-2",children:[a.jsx(r_,{className:"w-4 h-4"}),a.jsx("span",{children:"Previous"})]}),a.jsx("div",{className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 rounded-lg",children:a.jsxs("span",{className:"text-sm font-medium",children:["Page ",d," of ",m]})}),a.jsxs(fe,{onClick:P,disabled:d===m,variant:"outline",size:"sm",className:"flex items-center space-x-2",children:[a.jsx("span",{children:"Next"}),a.jsx(jh,{className:"w-4 h-4"})]})]}),a.jsxs("div",{className:"flex justify-center items-center space-x-3 mt-4",children:[a.jsxs("div",{className:"flex items-center space-x-1 bg-gray-100 rounded-lg p-1",children:[a.jsx("button",{onClick:$,disabled:y<=50,className:"p-2 text-gray-600 hover:text-gray-800 disabled:opacity-50 disabled:cursor-not-allowed",title:"Zoom out",children:a.jsx(NM,{className:"w-4 h-4"})}),a.jsxs("span",{className:"px-2 text-sm font-medium",children:[y,"%"]}),a.jsx("button",{onClick:L,disabled:y>=200,className:"p-2 text-gray-600 hover:text-gray-800 disabled:opacity-50 disabled:cursor-not-allowed",title:"Zoom in",children:a.jsx(SM,{className:"w-4 h-4"})})]}),a.jsx("button",{onClick:F,className:"p-2 bg-gray-100 text-gray-600 hover:text-gray-800 rounded-lg",title:"Rotate 90°",children:a.jsx(bM,{className:"w-4 h-4"})})]})]})})]})})]})}function SOe({block:t,isSelected:e=!1,isEditing:r=!1,onSelect:n,onEdit:i,onBlockChange:s,className:o}){const l=t.content,{prompt_id:c,title:u="Prompt",preview_text:f,show_copy_button:d=!0,allow_customization:p=!1}=l||{},[m,x]=O.useState(!1),[y,v]=O.useState(!1),[b,w]=O.useState(!1),N=E=>{var T;const A={prompt_id:E.id,title:E.title,preview_text:E.description||((T=E.content)==null?void 0:T.substring(0,200))+"...",show_copy_button:!0,allow_customization:!1};s&&s(t.id,{content:A}),w(!1)},j=()=>{s&&s(t.id,{content:{prompt_id:"",title:"Prompt",show_copy_button:!0}})},k=async()=>{if(f)try{await navigator.clipboard.writeText(f),x(!0),setTimeout(()=>x(!1),2e3)}catch(E){console.error("Failed to copy prompt:",E)}},_=async()=>{if(c){v(!0);try{window.open(`/prompts/${c}`,"_blank")}catch(E){console.error("Failed to view prompt:",E)}finally{v(!1)}}};return r&&!c?a.jsxs("div",{className:ge("border-2 border-dashed border-indigo-300 rounded-lg p-8 text-center bg-indigo-50",o),children:[a.jsx("div",{className:"text-indigo-400 mb-4",children:a.jsx(Gr,{className:"w-12 h-12 mx-auto"})}),a.jsx("h3",{className:"text-lg font-medium text-indigo-900 mb-2",children:"Select a Prompt"}),a.jsx("p",{className:"text-indigo-600 text-sm mb-4",children:"Choose a prompt template from your repository to embed here."}),a.jsxs(fe,{onClick:()=>w(!0),variant:"outline",size:"sm",className:"border-indigo-300 text-indigo-600 hover:bg-indigo-100",children:[a.jsx(Dn,{className:"w-4 h-4 mr-2"}),"Select Prompt"]})]}):a.jsxs("div",{className:ge("border border-gray-200 rounded-lg p-6 bg-white hover:shadow-md transition-shadow",e&&"ring-2 ring-blue-500",o),onClick:n,children:[a.jsxs("div",{className:"flex items-start justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[a.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center flex-shrink-0",children:a.jsx(Gr,{className:"w-5 h-5 text-indigo-600"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:u}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Prompt Template"})]})]}),r&&a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs(fe,{onClick:()=>w(!0),variant:"ghost",size:"sm",className:"flex items-center space-x-1",title:"Change prompt",children:[a.jsx(C0,{className:"w-4 h-4"}),a.jsx("span",{children:"Change"})]}),a.jsx(fe,{onClick:j,variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700",title:"Remove prompt",children:"×"})]})]}),f&&a.jsx("div",{className:"mb-4",children:a.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border text-sm text-gray-700 max-h-32 overflow-y-auto",children:f})}),c&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs(fe,{onClick:_,disabled:y,className:"flex items-center space-x-2",children:[y?a.jsx("div",{className:"w-4 h-4 animate-spin border-2 border-white border-t-transparent rounded-full"}):a.jsx(Os,{className:"w-4 h-4"}),a.jsx("span",{children:"View Full Prompt"})]}),d&&f&&a.jsxs(fe,{onClick:k,variant:"outline",size:"sm",className:"flex items-center space-x-1",children:[m?a.jsx(ln,{className:"w-3 h-3 text-green-600"}):a.jsx(gy,{className:"w-3 h-3"}),a.jsx("span",{children:m?"Copied!":"Copy"})]})]}),!c&&!r&&a.jsx("p",{className:"text-sm text-gray-500 italic",children:"No prompt selected"}),a.jsx(GC,{isOpen:b,onClose:()=>w(!1),onSelect:N,contentType:"prompt",title:"Select Prompt",description:"Choose a prompt template to embed in this block"})]})}const NOe=Mi(SOe);function kOe({block:t,isSelected:e=!1,isEditing:r=!1,onSelect:n,onEdit:i,onBlockChange:s,userContext:o,className:l}){const c=t.content,{automation_id:u,automation_name:f="Automation",automation_url:d,required_tools:p=[],description:m,display_mode:x="embedded"}=c||{},[y,v]=O.useState(!1),[b,w]=O.useState(!1),N=_=>{var A,T;const E={automation_id:_.id,automation_name:_.title,description:_.description,automation_url:((A=_.metadata)==null?void 0:A.automation_url)||_.file_url,required_tools:((T=_.metadata)==null?void 0:T.required_tools)||[],display_mode:"embedded"};s&&s(t.id,{content:E}),w(!1)},j=()=>{s&&s(t.id,{content:{automation_id:"",automation_name:"Automation",display_mode:"embedded"}})},k=async()=>{if(d){v(!0);try{window.open(d,"_blank")}catch(_){console.error("Failed to run automation:",_)}finally{v(!1)}}};return r&&!u?a.jsxs("div",{className:ge("border-2 border-dashed border-blue-300 rounded-lg p-8 text-center bg-blue-50",l),children:[a.jsx("div",{className:"text-blue-400 mb-4",children:a.jsx(Ei,{className:"w-12 h-12 mx-auto"})}),a.jsx("h3",{className:"text-lg font-medium text-blue-900 mb-2",children:"Select an Automation"}),a.jsx("p",{className:"text-blue-600 text-sm mb-4",children:"Choose an automation from your repository to embed here."}),a.jsxs(fe,{onClick:()=>w(!0),variant:"outline",size:"sm",className:"border-blue-300 text-blue-600 hover:bg-blue-100",children:[a.jsx(Dn,{className:"w-4 h-4 mr-2"}),"Select Automation"]})]}):a.jsxs("div",{className:ge("border border-gray-200 rounded-lg p-6 bg-white hover:shadow-md transition-shadow",e&&"ring-2 ring-blue-500",l),onClick:n,children:[a.jsxs("div",{className:"flex items-start justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center",children:a.jsx(Ei,{className:"w-5 h-5 text-yellow-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:f}),m&&a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:m})]})]}),r&&a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs(fe,{onClick:()=>w(!0),variant:"ghost",size:"sm",className:"flex items-center space-x-1",title:"Change automation",children:[a.jsx(C0,{className:"w-4 h-4"}),a.jsx("span",{children:"Change"})]}),a.jsx(fe,{onClick:j,variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700",title:"Remove automation",children:"×"})]})]}),p&&p.length>0&&a.jsxs("div",{className:"mb-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Required Tools:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:p.map((_,E)=>a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded-full",children:_},E))})]}),d&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs(fe,{onClick:k,disabled:y,className:"flex items-center space-x-2",children:[y?a.jsx("div",{className:"w-4 h-4 animate-spin border-2 border-white border-t-transparent rounded-full"}):a.jsx(si,{className:"w-4 h-4"}),a.jsx("span",{children:"Run Automation"})]}),a.jsxs(fe,{onClick:()=>window.open(d,"_blank"),variant:"outline",size:"sm",className:"flex items-center space-x-1",children:[a.jsx(Os,{className:"w-3 h-3"}),a.jsx("span",{children:"Open"})]})]}),!d&&!r&&a.jsx("p",{className:"text-sm text-gray-500 italic",children:"No automation URL configured"}),a.jsx(GC,{isOpen:b,onClose:()=>w(!1),onSelect:N,contentType:"automation",title:"Select Automation",description:"Choose an automation workflow to embed in this block"})]})}const _Oe=Mi(kOe);function OOe({item:t,index:e,isEditing:r,onUpdate:n,onDelete:i}){const[s,o]=O.useState(!1),[l,c]=O.useState(t),[u,f]=O.useState(t.is_open_by_default||!1),{attributes:d,listeners:p,setNodeRef:m,transform:x,transition:y,isDragging:v}=KC({id:t.id}),b={transform:Rs.Transform.toString(x),transition:y},w=()=>{n(t.id,l),o(!1)},N=()=>{c(t),o(!1)};return a.jsx("div",{ref:m,style:b,className:ge("border rounded-lg overflow-hidden transition-colors group",v&&"opacity-50",s?"border-blue-300 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:s?a.jsx("div",{className:"p-4 space-y-4",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[r&&a.jsx("button",{...d,...p,className:"mt-2 p-1 text-gray-400 hover:text-gray-600 cursor-grab active:cursor-grabbing",title:"Drag to reorder",children:a.jsx(s_,{className:"w-4 h-4"})}),a.jsxs("div",{className:"flex-1 space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Section Title"}),a.jsx(ct,{value:l.title,onChange:j=>c({...l,title:j.target.value}),placeholder:"Enter section title...",className:"font-medium"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Content"}),a.jsx(Ai,{value:l.content,onChange:j=>c({...l,content:j.target.value}),placeholder:"Enter section content...",className:"min-h-[120px] resize-none"})]}),a.jsx("div",{className:"flex items-center space-x-4",children:a.jsxs("label",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"checkbox",checked:l.is_open_by_default||!1,onChange:j=>c({...l,is_open_by_default:j.target.checked}),className:"form-checkbox text-blue-600"}),a.jsx("span",{className:"text-sm text-gray-700",children:"Open by default"})]})}),a.jsxs("div",{className:"flex items-center justify-end space-x-2 pt-2 border-t border-gray-200",children:[a.jsxs(fe,{onClick:N,size:"sm",variant:"outline",children:[a.jsx($r,{className:"w-4 h-4 mr-1"}),"Cancel"]}),a.jsxs(fe,{onClick:w,size:"sm",children:[a.jsx(ko,{className:"w-4 h-4 mr-1"}),"Save"]})]})]})]})}):a.jsxs("div",{children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("button",{onClick:()=>f(!u),className:"w-full px-4 py-3 text-left bg-gray-50 hover:bg-gray-100 transition-colors flex items-center justify-between focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset","aria-expanded":u,children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[r&&a.jsx("button",{...d,...p,className:"opacity-0 group-hover:opacity-100 p-1 text-gray-400 hover:text-gray-600 cursor-grab active:cursor-grabbing",title:"Drag to reorder",onClick:j=>j.stopPropagation(),children:a.jsx(s_,{className:"w-4 h-4"})}),a.jsx("span",{className:"font-medium text-gray-900",children:t.title})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[r&&a.jsxs("div",{className:"flex items-center space-x-1 opacity-0 group-hover:opacity-100",onClick:j=>j.stopPropagation(),children:[a.jsx(fe,{onClick:()=>o(!0),size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:a.jsx(yo,{className:"w-3 h-3"})}),a.jsx(fe,{onClick:()=>i(t.id),size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:a.jsx(ns,{className:"w-3 h-3"})})]}),u?a.jsx(CO,{className:"w-5 h-5 text-gray-500"}):a.jsx(mo,{className:"w-5 h-5 text-gray-500"})]})]})}),a.jsx("div",{className:ge("transition-all duration-200 ease-in-out overflow-hidden",u?"max-h-screen":"max-h-0"),children:a.jsxs("div",{className:"p-4 bg-white border-t border-gray-100",children:[t.html?a.jsx("div",{className:"prose prose-gray max-w-none text-sm",dangerouslySetInnerHTML:{__html:t.html}}):a.jsx("p",{className:"text-gray-700 leading-relaxed text-sm whitespace-pre-wrap",children:t.content}),r&&!t.content&&!t.html&&a.jsx("p",{className:"text-gray-400 italic text-sm",children:"No content added yet"})]})})]})})}function EOe({block:t,isEditing:e=!1,isSelected:r=!1,onContentChange:n}){const i=t.content,{items:s=[],allow_multiple_open:o=!0}=i||{},[l,c]=O.useState(new Set(s.filter(j=>j.is_open_by_default).map(j=>j.id))),[u,f]=O.useState(null),[d,p]=O.useState(!1),m=Fx(Bx(Ad,{activationConstraint:{distance:8}})),x=j=>{n&&n({...i,...j})},y=()=>{const k={id:`accordion_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:"New Section",content:"Enter content for this section...",is_open_by_default:!1};x({items:[...s,k]})},v=(j,k)=>{const _=s.map(E=>E.id===j?{...E,...k}:E);x({items:_})},b=j=>{const k=s.filter(_=>_.id!==j);x({items:k})},w=j=>{const{active:k,over:_}=j;if(_&&k.id!==_.id){const E=s.findIndex(T=>T.id===k.id),A=s.findIndex(T=>T.id===_.id);if(E!==-1&&A!==-1){const T=Td(s,E,A);x({items:T})}}f(null)},N=j=>{c(k=>{const _=new Set(k);return _.has(j)?_.delete(j):(o||_.clear(),_.add(j)),_})};return e&&r?a.jsxs("div",{className:ge("border border-gray-300 rounded-lg overflow-hidden","ring-2 ring-blue-500 ring-offset-2"),children:[a.jsxs("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Accordion Block"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create collapsible sections with expandable content"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs(fe,{onClick:()=>p(!d),size:"sm",variant:"outline",className:"flex items-center space-x-2",children:[a.jsx(Dn,{className:"w-4 h-4"}),a.jsx("span",{children:"Settings"})]}),a.jsxs(fe,{onClick:y,size:"sm",className:"flex items-center space-x-2",children:[a.jsx(Vt,{className:"w-4 h-4"}),a.jsx("span",{children:"Add Section"})]})]})]}),a.jsxs("div",{className:"text-sm text-gray-600",children:[s.length," section",s.length!==1?"s":""]}),d&&a.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 mt-4",children:a.jsxs("label",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"checkbox",checked:o,onChange:j=>x({allow_multiple_open:j.target.checked}),className:"form-checkbox text-blue-600"}),a.jsx("span",{className:"text-sm text-gray-700",children:"Allow multiple sections to be open at once"})]})})]}),a.jsx("div",{className:"p-6",children:s.length===0?a.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg",children:[a.jsx(Sh,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Sections Yet"}),a.jsx("p",{className:"text-gray-500 mb-4",children:"Add your first accordion section to get started"}),a.jsxs(fe,{onClick:y,className:"flex items-center space-x-2",children:[a.jsx(Vt,{className:"w-4 h-4"}),a.jsx("span",{children:"Add First Section"})]})]}):a.jsxs(Ux,{sensors:m,onDragStart:j=>f(j.active.id),onDragEnd:w,children:[a.jsx("div",{className:"space-y-3",children:a.jsx(Wx,{items:s.map(j=>j.id),strategy:Hx,children:s.map((j,k)=>a.jsx(OOe,{item:j,index:k,isEditing:!0,onUpdate:v,onDelete:b},j.id))})}),a.jsx(VC,{children:u?a.jsxs("div",{className:"bg-white border border-gray-300 rounded-lg p-4 shadow-lg",children:["Section ",s.findIndex(j=>j.id===u)+1]}):null})]})})]}):s.length===0?a.jsx("div",{className:"text-gray-400 italic py-4 text-center",children:"No accordion items configured"}):a.jsx("div",{className:"space-y-2",children:s.map((j,k)=>{const _=l.has(j.id);return a.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[a.jsxs("button",{onClick:()=>N(j.id),className:"w-full px-4 py-3 text-left bg-gray-50 hover:bg-gray-100 transition-colors flex items-center justify-between focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset","aria-expanded":_,children:[a.jsx("span",{className:"font-medium text-gray-900",children:j.title}),_?a.jsx(CO,{className:"w-5 h-5 text-gray-500"}):a.jsx(mo,{className:"w-5 h-5 text-gray-500"})]}),a.jsx("div",{className:ge("transition-all duration-200 ease-in-out overflow-hidden",_?"max-h-screen":"max-h-0"),children:a.jsx("div",{className:"p-4 bg-white border-t border-gray-100",children:j.html?a.jsx("div",{className:"prose prose-gray max-w-none",dangerouslySetInnerHTML:{__html:j.html}}):a.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-wrap",children:j.content})})})]},j.id)})})}const COe=Mi(EOe);function AOe({question:t,index:e,isEditing:r,onUpdate:n,onDelete:i}){var k;const[s,o]=O.useState(!1),[l,c]=O.useState(t),{attributes:u,listeners:f,setNodeRef:d,transform:p,transition:m,isDragging:x}=KC({id:t.id}),y={transform:Rs.Transform.toString(p),transition:m},v=()=>{n(t.id,l),o(!1)},b=()=>{c(t),o(!1)},w=()=>{const _=[...l.options||[],"New Option"];c({...l,options:_})},N=(_,E)=>{const A=[...l.options];A[_]=E,c({...l,options:A})},j=_=>{const E=l.options.filter((A,T)=>T!==_);c({...l,options:E})};return a.jsx("div",{ref:d,style:y,className:ge("border rounded-lg p-4 transition-colors group",x&&"opacity-50",s?"border-blue-300 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:a.jsxs("div",{className:"flex items-start space-x-3",children:[r&&a.jsx("button",{...u,...f,className:"opacity-0 group-hover:opacity-100 mt-1 p-1 text-gray-400 hover:text-gray-600 cursor-grab active:cursor-grabbing",title:"Drag to reorder",children:a.jsx(s_,{className:"w-4 h-4"})}),a.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-800 text-sm font-medium rounded-full flex items-center justify-center mt-1",children:e+1}),a.jsx("div",{className:"flex-1",children:s?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Question"}),a.jsx(Ai,{value:l.question,onChange:_=>c({...l,question:_.target.value}),placeholder:"Enter your question...",className:"min-h-[80px]"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Question Type"}),a.jsxs(ec,{value:l.type,onValueChange:_=>c({...l,type:_}),children:[a.jsx(Da,{children:a.jsx(tc,{})}),a.jsxs(La,{children:[a.jsx(kt,{value:"multiple_choice",children:"Multiple Choice"}),a.jsx(kt,{value:"true_false",children:"True/False"}),a.jsx(kt,{value:"short_answer",children:"Short Answer"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Points"}),a.jsx(ct,{type:"number",value:l.points,onChange:_=>c({...l,points:parseInt(_.target.value)||1}),min:"1",className:"w-full"})]})]}),l.type==="multiple_choice"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Answer Options"}),a.jsxs("div",{className:"space-y-2",children:[(k=l.options)==null?void 0:k.map((_,E)=>a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(ct,{value:_,onChange:A=>N(E,A.target.value),placeholder:`Option ${E+1}`,className:"flex-1"}),a.jsx(fe,{onClick:()=>c({...l,correct_answer:_}),size:"sm",variant:l.correct_answer===_?"default":"outline",className:"shrink-0",children:l.correct_answer===_?"Correct":"Set Correct"}),a.jsx(fe,{onClick:()=>j(E),size:"sm",variant:"ghost",className:"shrink-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:a.jsx(ns,{className:"w-4 h-4"})})]},E)),a.jsxs(fe,{onClick:w,size:"sm",variant:"outline",className:"flex items-center space-x-2",children:[a.jsx(Vt,{className:"w-4 h-4"}),a.jsx("span",{children:"Add Option"})]})]})]}),l.type!=="multiple_choice"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Correct Answer"}),l.type==="true_false"?a.jsxs(ec,{value:l.correct_answer,onValueChange:_=>c({...l,correct_answer:_}),children:[a.jsx(Da,{className:"w-32",children:a.jsx(tc,{})}),a.jsxs(La,{children:[a.jsx(kt,{value:"True",children:"True"}),a.jsx(kt,{value:"False",children:"False"})]})]}):a.jsx(ct,{value:l.correct_answer,onChange:_=>c({...l,correct_answer:_.target.value}),placeholder:"Enter the correct answer..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Explanation (Optional)"}),a.jsx(Ai,{value:l.explanation||"",onChange:_=>c({...l,explanation:_.target.value}),placeholder:"Explain why this answer is correct...",className:"min-h-[60px]"})]}),a.jsxs("div",{className:"flex items-center justify-end space-x-2 pt-2 border-t border-gray-200",children:[a.jsxs(fe,{onClick:b,size:"sm",variant:"outline",children:[a.jsx($r,{className:"w-4 h-4 mr-1"}),"Cancel"]}),a.jsxs(fe,{onClick:v,size:"sm",children:[a.jsx(ko,{className:"w-4 h-4 mr-1"}),"Save"]})]})]}):a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("p",{className:"font-medium text-gray-900 flex-1",children:[t.question,a.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",t.points," pt",t.points!==1?"s":"",")"]})]}),r&&a.jsxs("div",{className:"flex items-center space-x-1 opacity-0 group-hover:opacity-100",children:[a.jsx(fe,{onClick:()=>o(!0),size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:a.jsx(yo,{className:"w-3 h-3"})}),a.jsx(fe,{onClick:()=>i(t.id),size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:a.jsx(ns,{className:"w-3 h-3"})})]})]}),a.jsxs("div",{className:"text-sm text-gray-600",children:[a.jsx("strong",{children:"Type:"})," ",t.type==="multiple_choice"?"Multiple Choice":t.type==="true_false"?"True/False":"Short Answer",t.type==="multiple_choice"&&t.options&&a.jsxs("span",{className:"ml-2",children:["(",t.options.length," options)"]})]}),t.correct_answer&&a.jsxs("div",{className:"text-sm text-green-600",children:[a.jsx("strong",{children:"Answer:"})," ",String(t.correct_answer)]})]})})]})})}function TOe({block:t,isEditing:e=!1,isSelected:r=!1,onContentChange:n,onComplete:i}){const s=t.content,{title:o="Quiz",description:l="",questions:c=[],time_limit:u,passing_score:f=70,allow_retries:d=!0,show_results_immediately:p=!0}=s||{},[m,x]=O.useState({}),[y,v]=O.useState(!1),[b,w]=O.useState(null),[N,j]=O.useState(u?u*60:null),[k,_]=O.useState(!1),[E,A]=O.useState(o),[T,M]=O.useState(l),[P,R]=O.useState(!1),[L,$]=O.useState(null),F=Fx(Bx(Ad,{activationConstraint:{distance:8}})),z=J=>{n&&n({...s,...J})},W=()=>{const ne={id:`q_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,question:"New Question",type:"multiple_choice",options:["Option 1","Option 2"],correct_answer:"Option 1",points:1};z({questions:[...c,ne]})},K=(J,ne)=>{const te=c.map(se=>se.id===J?{...se,...ne}:se);z({questions:te})},q=J=>{const ne=c.filter(te=>te.id!==J);z({questions:ne})},V=J=>{const{active:ne,over:te}=J;if(te&&ne.id!==te.id){const se=c.findIndex(ie=>ie.id===ne.id),ve=c.findIndex(ie=>ie.id===te.id);if(se!==-1&&ve!==-1){const ie=Td(c,se,ve);z({questions:ie})}}$(null)},D=()=>{z({title:E,description:T})},U=(J,ne)=>{x(te=>({...te,[J]:ne}))},G=()=>{let J=0,ne=0;return c.forEach(te=>{J+=te.points;const se=m[te.id];te.type==="multiple_choice"||te.type==="true_false"?se===te.correct_answer&&(ne+=te.points):te.type==="short_answer"&&se&&se.toLowerCase().trim()===String(te.correct_answer).toLowerCase().trim()&&(ne+=te.points)}),J>0?Math.round(ne/J*100):0},ee=()=>{const J=G();w(J),v(!0),p&&_(!0),i==null||i(J,m)},Q=()=>{x({}),v(!1),w(null),_(!1),j(u?u*60:null)},H=J=>m[J]!==void 0&&m[J]!=="",Y=c.every(J=>H(J.id)),re=b!==null&&b>=f;return O.useEffect(()=>{if(N!==null&&N>0&&!y){const J=setTimeout(()=>{j(ne=>ne-1)},1e3);return()=>clearTimeout(J)}else N===0&&!y&&ee()},[N,y]),O.useEffect(()=>{if(e){const J=setTimeout(()=>{(E!==o||T!==l)&&D()},1e3);return()=>clearTimeout(J)}},[E,T,e]),e&&r?a.jsxs("div",{className:ge("border border-gray-300 rounded-lg overflow-hidden","ring-2 ring-blue-500 ring-offset-2"),children:[a.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quiz Title"}),a.jsx(ct,{value:E,onChange:J=>A(J.target.value),placeholder:"Enter quiz title...",className:"font-semibold"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description (Optional)"}),a.jsx(Ai,{value:T,onChange:J=>M(J.target.value),placeholder:"Enter quiz description...",className:"min-h-[60px] resize-none"})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:[c.length," question",c.length!==1?"s":""]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs(fe,{onClick:()=>R(!P),size:"sm",variant:"outline",className:"flex items-center space-x-2",children:[a.jsx(Dn,{className:"w-4 h-4"}),a.jsx("span",{children:"Settings"})]}),a.jsxs(fe,{onClick:W,size:"sm",className:"flex items-center space-x-2",children:[a.jsx(Vt,{className:"w-4 h-4"}),a.jsx("span",{children:"Add Question"})]})]})]}),P&&a.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Time Limit (minutes)"}),a.jsx(ct,{type:"number",value:u||"",onChange:J=>z({time_limit:J.target.value?parseInt(J.target.value):void 0}),placeholder:"No limit",min:"1"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Passing Score (%)"}),a.jsx(ct,{type:"number",value:f,onChange:J=>z({passing_score:parseInt(J.target.value)||70}),min:"0",max:"100"})]})]}),a.jsxs("div",{className:"flex items-center space-x-6",children:[a.jsxs("label",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"checkbox",checked:d,onChange:J=>z({allow_retries:J.target.checked}),className:"form-checkbox text-blue-600"}),a.jsx("span",{className:"text-sm text-gray-700",children:"Allow retries"})]}),a.jsxs("label",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"checkbox",checked:p,onChange:J=>z({show_results_immediately:J.target.checked}),className:"form-checkbox text-blue-600"}),a.jsx("span",{className:"text-sm text-gray-700",children:"Show results immediately"})]})]})]})]})}),a.jsx("div",{className:"p-6",children:c.length===0?a.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg",children:[a.jsx(AO,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Questions Yet"}),a.jsx("p",{className:"text-gray-500 mb-4",children:"Add your first question to get started"}),a.jsxs(fe,{onClick:W,className:"flex items-center space-x-2",children:[a.jsx(Vt,{className:"w-4 h-4"}),a.jsx("span",{children:"Add First Question"})]})]}):a.jsxs(Ux,{sensors:F,onDragStart:J=>$(J.active.id),onDragEnd:V,children:[a.jsx("div",{className:"space-y-4",children:a.jsx(Wx,{items:c.map(J=>J.id),strategy:Hx,children:c.map((J,ne)=>a.jsx(AOe,{question:J,index:ne,isEditing:!0,onUpdate:K,onDelete:q},J.id))})}),a.jsx(VC,{children:L?a.jsxs("div",{className:"bg-white border border-gray-300 rounded-lg p-4 shadow-lg",children:["Question ",c.findIndex(J=>J.id===L)+1]}):null})]})})]}):c.length===0?a.jsx("div",{className:"text-gray-400 italic py-8 text-center",children:"No quiz questions configured"}):a.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[a.jsxs("div",{className:"bg-blue-50 px-6 py-4 border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:o}),l&&a.jsx("p",{className:"text-gray-600 mt-1",children:l})]}),N!==null&&!y&&a.jsxs("div",{className:"flex items-center space-x-2 bg-white px-3 py-2 rounded-lg border",children:[a.jsx(go,{className:"w-4 h-4 text-gray-500"}),a.jsxs("span",{className:ge("font-mono text-sm",N<60?"text-red-600 font-bold":"text-gray-700"),children:[Math.floor(N/60),":",String(N%60).padStart(2,"0")]})]})]}),y&&b!==null&&a.jsxs("div",{className:ge("mt-4 p-3 rounded-lg flex items-center space-x-2",re?"bg-green-100 border border-green-200":"bg-red-100 border border-red-200"),children:[re?a.jsx(ko,{className:"w-5 h-5 text-green-600"}):a.jsx($r,{className:"w-5 h-5 text-red-600"}),a.jsxs("span",{className:ge("font-medium",re?"text-green-800":"text-red-800"),children:["Score: ",b,"% ",re?"(Passed)":`(Failed - ${f}% required)`]})]})]}),a.jsx("div",{className:"p-6 space-y-6",children:c.map((J,ne)=>{const te=m[J.id],se=y&&te===J.correct_answer,ve=y&&te!==J.correct_answer;return a.jsx("div",{className:ge("border rounded-lg p-4 transition-colors",y&&se&&"border-green-300 bg-green-50",y&&ve&&"border-red-300 bg-red-50",!y&&"border-gray-200"),children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-800 text-sm font-medium rounded-full flex items-center justify-center",children:ne+1}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("p",{className:"font-medium text-gray-900 mb-3",children:[J.question,a.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",J.points," pt",J.points!==1?"s":"",")"]})]}),J.type==="multiple_choice"&&J.options&&a.jsx("div",{className:"space-y-2",children:J.options.map((ie,ye)=>a.jsxs("label",{className:ge("flex items-center space-x-2 p-2 rounded cursor-pointer transition-colors",!y&&"hover:bg-gray-50",y&&ie===J.correct_answer&&"bg-green-100 border border-green-300",y&&ie===te&&ie!==J.correct_answer&&"bg-red-100 border border-red-300"),children:[a.jsx("input",{type:"radio",name:`question-${J.id}`,value:ie,checked:te===ie,disabled:y,onChange:Te=>U(J.id,Te.target.value),className:"form-radio text-blue-600"}),a.jsx("span",{className:ge("text-gray-700",y&&ie===J.correct_answer&&"font-medium text-green-800",y&&ie===te&&ie!==J.correct_answer&&"text-red-800"),children:ie})]},ye))}),J.type==="true_false"&&a.jsx("div",{className:"space-y-2",children:["True","False"].map(ie=>a.jsxs("label",{className:ge("flex items-center space-x-2 p-2 rounded cursor-pointer transition-colors",!y&&"hover:bg-gray-50",y&&ie===J.correct_answer&&"bg-green-100 border border-green-300",y&&ie===te&&ie!==J.correct_answer&&"bg-red-100 border border-red-300"),children:[a.jsx("input",{type:"radio",name:`question-${J.id}`,value:ie,checked:te===ie,disabled:y,onChange:ye=>U(J.id,ye.target.value),className:"form-radio text-blue-600"}),a.jsx("span",{children:ie})]},ie))}),J.type==="short_answer"&&a.jsx("input",{type:"text",value:te||"",disabled:y,onChange:ie=>U(J.id,ie.target.value),placeholder:"Enter your answer...",className:ge("w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",y&&se&&"border-green-300 bg-green-50",y&&ve&&"border-red-300 bg-red-50")}),y&&k&&J.explanation&&a.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded",children:a.jsxs("p",{className:"text-blue-800 text-sm",children:[a.jsx("strong",{children:"Explanation:"})," ",J.explanation]})})]})]})},J.id)})}),a.jsx("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:["Questions answered: ",Object.keys(m).length," of ",c.length]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[y&&!re&&d&&a.jsx("button",{onClick:Q,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Retry Quiz"}),!y&&a.jsx("button",{onClick:ee,disabled:!Y,className:"px-6 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Submit Quiz"}),y&&p&&!k&&a.jsx("button",{onClick:()=>_(!0),className:"px-4 py-2 text-sm font-medium text-blue-700 bg-blue-100 border border-blue-300 rounded-md hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Show Answers"})]})]})})]})}const POe=Mi(TOe);function MOe({block:t,isSelected:e=!1,isEditing:r=!1,onSelect:n,onEdit:i,onBlockChange:s,className:o}){const l=t.content,{title:c="Submit Your Work",description:u,submission_type:f="text",instructions:d="Please provide your submission below",max_file_size:p,allowed_file_types:m=[],required_fields:x=[],auto_grade:y=!1}=l||{},[v,b]=O.useState({}),[w,N]=O.useState(null),[j,k]=O.useState(!1),[_,E]=O.useState(!1),[A,T]=O.useState(!1),M=K=>{N(K.target.files)},P=async()=>{k(!0);try{await new Promise(K=>setTimeout(K,2e3)),console.log("Submission:",{blockId:t.id,submissionType:f,submission:v,files:w?Array.from(w):[]}),E(!0)}catch(K){console.error("Failed to submit:",K)}finally{k(!1)}},L=(()=>{switch(f){case"file":return IB;case"url":return E0;case"text":return Ot;default:return Ir}})(),$=K=>{s&&s(t.id,{content:{...l,...K}})},F=()=>{const K={name:`field_${Date.now()}`,label:"New Field",type:"text",required:!0};$({required_fields:[...x||[],K]})},z=(K,q)=>{const V=[...x||[]];V[K]={...V[K],...q},$({required_fields:V})},W=K=>{const q=[...x||[]];q.splice(K,1),$({required_fields:q})};return r?a.jsx("div",{className:ge("border-2 border-dashed border-orange-300 rounded-lg bg-orange-50",o),children:A?a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-orange-900",children:"Configure User Submission"}),a.jsx(fe,{onClick:()=>T(!1),variant:"ghost",size:"sm",className:"text-orange-600 hover:bg-orange-100",children:a.jsx($r,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title"}),a.jsx(ct,{value:c,onChange:K=>$({title:K.target.value}),placeholder:"Submit Your Work"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Submission Type"}),a.jsxs(ec,{value:f,onValueChange:K=>$({submission_type:K}),children:[a.jsx(Da,{children:a.jsx(tc,{})}),a.jsxs(La,{children:[a.jsx(kt,{value:"text",children:"Text Submission"}),a.jsx(kt,{value:"file",children:"Single File"}),a.jsx(kt,{value:"multiple",children:"Multiple Files"}),a.jsx(kt,{value:"url",children:"URL/Link"})]})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description (Optional)"}),a.jsx(ct,{value:u||"",onChange:K=>$({description:K.target.value}),placeholder:"Brief description of the submission"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Instructions"}),a.jsx(Ai,{value:d,onChange:K=>$({instructions:K.target.value}),placeholder:"Please provide your submission below",rows:3})]}),(f==="file"||f==="multiple")&&a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg space-y-4",children:[a.jsx("h4",{className:"font-medium text-blue-900",children:"File Upload Settings"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max File Size (MB)"}),a.jsx(ct,{type:"number",value:p?Math.round(p/(1024*1024)):"",onChange:K=>{const q=parseInt(K.target.value)||0;$({max_file_size:q*1024*1024})},placeholder:"10",min:"1",max:"100"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Allowed File Types (comma separated)"}),a.jsx(ct,{value:(m==null?void 0:m.join(", "))||"",onChange:K=>{const q=K.target.value.split(",").map(V=>V.trim()).filter(Boolean);$({allowed_file_types:q})},placeholder:".pdf, .docx, .txt, image/*"})]})]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Additional Fields"}),a.jsxs(fe,{onClick:F,variant:"outline",size:"sm",className:"text-blue-600 border-blue-300 hover:bg-blue-50",children:[a.jsx(Vt,{className:"w-4 h-4 mr-1"}),"Add Field"]})]}),x&&x.length>0?a.jsx("div",{className:"space-y-3",children:x.map((K,q)=>a.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Field ",q+1]}),a.jsx(fe,{onClick:()=>W(q),variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-50",children:a.jsx(ns,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Field Name"}),a.jsx(ct,{value:K.name,onChange:V=>z(q,{name:V.target.value}),placeholder:"field_name"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Label"}),a.jsx(ct,{value:K.label,onChange:V=>z(q,{label:V.target.value}),placeholder:"Field Label"})]}),a.jsxs("div",{className:"flex items-end gap-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Type"}),a.jsxs(ec,{value:K.type,onValueChange:V=>z(q,{type:V}),children:[a.jsx(Da,{className:"h-9",children:a.jsx(tc,{})}),a.jsxs(La,{children:[a.jsx(kt,{value:"text",children:"Text"}),a.jsx(kt,{value:"email",children:"Email"}),a.jsx(kt,{value:"number",children:"Number"}),a.jsx(kt,{value:"tel",children:"Phone"}),a.jsx(kt,{value:"date",children:"Date"}),a.jsx(kt,{value:"textarea",children:"Long Text"})]})]})]}),a.jsxs("div",{className:"flex items-center h-9",children:[a.jsx("input",{type:"checkbox",id:`required-${q}`,checked:K.required,onChange:V=>z(q,{required:V.target.checked}),className:"mr-2"}),a.jsx("label",{htmlFor:`required-${q}`,className:"text-xs text-gray-600",children:"Required"})]})]})]})]},q))}):a.jsx("p",{className:"text-sm text-gray-500 italic",children:'No additional fields configured. Click "Add Field" to create custom form fields.'})]}),a.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"auto-grade",checked:y||!1,onChange:K=>$({auto_grade:K.target.checked}),className:"mr-3"}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"auto-grade",className:"text-sm font-medium text-green-900",children:"Enable Auto-Grading"}),a.jsx("p",{className:"text-xs text-green-700",children:"Automatically evaluate submissions when possible"})]})]})})]}):a.jsxs("div",{className:"p-8 text-center",children:[a.jsx("div",{className:"text-orange-400 mb-4",children:a.jsx(Ir,{className:"w-12 h-12 mx-auto"})}),a.jsx("h3",{className:"text-lg font-medium text-orange-900 mb-2",children:"User Submission Block"}),a.jsx("p",{className:"text-orange-600 text-sm mb-4",children:"Configure how users can submit their work."}),a.jsxs(fe,{onClick:()=>T(!0),variant:"outline",size:"sm",className:"border-orange-300 text-orange-600 hover:bg-orange-100",children:[a.jsx(Dn,{className:"w-4 h-4 mr-2"}),"Configure Submission"]})]})}):_?a.jsxs("div",{className:ge("border border-green-200 rounded-lg p-6 bg-green-50 text-center",e&&"ring-2 ring-blue-500",o),onClick:n,children:[a.jsx("div",{className:"text-green-500 mb-4",children:a.jsx(ln,{className:"w-12 h-12 mx-auto"})}),a.jsx("h3",{className:"text-lg font-semibold text-green-900 mb-2",children:"Submission Received!"}),a.jsxs("p",{className:"text-green-700 text-sm",children:["Thank you for your submission. ",y?"Your work is being evaluated automatically.":"Your work will be reviewed soon."]})]}):a.jsxs("div",{className:ge("border border-gray-200 rounded-lg p-6 bg-white",e&&"ring-2 ring-blue-500",o),onClick:n,children:[a.jsx("div",{className:"flex items-start justify-between mb-4",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:a.jsx(L,{className:"w-5 h-5 text-orange-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:c}),u&&a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:u})]})]})}),a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:a.jsxs("p",{className:"text-sm text-blue-800",children:[a.jsx("strong",{children:"Instructions:"})," ",d]})}),a.jsxs("div",{className:"space-y-4",children:[x.map((K,q)=>a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[K.label," ",K.required&&a.jsx("span",{className:"text-red-500",children:"*"})]}),K.type==="textarea"?a.jsx("textarea",{value:v[K.name]||"",onChange:V=>b(D=>({...D,[K.name]:V.target.value})),placeholder:`Enter ${K.label.toLowerCase()}`,required:K.required,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):a.jsx(ct,{type:K.type||"text",value:v[K.name]||"",onChange:V=>b(D=>({...D,[K.name]:V.target.value})),placeholder:`Enter ${K.label.toLowerCase()}`,required:K.required})]},q)),f==="text"&&a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Your Submission ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("textarea",{value:v.content||"",onChange:K=>b(q=>({...q,content:K.target.value})),placeholder:"Enter your submission here...",rows:6,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),(f==="file"||f==="multiple")&&a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Upload File(s) ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"file",onChange:M,multiple:f==="multiple",accept:m.join(","),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),p&&a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Maximum file size: ",Math.round(p/(1024*1024)),"MB"]})]}),f==="url"&&a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["URL ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(ct,{type:"url",value:v.url||"",onChange:K=>b(q=>({...q,url:K.target.value})),placeholder:"https://example.com",required:!0})]}),a.jsxs(fe,{onClick:P,disabled:j,className:"w-full flex items-center justify-center space-x-2",children:[j?a.jsx("div",{className:"w-4 h-4 animate-spin border-2 border-white border-t-transparent rounded-full"}):a.jsx($B,{className:"w-4 h-4"}),a.jsx("span",{children:j?"Submitting...":"Submit"})]})]})]})}const ROe=Mi(MOe);function tW({block:t,isSelected:e=!1,isEditing:r=!1,onSelect:n,onEdit:i,onProgress:s,onContentChange:o,userContext:l,className:c}){const u={block:t,isSelected:e,isEditing:r,onSelect:n,onEdit:i,className:c},f=d=>{o==null||o(t.id,d)};switch(t.block_type){case"section_header":return a.jsx(v_e,{...u,onContentChange:f});case"rich_text":return a.jsx(b_e,{...u,onContentChange:f});case"image":return a.jsx(j_e,{...u,onContentChange:f});case"list":return a.jsx(uOe,{...u,onContentChange:f});case"quote":return a.jsx(fOe,{...u,onContentChange:f});case"divider":return a.jsx(pOe,{...u});case"video":return a.jsx(xOe,{...u,onContentChange:f});case"agent":return a.jsx(wOe,{...u});case"document":return a.jsx(jOe,{...u,onContentChange:f});case"prompt":return a.jsx(NOe,{...u});case"automation":return a.jsx(_Oe,{...u,userContext:l});case"quiz":return a.jsx(POe,{...u,onComplete:(d,p)=>{console.log("Quiz completed:",{blockId:t.id,score:d,answers:p})}});case"user_submission":return a.jsx(ROe,{...u});case"accordion":return a.jsx(COe,{...u});default:return a.jsxs("div",{className:"border-2 border-dashed border-red-300 rounded-lg p-8 text-center bg-red-50",children:[a.jsx("div",{className:"text-red-400 mb-2",children:a.jsx("svg",{className:"w-8 h-8 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"})})}),a.jsxs("p",{className:"text-red-600 text-sm font-medium",children:["Unknown Block Type: ",t.block_type]}),a.jsx("p",{className:"text-red-500 text-xs mt-1",children:"This block type is not supported"})]})}}var IOe="Separator",Z6="horizontal",DOe=["horizontal","vertical"],rW=O.forwardRef((t,e)=>{const{decorative:r,orientation:n=Z6,...i}=t,s=LOe(n)?n:Z6,l=r?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return a.jsx($t.div,{"data-orientation":s,...l,...i,ref:e})});rW.displayName=IOe;function LOe(t){return DOe.includes(t)}var nW=rW;const Pd=O.forwardRef(({className:t,orientation:e="horizontal",decorative:r=!0,...n},i)=>a.jsx(nW,{ref:i,decorative:r,orientation:e,className:ge("shrink-0 bg-border",e==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...n}));Pd.displayName=nW.displayName;var YC="Switch",[$Oe,CEe]=Yp(YC),[BOe,FOe]=$Oe(YC),iW=O.forwardRef((t,e)=>{const{__scopeSwitch:r,name:n,checked:i,defaultChecked:s,required:o,disabled:l,value:c="on",onCheckedChange:u,form:f,...d}=t,[p,m]=O.useState(null),x=yr(e,N=>m(N)),y=O.useRef(!1),v=p?f||!!p.closest("form"):!0,[b=!1,w]=v0({prop:i,defaultProp:s,onChange:u});return a.jsxs(BOe,{scope:r,checked:b,disabled:l,children:[a.jsx($t.button,{type:"button",role:"switch","aria-checked":b,"aria-required":o,"data-state":aW(b),"data-disabled":l?"":void 0,disabled:l,value:c,...d,ref:x,onClick:Jt(t.onClick,N=>{w(j=>!j),v&&(y.current=N.isPropagationStopped(),y.current||N.stopPropagation())})}),v&&a.jsx(qOe,{control:p,bubbles:!y.current,name:n,value:c,checked:b,required:o,disabled:l,form:f,style:{transform:"translateX(-100%)"}})]})});iW.displayName=YC;var sW="SwitchThumb",oW=O.forwardRef((t,e)=>{const{__scopeSwitch:r,...n}=t,i=FOe(sW,r);return a.jsx($t.span,{"data-state":aW(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:e})});oW.displayName=sW;var qOe=t=>{const{control:e,checked:r,bubbles:n=!0,...i}=t,s=O.useRef(null),o=$C(r),l=IC(e);return O.useEffect(()=>{const c=s.current,u=window.HTMLInputElement.prototype,d=Object.getOwnPropertyDescriptor(u,"checked").set;if(o!==r&&d){const p=new Event("click",{bubbles:n});d.call(c,r),c.dispatchEvent(p)}},[o,r,n]),a.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...i,tabIndex:-1,ref:s,style:{...t.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function aW(t){return t?"checked":"unchecked"}var lW=iW,zOe=oW;const kp=O.forwardRef(({className:t,...e},r)=>a.jsx(lW,{className:ge("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...e,ref:r,children:a.jsx(zOe,{className:ge("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));kp.displayName=lW.displayName;var UOe="Label",cW=O.forwardRef((t,e)=>a.jsx($t.label,{...t,ref:e,onMouseDown:r=>{var i;r.target.closest("button, input, select, textarea")||((i=t.onMouseDown)==null||i.call(t,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));cW.displayName=UOe;var uW=cW;const HOe=it,WOe=(t,e)=>r=>HOe(t,r==null?void 0:r.class,r==null?void 0:r.className),VOe=WOe("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),_t=O.forwardRef(({className:t,...e},r)=>a.jsx(uW,{ref:r,className:ge(VOe(),t),...e}));_t.displayName=uW.displayName;const If={ai_agent:"AI Agents",video:"Videos",document:"Documents",prompt:"Prompts",automation:"Automations",image:"Images",pdf:"PDFs"},Gg={ai_agent:"🤖",video:"📹",document:"📄",prompt:"💬",automation:"⚡",image:"🖼️",pdf:"📑"};function KOe({contentType:t,selectedItemId:e,onSelect:r,onCancel:n,className:i}){const{user:s}=Ln(),[o,l]=O.useState([]),[c,u]=O.useState(!0),[f,d]=O.useState(""),[p,m]=O.useState("grid"),[x,y]=O.useState("updated_at"),[v,b]=O.useState("desc"),[w,N]=O.useState("published"),[j,k]=O.useState(null);O.useEffect(()=>{_()},[t,x,v,w]);const _=async()=>{try{u(!0),k(null);let R=pe.from("content_items").select("*");if(t==="image"){const{data:z,error:W}=await pe.from("content_images").select("*").eq("status",w==="all"?void 0:w).order(x,{ascending:v==="asc"});if(W)throw W;l(z||[]);return}if(t==="pdf"){const{data:z,error:W}=await pe.from("content_pdfs").select("*").eq("status",w==="all"?void 0:w).order(x,{ascending:v==="asc"});if(W)throw W;l(z||[]);return}R=R.eq("content_type",t),w!=="all"&&(R=R.eq("status",w)),R=R.order(x,{ascending:v==="asc"});const{data:L,error:$}=await R;if($)throw $;const F=await Promise.all((L||[]).map(async z=>{try{switch(z.content_type){case"ai_agent":{const{data:W}=await pe.from("ai_agents").select("agent_name").eq("content_item_id",z.id).maybeSingle();return{...z,agent_name:W==null?void 0:W.agent_name}}case"video":{const{data:W}=await pe.from("videos").select("video_url").eq("content_item_id",z.id).maybeSingle();return{...z,video_url:W==null?void 0:W.video_url}}case"document":{const{data:W}=await pe.from("documents").select("content_html").eq("content_item_id",z.id).maybeSingle();return{...z,content_html:W==null?void 0:W.content_html}}case"prompt":{const{data:W}=await pe.from("prompts").select("prompt_text").eq("content_item_id",z.id).maybeSingle();return{...z,prompt_text:W==null?void 0:W.prompt_text}}case"automation":{const{data:W}=await pe.from("automations").select("automation_url").eq("content_item_id",z.id).maybeSingle();return{...z,automation_url:W==null?void 0:W.automation_url}}default:return z}}catch(W){return console.error(`Error loading details for ${z.content_type}:`,W),z}}));l(F)}catch(R){console.error("Error loading content:",R),k(R instanceof Error?R.message:"Failed to load content")}finally{u(!1)}},E=O.useMemo(()=>o.filter(R=>{var $,F,z,W;const L=f.toLowerCase();return(($=R.title)==null?void 0:$.toLowerCase().includes(L))||((F=R.description)==null?void 0:F.toLowerCase().includes(L))||((z=R.agent_name)==null?void 0:z.toLowerCase().includes(L))||((W=R.prompt_text)==null?void 0:W.toLowerCase().includes(L))}),[o,f]),A=R=>{x===R?b(v==="asc"?"desc":"asc"):(y(R),b("desc"))},T=R=>{switch(R){case"published":return a.jsxs(At,{className:"bg-green-100 text-green-800 border-green-200",children:[a.jsx(ln,{className:"w-3 h-3 mr-1"}),"Published"]});case"draft":return a.jsxs(At,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:[a.jsx(go,{className:"w-3 h-3 mr-1"}),"Draft"]});case"archived":return a.jsxs(At,{className:"bg-gray-100 text-gray-800 border-gray-200",children:[a.jsx(t_,{className:"w-3 h-3 mr-1"}),"Archived"]});default:return a.jsx(At,{variant:"outline",children:R})}},M=R=>new Date(R).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),P=R=>{switch(R.content_type||t){case"ai_agent":return R.agent_name||"AI Agent";case"video":return"Video Content";case"document":return R.content_html?`${R.content_html.length} characters`:"Document";case"prompt":return R.prompt_text?R.prompt_text.substring(0,100)+"...":"Prompt";case"automation":return R.automation_url||"Automation";case"image":return"Image File";case"pdf":return"PDF Document";default:return R.description||"Content Item"}};return c?a.jsx("div",{className:ge("bg-white rounded-lg border border-gray-200 p-6 max-w-4xl mx-auto",i),children:a.jsxs("div",{className:"flex items-center justify-center h-64",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),a.jsxs("span",{className:"ml-3 text-gray-600",children:["Loading ",If[t],"..."]})]})}):a.jsxs("div",{className:ge("bg-white rounded-lg border border-gray-200 max-w-4xl mx-auto",i),children:[a.jsxs("div",{className:"p-6 border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("span",{className:"text-2xl",children:Gg[t]}),a.jsxs("div",{children:[a.jsxs("h2",{className:"text-xl font-semibold",children:["Select ",If[t]]}),a.jsx("p",{className:"text-sm text-gray-600",children:"Choose content from your repository"})]})]}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:n,children:a.jsx($r,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("div",{className:"flex-1 relative",children:[a.jsx(In,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ct,{placeholder:`Search ${If[t].toLowerCase()}...`,value:f,onChange:R=>d(R.target.value),className:"pl-10"})]}),a.jsxs("div",{className:"flex border border-gray-200 rounded-lg overflow-hidden",children:[a.jsx(fe,{variant:p==="grid"?"default":"ghost",size:"sm",onClick:()=>m("grid"),className:"rounded-none border-0",children:a.jsx(dd,{className:"h-4 w-4"})}),a.jsx(fe,{variant:p==="list"?"default":"ghost",size:"sm",onClick:()=>m("list"),className:"rounded-none border-0 border-l border-gray-200",children:a.jsx(rs,{className:"h-4 w-4"})})]}),a.jsxs("select",{value:w,onChange:R=>N(R.target.value),className:"border border-gray-200 rounded-lg px-3 py-2 text-sm",children:[a.jsx("option",{value:"all",children:"All Status"}),a.jsx("option",{value:"published",children:"Published Only"}),a.jsx("option",{value:"draft",children:"Draft"}),a.jsx("option",{value:"archived",children:"Archived"})]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsxs(fe,{variant:"outline",size:"sm",onClick:()=>A("name"),className:ge("flex items-center space-x-1",x==="name"&&"bg-blue-50 border-blue-200"),children:[a.jsx("span",{children:"Name"}),x==="name"&&(v==="asc"?a.jsx(yM,{className:"h-3 w-3"}):a.jsx(gM,{className:"h-3 w-3"}))]}),a.jsxs(fe,{variant:"outline",size:"sm",onClick:()=>A("updated_at"),className:ge("flex items-center space-x-1",x==="updated_at"&&"bg-blue-50 border-blue-200"),children:[a.jsx("span",{children:"Modified"}),x==="updated_at"&&(v==="asc"?a.jsx(yM,{className:"h-3 w-3"}):a.jsx(gM,{className:"h-3 w-3"}))]})]})]})]}),a.jsxs("div",{className:"p-6",children:[j&&a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:[a.jsx("p",{className:"text-red-800",children:j}),a.jsx(fe,{variant:"outline",size:"sm",onClick:_,className:"mt-2",children:"Try Again"})]}),E.length===0?a.jsxs("div",{className:"text-center py-12",children:[a.jsx("span",{className:"text-6xl mb-4 block",children:Gg[t]}),a.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:["No ",If[t]," Found"]}),a.jsx("p",{className:"text-gray-600 mb-4",children:f?"Try adjusting your search terms.":`No ${If[t].toLowerCase()} available yet.`}),f&&a.jsx(fe,{variant:"outline",onClick:()=>d(""),children:"Clear Search"})]}):a.jsx("div",{className:ge(p==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4":"space-y-3"),children:E.map(R=>a.jsx("div",{onClick:()=>r(R),className:ge("border border-gray-200 rounded-lg p-4 cursor-pointer transition-all hover:border-blue-300 hover:shadow-md",e===R.id&&"border-blue-500 bg-blue-50",p==="list"&&"flex items-center space-x-4"),children:p==="grid"?a.jsxs("div",{children:[a.jsx("div",{className:"w-full h-32 bg-gray-100 rounded-lg flex items-center justify-center mb-3",children:a.jsx("span",{className:"text-3xl",children:Gg[t]})}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h3",{className:"font-medium text-sm line-clamp-2",children:R.title}),a.jsx("p",{className:"text-xs text-gray-600 line-clamp-2",children:P(R)}),a.jsxs("div",{className:"flex items-center justify-between",children:[T(R.status),a.jsx("span",{className:"text-xs text-gray-500",children:M(R.updated_at)})]})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0",children:a.jsx("span",{className:"text-xl",children:Gg[t]})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"font-medium text-sm truncate",children:R.title}),a.jsx("p",{className:"text-xs text-gray-600 truncate",children:P(R)})]}),a.jsxs("div",{className:"flex items-center space-x-3 flex-shrink-0",children:[T(R.status),a.jsx("span",{className:"text-xs text-gray-500",children:M(R.updated_at)})]})]})},R.id))})]}),a.jsxs("div",{className:"p-6 border-t border-gray-200 flex items-center justify-between",children:[a.jsxs("p",{className:"text-sm text-gray-600",children:[E.length," ",E.length===1?"item":"items",f&&` matching "${f}"`]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsx(fe,{variant:"outline",onClick:n,children:"Cancel"}),a.jsx(fe,{disabled:!e,onClick:()=>{const R=E.find(L=>L.id===e);R&&r(R)},children:"Select Content"})]})]})]})}const GOe={section_header:{icon:DO,label:"Section Header",description:"Create section headings with formatting"},rich_text:{icon:Ot,label:"Rich Text",description:"WYSIWYG text editor with formatting"},list:{icon:rs,label:"List",description:"Bullets, numbers, checkboxes with interactions"},quote:{icon:xy,label:"Quote",description:"Blockquotes with optional author attribution"},divider:{icon:RO,label:"Division",description:"Horizontal rule with spacing controls"},quiz:{icon:AO,label:"Quiz",description:"Interactive quizzes with multiple question types"},accordion:{icon:mo,label:"Accordion",description:"Expandable content sections"},user_submission:{icon:Ir,label:"User Submission",description:"Forms for text and file submissions"}},YOe={video:{icon:UB,label:"Video",description:"Video content from repository"},agent:{icon:Kr,label:"AI Agent",description:"Interactive AI agent conversations"},document:{icon:IB,label:"Document",description:"Rich documents from repository"},prompt:{icon:Gr,label:"Prompts",description:"Interactive prompt execution"},automation:{icon:Ei,label:"Automation",description:"Process automation workflows"},image:{icon:Eu,label:"Image",description:"Images with upload or repository selection"},pdf:{icon:RX,label:"PDF",description:"PDF documents with carousel view"}};function XOe({onBlockAdd:t,onPageCreate:e,onPageSelect:r,pages:n,currentPageId:i,structure:s,onSave:o,onPreview:l,isPreviewMode:c=!1,onStructureUpdate:u,className:f}){const[d,p]=O.useState(null),[m,x]=O.useState(""),[y,v]=O.useState((s==null?void 0:s.title)||""),[b,w]=O.useState((s==null?void 0:s.description)||""),[N,j]=O.useState((s==null?void 0:s.status)==="published"),[k,_]=O.useState(!1),[E,A]=O.useState(!1),[T,M]=O.useState(!1),[P,R]=O.useState(null);O.useEffect(()=>{s&&(v(s.title||""),w(s.description||""),j(s.status==="published"),_(!1))},[s]),O.useEffect(()=>{if(s){const U=y!==(s.title||"")||b!==(s.description||"")||N!==(s.status==="published");_(U)}},[s,y,b,N]);const L=async()=>{if(!(!u||!s||!k)){A(!0);try{await u({title:y,description:b,status:N?"published":"draft"}),_(!1),console.log("Settings saved successfully")}catch(U){console.error("Failed to save settings:",U)}finally{A(!1)}}},$=async U=>{if(!P)return;const ee={video:"video",ai_agent:"agent",document:"document",prompt:"prompt",automation:"automation",image:"image",pdf:"pdf"}[P];ee&&await t(ee),M(!1),R(null),p(null)},F=()=>{M(!1),R(null)},z=U=>{p(d===U?null:U)},W=()=>{p(null)},K=Object.entries(GOe).filter(([U,G])=>m===""||G.label.toLowerCase().includes(m.toLowerCase())),q=Object.entries(YOe).filter(([U,G])=>m===""||G.label.toLowerCase().includes(m.toLowerCase())),V=K.length>0,D=q.length>0;return a.jsxs("div",{className:ge("flex",f),children:[a.jsxs("div",{className:"w-16 bg-gray-900 border-r border-gray-800 flex flex-col items-center py-4 space-y-2 fixed left-0 top-0 bottom-0 z-40",children:[a.jsx(fe,{variant:d==="setup"?"secondary":"ghost",size:"sm",onClick:()=>z("setup"),className:"w-12 h-12 p-0 text-gray-300 hover:text-white hover:bg-gray-700 data-[state=open]:bg-gray-700",title:"Setup",children:a.jsx(Dn,{className:"h-5 w-5"})}),a.jsx(fe,{variant:d==="elements"?"secondary":"ghost",size:"sm",onClick:()=>z("elements"),className:"w-12 h-12 p-0 text-gray-300 hover:text-white hover:bg-gray-700 data-[state=open]:bg-gray-700",title:"Elements",children:a.jsx("div",{className:"relative",children:a.jsx("div",{className:"w-6 h-6 border-2 border-current rounded-full flex items-center justify-center",children:a.jsx(Vt,{className:"h-3 w-3"})})})}),a.jsx(fe,{variant:d==="content"?"secondary":"ghost",size:"sm",onClick:()=>z("content"),className:"w-12 h-12 p-0 text-gray-300 hover:text-white hover:bg-gray-700 data-[state=open]:bg-gray-700",title:"Content",children:a.jsx(Ot,{className:"h-5 w-5"})}),a.jsx(fe,{variant:d==="pages"?"secondary":"ghost",size:"sm",onClick:()=>z("pages"),className:"w-12 h-12 p-0 text-gray-300 hover:text-white hover:bg-gray-700 data-[state=open]:bg-gray-700",title:"Pages",children:a.jsx(Sh,{className:"h-5 w-5"})}),a.jsx("div",{className:"flex-1"}),o&&a.jsx(fe,{variant:"ghost",size:"sm",onClick:o,className:"w-12 h-12 p-0 text-gray-300 hover:text-white hover:bg-gray-700",title:"Save",children:a.jsx(Cp,{className:"h-5 w-5"})}),l&&a.jsx(fe,{variant:"ghost",size:"sm",onClick:l,className:"w-12 h-12 p-0 text-gray-300 hover:text-white hover:bg-gray-700",title:c?"Exit Preview":"Preview",children:a.jsx(ii,{className:"h-5 w-5"})})]}),d&&a.jsx("div",{className:"fixed inset-0 z-30",onClick:W}),d&&a.jsxs("div",{className:"w-80 bg-white border-r border-gray-200 flex flex-col fixed left-16 top-0 bottom-0 z-40 shadow-lg",children:[d==="setup"&&a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"p-4 border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h2",{className:"font-semibold text-lg",children:"WOD Setup"}),E?a.jsxs("div",{className:"flex items-center text-blue-600 text-sm",children:[a.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b border-blue-600 mr-2"}),"Saving..."]}):k?a.jsxs("div",{className:"flex items-center text-orange-600 text-sm",children:[a.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full mr-2"}),"Unsaved"]}):a.jsxs("div",{className:"flex items-center text-green-600 text-sm",children:[a.jsx(ln,{className:"h-3 w-3 mr-1"}),"Saved"]})]}),a.jsx("p",{className:"text-sm text-gray-600",children:"Configure your Workout of the Day"})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[a.jsxs("div",{children:[a.jsx(_t,{htmlFor:"wod-title",className:"text-sm font-medium",children:"WOD Title"}),a.jsx(ct,{id:"wod-title",value:y,onChange:U=>v(U.target.value),placeholder:"Enter WOD title...",className:"mt-1"})]}),a.jsxs("div",{children:[a.jsx(_t,{htmlFor:"wod-description",className:"text-sm font-medium",children:"Description"}),a.jsx(Ai,{id:"wod-description",value:b,onChange:U=>w(U.target.value),placeholder:"Describe this WOD...",rows:3,className:"mt-1"})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(_t,{htmlFor:"publication-status",className:"text-sm font-medium",children:"Publication Status"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:N?"Published - visible to users":"Draft - only visible to admins"})]}),a.jsx(kp,{id:"publication-status",checked:N,onCheckedChange:j})]}),k&&a.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-orange-900",children:"Unsaved Changes"}),a.jsx("p",{className:"text-xs text-orange-700 mt-1",children:"Click save to update WOD settings"})]}),a.jsx(fe,{onClick:L,disabled:E,size:"sm",className:"bg-orange-600 hover:bg-orange-700",children:E?a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b border-white mr-2"}),"Saving..."]}):"Save Settings"})]})}),a.jsx(Pd,{}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium mb-3",children:"WOD Categories & Settings"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(_t,{className:"text-sm font-medium",children:"Category"}),a.jsxs("select",{className:"w-full text-sm border border-gray-300 rounded-md px-3 py-2 mt-1",children:[a.jsx("option",{value:"",children:"Select Category"}),a.jsx("option",{value:"strength",children:"Strength Training"}),a.jsx("option",{value:"cardio",children:"Cardiovascular"}),a.jsx("option",{value:"hiit",children:"HIIT"}),a.jsx("option",{value:"flexibility",children:"Flexibility & Mobility"}),a.jsx("option",{value:"functional",children:"Functional Fitness"}),a.jsx("option",{value:"olympic",children:"Olympic Lifting"}),a.jsx("option",{value:"bodyweight",children:"Bodyweight"}),a.jsx("option",{value:"crossfit",children:"CrossFit Style"})]})]}),a.jsxs("div",{children:[a.jsx(_t,{className:"text-sm font-medium",children:"Workout Type"}),a.jsxs("select",{className:"w-full text-sm border border-gray-300 rounded-md px-3 py-2 mt-1",children:[a.jsx("option",{value:"",children:"Select Type"}),a.jsx("option",{value:"strength",children:"Strength"}),a.jsx("option",{value:"cardio",children:"Cardio"}),a.jsx("option",{value:"hiit",children:"HIIT"}),a.jsx("option",{value:"endurance",children:"Endurance"}),a.jsx("option",{value:"power",children:"Power"}),a.jsx("option",{value:"flexibility",children:"Flexibility"}),a.jsx("option",{value:"recovery",children:"Recovery"})]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(_t,{className:"text-sm font-medium",children:"Difficulty Level"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Set the difficulty level"})]}),a.jsxs("select",{className:"text-sm border rounded px-2 py-1",children:[a.jsx("option",{children:"Beginner"}),a.jsx("option",{children:"Intermediate"}),a.jsx("option",{children:"Advanced"})]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(_t,{className:"text-sm font-medium",children:"Progress Tracking"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Track user progress (ready for future functionality)"})]}),a.jsx(kp,{defaultChecked:!0,disabled:!0,className:"opacity-50"})]})]})]})]})]}),d==="elements"&&a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"p-4 border-b border-gray-200",children:[a.jsx("h2",{className:"font-semibold text-lg mb-3",children:"Elements"}),a.jsxs("div",{className:"relative",children:[a.jsx(In,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ct,{placeholder:"Search elements...",value:m,onChange:U=>x(U.target.value),className:"w-full pl-10"})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:a.jsxs("div",{className:"space-y-6",children:[V&&a.jsxs("div",{children:[a.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3",children:"Basic Elements"}),a.jsx("div",{className:"space-y-3",children:K.map(([U,G])=>{const ee=G.icon;return a.jsxs(fe,{variant:"outline",onClick:()=>{t(U),p(null)},className:"w-full h-auto p-4 flex items-start space-x-3 hover:bg-gray-50 transition-colors text-left",children:[a.jsx(ee,{className:"h-5 w-5 text-gray-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium text-sm",children:G.label}),a.jsx("div",{className:"text-xs text-gray-500 mt-1",children:G.description})]})]},U)})})]}),D&&a.jsxs("div",{children:[a.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3",children:"Content Elements"}),a.jsx("div",{className:"space-y-3",children:q.map(([U,G])=>{const ee=G.icon;return a.jsxs(fe,{variant:"outline",onClick:()=>{t(U),p(null)},className:"w-full h-auto p-4 flex items-start space-x-3 hover:bg-gray-50 transition-colors text-left",children:[a.jsx(ee,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium text-sm",children:G.label}),a.jsx("div",{className:"text-xs text-gray-500 mt-1",children:G.description})]}),a.jsx(At,{variant:"secondary",className:"text-xs ml-2",children:"Repository"})]},U)})})]}),!V&&!D&&m&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx(dd,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),a.jsx("p",{className:"text-sm",children:"No elements found"}),a.jsx("p",{className:"text-xs",children:"Try adjusting your search"})]})]})})]}),d==="content"&&a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"p-4 border-b border-gray-200",children:[a.jsx("h2",{className:"font-semibold text-lg mb-3",children:"Content"}),a.jsxs("div",{className:"relative",children:[a.jsx(In,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ct,{placeholder:"Search content blocks...",value:m,onChange:U=>x(U.target.value),className:"w-full pl-10"})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:a.jsx("div",{className:"space-y-3",children:q.map(([U,G])=>{const ee=G.icon;return a.jsxs(fe,{variant:"outline",onClick:()=>{const Q={video:"video",agent:"ai_agent",document:"document",prompt:"prompt",automation:"automation",image:"image",pdf:"pdf"};U in Q?(R(Q[U]),M(!0)):(t(U),p(null))},className:"w-full h-auto p-4 flex items-start space-x-3 hover:bg-gray-50 transition-colors text-left",children:[a.jsx(ee,{className:"h-5 w-5 text-gray-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium text-sm",children:G.label}),a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Select from ",G.label.toLowerCase()," repository"]})]})]},U)})})})]}),d==="pages"&&a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"p-4 border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h2",{className:"font-semibold text-lg",children:"Pages"}),a.jsxs(fe,{size:"sm",onClick:e,children:[a.jsx(Vt,{className:"h-4 w-4 mr-1"}),"New"]})]}),a.jsx("p",{className:"text-sm text-gray-600",children:"Manage WOD pages"})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:a.jsxs("div",{className:"space-y-2",children:[n.map((U,G)=>a.jsx("div",{onClick:()=>{r(U.id),p(null)},className:ge("p-3 rounded-lg border cursor-pointer transition-colors",i===U.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"),children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:G+1}),a.jsx("span",{className:"font-medium text-sm",children:U.title})]}),a.jsxs(At,{variant:"outline",className:"text-xs",children:[U.blocks," blocks"]})]})},U.id)),n.length===0&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx(Sh,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),a.jsx("p",{className:"text-sm",children:"No pages yet"}),a.jsx("p",{className:"text-xs",children:"Create your first page to get started"})]})]})})]})]}),T&&P&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsx(KOe,{contentType:P,onSelect:$,onCancel:F,className:"max-w-4xl w-full mx-4"})})]})}function JOe({block:t,onContentChange:e,onConfigChange:r,isPreview:n}){const i=t.content||{},s=i.title||"",o=i.subtitle||"",l=i.level||1,c=d=>{e({...i,title:d})},u=d=>{e({...i,subtitle:d})},f=d=>{e({...i,level:parseInt(d)})};if(n){const d=`h${l}`;return a.jsxs("div",{className:"p-4",children:[a.jsx(d,{className:`font-bold mb-2 ${l===1?"text-3xl":l===2?"text-2xl":l===3?"text-xl":l===4?"text-lg":l===5?"text-base":"text-sm"}`,children:s||"Untitled Section"}),o&&a.jsx("p",{className:"text-gray-600 text-sm",children:o})]})}return a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx(_t,{htmlFor:"title",children:"Section Title"}),a.jsx(ct,{id:"title",value:s,onChange:d=>c(d.target.value),placeholder:"Enter section title...",className:"mt-1"})]}),a.jsxs("div",{children:[a.jsx(_t,{htmlFor:"subtitle",children:"Subtitle (optional)"}),a.jsx(ct,{id:"subtitle",value:o,onChange:d=>u(d.target.value),placeholder:"Enter subtitle...",className:"mt-1"})]}),a.jsxs("div",{children:[a.jsx(_t,{htmlFor:"level",children:"Heading Level"}),a.jsxs(ec,{value:l.toString(),onValueChange:f,children:[a.jsx(Da,{className:"mt-1",children:a.jsx(tc,{placeholder:"Select heading level"})}),a.jsxs(La,{children:[a.jsx(kt,{value:"1",children:"H1 - Main Title"}),a.jsx(kt,{value:"2",children:"H2 - Section Title"}),a.jsx(kt,{value:"3",children:"H3 - Subsection"}),a.jsx(kt,{value:"4",children:"H4 - Small Heading"}),a.jsx(kt,{value:"5",children:"H5 - Tiny Heading"})]})]})]})]})}function QOe({block:t,onContentChange:e,onConfigChange:r,isPreview:n}){const i=t.content||{},s=i.html||"<p>Enter your text here...</p>";i.text;const o=Rv({extensions:[d0.configure({bulletList:{keepMarks:!0,keepAttributes:!1},orderedList:{keepMarks:!0,keepAttributes:!1}}),xp,bp,CH.configure({types:["heading","paragraph"]}),NC.configure({openOnClick:!1,HTMLAttributes:{class:"text-blue-600 hover:text-blue-800 underline"}}),f0,u0.configure({placeholder:"Start typing your content here..."})],content:s,editable:!n,onUpdate:({editor:y})=>{const v=y.getHTML(),b=y.getText();e({html:v,text:b})}});if(O.useEffect(()=>{o&&o.getHTML()!==s&&o.commands.setContent(s)},[o,s]),!o)return a.jsx("div",{className:"p-4",children:a.jsxs("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})});const l=()=>o.chain().focus().toggleBold().run(),c=()=>o.chain().focus().toggleItalic().run(),u=()=>o.chain().focus().toggleUnderline().run(),f=()=>o.chain().focus().toggleStrike().run(),d=y=>o.chain().focus().setTextAlign(y).run(),p=()=>o.chain().focus().toggleBulletList().run(),m=()=>o.chain().focus().toggleOrderedList().run(),x=()=>{const y=o.getAttributes("link").href,v=window.prompt("URL",y);if(v!==null){if(v===""){o.chain().focus().extendMarkRange("link").unsetLink().run();return}o.chain().focus().extendMarkRange("link").setLink({href:v}).run()}};return n?a.jsx("div",{className:"p-4",children:a.jsx("div",{dangerouslySetInnerHTML:{__html:s},className:"prose prose-sm max-w-none"})}):a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx(_t,{className:"text-base font-semibold mb-4 block",children:"Content Editor"}),a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Use the toolbar below to format your text. Changes will be reflected on the canvas in real-time."})]}),a.jsx(Pd,{}),a.jsx("div",{className:"border border-gray-200 rounded-lg bg-gray-50 p-2",children:a.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.jsx(fe,{variant:"ghost",size:"sm",onClick:l,className:ge("h-8 w-8 p-0",o.isActive("bold")&&"bg-gray-200"),children:a.jsx(my,{className:"w-4 h-4"})}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:c,className:ge("h-8 w-8 p-0",o.isActive("italic")&&"bg-gray-200"),children:a.jsx(vy,{className:"w-4 h-4"})}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:u,className:ge("h-8 w-8 p-0",o.isActive("underline")&&"bg-gray-200"),children:a.jsx(qB,{className:"w-4 h-4"})}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:f,className:ge("h-8 w-8 p-0",o.isActive("strike")&&"bg-gray-200"),children:a.jsx(BB,{className:"w-4 h-4"})}),a.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1 self-center"}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>d("left"),className:ge("h-8 w-8 p-0",o.isActive({textAlign:"left"})&&"bg-gray-200"),children:a.jsx(PB,{className:"w-4 h-4"})}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>d("center"),className:ge("h-8 w-8 p-0",o.isActive({textAlign:"center"})&&"bg-gray-200"),children:a.jsx(TB,{className:"w-4 h-4"})}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>d("right"),className:ge("h-8 w-8 p-0",o.isActive({textAlign:"right"})&&"bg-gray-200"),children:a.jsx(MB,{className:"w-4 h-4"})}),a.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1 self-center"}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:p,className:ge("h-8 w-8 p-0",o.isActive("bulletList")&&"bg-gray-200"),children:a.jsx(rs,{className:"w-4 h-4"})}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:m,className:ge("h-8 w-8 p-0",o.isActive("orderedList")&&"bg-gray-200"),children:a.jsx(MO,{className:"w-4 h-4"})}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:x,className:ge("h-8 w-8 p-0",o.isActive("link")&&"bg-gray-200"),children:a.jsx(E0,{className:"w-4 h-4"})})]})}),a.jsx("div",{className:"border border-gray-200 rounded-lg p-4 min-h-[300px] bg-white",children:a.jsx(Mv,{editor:o,className:"prose prose-gray max-w-none focus:outline-none min-h-[250px]"})}),a.jsxs("div",{className:"text-xs text-gray-500",children:[a.jsx("strong",{children:"Tip:"})," Select text and use the toolbar buttons to format it. Your changes will appear on the canvas immediately."]})]})}function ZOe({block:t,onContentChange:e,onConfigChange:r,isPreview:n}){const{user:i}=Ln(),s=O.useRef(null),[o,l]=O.useState([]),[c,u]=O.useState(""),[f,d]=O.useState(!1),[p,m]=O.useState(!1),[x,y]=O.useState(!1),v=t.content||{},b=v.src||"",w=v.alt||"",N=v.caption||"",j=v.width,k=v.height;Z.useEffect(()=>{x&&_()},[x]);const _=async()=>{if(i)try{d(!0);const{data:$,error:F}=await pe.from("uploaded_files").select("*").like("mime_type","image/%").order("created_at",{ascending:!1});if(F)throw F;l($||[])}catch($){console.error("Error loading images:",$)}finally{d(!1)}},E=async $=>{var z;const F=(z=$.target.files)==null?void 0:z[0];if(F){if(!F.type.startsWith("image/")){alert("Please select a valid image file");return}if(F.size>5*1024*1024){alert("File size must be less than 5MB");return}try{m(!0);const W=await new Promise((D,U)=>{const G=new FileReader;G.onloadend=()=>D(G.result),G.onerror=U,G.readAsDataURL(F)}),{data:K,error:q}=await pe.functions.invoke("enhanced-file-upload",{body:{fileData:W,fileName:F.name,fileType:F.type,folder:"page-builder"}});if(q)throw q;const V=K.data;e({...v,src:V.publicUrl,alt:w||F.name,width:void 0,height:void 0}),_()}catch(W){console.error("Error uploading file:",W),alert("Failed to upload image. Please try again.")}finally{m(!1),s.current&&(s.current.value="")}}},A=$=>{e({...v,src:$.file_url,alt:w||$.filename,width:void 0,height:void 0}),y(!1)},T=$=>{e({...v,alt:$})},M=$=>{e({...v,caption:$})},P=($,F)=>{const z=F?parseInt(F,10):void 0;e({...v,[$]:z})},R=()=>{e({...v,src:"",alt:"",caption:"",width:void 0,height:void 0})},L=o.filter($=>c===""||$.filename.toLowerCase().includes(c.toLowerCase()));return n?b?a.jsx("div",{className:"p-4",children:a.jsxs("div",{className:"text-center",children:[a.jsx("img",{src:b,alt:w,style:{width:j?`${j}px`:"auto",height:k?`${k}px`:"auto",maxWidth:"100%"},className:"rounded-lg shadow-sm mx-auto"}),N&&a.jsx("p",{className:"text-sm text-gray-600 mt-2 italic",children:N})]})}):a.jsxs("div",{className:"p-4 text-center text-gray-500",children:[a.jsx(Eu,{className:"h-12 w-12 mx-auto mb-2 text-gray-300"}),a.jsx("p",{children:"No image selected"})]}):a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx(_t,{children:"Current Image"}),b?a.jsxs("div",{className:"mt-2 relative",children:[a.jsx("img",{src:b,alt:w,className:"w-full max-w-xs rounded-lg border border-gray-200"}),a.jsx(fe,{variant:"destructive",size:"sm",onClick:R,className:"absolute top-2 right-2 h-6 w-6 p-0",children:a.jsx($r,{className:"h-3 w-3"})})]}):a.jsxs("div",{className:"mt-2 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center text-gray-500",children:[a.jsx(Eu,{className:"h-12 w-12 mx-auto mb-2"}),a.jsx("p",{children:"No image selected"})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs(fe,{onClick:()=>{var $;return($=s.current)==null?void 0:$.click()},disabled:p,size:"sm",children:[a.jsx(Ir,{className:"h-4 w-4 mr-1"}),p?"Uploading...":"Upload New"]}),a.jsx(fe,{variant:"outline",size:"sm",onClick:()=>y(!x),children:x?"Hide Repository":"Browse Repository"})]}),a.jsx("input",{type:"file",ref:s,onChange:E,accept:"image/*",className:"hidden"}),x&&a.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[a.jsx("div",{className:"p-3 border-b border-gray-200",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(In,{className:"h-4 w-4 text-gray-400"}),a.jsx(ct,{placeholder:"Search images...",value:c,onChange:$=>u($.target.value),className:"flex-1"})]})}),a.jsx("div",{className:"max-h-64 overflow-y-auto",children:f?a.jsx("div",{className:"p-4 text-center text-gray-500",children:"Loading images..."}):L.length>0?a.jsx("div",{className:"grid grid-cols-3 gap-2 p-3",children:L.map($=>a.jsx("button",{onClick:()=>A($),className:"aspect-square bg-gray-100 rounded border hover:border-blue-500 transition-colors overflow-hidden",children:a.jsx("img",{src:$.file_url,alt:$.filename,className:"w-full h-full object-cover"})},$.id))}):a.jsx("div",{className:"p-4 text-center text-gray-500",children:a.jsx("p",{children:"No images found"})})})]}),b&&a.jsxs(a.Fragment,{children:[a.jsx(Pd,{}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(_t,{htmlFor:"alt-text",children:"Alt Text"}),a.jsx(ct,{id:"alt-text",value:w,onChange:$=>T($.target.value),placeholder:"Describe this image for accessibility...",className:"mt-1"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Alt text is important for screen readers and SEO"})]}),a.jsxs("div",{children:[a.jsx(_t,{htmlFor:"caption",children:"Caption (optional)"}),a.jsx(Ai,{id:"caption",value:N,onChange:$=>M($.target.value),placeholder:"Add a caption that will appear below the image...",className:"mt-1 min-h-[60px]"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(_t,{htmlFor:"width",children:"Width (px)"}),a.jsx(ct,{id:"width",type:"number",value:j||"",onChange:$=>P("width",$.target.value),placeholder:"Auto",className:"mt-1"})]}),a.jsxs("div",{children:[a.jsx(_t,{htmlFor:"height",children:"Height (px)"}),a.jsx(ct,{id:"height",type:"number",value:k||"",onChange:$=>P("height",$.target.value),placeholder:"Auto",className:"mt-1"})]})]}),a.jsx("p",{className:"text-xs text-gray-500",children:"Leave dimensions empty for automatic sizing"})]})]})]})}const dW=({fileTypes:t=[],onSelect:e,onCancel:r,allowUpload:n=!0,multiSelect:i=!1,title:s="Content Repository",subtitle:o="Select content from your repository"})=>{const[l,c]=O.useState([]),[u,f]=O.useState([]),[d,p]=O.useState(!0),[m,x]=O.useState(null),[y,v]=O.useState(""),[b,w]=O.useState("grid"),[N,j]=O.useState("created_at"),[k,_]=O.useState("desc"),[E,A]=O.useState(!0),[T,M]=O.useState([]),[P,R]=O.useState(null),[L,$]=O.useState(0),[F,z]=O.useState(!1);O.useEffect(()=>{W()},[]),O.useEffect(()=>{K()},[l,y,N,k,E,t]);const W=async()=>{try{p(!0),x(null);let Q=pe.from("uploaded_files").select("*");if(t.length>0){const re=t.map(J=>J.endsWith("/*")?`file_type.like.${J.replace("/*","/%")}`:`file_type.eq.${J}`);Q=Q.or(re.join(","))}const{data:H,error:Y}=await Q;if(Y)throw Y;c(H||[])}catch(Q){console.error("Error fetching files:",Q),x(Q.message||"Failed to load files")}finally{p(!1)}},K=()=>{let Q=[...l];y.trim()&&(Q=Q.filter(H=>H.file_name.toLowerCase().includes(y.toLowerCase()))),E&&(Q=Q.filter(H=>H.is_published)),Q.sort((H,Y)=>{let re,J;switch(N){case"name":re=H.file_name.toLowerCase(),J=Y.file_name.toLowerCase();break;case"created_at":re=new Date(H.created_at).getTime(),J=new Date(Y.created_at).getTime();break;case"file_size":re=H.file_size,J=Y.file_size;break;default:return 0}return re<J?k==="asc"?-1:1:re>J?k==="asc"?1:-1:0}),f(Q)},q=async Q=>{const H=Q.target.files;if(!H||H.length===0)return;const Y=H[0];try{z(!0),$(0),x(null);const ne=`uploads/${`${Date.now()}-${Y.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`}`,{data:te,error:se}=await pe.storage.from("missions").upload(ne,Y,{cacheControl:"3600",upsert:!1});if(se)throw se;const{data:{user:ve}}=await pe.auth.getUser();if(!ve)throw new Error("User not authenticated");const{data:ie}=await pe.from("users").select("organization_id").eq("id",ve.id).single();if(!(ie!=null&&ie.organization_id))throw new Error("User organization not found");const{data:ye,error:Te}=await pe.from("uploaded_files").insert({file_name:Y.name,file_type:Y.type,file_size:Y.size,storage_path:ne,organization_id:ie.organization_id,uploader_id:ve.id,is_published:!0}).select().single();if(Te)throw Te;await W(),e(ye)}catch(re){console.error("Error uploading file:",re),x(re.message||"Failed to upload file")}finally{z(!1),$(0)}},V=Q=>{if(Q===0)return"0 Bytes";const H=1024,Y=["Bytes","KB","MB","GB"],re=Math.floor(Math.log(Q)/Math.log(H));return parseFloat((Q/Math.pow(H,re)).toFixed(2))+" "+Y[re]},D=Q=>Q.startsWith("image/")?"🖼️":Q==="application/pdf"?"📄":Q.startsWith("video/")?"🎥":"📎",U=Q=>{if(i){const H=T.includes(Q.id)?T.filter(Y=>Y!==Q.id):[...T,Q.id];M(H)}else R(Q)},G=()=>{P&&e(P)},ee=()=>{const Q=u.filter(H=>T.includes(H.id));Q.length>0&&e(Q[0])};return d?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsx("div",{className:"bg-white rounded-lg p-8 max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden",children:a.jsxs("div",{className:"flex items-center justify-center h-64",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"}),a.jsx("span",{className:"ml-3 text-lg",children:"Loading files..."})]})})}):a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"p-6 border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:s}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:o})]}),a.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"×"})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(In,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),a.jsx("input",{type:"text",placeholder:t.some(Q=>Q.startsWith("video"))?"Search videos...":"Search files...",value:y,onChange:Q=>v(Q.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),a.jsxs("div",{className:"flex gap-2 items-center",children:[a.jsxs("div",{className:"flex border border-gray-300 rounded-md",children:[a.jsx("button",{onClick:()=>w("grid"),className:`p-2 ${b==="grid"?"bg-blue-500 text-white":"text-gray-600 hover:bg-gray-100"}`,children:a.jsx(dd,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>w("list"),className:`p-2 ${b==="list"?"bg-blue-500 text-white":"text-gray-600 hover:bg-gray-100"}`,children:a.jsx(rs,{className:"h-4 w-4"})})]}),a.jsxs("select",{value:`${N}-${k}`,onChange:Q=>{const[H,Y]=Q.target.value.split("-");j(H),_(Y)},className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[a.jsx("option",{value:"created_at-desc",children:"Newest First"}),a.jsx("option",{value:"created_at-asc",children:"Oldest First"}),a.jsx("option",{value:"name-asc",children:"Name A-Z"}),a.jsx("option",{value:"name-desc",children:"Name Z-A"}),a.jsx("option",{value:"file_size-desc",children:"Largest First"}),a.jsx("option",{value:"file_size-asc",children:"Smallest First"})]}),a.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[a.jsx("input",{type:"checkbox",checked:E,onChange:Q=>A(Q.target.checked),className:"rounded border-gray-300 focus:ring-2 focus:ring-blue-500"}),"Published Only"]})]})]})]}),n&&a.jsx("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("label",{className:"flex items-center gap-2 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md cursor-pointer transition-colors",children:[a.jsx(Ir,{className:"h-4 w-4"}),F?"Uploading...":"Upload New File",a.jsx("input",{type:"file",onChange:q,className:"hidden",accept:t.join(","),disabled:F})]}),F&&a.jsx("div",{className:"flex-1",children:a.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${L}%`}})})})]})}),m&&a.jsx("div",{className:"p-4 bg-red-50 border-b border-red-200",children:a.jsx("p",{className:"text-red-600",children:m})}),a.jsx("div",{className:"flex-1 overflow-auto p-6",children:u.length===0?a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"📁"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No files found"}),a.jsx("p",{className:"text-gray-600",children:y?"Try adjusting your search terms":"Upload some files to get started"})]}):b==="grid"?a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:u.map(Q=>a.jsx("div",{onClick:()=>U(Q),className:`border-2 rounded-lg p-4 cursor-pointer transition-all duration-200 hover:shadow-lg ${i&&T.includes(Q.id)||!i&&(P==null?void 0:P.id)===Q.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-4xl mb-2",children:D(Q.file_type)}),a.jsx("h4",{className:"font-medium text-sm text-gray-900 mb-1 truncate",title:Q.file_name,children:Q.file_name}),a.jsx("p",{className:"text-xs text-gray-500",children:V(Q.file_size)}),a.jsx("p",{className:"text-xs text-gray-400",children:new Date(Q.created_at).toLocaleDateString()})]})},Q.id))}):a.jsx("div",{className:"space-y-2",children:u.map(Q=>a.jsxs("div",{onClick:()=>U(Q),className:`flex items-center gap-4 p-4 rounded-lg cursor-pointer transition-all duration-200 hover:bg-gray-50 ${i&&T.includes(Q.id)||!i&&(P==null?void 0:P.id)===Q.id?"bg-blue-50 border border-blue-200":"border border-gray-200"}`,children:[a.jsx("div",{className:"text-2xl",children:D(Q.file_type)}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"font-medium text-gray-900 truncate",children:Q.file_name}),a.jsxs("p",{className:"text-sm text-gray-500",children:[V(Q.file_size)," • ",new Date(Q.created_at).toLocaleDateString()]})]}),!Q.is_published&&a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full",children:"Draft"})]},Q.id))})}),a.jsxs("div",{className:"p-6 border-t border-gray-200 flex justify-between items-center",children:[a.jsxs("p",{className:"text-sm text-gray-600",children:[u.length," file",u.length!==1?"s":""," found",i&&T.length>0&&` • ${T.length} selected`,!i&&P&&` • ${P.file_name} selected`]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"}),i&&T.length>0&&a.jsxs("button",{onClick:ee,className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md transition-colors",children:["Select ",T.length," File",T.length!==1?"s":""]}),!i&&P&&a.jsx("button",{onClick:G,className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md transition-colors",children:"Select Content"})]})]})]})})};function eEe({block:t,onContentChange:e,onConfigChange:r,isPreview:n}){const{user:i}=Ln(),[s,o]=O.useState([]),[l,c]=O.useState(!1),[u,f]=O.useState(!1),d=t.content||{},p=d.video_id,m=s.find(k=>k.id===p),x=d.autoplay||!1,y=d.controls!==!1;O.useEffect(()=>{v()},[]);const v=async()=>{if(i)try{c(!0);const{data:k,error:_}=await pe.from("videos").select("*").eq("status","published").order("created_at",{ascending:!1});if(_)throw _;o(k||[])}catch(k){console.error("Error loading videos:",k)}finally{c(!1)}},b=k=>{e({...d,video_id:k.id,title:k.file_name,description:"",thumbnail:"",url:k.storage_path,platform:"direct",video_id_external:"",duration:0}),f(!1)},w=k=>{e({...d,autoplay:k})},N=k=>{e({...d,controls:k})},j=k=>k.video_url?k.video_url:k.platform==="youtube"&&k.video_id_external?`https://www.youtube.com/embed/${k.video_id_external}?autoplay=${x?1:0}&controls=${y?1:0}`:k.platform==="vimeo"&&k.video_id_external?`https://player.vimeo.com/video/${k.video_id_external}?autoplay=${x?1:0}&controls=${y?1:0}`:null;if(n){if(!m)return a.jsxs("div",{className:"p-4 text-center text-gray-500",children:[a.jsx(si,{className:"h-12 w-12 mx-auto mb-2 text-gray-300"}),a.jsx("p",{children:"No video selected"})]});const k=j(m);return k?a.jsxs("div",{className:"p-4",children:[a.jsx("div",{className:"aspect-video bg-black rounded-lg overflow-hidden",children:m.platform&&m.platform!=="direct"?a.jsx("iframe",{src:k,title:m.title,className:"w-full h-full",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):a.jsx("video",{src:k,controls:y,autoPlay:x,className:"w-full h-full",poster:m.thumbnail_url,children:"Your browser does not support the video tag."})}),a.jsxs("div",{className:"mt-3",children:[a.jsx("h3",{className:"font-medium",children:m.title}),m.description&&a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:m.description}),m.duration&&a.jsxs(At,{variant:"secondary",className:"mt-2 text-xs",children:[Math.floor(m.duration/60),":",(m.duration%60).toString().padStart(2,"0")]})]})]}):a.jsx("div",{className:"p-4 text-center text-red-500",children:a.jsx("p",{children:"Invalid video configuration"})})}return a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx(_t,{children:"Selected Video"}),a.jsx(fe,{size:"sm",onClick:()=>{console.log("Browse Repository button clicked"),f(!0)},className:"bg-blue-500 hover:bg-blue-600 text-white",children:"Browse Repository"})]}),m?a.jsx("div",{className:"border border-gray-200 rounded-lg p-3",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-medium",children:m.title}),m.description&&a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:m.description}),a.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[a.jsx(At,{variant:"outline",className:"text-xs",children:m.platform||"Direct"}),m.duration&&a.jsxs(At,{variant:"secondary",className:"text-xs",children:[Math.floor(m.duration/60),":",(m.duration%60).toString().padStart(2,"0")]})]})]}),m.thumbnail_url&&a.jsx("img",{src:m.thumbnail_url,alt:m.title,className:"w-16 h-12 object-cover rounded"})]})}):a.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center text-gray-500",children:[a.jsx(si,{className:"h-12 w-12 mx-auto mb-2"}),a.jsx("p",{children:"No video selected"}),a.jsx("p",{className:"text-sm",children:"Browse the repository to select a video"})]})]}),u&&a.jsx(dW,{title:"Select Videos",subtitle:"Choose a video from your content repository",fileTypes:["video/*"],onSelect:b,onCancel:()=>f(!1),allowUpload:!0}),m&&a.jsxs(a.Fragment,{children:[a.jsx(Pd,{}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(_t,{className:"font-medium",children:"Autoplay"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Start playing automatically when visible"})]}),a.jsx(kp,{checked:x,onCheckedChange:w})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(_t,{className:"font-medium",children:"Show Controls"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Display video player controls"})]}),a.jsx(kp,{checked:y,onCheckedChange:N})]})]})]})]})}function tEe({block:t,onContentChange:e,onConfigChange:r,isPreview:n}){const{user:i}=Ln(),[s,o]=O.useState([]),[l,c]=O.useState(!1),[u,f]=O.useState(!1),d=t.content||{},p=d.agent_id,m=s.find(j=>j.id===p),x=d.initial_message||"",y=d.context||"";O.useEffect(()=>{v()},[]);const v=async()=>{if(i)try{c(!0);const{data:j,error:k}=await pe.from("ai_agents").select("*").eq("status","published").order("created_at",{ascending:!1});if(k)throw k;o(j||[])}catch(j){console.error("Error loading AI agents:",j)}finally{c(!1)}},b=j=>{e({...d,agent_id:j.id,agent_name:j.file_name,agent_description:"AI Agent from file repository",model:"default",avatar_url:""}),f(!1)},w=j=>{e({...d,initial_message:j})},N=j=>{e({...d,context:j})};return n?m?a.jsx("div",{className:"p-4",children:a.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:m.avatar_url?a.jsx("img",{src:m.avatar_url,alt:m.name,className:"w-full h-full rounded-full object-cover"}):a.jsx(Kr,{className:"h-5 w-5 text-blue-600"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-semibold text-blue-900",children:m.name}),m.description&&a.jsx("p",{className:"text-sm text-blue-700 mt-1",children:m.description}),x&&a.jsx("div",{className:"mt-3 bg-white border border-blue-200 rounded-lg p-3",children:a.jsxs("div",{className:"flex items-start space-x-2",children:[a.jsx(Gr,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),a.jsx("p",{className:"text-sm text-gray-700",children:x})]})}),a.jsx(fe,{size:"sm",className:"mt-3 bg-blue-600 hover:bg-blue-700",disabled:!0,children:"Start Conversation"})]})]})})}):a.jsxs("div",{className:"p-4 text-center text-gray-500",children:[a.jsx(Kr,{className:"h-12 w-12 mx-auto mb-2 text-gray-300"}),a.jsx("p",{children:"No AI agent selected"})]}):a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx(_t,{children:"Selected AI Agent"}),a.jsx(fe,{size:"sm",onClick:()=>{console.log("Browse Repository button clicked"),f(!0)},className:"bg-blue-500 hover:bg-blue-600 text-white",children:"Browse Repository"})]}),m?a.jsx("div",{className:"border border-gray-200 rounded-lg p-3",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center flex-shrink-0",children:m.avatar_url?a.jsx("img",{src:m.avatar_url,alt:m.name,className:"w-full h-full rounded-full object-cover"}):a.jsx(Kr,{className:"h-5 w-5 text-gray-600"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-medium",children:m.name}),m.description&&a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:m.description}),a.jsx("div",{className:"flex items-center space-x-2 mt-2",children:a.jsx(At,{variant:"outline",className:"text-xs",children:m.model||"Default Model"})})]})]})}):a.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center text-gray-500",children:[a.jsx(Kr,{className:"h-12 w-12 mx-auto mb-2"}),a.jsx("p",{children:"No AI agent selected"}),a.jsx("p",{className:"text-sm",children:"Browse the repository to select an agent"})]})]}),u&&a.jsx(dW,{title:"Select AI Agent",subtitle:"Choose an AI agent from your content repository",fileTypes:["application/json"],onSelect:b,onCancel:()=>f(!1),allowUpload:!0}),m&&a.jsxs(a.Fragment,{children:[a.jsx(Pd,{}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(_t,{htmlFor:"initial-message",children:"Initial Message (optional)"}),a.jsx(Ai,{id:"initial-message",value:x,onChange:j=>w(j.target.value),placeholder:"Enter the agent's greeting message...",className:"mt-1 min-h-[80px]"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This message will be displayed when the agent first loads"})]}),a.jsxs("div",{children:[a.jsx(_t,{htmlFor:"custom-context",children:"Additional Context (optional)"}),a.jsx(Ai,{id:"custom-context",value:y,onChange:j=>N(j.target.value),placeholder:"Provide additional context specific to this interaction...",className:"mt-1 min-h-[80px]"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Additional context that will be provided to the agent for this specific interaction"})]})]})]})]})}function rEe(t,e){return O.useReducer((r,n)=>e[r][n]??r,t)}var fW=t=>{const{present:e,children:r}=t,n=nEe(e),i=typeof r=="function"?r({present:n.isPresent}):O.Children.only(r),s=yr(n.ref,iEe(i));return typeof r=="function"||n.isPresent?O.cloneElement(i,{ref:s}):null};fW.displayName="Presence";function nEe(t){const[e,r]=O.useState(),n=O.useRef({}),i=O.useRef(t),s=O.useRef("none"),o=t?"mounted":"unmounted",[l,c]=rEe(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return O.useEffect(()=>{const u=Yg(n.current);s.current=l==="mounted"?u:"none"},[l]),Sn(()=>{const u=n.current,f=i.current;if(f!==t){const p=s.current,m=Yg(u);t?c("MOUNT"):m==="none"||(u==null?void 0:u.display)==="none"?c("UNMOUNT"):c(f&&p!==m?"ANIMATION_OUT":"UNMOUNT"),i.current=t}},[t,c]),Sn(()=>{if(e){let u;const f=e.ownerDocument.defaultView??window,d=m=>{const y=Yg(n.current).includes(m.animationName);if(m.target===e&&y&&(c("ANIMATION_END"),!i.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",u=f.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},p=m=>{m.target===e&&(s.current=Yg(n.current))};return e.addEventListener("animationstart",p),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{f.clearTimeout(u),e.removeEventListener("animationstart",p),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:O.useCallback(u=>{u&&(n.current=getComputedStyle(u)),r(u)},[])}}function Yg(t){return(t==null?void 0:t.animationName)||"none"}function iEe(t){var n,i;let e=(n=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:n.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var XC="Checkbox",[sEe,AEe]=Yp(XC),[oEe,aEe]=sEe(XC),hW=O.forwardRef((t,e)=>{const{__scopeCheckbox:r,name:n,checked:i,defaultChecked:s,required:o,disabled:l,value:c="on",onCheckedChange:u,form:f,...d}=t,[p,m]=O.useState(null),x=yr(e,j=>m(j)),y=O.useRef(!1),v=p?f||!!p.closest("form"):!0,[b=!1,w]=v0({prop:i,defaultProp:s,onChange:u}),N=O.useRef(b);return O.useEffect(()=>{const j=p==null?void 0:p.form;if(j){const k=()=>w(N.current);return j.addEventListener("reset",k),()=>j.removeEventListener("reset",k)}},[p,w]),a.jsxs(oEe,{scope:r,state:b,disabled:l,children:[a.jsx($t.button,{type:"button",role:"checkbox","aria-checked":Ca(b)?"mixed":b,"aria-required":o,"data-state":gW(b),"data-disabled":l?"":void 0,disabled:l,value:c,...d,ref:x,onKeyDown:Jt(t.onKeyDown,j=>{j.key==="Enter"&&j.preventDefault()}),onClick:Jt(t.onClick,j=>{w(k=>Ca(k)?!0:!k),v&&(y.current=j.isPropagationStopped(),y.current||j.stopPropagation())})}),v&&a.jsx(lEe,{control:p,bubbles:!y.current,name:n,value:c,checked:b,required:o,disabled:l,form:f,style:{transform:"translateX(-100%)"},defaultChecked:Ca(s)?!1:s})]})});hW.displayName=XC;var pW="CheckboxIndicator",mW=O.forwardRef((t,e)=>{const{__scopeCheckbox:r,forceMount:n,...i}=t,s=aEe(pW,r);return a.jsx(fW,{present:n||Ca(s.state)||s.state===!0,children:a.jsx($t.span,{"data-state":gW(s.state),"data-disabled":s.disabled?"":void 0,...i,ref:e,style:{pointerEvents:"none",...t.style}})})});mW.displayName=pW;var lEe=t=>{const{control:e,checked:r,bubbles:n=!0,defaultChecked:i,...s}=t,o=O.useRef(null),l=$C(r),c=IC(e);O.useEffect(()=>{const f=o.current,d=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(d,"checked").set;if(l!==r&&m){const x=new Event("click",{bubbles:n});f.indeterminate=Ca(r),m.call(f,Ca(r)?!1:r),f.dispatchEvent(x)}},[l,r,n]);const u=O.useRef(Ca(r)?!1:r);return a.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i??u.current,...s,tabIndex:-1,ref:o,style:{...t.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Ca(t){return t==="indeterminate"}function gW(t){return Ca(t)?"indeterminate":t?"checked":"unchecked"}var yW=hW,cEe=mW;const Yf=O.forwardRef(({className:t,...e},r)=>a.jsx(yW,{ref:r,className:ge("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...e,children:a.jsx(cEe,{className:ge("flex items-center justify-center text-current"),children:a.jsx(ko,{className:"h-4 w-4"})})}));Yf.displayName=yW.displayName;function uEe({block:t,onContentChange:e,onConfigChange:r,isPreview:n}){const i=t.content||{},s=i.type||"unordered",o=i.items||[{id:"1",text:""}],l=i.checklistStyle||!1,c=y=>{e({...i,type:y})},u=y=>{e({...i,checklistStyle:y,items:o.map(v=>({...v,checked:y?!1:void 0}))})},f=(y,v)=>{const b=o.map(w=>w.id===y?{...w,text:v}:w);e({...i,items:b})},d=(y,v)=>{const b=o.map(w=>w.id===y?{...w,checked:v}:w);e({...i,items:b})},p=()=>{const y=(Math.max(...o.map(b=>parseInt(b.id)||0))+1).toString(),v=[...o,{id:y,text:"",...l&&{checked:!1}}];e({...i,items:v})},m=y=>{if(o.length<=1)return;const v=o.filter(b=>b.id!==y);e({...i,items:v})},x=(y,v)=>{const b=[...o],w=y-1;w<0||w>=b.length||([b[y],b[w]]=[b[w],b[y]],e({...i,items:b}))};return n?a.jsx("div",{className:"p-4",children:s==="ordered"?a.jsx("ol",{className:"list-decimal list-inside space-y-2",children:o.map((y,v)=>a.jsx("li",{className:"flex items-start",children:l?a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Yf,{checked:y.checked||!1,disabled:!0,className:"mt-0.5"}),a.jsx("span",{className:y.checked?"line-through text-gray-500":"",children:y.text||`Item ${v+1}`})]}):a.jsx("span",{children:y.text||`Item ${v+1}`})},y.id))}):a.jsx("ul",{className:"list-disc list-inside space-y-2",children:o.map((y,v)=>a.jsx("li",{className:"flex items-start",children:l?a.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[a.jsx(Yf,{checked:y.checked||!1,disabled:!0,className:"mt-0.5"}),a.jsx("span",{className:y.checked?"line-through text-gray-500":"",children:y.text||`Item ${v+1}`})]}):a.jsx("span",{className:"ml-4",children:y.text||`Item ${v+1}`})},y.id))})}):a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(_t,{htmlFor:"list-type",children:"List Type"}),a.jsxs(ec,{value:s,onValueChange:c,children:[a.jsx(Da,{className:"mt-1",children:a.jsx(tc,{placeholder:"Select list type"})}),a.jsxs(La,{children:[a.jsx(kt,{value:"unordered",children:"Bulleted List"}),a.jsx(kt,{value:"ordered",children:"Numbered List"})]})]})]}),a.jsx("div",{className:"flex items-end",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Yf,{id:"checklist-style",checked:l,onCheckedChange:u}),a.jsx(_t,{htmlFor:"checklist-style",className:"text-sm",children:"Interactive Checklist"})]})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(_t,{children:"List Items"}),a.jsxs(fe,{size:"sm",onClick:p,children:[a.jsx(Vt,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),o.map((y,v)=>a.jsxs("div",{className:"flex items-center space-x-2 group",children:[a.jsx("div",{className:"flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:a.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>x(v),disabled:v===0,className:"h-8 w-8 p-0",children:a.jsx(DB,{className:"h-4 w-4"})})}),l&&a.jsx(Yf,{checked:y.checked||!1,onCheckedChange:b=>d(y.id,b)}),a.jsx(ct,{value:y.text,onChange:b=>f(y.id,b.target.value),placeholder:`Item ${v+1}...`,className:"flex-1"}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>m(y.id),disabled:o.length<=1,className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-opacity",children:a.jsx(RO,{className:"h-4 w-4"})})]},y.id))]})]})}function dEe({block:t,onContentChange:e,onConfigChange:r,isPreview:n}){const i=t.content||{},s=i.text||"",o=i.author||"",l=i.source||"",c=d=>{e({...i,text:d})},u=d=>{e({...i,author:d})},f=d=>{e({...i,source:d})};return n?a.jsx("div",{className:"p-4",children:a.jsxs("blockquote",{className:"border-l-4 border-blue-500 bg-blue-50 p-4 italic",children:[a.jsxs("p",{className:"text-gray-800 text-lg mb-2",children:['"',s||"Enter your quote text...",'"']}),(o||l)&&a.jsxs("footer",{className:"text-gray-600 text-sm",children:[o&&a.jsx("span",{className:"font-medium",children:o}),o&&l&&a.jsx("span",{children:", "}),l&&a.jsx("cite",{className:"not-italic",children:l})]})]})}):a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx(_t,{htmlFor:"quote-text",children:"Quote Text"}),a.jsx(Ai,{id:"quote-text",value:s,onChange:d=>c(d.target.value),placeholder:"Enter the quote text...",className:"mt-1 min-h-[100px]"})]}),a.jsxs("div",{children:[a.jsx(_t,{htmlFor:"quote-author",children:"Author (optional)"}),a.jsx(ct,{id:"quote-author",value:o,onChange:d=>u(d.target.value),placeholder:"Quote author...",className:"mt-1"})]}),a.jsxs("div",{children:[a.jsx(_t,{htmlFor:"quote-source",children:"Source (optional)"}),a.jsx(ct,{id:"quote-source",value:l,onChange:d=>f(d.target.value),placeholder:"Source or publication...",className:"mt-1"})]})]})}function fEe({block:t,onContentChange:e,onConfigChange:r,isPreview:n}){return Z.createElement("div",{className:"p-4 text-center text-gray-500"},Z.createElement("p",null,"Document editor coming soon"),Z.createElement("p",{className:"text-sm"},"This will integrate with the document repository"))}function hEe({block:t,onContentChange:e,onConfigChange:r,isPreview:n}){return Z.createElement("div",{className:"p-4 text-center text-gray-500"},Z.createElement("p",null,"Prompt editor coming soon"),Z.createElement("p",{className:"text-sm"},"This will integrate with the prompts repository"))}function pEe({block:t,onContentChange:e,onConfigChange:r,isPreview:n}){return Z.createElement("div",{className:"p-4 text-center text-gray-500"},Z.createElement("p",null,"Automation editor coming soon"),Z.createElement("p",{className:"text-sm"},"This will integrate with the automations repository"))}function mEe({block:t,onContentChange:e,onConfigChange:r,isPreview:n}){return Z.createElement("div",{className:"p-4 text-center text-gray-500"},Z.createElement("p",null,"Quiz editor coming soon"),Z.createElement("p",{className:"text-sm"},"This will include question creation and scoring"))}function gEe({block:t,onContentChange:e,onConfigChange:r,isPreview:n}){return Z.createElement("div",{className:"p-4 text-center text-gray-500"},Z.createElement("p",null,"Accordion editor coming soon"),Z.createElement("p",{className:"text-sm"},"This will create expandable sections"))}function yEe({block:t,onContentChange:e,onConfigChange:r,isPreview:n}){return Z.createElement("div",{className:"p-4 text-center text-gray-500"},Z.createElement("p",null,"User submission editor coming soon"),Z.createElement("p",{className:"text-sm"},"This will create forms for user data collection"))}function Fk(){const{type:t,id:e}=us(),r=Ti(),{user:n}=Ln(),{structure:i,currentPage:s,selectedBlock:o,isEditing:l,previewMode:c,loading:u,error:f,loadStructure:d,createPage:p,updatePage:m,navigateToPage:x,createBlock:y,updateBlock:v,deleteBlock:b,reorderBlocks:w,setSelectedBlock:N,setIsEditing:j,setPreviewMode:k}=C8(t==="wods"?"mission":"course",e||""),_=O.useCallback(async Ae=>{var ut,wt;if(!i)return;const Me=t==="wods",Re=Me?qf:zf,sr=Me?(ut=i.mission)==null?void 0:ut.id:(wt=i.course)==null?void 0:wt.id;if(!sr)throw new Error("Parent ID not found");try{await Re.update(sr,Ae),await d()}catch(ci){throw console.error("Failed to update structure:",ci),ci}},[i,t,d]),{trackProgress:E}=A8(t==="wods"?"mission":"course",e||""),[A,T]=O.useState("desktop"),[M,P]=O.useState(!1),[R,L]=O.useState({isOpen:!1}),[$,F]=O.useState(!1),[z,W]=O.useState("idle"),[K,q]=O.useState(null),[V,D]=O.useState(null),[U,G]=O.useState(null),ee=Fx(Bx(Ad,{activationConstraint:{distance:8}})),Q=O.useRef(!0),H=O.useRef(null),Y=O.useMemo(()=>s?{id:s.id,title:s.title,description:s.description,status:s.status,is_locked:s.is_locked,unlock_conditions:s.unlock_conditions,page_config:s.page_config,order_index:s.order_index}:null,[s==null?void 0:s.id,s==null?void 0:s.title,s==null?void 0:s.description,s==null?void 0:s.status]);O.useEffect(()=>{e&&Q.current&&d(!0)},[e,d]),O.useEffect(()=>()=>{Q.current=!1,H.current&&H.current.abort()},[]);const re=O.useCallback(async Ae=>{if(!s||!Q.current){console.warn("Cannot add block - no current page or component unmounted");return}try{const Me=Xye[Ae];if(!Me)throw new Error(`Unknown block type: ${Ae}`);console.log("Creating block of type:",Ae);const Re=await y(Ae,Me.defaultContent||{});Re&&Q.current&&(N(Re),P(!0),j(!0),E({progressType:"block_interacted",pageId:s.id,progressData:{action:"block_created",blockType:Ae}}))}catch(Me){console.error("Failed to add block:",Me),q(Me instanceof Error?Me.message:"Failed to add block"),W("error")}},[s,y,E,N,j]),J=O.useCallback(async(Ae,Me)=>{new AbortController;try{await v(Ae,{content:Me}),Q.current&&j(!0)}catch(Re){Re.name!=="AbortError"&&(console.error("Failed to update block content:",Re),q(Re instanceof Error?Re.message:"Failed to update block"),W("error"))}},[v,j]),ne=O.useCallback(Ae=>{Q.current&&(N(Ae),P(!0),j(!1))},[N,j]),te=O.useCallback(Ae=>{Q.current&&(N(Ae),P(!0),j(!0))},[N,j]),se=O.useCallback(async(Ae,Me)=>{new AbortController;try{await v(Ae,Me),Q.current&&j(!0)}catch(Re){Re.name!=="AbortError"&&(console.error("Failed to update block:",Re),q(Re instanceof Error?Re.message:"Failed to update block"),W("error"))}},[v,j]),ve=O.useCallback(Ae=>{L({isOpen:!0,blockId:Ae})},[]),ie=O.useCallback(async()=>{if(!R.blockId||!Q.current)return;const Ae=new AbortController,Me=setTimeout(()=>{Ae.abort(),q("Delete operation timed out - please try again"),W("error")},1e4);try{await b(R.blockId),clearTimeout(Me),L({isOpen:!1}),(o==null?void 0:o.id)===R.blockId&&(N(null),P(!1))}catch(Re){clearTimeout(Me),Re.name!=="AbortError"&&(console.error("Failed to delete block:",Re),q(Re instanceof Error?Re.message:"Failed to delete block"),W("error"))}},[R.blockId,b,o,N]),ye=O.useCallback(async Ae=>{new AbortController;try{await w(Ae),Q.current&&j(!0)}catch(Me){Me.name!=="AbortError"&&(console.error("Failed to reorder blocks:",Me),q(Me instanceof Error?Me.message:"Failed to reorder blocks"),W("error"))}},[w,j]),Te=O.useCallback(async()=>{if(!Y||!Q.current){console.warn("Save attempted without valid page data");return}if(H.current){console.log("Save operation already in progress");return}W("saving"),F(!0),q(null);const Ae=new AbortController;H.current=Ae;try{console.log("Saving WOD page data:",Y.title),await m(Y),Q.current&&(W("saved"),j(!1),H.current=null,console.log("WOD saved successfully - staying on current page"),setTimeout(()=>{Q.current&&z!=="saving"&&W("idle")},3e3))}catch(Me){if(Me.name!=="AbortError"&&Q.current){console.error("Save failed:",Me);const Re=Me instanceof Error?Me.message:"Failed to save";q(Re),W("error"),H.current=null,setTimeout(()=>{Q.current&&(q(null),W("idle"))},1e4)}}finally{Q.current&&F(!1)}},[Y,m,j,z]),Le=O.useCallback(()=>{Q.current&&(k(!c),c||P(!1))},[c,k]),ue=O.useCallback(async()=>{if(!i||!Q.current)return;const Ae=new AbortController,Me=setTimeout(()=>{Ae.abort(),q("Page creation timed out - please try again"),W("error")},15e3);try{const Re=i.pages.length+1,sr=await p({title:`Page ${Re}`,description:"",is_locked:!1,status:"draft"});clearTimeout(Me),sr&&Q.current&&x(sr)}catch(Re){clearTimeout(Me),Re.name!=="AbortError"&&(console.error("Failed to create page:",Re),q(Re instanceof Error?Re.message:"Failed to create page"),W("error"))}},[i,p,x]),he=O.useCallback(Ae=>{const Me=i==null?void 0:i.pages.find(Re=>Re.id===Ae);Me&&Q.current&&(x(Me),P(!1),N(null))},[i==null?void 0:i.pages,x,N]),we=O.useCallback(Ae=>{const{active:Me}=Ae;if(D(Me.id),s!=null&&s.blocks){const Re=s.blocks.find(sr=>sr.id===Me.id);G(Re||null)}},[s==null?void 0:s.blocks]),Oe=O.useCallback(Ae=>{var sr;const{active:Me,over:Re}=Ae;if(D(null),G(null),!!Re){if(((sr=Me.data.current)==null?void 0:sr.type)==="block-type"){const ut=Me.data.current.blockType;re(ut);return}if(Me.id!==Re.id&&(s!=null&&s.blocks)){const ut=s.blocks.findIndex(ci=>ci.id===Me.id),wt=s.blocks.findIndex(ci=>ci.id===Re.id);if(ut!==-1&&wt!==-1){const dc=Td(s.blocks,ut,wt).map(fc=>fc.id);ye(dc)}}}},[s==null?void 0:s.blocks,re,ye]),be=O.useCallback(()=>{if(!o)return null;const Ae={block:o,onContentChange:Me=>{J(o.id,Me)},onConfigChange:Me=>{se(o.id,{config:Me})},isPreview:!1};switch(o.block_type){case"rich_text":return a.jsx(QOe,{...Ae});case"section_header":return a.jsx(JOe,{...Ae});case"image":return a.jsx(ZOe,{...Ae});case"video":return a.jsx(eEe,{...Ae});case"agent":return a.jsx(tEe,{...Ae});case"list":return a.jsx(uEe,{...Ae});case"quote":return a.jsx(dEe,{...Ae});case"document":return a.jsx(fEe,{...Ae});case"prompt":return a.jsx(hEe,{...Ae});case"automation":return a.jsx(pEe,{...Ae});case"quiz":return a.jsx(mEe,{...Ae});case"accordion":return a.jsx(gEe,{...Ae});case"user_submission":return a.jsx(yEe,{...Ae});default:return a.jsxs("div",{className:"p-4 text-center text-gray-500",children:[a.jsxs("p",{children:["Editor not available for ",o.block_type]}),a.jsx("p",{className:"text-sm",children:"Using fallback to generic editor"})]})}},[o,J,se]),We=()=>{switch(A){case"mobile":return"max-w-sm mx-auto";case"tablet":return"max-w-2xl mx-auto";case"desktop":default:return"max-w-full"}},Je=Ae=>{switch(Ae){case"mobile":return UX;case"tablet":return HX;case"desktop":return $X}};if(u)return a.jsx("div",{className:"h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading WOD builder..."})]})});if(f||!i)return a.jsx("div",{className:"h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-8 max-w-md",children:[a.jsx(ql,{className:"h-8 w-8 text-red-600 mx-auto mb-4"}),a.jsxs("p",{className:"text-red-800 text-center mb-4",children:["Error: ",f||"Failed to load content"]}),a.jsxs(fe,{onClick:()=>r("/training-zone"),variant:"outline",className:"w-full",children:[a.jsx(lo,{className:"h-4 w-4 mr-2"}),"Back to Training Zone"]})]})});const Ye=t==="wods"?i.mission:i.course;return Ye?a.jsxs("div",{className:"h-screen bg-gray-50 flex overflow-hidden",children:[!c&&a.jsx(XOe,{onBlockAdd:re,onPageCreate:ue,onPageSelect:he,pages:i.pages.map(Ae=>{var Me;return{id:Ae.id,title:Ae.title,blocks:((Me=Ae.blocks)==null?void 0:Me.length)||0}}),currentPageId:s==null?void 0:s.id,structure:Ye,onSave:Te,onPreview:Le,isPreviewMode:c,onStructureUpdate:_}),a.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",style:{marginLeft:c?"0":"64px"},children:[a.jsxs("div",{className:"bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between flex-shrink-0",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs(fe,{variant:"ghost",size:"sm",onClick:()=>r("/training-zone"),className:"text-gray-600 hover:text-gray-900",children:[a.jsx(lo,{className:"h-4 w-4 mr-2"}),"Back to Training Zone"]}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:Ye.title}),a.jsxs("p",{className:"text-sm text-gray-600",children:[Ye.status," • ",i.pages.length," pages",s&&` • Page: ${s.title}`]})]})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[!c&&a.jsx("div",{className:"flex items-center border border-gray-200 rounded-lg",children:["desktop","tablet","mobile"].map(Ae=>{const Me=Je(Ae);return a.jsx(fe,{variant:A===Ae?"default":"ghost",size:"sm",onClick:()=>T(Ae),className:"rounded-none first:rounded-l-lg last:rounded-r-lg",children:a.jsx(Me,{className:"h-4 w-4"})},Ae)})}),a.jsxs("div",{className:"flex items-center space-x-2",children:[z==="saving"&&a.jsxs("div",{className:"flex items-center text-blue-600 text-sm",children:[a.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b border-blue-600 mr-2"}),"Saving..."]}),z==="saved"&&a.jsxs("div",{className:"flex items-center text-green-600 text-sm",children:[a.jsx(ln,{className:"h-3 w-3 mr-1"}),"Saved"]}),z==="error"&&K&&a.jsxs("div",{className:"flex items-center text-red-600 text-sm",children:[a.jsx(ql,{className:"h-3 w-3 mr-1"}),K]}),l&&z==="idle"&&a.jsx(At,{variant:"outline",className:"text-orange-600",children:"Unsaved Changes"})]}),a.jsx(fe,{variant:c?"default":"outline",size:"sm",onClick:Le,className:"min-w-[100px]",children:c?a.jsxs(a.Fragment,{children:[a.jsx(TO,{className:"h-4 w-4 mr-2"}),"Exit Preview"]}):a.jsxs(a.Fragment,{children:[a.jsx(ii,{className:"h-4 w-4 mr-2"}),"Preview"]})}),a.jsxs(fe,{onClick:Te,disabled:$||!l,size:"sm",className:"min-w-[80px]",children:[$?a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b border-white mr-2"}):a.jsx(Cp,{className:"h-4 w-4 mr-2"}),"Save"]})]})]}),a.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[a.jsx("div",{className:ge("flex-1 overflow-auto",c&&"bg-white",!c&&M&&"mr-96"),children:a.jsx("div",{className:ge("min-h-full",We()),children:a.jsx(Ux,{sensors:ee,onDragStart:we,onDragEnd:Oe,children:a.jsx("div",{className:ge("min-h-full",c?"bg-white":"bg-gray-50 p-8"),children:s?a.jsx("div",{className:ge("bg-white rounded-lg shadow-sm",c?"min-h-screen":"min-h-[600px] p-6"),children:s.blocks&&s.blocks.length>0?a.jsx(Wx,{items:s.blocks.map(Ae=>Ae.id),strategy:Hx,children:a.jsx("div",{className:"space-y-4",children:s.blocks.map(Ae=>a.jsxs("div",{className:ge("group relative",!c&&"border border-transparent hover:border-gray-300 rounded-lg transition-colors",(o==null?void 0:o.id)===Ae.id&&!c&&"border-blue-500 bg-blue-50/50"),onClick:()=>!c&&ne(Ae),children:[!c&&a.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:a.jsxs("div",{className:"flex items-center space-x-1 bg-white border border-gray-200 rounded-lg shadow-sm p-1",children:[a.jsx(fe,{variant:"ghost",size:"sm",onClick:Me=>{Me.stopPropagation(),te(Ae)},className:"h-6 w-6 p-0",children:a.jsx(FX,{className:"h-3 w-3"})}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:Me=>{Me.stopPropagation(),ve(Ae.id)},className:"h-6 w-6 p-0 text-red-600 hover:text-red-700",children:a.jsx(ns,{className:"h-3 w-3"})})]})}),a.jsx(tW,{block:Ae,isEditing:!c&&(o==null?void 0:o.id)===Ae.id,isSelected:(o==null?void 0:o.id)===Ae.id,onContentChange:(Me,Re)=>J(Me,Re)})]},Ae.id))})}):a.jsx("div",{className:"flex items-center justify-center py-20",children:a.jsxs("div",{className:"text-center",children:[a.jsx(Sh,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),a.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:["Start building your ",t==="wods"?"WOD":"block"]}),a.jsx("p",{className:"text-gray-500 mb-6",children:"Add blocks from the left panel to create engaging content"}),a.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Use the left sidebar to add blocks and manage content"})]})})}):a.jsx("div",{className:"flex items-center justify-center py-20",children:a.jsxs("div",{className:"text-center",children:[a.jsx(Ot,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No page selected"}),a.jsx("p",{className:"text-gray-500",children:"Select a page from the pages panel to start editing"})]})})})})})}),!c&&M&&o&&a.jsxs("div",{className:"w-96 bg-white border-l border-gray-200 flex flex-col h-full",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[(()=>{const Ae=(()=>{switch(o.block_type){case"section_header":return IX;case"rich_text":return DO;case"list":return rs;case"quote":return xy;case"image":return Eu;case"video":return si;case"agent":return Kr;case"document":return Ot;case"prompt":return Gr;case"automation":return Ei;case"quiz":return AO;case"user_submission":return Ir;default:return Dn}})();return a.jsx(Ae,{className:"h-5 w-5 text-gray-600"})})(),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:(()=>{switch(o.block_type){case"section_header":return"Section Header";case"rich_text":return"Rich Text";case"list":return"List";case"quote":return"Quote";case"image":return"Image";case"video":return"Video";case"agent":return"AI Agent";case"document":return"Document";case"prompt":return"Prompts";case"automation":return"Automation";case"quiz":return"Quiz";case"user_submission":return"User Form";default:return"Block"}})()}),a.jsx("p",{className:"text-sm text-gray-500",children:"Configure block content and settings"})]})]}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>P(!1),className:"h-8 w-8 p-0",children:a.jsx($r,{className:"h-4 w-4"})})]}),a.jsx("div",{className:"flex-1 overflow-auto",children:be()})]})]})]}),a.jsx(T8,{isOpen:R.isOpen,onClose:()=>L({isOpen:!1}),onConfirm:ie,title:"Delete Block",message:"Are you sure you want to delete this block? This action cannot be undone.",confirmText:"Delete",variant:"destructive"})]}):a.jsx("div",{className:"h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-8 max-w-md",children:[a.jsx("p",{className:"text-red-800 text-center mb-4",children:"Content not found"}),a.jsxs(fe,{onClick:()=>r("/training-zone"),variant:"outline",className:"w-full",children:[a.jsx(lo,{className:"h-4 w-4 mr-2"}),"Back to Training Zone"]})]})})}function vEe({value:t=0,max:e=100,className:r,...n}){const i=Math.min(Math.max(t/e*100,0),100);return a.jsx("div",{className:ge("relative h-2 w-full overflow-hidden rounded-full bg-gray-200",r),...n,children:a.jsx("div",{className:"h-full bg-blue-600 transition-all duration-300 ease-in-out",style:{width:`${i}%`}})})}function xEe(){const{type:t,id:e}=us(),r=Ti(),{user:n}=Ln(),{structure:i,currentPage:s,loading:o,error:l,loadStructure:c,navigateToPageIndex:u}=C8(t==="missions"?"mission":"course",e||""),{progressMetrics:f,trackProgress:d}=A8(t==="missions"?"mission":"course",e||""),[p,m]=O.useState(!1),[x,y]=O.useState(0),[v,b]=O.useState(null);O.useEffect(()=>{e&&n&&(c(!0),b(new Date))},[e,n,c]),O.useEffect(()=>{s&&n&&d({progressType:"page_started",pageId:s.id,progressData:{timestamp:new Date().toISOString(),pageIndex:x}})},[s,n,d,x]),O.useEffect(()=>()=>{if(v&&s&&n){const T=Math.floor((new Date().getTime()-v.getTime())/1e3);T>10&&d({progressType:"page_completed",pageId:s.id,completionPercentage:100,timeSpent:T,progressData:{completed:!0,endTime:new Date().toISOString()}})}},[v,s,n,d]);const w=()=>{if(x>0){const T=x-1;y(T),u(T),b(new Date)}},N=()=>{if(i&&x<i.pages.length-1){const T=x+1;y(T),u(T),b(new Date)}},j=T=>{y(T),u(T),m(!1),b(new Date)},k=(T,M)=>{n&&s&&d({progressType:"block_interacted",pageId:s.id,blockId:T,progressData:{interactionProgress:M,timestamp:new Date().toISOString()}})},_=T=>f.lastActivity?f.lastActivity.page_id===T.id&&f.lastActivity.progress_type==="page_completed":!1,E=()=>i!=null&&i.pages.length?f.completedPages/i.pages.length*100:0;if(o)return a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading your learning experience..."})]})});if(l||!i)return a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-red-500 mb-4",children:a.jsx(Zn,{className:"w-12 h-12 mx-auto"})}),a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Content not available"}),a.jsx("p",{className:"text-gray-600 mb-6",children:l||"The requested content could not be found."}),a.jsx(fe,{onClick:()=>r("/dashboard"),variant:"outline",children:"Return to Dashboard"})]})});const A=t==="missions"?i.mission:i.course;return A?a.jsxs("div",{className:"min-h-screen bg-white",children:[a.jsxs("div",{className:"sticky top-0 z-40 bg-white border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>m(!0),className:"md:hidden",children:a.jsx(LX,{className:"w-5 h-5"})}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:a.jsx(Zn,{className:"w-4 h-4 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"font-semibold text-gray-900 text-sm md:text-base truncate max-w-48",children:A.title}),a.jsxs("p",{className:"text-xs text-gray-500",children:[x+1," of ",i.pages.length]})]})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("div",{className:"text-right hidden sm:block",children:[a.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[Math.round(E()),"% Complete"]}),a.jsxs("div",{className:"text-xs text-gray-500",children:[f.completedPages," of ",i.pages.length," pages"]})]}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>r("/dashboard"),children:"Exit"})]})]}),a.jsx("div",{className:"px-4 pb-3",children:a.jsx(vEe,{value:E(),className:"h-2"})})]}),a.jsxs("div",{className:"flex",children:[a.jsx("div",{className:"hidden md:block w-80 bg-gray-50 border-r border-gray-200 h-screen sticky top-16 overflow-y-auto",children:a.jsxs("div",{className:"p-4",children:[a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[a.jsx(At,{variant:A.status==="published"?"default":"secondary",children:A.status}),A.difficulty_level&&a.jsx(At,{variant:"outline",children:A.difficulty_level})]}),A.description&&a.jsx("p",{className:"text-sm text-gray-600 mb-3",children:A.description}),a.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[A.estimated_duration_minutes&&a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(go,{className:"w-3 h-3"}),a.jsxs("span",{children:[A.estimated_duration_minutes,"min"]})]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(TX,{className:"w-3 h-3"}),a.jsxs("span",{children:[f.completedPages," completed"]})]})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Pages"}),a.jsx("nav",{className:"space-y-1",children:i.pages.map((T,M)=>{const P=_(T),R=M===x;return a.jsxs("button",{onClick:()=>j(M),className:ge("w-full text-left px-3 py-2 rounded-md text-sm transition-colors flex items-center space-x-2",R?"bg-blue-100 text-blue-900 font-medium":"text-gray-700 hover:bg-gray-200"),disabled:T.is_locked,children:[a.jsx("div",{className:"flex-shrink-0",children:P?a.jsx(ln,{className:"w-4 h-4 text-green-500"}):a.jsx(vM,{className:ge("w-4 h-4",R?"text-blue-600":"text-gray-400")})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:ge("truncate",T.is_locked?"text-gray-400":""),children:T.title}),T.description&&a.jsx("div",{className:"text-xs text-gray-500 truncate",children:T.description})]}),a.jsx("div",{className:"text-xs text-gray-400",children:M+1})]},T.id)})})]})]})}),p&&a.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:()=>m(!1)}),a.jsxs("div",{className:"fixed left-0 top-0 bottom-0 w-80 bg-white",children:[a.jsx("div",{className:"p-4 border-b border-gray-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"font-semibold text-gray-900",children:"Navigation"}),a.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>m(!1),children:a.jsx($r,{className:"w-5 h-5"})})]})}),a.jsxs("div",{className:"p-4 overflow-y-auto h-full",children:[a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[a.jsx(At,{variant:A.status==="published"?"default":"secondary",children:A.status}),A.difficulty_level&&a.jsx(At,{variant:"outline",children:A.difficulty_level})]}),A.description&&a.jsx("p",{className:"text-sm text-gray-600 mb-3",children:A.description})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Pages"}),a.jsx("nav",{className:"space-y-1",children:i.pages.map((T,M)=>{const P=_(T),R=M===x;return a.jsxs("button",{onClick:()=>j(M),className:ge("w-full text-left px-3 py-2 rounded-md text-sm transition-colors flex items-center space-x-2",R?"bg-blue-100 text-blue-900 font-medium":"text-gray-700 hover:bg-gray-200"),disabled:T.is_locked,children:[a.jsx("div",{className:"flex-shrink-0",children:P?a.jsx(ln,{className:"w-4 h-4 text-green-500"}):a.jsx(vM,{className:ge("w-4 h-4",R?"text-blue-600":"text-gray-400")})}),a.jsx("div",{className:"flex-1 min-w-0",children:a.jsx("div",{className:ge("truncate",T.is_locked?"text-gray-400":""),children:T.title})}),a.jsx("div",{className:"text-xs text-gray-400",children:M+1})]},T.id)})})]})]})]})]}),a.jsx("div",{className:"flex-1 min-h-screen",children:s?a.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:s.title}),s.description&&a.jsx("p",{className:"text-lg text-gray-600 leading-relaxed",children:s.description})]}),a.jsx("div",{className:"space-y-8 mb-12",children:s.blocks&&s.blocks.length>0?s.blocks.filter(T=>T.is_visible).map(T=>a.jsx(tW,{block:T,onProgress:k,userContext:{userId:n==null?void 0:n.id,progress:f,learningMode:!0}},T.id)):a.jsxs("div",{className:"text-center py-16",children:[a.jsx(Zn,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500",children:"This page doesn't have any content yet."})]})}),a.jsx("div",{className:"border-t border-gray-200 pt-8",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(fe,{variant:"outline",onClick:w,disabled:x===0,className:"flex items-center space-x-2",children:[a.jsx(r_,{className:"w-4 h-4"}),a.jsx("span",{children:"Previous"})]}),a.jsx("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:a.jsxs("span",{children:["Page ",x+1," of ",i.pages.length]})}),a.jsxs(fe,{onClick:N,disabled:x===i.pages.length-1,className:"flex items-center space-x-2",children:[a.jsx("span",{children:"Next"}),a.jsx(jh,{className:"w-4 h-4"})]})]})})]}):a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsx("p",{className:"text-gray-500",children:"No content available"})})})]})]}):a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsx("div",{className:"text-center",children:a.jsx("p",{className:"text-red-600",children:"Content not found"})})})}function bEe(){const[t,e]=O.useState(!1),[r,n]=O.useState("video"),[i,s]=O.useState([]),o=[{type:"video",label:"Videos",icon:si,color:"#EF4444",description:"Educational videos with transcriptions"},{type:"ai_agent",label:"AI Agents",icon:Kr,color:"#3B82F6",description:"Intelligent AI agents with custom prompts"},{type:"document",label:"Documents",icon:Ot,color:"#10B981",description:"Rich text documents and guides"},{type:"prompt",label:"Prompts",icon:Gr,color:"#8B5CF6",description:"Reusable prompt templates"},{type:"automation",label:"Automations",icon:Ei,color:"#F59E0B",description:"Process automations and workflows"}],l=p=>{n(p),e(!0)},c=p=>{const m={type:r,item:p};s(x=>[...x.filter(v=>!(v.type===r&&v.item.id===p.id)),m]),e(!1)},u=(p,m)=>{s(x=>x.filter(y=>!(y.type===p&&y.item.id===m)))},f=p=>o.find(m=>m.type===p),d=p=>{const m=f(p.type),{item:x}=p,y=uy.generatePreviewText(x);return a.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:m.color+"15"},children:a.jsx(m.icon,{className:"w-5 h-5",style:{color:m.color}})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:x.title}),a.jsx("button",{onClick:()=>u(p.type,x.id),className:"text-red-500 hover:text-red-700 text-sm ml-2",children:"Remove"})]}),a.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:y}),a.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-xs text-gray-500",children:[a.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",style:{backgroundColor:m.color+"10",color:m.color},children:m.label.slice(0,-1)}),a.jsxs("span",{children:["Updated ",new Date(x.updated_at).toLocaleDateString()]}),a.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${x.status==="published"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:x.status})]})]})]})},`${p.type}-${x.id}`)};return a.jsx(pr,{children:a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-6",children:a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"h-12 w-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center",children:a.jsx(wM,{className:"h-6 w-6 text-white"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Content Selector System Demo"}),a.jsx("p",{className:"text-gray-600 mt-1",children:"Demonstrating the reusable Content Selector Modal for all content types"})]})]})}),a.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Select Content Type"}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:o.map(p=>{const m=p.icon;return a.jsx("button",{onClick:()=>l(p.type),className:"p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-all text-left group",children:a.jsxs("div",{className:"flex flex-col items-center text-center space-y-2",children:[a.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform",style:{backgroundColor:p.color+"15"},children:a.jsx(m,{className:"w-6 h-6",style:{color:p.color}})}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-gray-900",children:p.label}),a.jsx("div",{className:"text-xs text-gray-500 mt-1",children:p.description})]})]})},p.type)})})]}),a.jsxs("div",{className:"mb-8",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Selected Content"}),a.jsxs("div",{className:"text-sm text-gray-500",children:[i.length," ",i.length===1?"item":"items"," selected"]})]}),i.length===0?a.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-12 text-center",children:[a.jsx(wM,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Content Selected"}),a.jsx("p",{className:"text-gray-600",children:"Click on any content type above to open the Content Selector Modal and choose items from your repositories."})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(d)})]}),a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:"Demo Features"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Content Selector Modal"}),a.jsxs("ul",{className:"text-blue-700 space-y-1",children:[a.jsx("li",{children:"• Unified interface for all content types"}),a.jsx("li",{children:"• Search and filter capabilities"}),a.jsx("li",{children:"• Card and list view modes"}),a.jsx("li",{children:"• Pagination for large datasets"})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Content Integration"}),a.jsxs("ul",{className:"text-blue-700 space-y-1",children:[a.jsx("li",{children:"• Type-specific metadata display"}),a.jsx("li",{children:"• Status and update information"}),a.jsx("li",{children:"• Reusable across all block types"}),a.jsx("li",{children:"• Error handling and loading states"})]})]})]})]}),a.jsxs("div",{className:"mt-6 bg-gray-50 rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"How It Works"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 text-sm text-gray-700",children:[a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:a.jsx("span",{className:"text-blue-600 font-semibold",children:"1"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Select Content Type"}),a.jsx("p",{children:"Click any content type button to open the selector modal for that specific repository."})]})]}),a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:a.jsx("span",{className:"text-blue-600 font-semibold",children:"2"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Browse & Search"}),a.jsx("p",{children:"Use the search, filters, and view modes to find the content you need from the repository."})]})]}),a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:a.jsx("span",{className:"text-blue-600 font-semibold",children:"3"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Select & Use"}),a.jsx("p",{children:'Click on any item to select it. The selected content will appear in the "Selected Content" section below.'})]})]})]})]})]}),a.jsx(GC,{isOpen:t,onClose:()=>e(!1),onSelect:c,contentType:r})]})})}function wEe(){return a.jsx(Nh,{onError:(t,e)=>{console.group("🚨 Application Error"),console.error("App-level error:",t),console.error("Error info:",e),console.groupEnd(),console.warn("Production error reporting not configured")},children:a.jsx(EX,{children:a.jsx(bG,{children:a.jsx("div",{className:"App",children:a.jsx(Nh,{children:a.jsxs(hG,{children:[a.jsx(rt,{path:"/login",element:a.jsx(_J,{})}),a.jsx(rt,{path:"/",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(da,{to:"/dashboard",replace:!0})})}),a.jsx(rt,{path:"/dashboard",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(mge,{})})}),a.jsx(rt,{path:"/clients",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(yge,{})})}),a.jsx(rt,{path:"/clients/:clientId",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(Sge,{})})}),a.jsx(rt,{path:"/users/:userId",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(Nge,{})})}),a.jsx(rt,{path:"/users",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(vge,{})})}),a.jsx(rt,{path:"/tags",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(wge,{})})}),a.jsx(rt,{path:"/content",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(_ge,{})})}),a.jsx(rt,{path:"/content/articles",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(Oge,{})})}),a.jsx(rt,{path:"/content/ai-agents",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(Ege,{})})}),a.jsx(rt,{path:"/content/videos",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(Cge,{})})}),a.jsx(rt,{path:"/content/documents",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(Age,{})})}),a.jsx(rt,{path:"/content/prompts",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(Tge,{})})}),a.jsx(rt,{path:"/content/automations",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(Pge,{})})}),a.jsx(rt,{path:"/content/articles/create",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(A5,{})})}),a.jsx(rt,{path:"/content/articles/:id/edit",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(A5,{})})}),a.jsx(rt,{path:"/content/ai-agents/create",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(L5,{})})}),a.jsx(rt,{path:"/content/ai-agents/:id/edit",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(L5,{})})}),a.jsx(rt,{path:"/content/videos/create",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx($5,{})})}),a.jsx(rt,{path:"/content/videos/:id/edit",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx($5,{})})}),a.jsx(rt,{path:"/content/documents/create",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(q5,{})})}),a.jsx(rt,{path:"/content/documents/:id/edit",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(q5,{})})}),a.jsx(rt,{path:"/content/prompts/create",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(z5,{})})}),a.jsx(rt,{path:"/content/prompts/:id/edit",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(z5,{})})}),a.jsx(rt,{path:"/content/automations/create",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(U5,{})})}),a.jsx(rt,{path:"/content/automations/:id/edit",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(U5,{})})}),a.jsx(rt,{path:"/training-zone",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(Yye,{})})}),a.jsx(rt,{path:"/wod-builder",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(Fk,{})})}),a.jsx(rt,{path:"/training-zone/:type/:id",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(Fk,{})})}),a.jsx(rt,{path:"/training-zone/legacy/:type/:id",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(Fk,{})})}),a.jsx(rt,{path:"/page-builder",element:a.jsx(da,{to:"/training-zone",replace:!0})}),a.jsx(rt,{path:"/page-builder/*",element:a.jsx(da,{to:"/training-zone",replace:!0})}),a.jsx(rt,{path:"/mission-builder-v4",element:a.jsx(da,{to:"/wod-builder",replace:!0})}),a.jsx(rt,{path:"/demo/content-selector",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(bEe,{})})}),a.jsx(rt,{path:"/learn/:type/:id",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(xEe,{})})}),a.jsx(rt,{path:"/sandbox",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"AI Sandbox"}),a.jsx("p",{className:"text-gray-600",children:"Interactive learning environment coming soon..."})]})})})}),a.jsx(rt,{path:"/admin",element:a.jsx(da,{to:"/dashboard",replace:!0})}),a.jsx(rt,{path:"/settings",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Settings"}),a.jsx("p",{className:"text-gray-600",children:"Settings page coming soon..."})]})})})}),a.jsx(rt,{path:"/logout",element:a.jsx(ft,{requireAdmin:!0,children:a.jsx(kge,{})})}),a.jsx(rt,{path:"*",element:a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Page Not Found"}),a.jsx("p",{className:"text-gray-600",children:"The page you're looking for doesn't exist."})]})})})]})})})})})})}jK.createRoot(document.getElementById("root")).render(a.jsx(Z.StrictMode,{children:a.jsx(wEe,{})}));
